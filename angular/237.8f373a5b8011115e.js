"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[237],{1643:(Q,L,m)=>{m.d(L,{p:()=>x});var S=m(55330),t=m(94650),z=m(63382),I=m(51009),A=m(36895),R=m(1033);function O(i,_){if(1&i&&(t.TgZ(0,"h3",6),t._uU(1),t.qZA()),2&i){const n=t.oxw(3);t.xp6(1),t.Oqu(n.title)}}const F=function(i){return{"rotated-img":i}},D=function(i,_,n,s){return{"width.px":i,"height.px":_,"aspect-ratio":n,transform:s}};function W(i,_){if(1&i&&(t._UZ(0,"img",10),t.ALo(1,"mycdn")),2&i){const n=t.oxw(2).$implicit,s=t.oxw(2);t.s9C("src",t.lcZ(1,4,n.backgroundImage),t.LSH),t.Q6J("ngClass",t.VKq(6,F,s.isRightRotation(n.rotation||0)))("ngStyle",t.l5B(8,D,(n.width||0)<(n.height||0)?"auto":s.isRightRotation(n.rotation||0)?n.height:n.width,(n.width||0)>(n.height||0)?"auto":s.isRightRotation(n.rotation||0)?n.width:n.height,(n.width||0)/(n.height||1),"rotate("+n.rotation+"deg)")),t.uIk("data-ratio",(n.width||0)/(n.height||1))}}function l(i,_){1&i&&(t.TgZ(0,"div",11),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"lang_auto_dinh_dang_file_khong_ho_tro_xuat_ra_pdf_he_thong_chi_xuat_duoc_file_pdf_doi_voi_file_tai_len_dang_anh_va_pdf")))}function a(i,_){if(1&i&&(t._UZ(0,"img",12),t.ALo(1,"mycdn")),2&i){const n=t.oxw(2).$implicit;t.s9C("src",t.lcZ(1,1,n.draw),t.LSH)}}function d(i,_){if(1&i&&(t.ynx(0),t._uU(1),t.BQk()),2&i){const n=t.oxw(6);t.xp6(1),t.hij(" ",null==n.result.staticTextConfigParse?null:n.result.staticTextConfigParse.textCorrect," ")}}function f(i,_){if(1&i&&(t.ynx(0),t._uU(1),t.BQk()),2&i){const n=t.oxw(6);t.xp6(1),t.hij(" ",null==n.result.staticTextConfigParse?null:n.result.staticTextConfigParse.textWrong," ")}}function p(i,_){if(1&i&&t._UZ(0,"img",15),2&i){const n=t.oxw(6);t.s9C("src","assets/images/classlive/"+(null==n.result.staticTextConfigParse?null:n.result.staticTextConfigParse.urlImgCorrect),t.LSH)}}function C(i,_){if(1&i&&t._UZ(0,"img",15),2&i){const n=t.oxw(6);t.s9C("src","assets/images/classlive/"+(null==n.result.staticTextConfigParse?null:n.result.staticTextConfigParse.urlImgWrong),t.LSH)}}const E=function(i,_,n,s,P){return{"font-family":i,color:_,"font-size":n,position:"absolute","z-index":2,"top.px":s,"left.px":P}};function v(i,_){if(1&i&&(t.ynx(0),t.TgZ(1,"span",13),t.YNc(2,d,2,1,"ng-container",0),t.YNc(3,f,2,1,"ng-container",0),t.YNc(4,p,1,1,"img",14),t.YNc(5,C,1,1,"img",14),t.qZA(),t.BQk()),2&i){const n=_.$implicit,s=t.oxw(5);t.xp6(1),t.Q6J("ngStyle",t.qbA(5,E,null==s.result.staticTextConfigParse?null:s.result.staticTextConfigParse.fontText,null==s.result.staticTextConfigParse?null:s.result.staticTextConfigParse.fontColor,(null==s.result.staticTextConfigParse?null:s.result.staticTextConfigParse.fontSize)+"px",n.y,n.x)),t.xp6(1),t.Q6J("ngIf",(null==s.result.staticTextConfigParse?null:s.result.staticTextConfigParse.useCorrectText)&&"correct"==n.value),t.xp6(1),t.Q6J("ngIf",(null==s.result.staticTextConfigParse?null:s.result.staticTextConfigParse.useCorrectText)&&"wrong"==n.value),t.xp6(1),t.Q6J("ngIf",!(null!=s.result.staticTextConfigParse&&s.result.staticTextConfigParse.useCorrectText)&&"correct"==n.value),t.xp6(1),t.Q6J("ngIf",!(null!=s.result.staticTextConfigParse&&s.result.staticTextConfigParse.useWrongText)&&"wrong"==n.value)}}function T(i,_){if(1&i&&t.YNc(0,v,6,11,"ng-container",1),2&i){const n=t.oxw(2).$implicit;t.Q6J("ngForOf",n.staticText)}}const e=function(i,_,n,s,P,y){return{"font-family":i,color:_,"font-size":n,display:"block","line-height":1.5,position:"absolute",letterSpacing:"3px",fontWeight:"bold","z-index":3,"text-align":s,"top.px":P,"left.px":y}};function o(i,_){if(1&i&&(t.ynx(0),t._UZ(1,"span",16),t.ALo(2,"formatNoteBreak"),t.BQk()),2&i){const n=_.$implicit;t.xp6(1),t.Q6J("ngStyle",t.HTZ(4,e,n.textStyle.font,n.textStyle.color,n.textStyle.size+"px",n.textStyle.align,n.y,n.x))("innerHtml",t.lcZ(2,2,n.value),t.oJD)}}function r(i,_){if(1&i&&t.YNc(0,o,3,11,"ng-container",1),2&i){const n=t.oxw(2).$implicit;t.Q6J("ngForOf",n.objText)}}function c(i,_){if(1&i&&(t.YNc(0,W,2,13,"img",7),t.ALo(1,"isImageExtension"),t.YNc(2,l,3,3,"ng-template",null,8,t.W1O),t.YNc(4,a,2,3,"img",9),t.YNc(5,T,1,1,"ng-template",5),t.YNc(6,r,1,1,"ng-template",5)),2&i){const n=t.MAs(3),s=t.oxw().$implicit;t.Q6J("ngIf",t.lcZ(1,5,(null==s?null:s.backgroundImage)||""))("ngIfElse",n),t.xp6(4),t.Q6J("ngIf",s.draw),t.xp6(1),t.Q6J("ngIf",s.staticText&&s.staticText.length>0),t.xp6(1),t.Q6J("ngIf",s.objText&&s.objText.length>0)}}const g=function(i,_){return{position:"relative","width.px":i,"height.px":_,display:"flex","justify-content":"center","align-items":"center"}};function h(i,_){if(1&i&&(t.ynx(0),t.TgZ(1,"div",2),t.YNc(2,O,2,1,"h3",3),t.TgZ(3,"div",4),t.YNc(4,c,7,7,"ng-template",5),t.qZA()(),t.BQk()),2&i){const n=_.$implicit,s=_.first,P=t.oxw(2);t.xp6(1),t.Tol("mb-2 essayPdfImage "+P.blockItemCropClass+" "+P.blockItemEssayCropClass),t.xp6(1),t.Q6J("ngIf",s),t.xp6(1),t.Q6J("ngStyle",t.WLB(6,g,n.width,n.height)),t.xp6(1),t.Q6J("ngIf",null==n?null:n.backgroundImage)}}function u(i,_){if(1&i&&(t.ynx(0),t.YNc(1,h,5,9,"ng-container",1),t.BQk()),2&i){const n=t.oxw();t.xp6(1),t.Q6J("ngForOf",n.result.pages)}}let x=(()=>{class i extends S.Q{isRightRotation(n){return 1==Math.abs(n/90%2)}ngOnInit(){var n;this.title=null!==(n=this.commonService.myTranslateInstant("lang_auto_anh_bai_lam_tu_luan"))&&void 0!==n?n:"",this.result.staticTextConfig&&(this.result.staticTextConfigParse=this.commonService.myParseJson(this.result.staticTextConfig)),super.ngOnInit()}ngOnChanges(){this.result.staticTextConfig&&(this.result.staticTextConfigParse=this.commonService.myParseJson(this.result.staticTextConfig))}constructor(n,s){super(s),this.iframeService=n,this.commonService=s,this.title="",this.result={}}}return i.\u0275fac=function(n){return new(n||i)(t.Y36(z.X),t.Y36(I.v))},i.\u0275cmp=t.Xpm({type:i,selectors:[["azt-export-essay-template"]],inputs:{title:"title",blockItemEssayCropClass:"blockItemEssayCropClass",blockItemCropClass:"blockItemCropClass",result:"result"},features:[t.qOj,t.TTD],decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"display","flex","justify-content","center","align-items","center","flex-direction","column"],["id","essayPdfTitle","class","text-center",4,"ngIf"],[3,"ngStyle"],[3,"ngIf"],["id","essayPdfTitle",1,"text-center"],["class","user-img img_respon","alt","",3,"ngClass","ngStyle","src",4,"ngIf","ngIfElse"],["noSupportExtension",""],["style","position: absolute; z-index: 1; top: 0; left: 0","class","user-img img_respon","alt","",3,"src",4,"ngIf"],["alt","",1,"user-img","img_respon",3,"ngClass","ngStyle","src"],[1,"p-2","text-center",2,"border","2px solid red"],["alt","",1,"user-img","img_respon",2,"position","absolute","z-index","1","top","0","left","0",3,"src"],[2,"min-height","50px","min-width","50px","font-weight","bold","display","flex","line-height","1.5","font-weight","bold","align-items","center","justify-content","center","text-shadow","rgb(130 126 126) 1px 1px 1px",3,"ngStyle"],["width","30","height","30","class","","alt","",3,"src",4,"ngIf"],["width","30","height","30","alt","",1,"",3,"src"],[3,"ngStyle","innerHtml"]],template:function(n,s){1&n&&t.YNc(0,u,2,1,"ng-container",0),2&n&&t.Q6J("ngIf",s.result)},dependencies:[A.mk,A.sg,A.O5,A.PC,R.bT,R.GT,R.AL,R.kJ],encapsulation:2}),i})()},16031:(Q,L,m)=>{m.d(L,{I:()=>E});var S=m(70655),t=m(4159),I=m(96166),A=m(17489),O=m(94650),F=m(296),D=m(20814),W=m(88161),l=m(72491);const C={top:60,left:60,right:60,bottom:60};let E=(()=>{class v{get loadPercent(){return Math.floor(this.countDraw/this.totalDraw*100)}getSourceCanvas(e){return(0,S.mG)(this,void 0,void 0,function*(){var o=document.getElementById(e);return yield t(o,{scale:2})})}resetPosition(e){e&&(this.currentPos={left:60,top:60,right:60,bottom:60})}drawHomeworkNoteBoxOfTeacher(e){return(0,S.mG)(this,void 0,void 0,function*(){let o=document.querySelector(".box-point.display .text-mark");if(e){e.font="25px font_chu_dep",e.fillStyle="#000",o&&e.fillText("\u0110i\u1ec3m",90,this.currentPos.top+20),e.fillText("L\u1eddi ph\xea c\u1ee7a gi\xe1o vi\xean",420,this.currentPos.top+20),this.currentPos.top+=30;let r=document.querySelector(".box-msg .note p");if(r){e.lineWidth=2,e.fillStyle="#000",e.fillRect(this.currentPos.left,this.currentPos.top,e.canvas.width-this.currentPos.left-this.currentPos.right,1);const c=this.currentPos.top;let g=window.getComputedStyle(r,null).getPropertyValue("font"),h=window.getComputedStyle(r,null).getPropertyValue("color"),u=parseInt(g.split(" ")[0].split("p")[0],10);e.font=g;let i=this.exportPdfUtilsService.essayText2LinesArr(r.innerHTML,e,e.canvas.width-60-30-(o?200:0),16,g);this.currentPos.top+=35;const _=Math.round(1.5*u),n=this.currentPos.left+(o?200:0)+15;let s=0,P=200;for(let B=0;B<i.length;B++)for(let U=0;U<i[B].length;U++){const M=i[B][U];e.font=g,e.fillStyle=h,e.fillText(M,n,this.currentPos.top),this.currentPos.top+=_,s+=_}let y=document.querySelectorAll(".box-emoji> img"),w=this.currentPos.left+(o?100:0)+15,N=this.currentPos.top,k=78,H=78,j=15;y.forEach(B=>{var U;let M=new Image;M.src=null!==(U=B.getAttribute("src"))&&void 0!==U?U:"",M.onload=()=>{w=w+k+j,e.drawImage(M,w,N,k,H)}});let K=30+H;if(s>P-K&&(P=s+K),e.lineWidth=2,e.fillStyle="#000",e.fillRect(this.currentPos.left,c,1,P),o&&e.fillRect(this.currentPos.left+200,c,1,P),e.fillRect(e.canvas.width-this.currentPos.right,c,1,P),e.fillRect(this.currentPos.left,c+P,e.canvas.width-this.currentPos.right-this.currentPos.left,1),o){let B=o.getBoundingClientRect().width,U=o.getBoundingClientRect().height,M=window.getComputedStyle(o,null).getPropertyValue("font"),Y=window.getComputedStyle(o,null).getPropertyValue("color");e.font=M,e.fillStyle=Y,e.fillText(o.textContent?o.textContent:"",this.currentPos.left+100-B/2,c+P/2+U/4)}this.currentPos.top=c+P+20}else{if(e.lineWidth=2,e.rect(this.currentPos.left,this.currentPos.top,e.canvas.width-this.currentPos.left-this.currentPos.right,200),e.stroke(),o&&e.fillRect(this.currentPos.left+200,this.currentPos.top,1,200),o){let c=o.getBoundingClientRect().width,g=o.getBoundingClientRect().height,h=window.getComputedStyle(o,null).getPropertyValue("font"),u=window.getComputedStyle(o,null).getPropertyValue("color");e.font=h,e.fillStyle=u,e.fillText(o.textContent?o.textContent:"",this.currentPos.left+100-c/2,this.currentPos.top+150-g/2)}this.currentPos.top+=220}}})}drawExamTitle(e){if(e){let s=document.querySelector("#mainTitle span"),P=s?window.getComputedStyle(s,null).getPropertyValue("font"):"",y=s?.getBoundingClientRect().width,w=s?.getBoundingClientRect().height;var o=s?.querySelector("img"),r=o?.getBoundingClientRect().width,c=o?.getBoundingClientRect().height,g=0;if(s&&s.textContent&&y&&w&&!(o&&r&&c)){var h=(e.canvas.width-y)/2,u=this.currentPos.top+15;e.font=P,e.fillStyle="#000",e.fillText(s.textContent,h,u),g=w+20}else s&&s.textContent&&y&&w&&o&&r&&c&&(h=(e.canvas.width-y)/2,u=this.currentPos.top+20,e.font=P,e.fillStyle="#000",e.fillText(s.textContent,h,u),g=w+40,e.drawImage(o,0,0,r,c,h+(y-r)+5,this.currentPos.top-10,r,c));g>0&&(this.currentPos.top+=g,this.countDraw++)}}drawColLeftRightInHeaderOfExam(e){var o;let r=document.getElementById("colLeftInfo"),c=document.getElementById("colRightInfo"),g=r?r.querySelectorAll("h3"):void 0,h=c?c.querySelectorAll("h3"):void 0,u={top:0,left:0,right:0,bottom:0};if(e){if(e.font="16px Arial",g)for(let x=0;x<g.length;x++){0==x&&(u=A.cloneDeep(this.currentPos));const i=g[x];i.textContent&&(e.fillText(null!==(o=i.textContent)&&void 0!==o?o:"",this.currentPos.left,this.currentPos.top),this.currentPos.top+=i.getBoundingClientRect().height+5)}if(h)for(let x=0;x<h.length;x++){const i=h[x];i.textContent&&(e.fillText(i.textContent,e.canvas.width-this.currentPos.right-i.getBoundingClientRect().width,u.top),u.top+=i.getBoundingClientRect().height+5)}}}drawBlockItemToPageForExam(e,o){return(0,S.mG)(this,void 0,void 0,function*(){if(e){let c=document.querySelectorAll(`.${this.exportPdfUtilsService.blockCropItemClass}`);if(c.length>0){let g=[];for(let h=0;h<c.length;h++)g.push(h);var r=yield this.getSourceCanvas("multipleChoiceWrap");for(const h of g){const u=c[h];let x=u.classList.contains(this.exportPdfUtilsService.blockEssayCropItemClass),i=u.classList.contains("__TXT_ESSAY_PARA");console.log("nvanh 1",i,x);let _=2*u.offsetLeft,n=2*u.offsetTop,s=2*u.getBoundingClientRect().width,P=2*u.getBoundingClientRect().height;const y=e.canvas.width-this.currentPos.left-this.currentPos.right,w=y*P/s;if(w<=e.canvas.height-this.currentPos.bottom-this.currentPos.top&&!x)this.drawSingleBlockItemToCanvas(e,r,y,w,{left:_,top:n,width:s,height:P},i);else if(this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,e.canvas.toDataURL("image/jpeg",1)),this.pdfDoc.addPage(),this.exportPdfUtilsService.eraseCanvas(e),this.resetPosition(o),"h"==this.exportPdfConvertDataService.findScaleDirection(s,P)){const N=e.canvas.height-C.top-C.bottom,k=N*s/P;this.drawSingleBlockItemToCanvas(e,r,y,w,{left:_,top:n,width:s,height:P},i,(e.canvas.width-k)/2,C.top,k,N)}else this.drawSingleBlockItemToCanvas(e,r,y,w,{left:_,top:n,width:s,height:P},i)}this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,e.canvas.toDataURL("image/jpeg",1))}else this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,e.canvas.toDataURL("image/jpeg",1))}})}convertEssayBoxes2Canvas(e,o,r,c){return(0,S.mG)(this,void 0,void 0,function*(){let g=[];for(let h=0;h<e.length;h++)g.push(h);for(const h of g){const u=yield t(e[h]);0==h&&o?(c&&(o.canvas.width-50-50)*u.height/u.width>o.canvas.height-50-this.currentPos.top&&(this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,o.canvas.toDataURL("image/jpeg",1)),this.exportPdfUtilsService.eraseCanvas(o),this.resetPosition(r),this.pdfDoc.addPage()),this.addEssayImage(o,e,u,h)):(this.exportPdfUtilsService.eraseCanvas(o),this.resetPosition(r),this.addEssayImage(o,e,u,h))}})}drawEssayIframeContent(e,o,r){return(0,S.mG)(this,void 0,void 0,function*(){let c=document.querySelectorAll(".essayPdfImage");if(c.length>0&&e){r||(this.exportPdfUtilsService.eraseCanvas(e),this.resetPosition(o),this.pdfDoc.addPage());let g=document.querySelector("#essayPdfTitle span");e&&g&&g.textContent&&(e.font="18px Georgia",e.fillStyle="#333",e.fillText(g.textContent,(e.canvas.width-g.getBoundingClientRect().width)/2,this.currentPos.top+20),this.currentPos.top+=g.getBoundingClientRect().height+20),yield this.convertEssayBoxes2Canvas(c,e,o,r)}})}addEssayImage(e,o,r,c){if(e){if("w"==this.exportPdfConvertDataService.findScaleDirection(r.width,r.height))e.drawImage(r,0,0,r.width,r.height,50,this.currentPos.top+50,e.canvas.width-100,(e.canvas.width-100)*r.height/r.width);else{let g=e.canvas.height-this.currentPos.top-this.currentPos.bottom,h=g*r.width/r.height;e.drawImage(r,0,0,r.width,r.height,(e.canvas.width-h)/2,this.currentPos.top,h,g)}console.log(`[_Essay_image_] V\u1ebd \u1ea3nh t\u1ef1 lu\u1eadn s\u1ed1 ${c+1}`),this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,e.canvas.toDataURL("image/jpeg",1)),this.countDraw++,c!=o.length-1&&this.pdfDoc.addPage()}}drawSingleBlockItemToCanvas(e,o,r,c,g,h,u,x,i,_){h&&this.currentPos.top!=C.top&&(this.currentPos.top-=60),e.drawImage(o,g.left,g.top,g.width,g.height,u||this.currentPos.left,x||this.currentPos.top,i||r,_||c),this.currentPos.top+=c+80,this.countDraw++}examToPdf(e,o){return(0,S.mG)(this,void 0,void 0,function*(){this.countDraw=0,this.totalDraw=document.querySelectorAll(`.${this.exportPdfUtilsService.blockCropItemClass}`).length,this.pdfDoc=new I.jsPDF;let r=document.createElement("canvas"),c=document.getElementById("multipleChoiceWrap");if(console.log("nvanh",c),c){let u=c.getBoundingClientRect().width;r.width=2*u,r.height=297*u/210*2}let g=r.getContext("2d");return this.exportPdfUtilsService.eraseCanvas(g),c&&this.resetPosition(c),c&&(yield this.drawBlockItemToPageForExam(g,c)),this.countDraw=this.totalDraw,yield this.exportPdfUtilsService.asyncTimeout(1e3),"class"==e?this.pdfDoc.output("blob"):(this.pdfDoc.save(o||"test_result.pdf"),!0)})}homeworkToPdf(){return(0,S.mG)(this,void 0,void 0,function*(){this.pdfDoc=new I.jsPDF;let e=document.createElement("canvas"),o=document.getElementById("multipleChoiceWrap");if(o){let g=o.getBoundingClientRect().width;e.width=g,e.height=297*g/210}let r=e.getContext("2d");return this.exportPdfUtilsService.eraseCanvas(r),o&&this.resetPosition(o),this.drawExamTitle(r),this.drawColLeftRightInHeaderOfExam(r),yield this.drawHomeworkNoteBoxOfTeacher(r),o&&(yield this.drawEssayIframeContent(r,o,!0)),this.pdfDoc.output("blob")})}constructor(e,o,r,c){this.exportPdfConvertDataService=e,this.exportPdfUtilsService=o,this.answerTypeService=r,this.timeService=c,this.totalDraw=1,this.countDraw=0,this.currentPos=C,this.pdfDoc=new I.jsPDF}}return v.\u0275fac=function(e){return new(e||v)(O.LFG(F.S),O.LFG(D.V),O.LFG(W.T),O.LFG(l.O))},v.\u0275prov=O.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),v})()},50136:(Q,L,m)=>{m.d(L,{J:()=>F});var S=m(80529),t=m(69751),z=m(51442),I=m(94650),A=m(51009),R=m(45511),O=m(58326);let F=(()=>{class D{replaceImageInContent(l){return new t.y(a=>{if(l.includes("<img ")){var d=this.findAllSubString(l,"<img"),f=[],p=[];d.forEach(C=>{var E=l.indexOf("src=",C),v=l.indexOf('"',Number(E)+5),T=l.substring(Number(E)+5,Number(v)+1);T.includes(";base64")?f.push({oldUrl:T}):T.includes("blob:")&&p.push({oldUrl:T})}),f.length>0?this.reUploadBase64File(f,(C,E)=>{null!=E?this.reUploadBlobFile(p,(v,T)=>{null!=T?(l=this.replaceHomeworkContent(l,C),l=this.replaceHomeworkContent(l,v),a.next({errorMessage:void 0,content:l}),a.complete()):(a.next({errorMessage:T,content:l}),a.complete())}):(a.next({errorMessage:E,content:l}),a.complete())}):p.length>0?this.reUploadBlobFile(p,(C,E)=>{null!=E?(l=this.replaceHomeworkContent(l,C),a.next({errorMessage:void 0,content:l}),a.complete()):(a.next({errorMessage:E,content:l}),a.complete())}):(l=this.replaceHomeworkContent(l,[]),a.next({errorMessage:void 0,content:l}),a.complete())}else a.next({errorMessage:void 0,content:l}),a.complete()})}replaceHomeworkContent(l,a){return a.length>0&&a.forEach(d=>{var f,p=l.replace(null!==(f=d.oldUrl)&&void 0!==f?f:"  ",d.newUrl+'" class="w-100 img-fluid"');l=p}),l}findAllSubString(l,a){for(var d=0,f=0,p=[];l.indexOf(a,d)>-1;)f=l.indexOf(a,d),p.push(f),d=f+a.length;return p}getTypeFile(l){var a=l.indexOf(";");return l.substring(5,a)}getFileName(l){var a=l.split("").reverse().join(""),d=a.indexOf(";"),f=a.indexOf("/",d);return a.substring(d,f).split("").reverse().join("")}convertBlobToBase64(l){return new Promise(a=>{var d=new Image;d.crossOrigin="Anonymous",d.addEventListener("load",function(){var f=document.createElement("canvas"),p=f.getContext("2d");f.width=d.width,f.height=d.height,p?.drawImage(d,0,0);var C=f.toDataURL("image/png");a(C)},!1),d.src=l})}reUploadBase64File(l,a){var d;if(l&&l.length>0){let E,C=l.length;for(var f=[],p=0;p<l.length;p++){const v=l[p],T=null===(d=v.oldUrl)||void 0===d?void 0:d.substring(0,v.oldUrl.length-1);this.startUploadBlobFile(v,T??"",[],(e,o)=>{null==o?f=f.concat(e):E=o,C-=1,0==C&&a(f,E)})}}else a([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}reUploadBlobFile(l,a){var d;if(l&&l.length>0){let E,C=l.length;for(var f=[],p=0;p<l.length;p++){const v=l[p],T=null===(d=v?.oldUrl)||void 0===d?void 0:d.substring(0,v.oldUrl.length-1);this.convertBlobToBase64(T??"").then(e=>{this.startUploadBlobFile(v,e,[],(o,r)=>{null==r?f=f.concat(o):E=r,C-=1,0==C&&a(f,E)})})}}else a([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}startUploadBlobFile(l,a,d,f){if(a&&""!=a){var p=this.getTypeFile(a),C=this.myPdfService.b64toFile(a,this.getFileName(p),p);(0,z.hv)(C).then(E=>{this.apiUploadService.uploadToCdnForHomework(E).subscribe(v=>{var T,e;if(v.type!=S.dt.UploadProgress)if(1==v.success){var o=Object.assign(Object.assign({},l),{newUrl:null!==(e=null===(T=v.data)||void 0===T?void 0:T.url)&&void 0!==e?e:""});d.push(o),f(d,void 0)}else f(d,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi[SPLIT_LANG] [SPLIT_LANG]"+v.message)})})}else f(d,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}constructor(l,a,d){this.commonService=l,this.apiUploadService=a,this.myPdfService=d}}return D.\u0275fac=function(l){return new(l||D)(I.LFG(A.v),I.LFG(R.$),I.LFG(O.t))},D.\u0275prov=I.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),D})()}}]);