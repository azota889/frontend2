"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[495],{29225:(F,M,h)=>{h.d(M,{Z:()=>f});var t=h(5e3),e=h(93075),Z=h(55330),D=h(60284),A=h(43147),O=h(50690),B=h(36307),U=h(74202),S=h(69808),R=h(75477),s=h(74650),_=h(76224),p=h(1033);const m=function(r){return[r]};function C(r,v){1&r&&(t.TgZ(0,"div",24)(1,"a",25),t.ALo(2,"mylocalize"),t._UZ(3,"img",26),t.ALo(4,"convertCdnLinkOfGitHub"),t.qZA()()),2&r&&(t.xp6(1),t.Q6J("routerLink",t.VKq(6,m,t.lcZ(2,2,"/admin/dashboard"))),t.xp6(2),t.Q6J("src",t.lcZ(4,4,"azota_assets/images/logo.svg"),t.LSH))}function T(r,v){if(1&r){const n=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){t.CHM(n);const i=t.oxw(2);return t.KtG(i.goBack())}),t.O4$(),t.TgZ(1,"svg",28),t._UZ(2,"polyline",29),t.qZA()()}}function y(r,v){if(1&r){const n=t.EpF();t.TgZ(0,"button",30),t.NdJ("click",function(){t.CHM(n);const i=t.oxw(2);return t.KtG(i.goBackDialog())}),t.O4$(),t.TgZ(1,"svg",28),t._UZ(2,"polyline",29),t.qZA()()}}function x(r,v){1&r&&t._UZ(0,"div",31)}function P(r,v){if(1&r&&(t.ynx(0),t._UZ(1,"input",32),t.ALo(2,"mytranslate"),t.BQk()),2&r){const n=t.oxw(2);t.xp6(1),t.s9C("placeholder",t.lcZ(2,2,"lang_auto_nhap_ten")+" ..."),t.Q6J("formControl",n.examName)}}function o(r,v){if(1&r){const n=t.EpF();t.TgZ(0,"div",31)(1,"button",33),t.NdJ("click",function(){t.CHM(n);const i=t.oxw(2);return t.KtG(i.clickHandelCancel())}),t._uU(2),t.ALo(3,"mytranslate"),t.qZA(),t.TgZ(4,"button",34),t.NdJ("click",function(){t.CHM(n);const i=t.oxw(2);return t.KtG(i.clickHandelConfirm())}),t._uU(5),t.ALo(6,"mytranslate"),t.qZA()()}if(2&r){const n=t.oxw(2);t.xp6(2),t.hij(" ",t.lcZ(3,2,"lang_auto_huy")," "),t.xp6(3),t.hij(" ",t.lcZ(6,4,n.confirmTitle)," ")}}function l(r,v){if(1&r&&(t.ynx(0),t._UZ(1,"input",35),t.ALo(2,"mytranslate"),t.BQk()),2&r){const n=t.oxw(2);t.xp6(1),t.s9C("placeholder",t.lcZ(2,2,"lang_auto_nhap_ten")+" ..."),t.Q6J("formControl",n.examName)}}function c(r,v){if(1&r){const n=t.EpF();t.TgZ(0,"div",36)(1,"button",37),t.NdJ("click",function(){t.CHM(n);const i=t.oxw(2);return t.KtG(i.clickHandelCancel())}),t._uU(2),t.ALo(3,"mytranslate"),t.qZA(),t.TgZ(4,"button",38),t.NdJ("click",function(){t.CHM(n);const i=t.oxw(2);return t.KtG(i.clickHandelConfirm())}),t._uU(5),t.ALo(6,"mytranslate"),t.qZA()()}2&r&&(t.xp6(2),t.hij(" ",t.lcZ(3,2,"lang_auto_huy")," "),t.xp6(3),t.hij(" ",t.lcZ(6,4,"lang_auto_tiep_tuc")," "))}function g(r,v){if(1&r&&(t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",3),t.YNc(7,C,5,8,"div",7),t.YNc(8,T,3,0,"button",8),t.YNc(9,y,3,0,"button",9),t.qZA()(),t.TgZ(10,"div",10)(11,"div",11),t.YNc(12,x,1,0,"div",12),t.TgZ(13,"div",13),t.YNc(14,P,3,4,"ng-container",14),t.qZA(),t.YNc(15,o,7,6,"div",12),t.qZA()(),t.TgZ(16,"div",6)(17,"div",15)(18,"div",16),t._UZ(19,"azt-switch-language"),t.qZA(),t.TgZ(20,"div",16),t._UZ(21,"header-notice-box"),t.qZA(),t.TgZ(22,"div",17),t._UZ(23,"header-account-menu",18),t.qZA()()(),t.TgZ(24,"div",19)(25,"div",20)(26,"div",21),t.YNc(27,l,3,4,"ng-container",14),t.qZA(),t.YNc(28,c,7,6,"div",22),t.qZA()()(),t.TgZ(29,"div",23),t.Hsn(30),t.qZA()()()()()),2&r){const n=t.oxw();t.xp6(7),t.Q6J("ngIf",!n.isMobileWebView),t.xp6(1),t.Q6J("ngIf",!n.checkBackDialog&&""!=n.headerBackTolink),t.xp6(1),t.Q6J("ngIf",n.checkBackDialog),t.xp6(3),t.Q6J("ngIf",n.showConfirmButton),t.xp6(2),t.Q6J("ngIf",n.showInput),t.xp6(1),t.Q6J("ngIf",n.showConfirmButton),t.xp6(8),t.Q6J("isTeacherDashboard",!0),t.xp6(4),t.Q6J("ngIf",n.showInput),t.xp6(1),t.Q6J("ngIf",n.showConfirmButton)}}const u=["*"];let f=(()=>{class r extends Z.Q{goBack(){this.commonService.myNavigationBySpecialQueryString(this.headerBackTolink)}goBackDialog(){this.handleBackDialog.emit()}clickHandelCancel(){this.handleCancel.emit()}clickHandelConfirm(){this.handleConfirm.emit()}openMenuMobile(){let n=document.getElementById("toggle-menu");null==n||n.classList.add("mobile-menu--active")}closeMenuMobile(){let n=document.getElementById("toggle-menu");null==n||n.classList.remove("mobile-menu--active")}ngOnInit(){super.ngOnInit(),window.scrollTo(0,0),this.isLogin=this.baseApiService.isLogin()}constructor(n,d,i,a){super(i),this.processNoticeService=n,this.baseApiService=d,this.commonService=i,this.mobileWebviewService=a,this.headerBackTolink="",this.headerTitle="",this.confirmTitle="lang_auto_tiep_tuc",this.checkBackDialog=!1,this.showConfirmButton=!1,this.showInput=!1,this.examName=new e.p4,this.handleConfirm=new t.vpe,this.handleCancel=new t.vpe,this.handleBackDialog=new t.vpe,this.isLogin=!1,this.isMobileWebView=!1,this.subscriptions.add(this.mobileWebviewService.webviewBackToListenerSubscriber.subscribe(()=>{this.checkBackDialog?this.goBackDialog():this.headerBackTolink&&this.goBack()}))}}return r.\u0275fac=function(n){return new(n||r)(t.Y36(D.e),t.Y36(A._),t.Y36(O.v),t.Y36(B.F))},r.\u0275cmp=t.Xpm({type:r,selectors:[["editor-layout"]],inputs:{headerBackTolink:"headerBackTolink",headerTitle:"headerTitle",confirmTitle:"confirmTitle",checkBackDialog:"checkBackDialog",showConfirmButton:"showConfirmButton",showInput:"showInput",examName:"examName"},outputs:{handleConfirm:"handleConfirm",handleCancel:"handleCancel",handleBackDialog:"handleBackDialog"},features:[t.qOj],ngContentSelectors:u,decls:1,vars:1,consts:[["id","azt-layout","class","azt-layout",4,"ngIf"],["id","azt-layout",1,"azt-layout"],[1,"azt-body",2,"padding","0"],[1,"flex"],[1,"content","relative",2,"padding","0","border-radius","0"],[1,"top-bar","py-2","bg-white","dark:bg-darkmode-600","px-3","grid","grid-cols-12","gap-3",2,"height","auto","z-index","0","display","grid"],[1,"col-span-6","md:col-span-2"],["class","mr-3",4,"ngIf"],["azt-track-service","editor-layout-sjSDq2slMU","class","btn btn-transparent",3,"click",4,"ngIf"],["azt-track-service","editor-layout-0LcNE2-_PP","class","btn btn-transparent",3,"click",4,"ngIf"],[1,"col-span-12","md:col-span-8","azt-hidden","md:block"],[1,"flex","items-center"],["class","mr-2","style","width: 25%;",4,"ngIf"],[1,"mr-auto",2,"width","50%","padding-right","10px"],[4,"ngIf"],[1,"flex","items-center","justify-end","pr-4"],[1,"dropdown","mr-2","sm:mr-4"],[1,"dropdown","w-8","h-8"],[3,"isTeacherDashboard"],[1,"col-span-12","md:col-span-8","block","md:hidden"],[1,"flex","items-center","w-full",2,"flex-wrap","wrap"],[1,"mr-auto",2,"width","55%"],["class","mr-2 ml-auto",4,"ngIf"],[1,"azt-content"],[1,"mr-3"],["azt-track-service","editor-layout-fIGchmLIEg",3,"routerLink"],["alt","logo","width","95px",3,"src"],["azt-track-service","editor-layout-sjSDq2slMU",1,"btn","btn-transparent",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"lucide","w-5","h-5"],["points","15 18 9 12 15 6"],["azt-track-service","editor-layout-0LcNE2-_PP",1,"btn","btn-transparent",3,"click"],[1,"mr-2",2,"width","25%"],["type","text",1,"form-control",2,"text-align","center","border","0","box-shadow","none",3,"formControl","placeholder"],["azt-track-service","editor-layout-80eT0Nmtel",1,"btn","btn-secondary","w-20","mr-2",3,"click"],["azt-track-service","editor-layout-DOA7O4mmZV",1,"btn","btn-primary","w-20",3,"click"],["type","text",1,"form-control",3,"formControl","placeholder"],[1,"mr-2","ml-auto"],["azt-track-service","editor-layout-IQLlBSOOur",1,"btn","btn-secondary","mr-2",3,"click"],["azt-track-service","editor-layout-_3e-MqRK1i",1,"btn","btn-primary",3,"click"]],template:function(n,d){1&n&&(t.F$t(),t.YNc(0,g,31,9,"div",0)),2&n&&t.Q6J("ngIf",d.isLogin)},dependencies:[U.yS,S.O5,e.Fj,e.JJ,e.oH,R.x,s.H,_.y,p.mp,p.bT,p.Jc],encapsulation:2}),r})()},1643:(F,M,h)=>{h.d(M,{p:()=>v});var t=h(55330),e=h(5e3),Z=h(63382),D=h(50690),A=h(69808),O=h(1033);function B(n,d){if(1&n&&(e.TgZ(0,"h3",6),e._uU(1),e.qZA()),2&n){const i=e.oxw(3);e.xp6(1),e.Oqu(i.title)}}const U=function(n){return{"rotated-img":n}},S=function(n,d,i,a){return{"width.px":n,"height.px":d,"aspect-ratio":i,transform:a}};function R(n,d){if(1&n&&(e._UZ(0,"img",10),e.ALo(1,"mycdn")),2&n){const i=e.oxw(2).$implicit,a=e.oxw(2);e.s9C("src",e.lcZ(1,4,i.backgroundImage),e.LSH),e.Q6J("ngClass",e.VKq(6,U,a.isRightRotation(i.rotation||0)))("ngStyle",e.l5B(8,S,(i.width||0)<(i.height||0)?"auto":a.isRightRotation(i.rotation||0)?i.height:i.width,(i.width||0)>(i.height||0)?"auto":a.isRightRotation(i.rotation||0)?i.width:i.height,(i.width||0)/(i.height||1),"rotate("+i.rotation+"deg)")),e.uIk("data-ratio",(i.width||0)/(i.height||1))}}function s(n,d){1&n&&(e.TgZ(0,"div",11),e._uU(1),e.ALo(2,"mytranslate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"lang_auto_dinh_dang_file_khong_ho_tro_xuat_ra_pdf_he_thong_chi_xuat_duoc_file_pdf_doi_voi_file_tai_len_dang_anh_va_pdf")))}function _(n,d){if(1&n&&(e._UZ(0,"img",12),e.ALo(1,"mycdn")),2&n){const i=e.oxw(2).$implicit;e.s9C("src",e.lcZ(1,1,i.draw),e.LSH)}}function p(n,d){if(1&n&&(e.ynx(0),e._uU(1),e.BQk()),2&n){const i=e.oxw(6);e.xp6(1),e.hij(" ",null==i.result.staticTextConfigParse?null:i.result.staticTextConfigParse.textCorrect," ")}}function m(n,d){if(1&n&&(e.ynx(0),e._uU(1),e.BQk()),2&n){const i=e.oxw(6);e.xp6(1),e.hij(" ",null==i.result.staticTextConfigParse?null:i.result.staticTextConfigParse.textWrong," ")}}function C(n,d){if(1&n&&e._UZ(0,"img",15),2&n){const i=e.oxw(6);e.s9C("src","assets/images/classlive/"+(null==i.result.staticTextConfigParse?null:i.result.staticTextConfigParse.urlImgCorrect),e.LSH)}}function T(n,d){if(1&n&&e._UZ(0,"img",15),2&n){const i=e.oxw(6);e.s9C("src","assets/images/classlive/"+(null==i.result.staticTextConfigParse?null:i.result.staticTextConfigParse.urlImgWrong),e.LSH)}}const y=function(n,d,i,a,E){return{"font-family":n,color:d,"font-size":i,position:"absolute","z-index":2,"top.px":a,"left.px":E}};function x(n,d){if(1&n&&(e.ynx(0),e.TgZ(1,"span",13),e.YNc(2,p,2,1,"ng-container",0),e.YNc(3,m,2,1,"ng-container",0),e.YNc(4,C,1,1,"img",14),e.YNc(5,T,1,1,"img",14),e.qZA(),e.BQk()),2&n){const i=d.$implicit,a=e.oxw(5);e.xp6(1),e.Q6J("ngStyle",e.qbA(5,y,null==a.result.staticTextConfigParse?null:a.result.staticTextConfigParse.fontText,null==a.result.staticTextConfigParse?null:a.result.staticTextConfigParse.fontColor,(null==a.result.staticTextConfigParse?null:a.result.staticTextConfigParse.fontSize)+"px",i.y,i.x)),e.xp6(1),e.Q6J("ngIf",(null==a.result.staticTextConfigParse?null:a.result.staticTextConfigParse.useCorrectText)&&"correct"==i.value),e.xp6(1),e.Q6J("ngIf",(null==a.result.staticTextConfigParse?null:a.result.staticTextConfigParse.useCorrectText)&&"wrong"==i.value),e.xp6(1),e.Q6J("ngIf",!(null!=a.result.staticTextConfigParse&&a.result.staticTextConfigParse.useCorrectText)&&"correct"==i.value),e.xp6(1),e.Q6J("ngIf",!(null!=a.result.staticTextConfigParse&&a.result.staticTextConfigParse.useWrongText)&&"wrong"==i.value)}}function P(n,d){if(1&n&&e.YNc(0,x,6,11,"ng-container",1),2&n){const i=e.oxw(2).$implicit;e.Q6J("ngForOf",i.staticText)}}const o=function(n,d,i,a,E,w){return{"font-family":n,color:d,"font-size":i,display:"block","line-height":1.5,position:"absolute",letterSpacing:"3px",fontWeight:"bold","z-index":3,"text-align":a,"top.px":E,"left.px":w}};function l(n,d){if(1&n&&(e.ynx(0),e._UZ(1,"span",16),e.ALo(2,"formatNoteBreak"),e.BQk()),2&n){const i=d.$implicit;e.xp6(1),e.Q6J("ngStyle",e.HTZ(4,o,i.textStyle.font,i.textStyle.color,i.textStyle.size+"px",i.textStyle.align,i.y,i.x))("innerHtml",e.lcZ(2,2,i.value),e.oJD)}}function c(n,d){if(1&n&&e.YNc(0,l,3,11,"ng-container",1),2&n){const i=e.oxw(2).$implicit;e.Q6J("ngForOf",i.objText)}}function g(n,d){if(1&n&&(e.YNc(0,R,2,13,"img",7),e.ALo(1,"isImageExtension"),e.YNc(2,s,3,3,"ng-template",null,8,e.W1O),e.YNc(4,_,2,3,"img",9),e.YNc(5,P,1,1,"ng-template",5),e.YNc(6,c,1,1,"ng-template",5)),2&n){const i=e.MAs(3),a=e.oxw().$implicit;e.Q6J("ngIf",e.lcZ(1,5,(null==a?null:a.backgroundImage)||""))("ngIfElse",i),e.xp6(4),e.Q6J("ngIf",a.draw),e.xp6(1),e.Q6J("ngIf",a.staticText&&a.staticText.length>0),e.xp6(1),e.Q6J("ngIf",a.objText&&a.objText.length>0)}}const u=function(n,d){return{position:"relative","width.px":n,"height.px":d,display:"flex","justify-content":"center","align-items":"center"}};function f(n,d){if(1&n&&(e.ynx(0),e.TgZ(1,"div",2),e.YNc(2,B,2,1,"h3",3),e.TgZ(3,"div",4),e.YNc(4,g,7,7,"ng-template",5),e.qZA()(),e.BQk()),2&n){const i=d.$implicit,a=d.first,E=e.oxw(2);e.xp6(1),e.Tol("mb-2 essayPdfImage "+E.blockItemCropClass+" "+E.blockItemEssayCropClass),e.xp6(1),e.Q6J("ngIf",a),e.xp6(1),e.Q6J("ngStyle",e.WLB(6,u,i.width,i.height)),e.xp6(1),e.Q6J("ngIf",null==i?null:i.backgroundImage)}}function r(n,d){if(1&n&&(e.ynx(0),e.YNc(1,f,5,9,"ng-container",1),e.BQk()),2&n){const i=e.oxw();e.xp6(1),e.Q6J("ngForOf",i.result.pages)}}let v=(()=>{class n extends t.Q{isRightRotation(i){return 1==Math.abs(i/90%2)}ngOnInit(){var i;this.title=null!==(i=this.commonService.myTranslateInstant("lang_auto_anh_bai_lam_tu_luan"))&&void 0!==i?i:"",this.result.staticTextConfig&&(this.result.staticTextConfigParse=this.commonService.myParseJson(this.result.staticTextConfig)),super.ngOnInit()}ngOnChanges(){this.result.staticTextConfig&&(this.result.staticTextConfigParse=this.commonService.myParseJson(this.result.staticTextConfig))}constructor(i,a){super(a),this.iframeService=i,this.commonService=a,this.title="",this.result={}}}return n.\u0275fac=function(i){return new(i||n)(e.Y36(Z.X),e.Y36(D.v))},n.\u0275cmp=e.Xpm({type:n,selectors:[["azt-export-essay-template"]],inputs:{title:"title",blockItemEssayCropClass:"blockItemEssayCropClass",blockItemCropClass:"blockItemCropClass",result:"result"},features:[e.qOj,e.TTD],decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"display","flex","justify-content","center","align-items","center","flex-direction","column"],["id","essayPdfTitle","class","text-center",4,"ngIf"],[3,"ngStyle"],[3,"ngIf"],["id","essayPdfTitle",1,"text-center"],["class","user-img img_respon","alt","",3,"ngClass","ngStyle","src",4,"ngIf","ngIfElse"],["noSupportExtension",""],["style","position: absolute; z-index: 1; top: 0; left: 0","class","user-img img_respon","alt","",3,"src",4,"ngIf"],["alt","",1,"user-img","img_respon",3,"ngClass","ngStyle","src"],[1,"p-2","text-center",2,"border","2px solid red"],["alt","",1,"user-img","img_respon",2,"position","absolute","z-index","1","top","0","left","0",3,"src"],[2,"min-height","50px","min-width","50px","font-weight","bold","display","flex","line-height","1.5","font-weight","bold","align-items","center","justify-content","center","text-shadow","rgb(130 126 126) 1px 1px 1px",3,"ngStyle"],["width","30","height","30","class","","alt","",3,"src",4,"ngIf"],["width","30","height","30","alt","",1,"",3,"src"],[3,"ngStyle","innerHtml"]],template:function(i,a){1&i&&e.YNc(0,r,2,1,"ng-container",0),2&i&&e.Q6J("ngIf",a.result)},dependencies:[A.mk,A.sg,A.O5,A.PC,O.bT,O.GT,O.AL,O.kJ],encapsulation:2}),n})()},16031:(F,M,h)=>{h.d(M,{I:()=>y});var t=h(70655),e=h(4159),D=h(53583),A=h(17489),B=h(5e3),U=h(296),S=h(20814),R=h(88161),s=h(72491);const T={top:60,left:60,right:60,bottom:60};let y=(()=>{class x{get loadPercent(){return Math.floor(this.countDraw/this.totalDraw*100)}getSourceCanvas(o){return(0,t.mG)(this,void 0,void 0,function*(){var l=document.getElementById(o);return yield e(l,{scale:2})})}resetPosition(o){o&&(this.currentPos={left:60,top:60,right:60,bottom:60})}drawHomeworkNoteBoxOfTeacher(o){return(0,t.mG)(this,void 0,void 0,function*(){let l=document.querySelector(".box-point.display .text-mark");if(o){o.font="25px font_chu_dep",o.fillStyle="#000",l&&o.fillText("\u0110i\u1ec3m",90,this.currentPos.top+20),o.fillText("L\u1eddi ph\xea c\u1ee7a gi\xe1o vi\xean",420,this.currentPos.top+20),this.currentPos.top+=30;let c=document.querySelector(".box-msg .note p");if(c){o.lineWidth=2,o.fillStyle="#000",o.fillRect(this.currentPos.left,this.currentPos.top,o.canvas.width-this.currentPos.left-this.currentPos.right,1);const g=this.currentPos.top;let u=window.getComputedStyle(c,null).getPropertyValue("font"),f=window.getComputedStyle(c,null).getPropertyValue("color"),r=parseInt(u.split(" ")[0].split("p")[0],10);o.font=u;let n=this.exportPdfUtilsService.essayText2LinesArr(c.innerHTML,o,o.canvas.width-60-30-(l?200:0),16,u);this.currentPos.top+=35;const d=Math.round(1.5*r),i=this.currentPos.left+(l?200:0)+15;let a=0,E=200;for(let k=0;k<n.length;k++)for(let L=0;L<n[k].length;L++){const b=n[k][L];o.font=u,o.fillStyle=f,o.fillText(b,i,this.currentPos.top),this.currentPos.top+=d,a+=d}let w=document.querySelectorAll(".box-emoji> img"),I=this.currentPos.left+(l?100:0)+15,W=this.currentPos.top,N=78,z=78,H=15;w.forEach(k=>{var L;let b=new Image;b.src=null!==(L=k.getAttribute("src"))&&void 0!==L?L:"",b.onload=()=>{I=I+N+H,o.drawImage(b,I,W,N,z)}});let J=30+z;if(a>E-J&&(E=a+J),o.lineWidth=2,o.fillStyle="#000",o.fillRect(this.currentPos.left,g,1,E),l&&o.fillRect(this.currentPos.left+200,g,1,E),o.fillRect(o.canvas.width-this.currentPos.right,g,1,E),o.fillRect(this.currentPos.left,g+E,o.canvas.width-this.currentPos.right-this.currentPos.left,1),l){let k=l.getBoundingClientRect().width,L=l.getBoundingClientRect().height,b=window.getComputedStyle(l,null).getPropertyValue("font"),K=window.getComputedStyle(l,null).getPropertyValue("color");o.font=b,o.fillStyle=K,o.fillText(l.textContent?l.textContent:"",this.currentPos.left+100-k/2,g+E/2+L/4)}this.currentPos.top=g+E+20}else{if(o.lineWidth=2,o.rect(this.currentPos.left,this.currentPos.top,o.canvas.width-this.currentPos.left-this.currentPos.right,200),o.stroke(),l&&o.fillRect(this.currentPos.left+200,this.currentPos.top,1,200),l){let g=l.getBoundingClientRect().width,u=l.getBoundingClientRect().height,f=window.getComputedStyle(l,null).getPropertyValue("font"),r=window.getComputedStyle(l,null).getPropertyValue("color");o.font=f,o.fillStyle=r,o.fillText(l.textContent?l.textContent:"",this.currentPos.left+100-g/2,this.currentPos.top+150-u/2)}this.currentPos.top+=220}}})}drawExamTitle(o){if(o){let a=document.querySelector("#mainTitle span"),E=a?window.getComputedStyle(a,null).getPropertyValue("font"):"",w=null==a?void 0:a.getBoundingClientRect().width,I=null==a?void 0:a.getBoundingClientRect().height;var l=null==a?void 0:a.querySelector("img"),c=null==l?void 0:l.getBoundingClientRect().width,g=null==l?void 0:l.getBoundingClientRect().height,u=0;if(a&&a.textContent&&w&&I&&!(l&&c&&g)){var f=(o.canvas.width-w)/2,r=this.currentPos.top+15;o.font=E,o.fillStyle="#000",o.fillText(a.textContent,f,r),u=I+20}else a&&a.textContent&&w&&I&&l&&c&&g&&(f=(o.canvas.width-w)/2,r=this.currentPos.top+20,o.font=E,o.fillStyle="#000",o.fillText(a.textContent,f,r),u=I+40,o.drawImage(l,0,0,c,g,f+(w-c)+5,this.currentPos.top-10,c,g));u>0&&(this.currentPos.top+=u,this.countDraw++)}}drawColLeftRightInHeaderOfExam(o){var l;let c=document.getElementById("colLeftInfo"),g=document.getElementById("colRightInfo"),u=c?c.querySelectorAll("h3"):void 0,f=g?g.querySelectorAll("h3"):void 0,r={top:0,left:0,right:0,bottom:0};if(o){if(o.font="16px Arial",u)for(let v=0;v<u.length;v++){0==v&&(r=A.cloneDeep(this.currentPos));const n=u[v];n.textContent&&(o.fillText(null!==(l=n.textContent)&&void 0!==l?l:"",this.currentPos.left,this.currentPos.top),this.currentPos.top+=n.getBoundingClientRect().height+5)}if(f)for(let v=0;v<f.length;v++){const n=f[v];n.textContent&&(o.fillText(n.textContent,o.canvas.width-this.currentPos.right-n.getBoundingClientRect().width,r.top),r.top+=n.getBoundingClientRect().height+5)}}}drawBlockItemToPageForExam(o,l){return(0,t.mG)(this,void 0,void 0,function*(){if(o){let g=document.querySelectorAll(`.${this.exportPdfUtilsService.blockCropItemClass}`);if(g.length>0){let u=[];for(let f=0;f<g.length;f++)u.push(f);var c=yield this.getSourceCanvas("multipleChoiceWrap");for(const f of u){const r=g[f];let v=r.classList.contains(this.exportPdfUtilsService.blockEssayCropItemClass),n=r.classList.contains("__TXT_ESSAY_PARA");console.log("nvanh 1",n,v);let d=2*r.offsetLeft,i=2*r.offsetTop,a=2*r.getBoundingClientRect().width,E=2*r.getBoundingClientRect().height;const w=o.canvas.width-this.currentPos.left-this.currentPos.right,I=w*E/a;if(I<=o.canvas.height-this.currentPos.bottom-this.currentPos.top&&!v)this.drawSingleBlockItemToCanvas(o,c,w,I,{left:d,top:i,width:a,height:E},n);else if(this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,o.canvas.toDataURL("image/jpeg",1)),this.pdfDoc.addPage(),this.exportPdfUtilsService.eraseCanvas(o),this.resetPosition(l),"h"==this.exportPdfConvertDataService.findScaleDirection(a,E)){const W=o.canvas.height-T.top-T.bottom,N=W*a/E;this.drawSingleBlockItemToCanvas(o,c,w,I,{left:d,top:i,width:a,height:E},n,(o.canvas.width-N)/2,T.top,N,W)}else this.drawSingleBlockItemToCanvas(o,c,w,I,{left:d,top:i,width:a,height:E},n)}this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,o.canvas.toDataURL("image/jpeg",1))}else this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,o.canvas.toDataURL("image/jpeg",1))}})}convertEssayBoxes2Canvas(o,l,c,g){return(0,t.mG)(this,void 0,void 0,function*(){let u=[];for(let f=0;f<o.length;f++)u.push(f);for(const f of u){const r=yield e(o[f]);if(0==f&&l){const d=(l.canvas.width-50-50)*r.height/r.width;g&&d>l.canvas.height-50-this.currentPos.top&&(this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,l.canvas.toDataURL("image/jpeg",1)),this.exportPdfUtilsService.eraseCanvas(l),this.resetPosition(c),this.pdfDoc.addPage()),this.addEssayImage(l,o,r,f)}else this.exportPdfUtilsService.eraseCanvas(l),this.resetPosition(c),this.addEssayImage(l,o,r,f)}})}drawEssayIframeContent(o,l,c){return(0,t.mG)(this,void 0,void 0,function*(){let g=document.querySelectorAll(".essayPdfImage");if(g.length>0&&o){c||(this.exportPdfUtilsService.eraseCanvas(o),this.resetPosition(l),this.pdfDoc.addPage());let u=document.querySelector("#essayPdfTitle span");o&&u&&u.textContent&&(o.font="18px Georgia",o.fillStyle="#333",o.fillText(u.textContent,(o.canvas.width-u.getBoundingClientRect().width)/2,this.currentPos.top+20),this.currentPos.top+=u.getBoundingClientRect().height+20),yield this.convertEssayBoxes2Canvas(g,o,l,c)}})}addEssayImage(o,l,c,g){if(o){if("w"==this.exportPdfConvertDataService.findScaleDirection(c.width,c.height))o.drawImage(c,0,0,c.width,c.height,50,this.currentPos.top+50,o.canvas.width-100,(o.canvas.width-100)*c.height/c.width);else{let u=o.canvas.height-this.currentPos.top-this.currentPos.bottom,f=u*c.width/c.height;o.drawImage(c,0,0,c.width,c.height,(o.canvas.width-f)/2,this.currentPos.top,f,u)}console.log(`[_Essay_image_] V\u1ebd \u1ea3nh t\u1ef1 lu\u1eadn s\u1ed1 ${g+1}`),this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,o.canvas.toDataURL("image/jpeg",1)),this.countDraw++,g!=l.length-1&&this.pdfDoc.addPage()}}drawSingleBlockItemToCanvas(o,l,c,g,u,f,r,v,n,d){f&&this.currentPos.top!=T.top&&(this.currentPos.top-=60),o.drawImage(l,u.left,u.top,u.width,u.height,r||this.currentPos.left,v||this.currentPos.top,n||c,d||g),this.currentPos.top+=g+80,this.countDraw++}examToPdf(o,l){return(0,t.mG)(this,void 0,void 0,function*(){this.countDraw=0,this.totalDraw=document.querySelectorAll(`.${this.exportPdfUtilsService.blockCropItemClass}`).length,this.pdfDoc=new D.jsPDF;let c=document.createElement("canvas"),g=document.getElementById("multipleChoiceWrap");if(console.log("nvanh",g),g){let r=g.getBoundingClientRect().width;c.width=2*r,c.height=297*r/210*2}let u=c.getContext("2d");return this.exportPdfUtilsService.eraseCanvas(u),g&&this.resetPosition(g),g&&(yield this.drawBlockItemToPageForExam(u,g)),this.countDraw=this.totalDraw,yield this.exportPdfUtilsService.asyncTimeout(1e3),"class"==o?this.pdfDoc.output("blob"):(this.pdfDoc.save(l||"test_result.pdf"),!0)})}homeworkToPdf(){return(0,t.mG)(this,void 0,void 0,function*(){this.pdfDoc=new D.jsPDF;let o=document.createElement("canvas"),l=document.getElementById("multipleChoiceWrap");if(l){let u=l.getBoundingClientRect().width;o.width=u,o.height=297*u/210}let c=o.getContext("2d");return this.exportPdfUtilsService.eraseCanvas(c),l&&this.resetPosition(l),this.drawExamTitle(c),this.drawColLeftRightInHeaderOfExam(c),yield this.drawHomeworkNoteBoxOfTeacher(c),l&&(yield this.drawEssayIframeContent(c,l,!0)),this.pdfDoc.output("blob")})}constructor(o,l,c,g){this.exportPdfConvertDataService=o,this.exportPdfUtilsService=l,this.answerTypeService=c,this.timeService=g,this.totalDraw=1,this.countDraw=0,this.currentPos=T,this.pdfDoc=new D.jsPDF}}return x.\u0275fac=function(o){return new(o||x)(B.LFG(U.S),B.LFG(S.V),B.LFG(R.T),B.LFG(s.O))},x.\u0275prov=B.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})()},50136:(F,M,h)=>{h.d(M,{J:()=>U});var t=h(40520),e=h(34202),Z=h(51442),D=h(5e3),A=h(50690),O=h(45511),B=h(58326);let U=(()=>{class S{replaceImageInContent(s){return new e.y(_=>{if(s.includes("<img ")){var p=this.findAllSubString(s,"<img"),m=[],C=[];p.forEach(T=>{var y=s.indexOf("src=",T),x=s.indexOf('"',Number(y)+5),P=s.substring(Number(y)+5,Number(x)+1);P.includes(";base64")?m.push({oldUrl:P}):P.includes("blob:")&&C.push({oldUrl:P})}),m.length>0?this.reUploadBase64File(m,(T,y)=>{null!=y?this.reUploadBlobFile(C,(x,P)=>{null!=P?(s=this.replaceHomeworkContent(s,T),s=this.replaceHomeworkContent(s,x),_.next({errorMessage:void 0,content:s}),_.complete()):(_.next({errorMessage:P,content:s}),_.complete())}):(_.next({errorMessage:y,content:s}),_.complete())}):C.length>0?this.reUploadBlobFile(C,(T,y)=>{null!=y?(s=this.replaceHomeworkContent(s,T),_.next({errorMessage:void 0,content:s}),_.complete()):(_.next({errorMessage:y,content:s}),_.complete())}):(s=this.replaceHomeworkContent(s,[]),_.next({errorMessage:void 0,content:s}),_.complete())}else _.next({errorMessage:void 0,content:s}),_.complete()})}replaceHomeworkContent(s,_){return _.length>0&&_.forEach(p=>{var m,C=s.replace(null!==(m=p.oldUrl)&&void 0!==m?m:"  ",p.newUrl+'" class="w-100 img-fluid"');s=C}),s}findAllSubString(s,_){for(var p=0,m=0,C=[];s.indexOf(_,p)>-1;)m=s.indexOf(_,p),C.push(m),p=m+_.length;return C}getTypeFile(s){var _=s.indexOf(";");return s.substring(5,_)}getFileName(s){var _=s.split("").reverse().join(""),p=_.indexOf(";"),m=_.indexOf("/",p);return _.substring(p,m).split("").reverse().join("")}convertBlobToBase64(s){return new Promise(_=>{var p=new Image;p.crossOrigin="Anonymous",p.addEventListener("load",function(){var m=document.createElement("canvas"),C=m.getContext("2d");m.width=p.width,m.height=p.height,null==C||C.drawImage(p,0,0);var T=m.toDataURL("image/png");_(T)},!1),p.src=s})}reUploadBase64File(s,_){var p;if(s&&s.length>0){let y,T=s.length;for(var m=[],C=0;C<s.length;C++){const x=s[C],P=null===(p=x.oldUrl)||void 0===p?void 0:p.substring(0,x.oldUrl.length-1);this.startUploadBlobFile(x,null!=P?P:"",[],(o,l)=>{null==l?m=m.concat(o):y=l,T-=1,0==T&&_(m,y)})}}else _([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}reUploadBlobFile(s,_){var p;if(s&&s.length>0){let y,T=s.length;for(var m=[],C=0;C<s.length;C++){const x=s[C],P=null===(p=null==x?void 0:x.oldUrl)||void 0===p?void 0:p.substring(0,x.oldUrl.length-1);this.convertBlobToBase64(null!=P?P:"").then(o=>{this.startUploadBlobFile(x,o,[],(l,c)=>{null==c?m=m.concat(l):y=c,T-=1,0==T&&_(m,y)})})}}else _([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}startUploadBlobFile(s,_,p,m){if(_&&""!=_){var C=this.getTypeFile(_),T=this.myPdfService.b64toFile(_,this.getFileName(C),C);(0,Z.hv)(T).then(y=>{this.apiUploadService.uploadToCdnForHomework(y).subscribe(x=>{var P,o;if(x.type!=t.dt.UploadProgress)if(1==x.success){var l=Object.assign(Object.assign({},s),{newUrl:null!==(o=null===(P=x.data)||void 0===P?void 0:P.url)&&void 0!==o?o:""});p.push(l),m(p,void 0)}else m(p,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi[SPLIT_LANG] [SPLIT_LANG]"+x.message)})})}else m(p,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}constructor(s,_,p){this.commonService=s,this.apiUploadService=_,this.myPdfService=p}}return S.\u0275fac=function(s){return new(s||S)(D.LFG(A.v),D.LFG(O.$),D.LFG(B.t))},S.\u0275prov=D.Yz7({token:S,factory:S.\u0275fac,providedIn:"root"}),S})()}}]);