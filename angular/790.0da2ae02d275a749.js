"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[790],{41003:(W,B,l)=>{l.d(B,{Ip:()=>u,JR:()=>m,Le:()=>G,O8:()=>f,a3:()=>L,fI:()=>p,uG:()=>I});const f="00B050",G="f44336",L="_@COLOR@_",p="_@COLOR_END@_";function D(C,e,t){return C.replace(new RegExp(e,"g"),t)}function I(C,e="math",t=" xmlns"){if(!C)return"";const r=C.split(`<${e}`);return[["<span class=\"qv_string_eng_ans\" style='([^']+)'>([^<]*)<span style='([^']+)'>([A-Z])</span></span>",'<b><u below="$4"> $2</u></b>'],["([^>])(\r\n|\r|\n)([^<])","$1<br/>$3"]].forEach(c=>{for(let w=0;w<r.length;w++)if(r[w].startsWith(t)){const E=r[w].split(`</${e}>`);E.length>0&&(E[1]=D(E[1],c[0],c[1])),r[w]=E.join(`</${e}>`)}else r[w]=D(r[w],c[0],c[1])}),r.join(`<${e}`)}function m(C){return C.forEach(e=>{e.content=I(e.content);for(let t=0;t<e.answers.length;t++)e.answers[t]=I(e.answers[t])}),C}const g=[{key:"TABLE",value:'<w:tblPr><w:tblStyle w:val="TableGrid" /><w:tblpPr w:leftFromText="180" w:rightFromText="180" w:vertAnchor="text" w:tblpXSpec="right" w:tblpY="1" /><w:tblOverlap w:val="never" /><w:tblW w:w="0" w:type="auto" /><w:tblBorders><w:insideV w:val="none" w:sz="0" w:space="0" w:color="auto" /></w:tblBorders><w:tblCellMar><w:top w:w="113" w:type="dxa" /><w:left w:w="397" w:type="dxa" /><w:bottom w:w="113" w:type="dxa" /><w:right w:w="397" w:type="dxa" /></w:tblCellMar><w:tblLook w:val="0600" w:firstRow="0" w:lastRow="0" w:firstColumn="0" w:lastColumn="0" w:noHBand="1" w:noVBand="1" /></w:tblPr>'},{key:"CORRECT",value:`<w:tcPr><w:tcW w:w="0" w:type="auto" /><w:tcBorders><w:top w:val="single" w:sz="4" w:space="0" w:color="FFFFFF" /><w:left w:val="single" w:sz="4" w:space="0" w:color="FFFFFF" /><w:bottom w:val="single" w:sz="4" w:space="0" w:color="FFFFFF" /><w:right w:val="single" w:sz="4" w:space="0" w:color="${L}" /></w:tcBorders><w:vAlign w:val="center" /></w:tcPr>`},{key:"KEY_RESULT",value:`<w:tcPr><w:tcW w:w="0" w:type="auto" /><w:tcBorders><w:top w:val="single" w:sz="4" w:space="0" w:color="${L}" /><w:left w:val="single" w:sz="4" w:space="0" w:color="FFFFFF" /><w:bottom w:val="single" w:sz="4" w:space="0" w:color="${L}" /><w:right w:val="single" w:sz="4" w:space="0" w:color="${p}" /></w:tcBorders><w:vAlign w:val="center" /></w:tcPr>`},{key:"FILL_RESULT",value:`<w:tcPr><w:tcW w:w="0" w:type="auto" /><w:tcBorders><w:top w:val="single" w:sz="4" w:space="0" w:color="${L}" /><w:left w:val="single" w:sz="4" w:space="0" w:color="FFFFFF" /><w:bottom w:val="single" w:sz="4" w:space="0" w:color="${L}" /><w:right w:val="single" w:sz="4" w:space="0" w:color="${L}" /></w:tcBorders><w:vAlign w:val="center" /></w:tcPr>`},{key:"HEADER_TABLE",value:'<w:tblPr><w:tblW w:w="0" w:type="auto"/><w:jc w:val="center"/><w:tblBorders><w:top w:val="single" w:sz="4" w:space="0" w:color="auto"/><w:left w:val="single" w:sz="4" w:space="0" w:color="auto"/><w:bottom w:val="single" w:sz="4" w:space="0" w:color="auto"/><w:right w:val="single" w:sz="4" w:space="0" w:color="auto"/><w:insideH w:val="single" w:sz="4" w:space="0" w:color="auto"/><w:insideV w:val="single" w:sz="4" w:space="0" w:color="auto"/></w:tblBorders><w:tblLook w:val="04A0" w:firstRow="1" w:lastRow="0" w:firstColumn="1" w:lastColumn="0" w:noHBand="0" w:noVBand="1"/></w:tblPr>'},{key:"HEADER_TABLE_NO_BORDER",value:'<w:tblPr><w:tblW w:w="0" w:type="auto"/><w:jc w:val="center"/><w:tblLook w:val="04A0" w:firstRow="1" w:lastRow="0" w:firstColumn="1" w:lastColumn="0" w:noHBand="0" w:noVBand="1"/></w:tblPr>'},{key:"HEADER_TABLE_TR",value:'<w:trPr><w:jc w:val="center" /></w:trPr>'},{key:"HEADER_TABLE_LEFT",value:'<w:tcPr><w:tcW w:w="3528" w:type="dxa" /></w:tcPr>'},{key:"HEADER_TABLE_RIGHT",value:'<w:tcPr><w:tcW w:w="7262" w:type="dxa" /><w:hideMark /></w:tcPr>'},{key:"TB_RESULT_TXT",value:'<w:pPr><w:jc w:val="center" /></w:pPr>'},{key:"TB_RESULT_POINT",value:'<w:pPr><w:jc w:val="center" /></w:pPr>'},{key:"TB_RESULT_COMMENT",value:"<w:pPr><w:rPr><w:i /><w:iCs /></w:rPr></w:pPr>"},{key:"LINE_CENTER",value:'<w:pPr><w:jc w:val="center" /></w:pPr>'}];class u{static get(e,t=[]){const a=g.find(r=>r.key===e);if(a){let r=a.value;for(const c of t)r=D(r,c.key,c.value);return btoa(r)}return""}static makeHeaderTable(e,t,a=!0){const r=document.createElement("table"),c=document.createElement("tr");r.appendChild(c);const w=document.createElement("td"),E=document.createElement("td");c.appendChild(w),c.appendChild(E),r.setAttribute("docx-style",u.get(a?"HEADER_TABLE":"HEADER_TABLE_NO_BORDER")),c.setAttribute("docx-style",u.get("HEADER_TABLE_TR")),w.setAttribute("docx-style",u.get("HEADER_TABLE_LEFT")),E.setAttribute("docx-style",u.get("HEADER_TABLE_RIGHT"));const z=document.createElement("span"),s=document.createElement("span");return e.forEach(n=>{if("string"==typeof n){const _=document.createElement("br"),i=document.createElement("b");i.innerText=n,i.appendChild(_),z.appendChild(i)}else z.appendChild(n)}),t.forEach(n=>{if("string"==typeof n){const _=document.createElement("br"),i=document.createElement("b");i.innerText=n,i.appendChild(_),s.appendChild(i)}else s.appendChild(n)}),w.appendChild(z),E.appendChild(s),r.outerHTML}static createLineBold(e){const t=document.createElement("p"),a=document.createElement("b");return a.innerText=e,t.appendChild(a),t}static createLineCenterBold(e){const t=document.createElement("p"),a=document.createElement("b");return t.setAttribute("docx-style",u.get("LINE_CENTER")),a.innerText=e,t.appendChild(a),t}static createLineCenterItalicized(e){const t=document.createElement("p"),a=document.createElement("i");return t.setAttribute("docx-style",u.get("LINE_CENTER")),a.innerText=e,t.appendChild(a),t}}},52630:(W,B,l)=>{l.d(B,{s:()=>g});var f=l(65879),G=l(87384),L=l(50626),p=l(32839),D=l(92774),I=l(75108),m=l(11530);let g=(()=>{class u{constructor(e,t,a,r,c,w){this.commonService=e,this.sortService=t,this.shareFileFlutterService=a,this.encryptService=r,this.formatAnswerSheetService=c,this.exportExcelService=w}exportFileNameOfStudentCode(e,t,a){return 100==e&&(t=""),this.commonService.createFileNameExportFile(["DanhSachSBD"+(t?"_"+t:"")+"_"+this.encryptService.createMd5(a).substring(0,6)])+".xlsx"}chooseAnswerSheetTemplate(e,t,a,r,c,w){return 12==t?e.createA5AnswerSheetFullA4_50(w??50):13==t?e.createA4AnswerSheet_35hh(w??50):14==t?e.createA6AnswerSheetFullA4_20(w??20):e.createAzotaAnswerSheet_A4(w??120)}exportFileNameOfAnswerSheet(e,t,a){var r="";return 100==e&&(t=""),(0==e||100==e)&&(r=this.commonService.createFileNameExportFile(["PhieuTL_"+a+(t?"_"+t:"")])),r}exportFileNameOfAnswerExcelOffline(e,t,a){var r="";return 100==e&&(t=""),(0==e||100==e)&&(r=this.commonService.createFileNameExportFile(["DapAn_"+(t?"_"+t:"")])),r}exportFileNameOfRawExam(e,t,a){var r="";return 100==e&&(t=""),(0==e||100==e)&&(r=this.commonService.createFileNameExportFile([(t?"_"+t:"")+"_"+this.encryptService.createMd5(a).substring(0,6)])),r}exportFileNameOfExamOffline(e,t,a,r){var c="";return 100==e&&(t=""),(0==e||100==e)&&(c=this.commonService.createFileNameExportFile([(r?this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(r,3)+"_":"")+a+(t?"_"+t:"")])),c}printStudentCode(e,t){var a=[];let r=this.commonService.myClone(t);for(let c=0;c<r.length;c++)a.push({code:r[c].code??0,fullName:r[c]?.fullName??"",birthday:r[c]?.birthday??"",className:r[c].classroomName??""});this._exportExcelForCodeNumber(e,a)}_exportExcelForCodeNumber(e,t){let a=this.exportFileNameOfStudentCode(0,e?.name??"",e?.hashId??"");const r=this.exportExcelService.exportExcelForCodeNumber(t);this.shareFileFlutterService.shareFileWithBlob(r,a)}}return u.\u0275fac=function(e){return new(e||u)(f.LFG(G.z),f.LFG(L.V),f.LFG(p.g),f.LFG(D.j),f.LFG(I.j),f.LFG(m.L))},u.\u0275prov=f.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},96790:(W,B,l)=>{l.d(B,{F:()=>w});var f=l(85965),L=l(3760),p=l(60013),D=l(8720),I=l(86670),m=l(41003),g=l(65879),u=l(8415),C=l(87384),e=l(63934),t=l(66131),a=l(52630),r=l(75108),c=l(32839);let w=(()=>{class E{constructor(s,n,_,i,A,b,o){this.cdnService=s,this.commonService=n,this.userService=_,this.questionRenderService=i,this.printAnswersheetService=A,this.formatAnswerSheetService=b,this.shareFileFlutterService=o,this.configRenderService=new D.v,this.saveLoadingMsg="",this.isAnsDetail=!1,this.isEnableDebug=!1,this.zipper=new f,this.countRetryLoadJS=0}loadScriptAction(){return new Promise((s,n)=>{this.commonService.loadScriptPromises([{source:this.cdnService.registerJsCdn("min.azota_docx_script"),name:"min.azota_docx_script"}]).then(()=>{setTimeout(()=>{window.hasOwnProperty("azotaDocx")?(typeof azotaDocx<"u"&&azotaDocx&&s(!0),n(new Error)):(this.countRetryLoadJS++,this.countRetryLoadJS>3?n(new Error("lang_core_lib_not_load")):s(this.loadScriptAction()))},1e3)})})}convertAnswerQuestion(s){let n=[];return s.forEach(_=>{let i="<b>     "+(_.alpha?_.alpha:_.key)+".</b> "+(0,m.uG)(_.content);n.push(i)}),n}getDataForExportDocxApi(s,n,_){let i=[],A=1;if(_){let o=this.commonService.myTranslateInstant("lang_cms_publish_test_exam");i.push({content:`<b> ${o} `+this.formatAnswerSheetService.formatOfflineExamHashIdToNumber(_,3)+".</b>",answers:[]})}let b=this.expandInfoParse?.label??this.commonService.myTranslateInstant("lang_auto_cau");return n.forEach(o=>{1!==s.hideGroupQuestion&&o.groupInfo?.isFirstInGroup&&o.groupInfo.groupContent&&i.push({content:o.groupInfo.groupContent,answers:[]}),this.isEnableDebug&&i.push({content:` <br/><br/><br/>*** <b>Question ID: ${o.id}</b> ***`,answers:[]});let h={content:`<b>${b} `+(A+(s.startQuestionIndex??1)-1)+".</b> "+(o.content?.includes("<img")?"<br>":"")+(0,m.uG)(o.content),answers:this.convertAnswerQuestion(o.answers??[])};if(A++,i.push(h),this.isAnsDetail){if(o.answerResult){let d=[];o.answerResult.forEach(S=>{let O=S;const x=o.answers?.find(F=>F.key===S);x&&(O=x.alpha??O),d.push(O)}),i.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_dap_an_dung")}</b>: ${d.join(" | ")}`,answers:[]})}o.help&&i.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_giai_thich_chi_tiet_upper")}</b>: ${o.help}`,answers:[]})}this.isEnableDebug&&i.push({content:"*** *************** .. **************** ***<br/><br/><br/>",answers:[]})}),i}itemConverterCaller(s,n,_,i,A){return new Promise((b,o)=>{this.questionRenderService.parseRenderQuestions(s.listQuestion,h=>{this.saveLoadingMsg.includes(")")||(this.changeMsg?this.changeMsg(this.saveLoadingMsg+Math.floor(h)+"%"):p.G.changeMsgLoadingEffect(this.saveLoadingMsg+Math.floor(h)+"%"))},this.configRenderService,void 0,!0,A).then(h=>{let d=[];d.push({content:m.Ip.makeHeaderTable([m.Ip.createLineCenterBold(n.schoolName?n.schoolName:"")],[m.Ip.createLineCenterBold(n.examName??""),m.Ip.createLineCenterBold(n.subject??""),m.Ip.createLineCenterItalicized(n.examMinutes??""),m.Ip.createLineCenterItalicized("-------------------------")],!1),answers:[]}),d.push({content:m.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_ho_ten_thi_sinh_offline")??"").outerHTML,answers:[]}),d.push({content:m.Ip.createLineBold(this.commonService.myTranslateInstant("lang_auto_so_bao_danh_offline")??"").outerHTML,answers:[]}),d=d.concat(this.getDataForExportDocxApi(i,h,s.offlineExamMixQuestionObj?s.offlineExamMixQuestionObj.hashId??0:void 0)),typeof azotaDocx<"u"&&azotaDocx?azotaDocx.exportToDocxBinary({questions:d,additionalParams:{isHeadless:!0}}).then(S=>{b({userObj:_,data:S,input:d,additionParams:n,offlineExamMixQuestionObj:s.offlineExamMixQuestionObj})}):o(new Error("C\xf3 l\u1ed7i x\u1ea3y ra trong qu\xe1 tr\xecnh x\u1eed l\xfd d\u1eef li\u1ec7u (Kh\xf4ng t\u1ea3i \u0111\u01b0\u1ee3c th\u01b0 vi\u1ec7n). Vui l\xf2ng F5 v\xe0 th\u1eed l\u1ea1i sau!"))}).catch(h=>{o(new Error(h[0].message))})})}masterConverterCaller(s,n,_,i,A,b){return new Promise((o,h)=>{const d=this.userService.getUserObj();let S=this.commonService.myTranslateInstant("lang_testbank_utils_footer_infomation_school")?.toLowerCase(),O=this.commonService.myTranslateInstant("lang_auto_docx_mon_thi")?.toLowerCase(),x=this.commonService.myTranslateInstant("lang_auto_docx_bai_thi")?.toLowerCase(),F=this.commonService.myTranslateInstant("lang_testbank_testted_list_time_homework"),P=this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de"),R=this.commonService.myTranslateInstant("lang_testbank_testted_list_minute"),y=this.commonService.myTranslateInstant("lang_auto_khong_gioi_han");const N=new L.Q(1,{function:(T,v)=>{this.saveLoadingMsg=`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_cho_de_thi")} ${v<=1?"":`(${T}/${v}) `}`,this.changeMsg?this.changeMsg(this.saveLoadingMsg):p.G.changeMsgLoadingEffect(this.saveLoadingMsg)}});s.forEach(T=>{N.addTask(this,this.itemConverterCaller,[T,{schoolName:i?.nameSchool??`{${S}}`,subject:i?.nameSubject??`{${O}}`,examName:n.name??`{${x}}`,examMinutes:n.minutes&&n.minutes>0?`${F}: `+n.minutes+` ${R} (${P})`:` ${F}: ${y}`,templateType:A??0,numberOfQuestion:T.listQuestion.length,examId:T.offlineExamMixQuestionObj?.hashId??0},d,n,b])}),N.start().then(T=>{if(T.errs.length>0)h(T.errs[0]);else if(1===T.datas.length){const v=T.datas[0],M=new Blob([v.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let $=this.createNameExam(n,_,v.offlineExamMixQuestionObj);this.shareFileFlutterService.shareFileWithBlob(M,$),o()}else T.datas.forEach(v=>{let M=this.createNameExam(n,_,v.offlineExamMixQuestionObj);M=this.replaceAllString(M,"/","_"),this.zipper.file("DOCS/"+M,v.data)}),setTimeout(()=>{this.zipper.generateAsync({type:"blob"}).then(v=>{let M=this.commonService.createFileNameExportFile([n.name??"azota"])+"_offline_test.zip";this.shareFileFlutterService.shareFileWithBlob(v,M),o()},v=>{h(v)})},200)})})}replaceAllString(s,n,_){for(;s.includes(n);)s=s.replace(n,_);return s}createNameExam(s,n,_){return n?this.printAnswersheetService.exportFileNameOfExamOffline(0,s.name??"",n?.hashId??"",_?.hashId??0)+".docx":this.printAnswersheetService.exportFileNameOfRawExam(0,s.name??"",s.hashId??"")+".docx"}downloadExam(s,n,_,i,A,b,o,h,d,S,O){return new Promise((x,F)=>{this.isAnsDetail=s,this.isEnableDebug=!!S,this.expandInfoParse=this.commonService.castJsonToObj(n.expandInfo??"{}"),this.changeMsg=d,this.loadScriptAction().then(P=>{P?this.masterConverterCaller([{listQuestion:A,offlineExamMixQuestionObj:i}],n,_,b,o,O).then(()=>{this.zipper=new f,h?h(10):p.G.closeLoadingEffect(10),x()}).catch(R=>{p.G.closeLoadingEffect(10),F(R)}):(h?h(10):p.G.closeLoadingEffect(10),F(new Error("lang_core_lib_not_load")))}).catch(()=>{h?h(10):p.G.closeLoadingEffect(10),F(new Error("lang_core_lib_not_load"))})})}downloadExamObjs(s,n,_,i,A,b,o,h,d,S){return new Promise((O,x)=>{this.isAnsDetail=s,this.isEnableDebug=!!d,this.expandInfoParse=this.commonService.castJsonToObj(n.expandInfo??"{}"),this.changeMsg=h,this.loadScriptAction().then(F=>{if(F){let P=!0;const R=[];i.forEach(y=>{let N=this.commonService.castJsonToClassObjs(I.v,JSON.stringify(y.mixQuestions??[]))??[];N.length>0?R.push({listQuestion:N,offlineExamMixQuestionObj:y}):P=!1}),P?this.masterConverterCaller(R,n,_,A,b,S).then(()=>{this.zipper=new f,o?o(10):p.G.closeLoadingEffect(10),O()}).catch(y=>{o?o(10):p.G.closeLoadingEffect(10),x(y)}):(o?o(10):p.G.closeLoadingEffect(10),x(new Error("\u0110\u1ec1 thi kh\xf4ng h\u1ee3p l\u1ec7")))}else o?o(10):p.G.closeLoadingEffect(10),x(new Error("lang_core_lib_not_load"))}).catch(()=>{o?o(10):p.G.closeLoadingEffect(10),x(new Error("lang_core_lib_not_load"))})})}}return E.\u0275fac=function(s){return new(s||E)(g.LFG(u.E),g.LFG(C.z),g.LFG(e.U),g.LFG(t.h),g.LFG(a.s),g.LFG(r.j),g.LFG(c.g))},E.\u0275prov=g.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})()}}]);