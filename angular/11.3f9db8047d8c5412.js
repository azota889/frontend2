"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[11],{68234:(Qe,ce,v)=>{v.d(ce,{z:()=>B});var D=v(39621),h=v(65879),u=v(96814),_=v(56223),le=v(775),d=v(11964);function Q(S,m){if(1&S&&(h.TgZ(0,"div",1)(1,"form",2),h._UZ(2,"input",3),h.ALo(3,"mytranslate"),h._UZ(4,"input",4),h.ALo(5,"mytranslate"),h.qZA()()),2&S){const x=h.oxw();h.xp6(1),h.Q6J("formGroup",x.form),h.xp6(1),h.s9C("placeholder",h.lcZ(3,3,"lang_auto_ten_truong")),h.xp6(2),h.s9C("placeholder",h.lcZ(5,5,"lang_auto_mon_hoc_form"))}}let B=(()=>{class S extends D.Q{constructor(){super(),this.type=""}initData(){this.form?.patchValue({schoolName:this.examPrintInfoObj.schoolName,subjectName:this.examPrintInfoObj.subject})}ngOnInit(){this.initData()}}return S.\u0275fac=function(x){return new(x||S)},S.\u0275cmp=h.Xpm({type:S,selectors:[["add-info-print"]],inputs:{form:"form",examPrintInfoObj:"examPrintInfoObj",type:"type"},features:[h.qOj],decls:1,vars:1,consts:[["class","add-info-print",4,"ngIf"],[1,"add-info-print"],[3,"formGroup"],["id","school-name","type","text","formControlName","schoolName",1,"form-control","mt-3",3,"placeholder"],["id","subject-name","type","text","formControlName","subjectName",1,"form-control","mt-3",3,"placeholder"]],template:function(x,g){1&x&&h.YNc(0,Q,6,7,"div",0),2&x&&h.Q6J("ngIf",g.form)},dependencies:[u.O5,_._Y,_.Fj,_.JJ,_.JL,_.sg,_.u,le.M,d.bT],encapsulation:2}),S})()},51969:(Qe,ce,v)=>{v.d(ce,{l:()=>B});var D=v(39621),h=v(65879),u=v(8415),_=v(96814);let le=(()=>{class S{convertUrl(){this.src=this.cdnService.getRawCdnLink(this.src)}constructor(x){this.cdnService=x,this.src=""}}return S.\u0275fac=function(x){return new(x||S)(h.Y36(u.U))},S.\u0275dir=h.lG2({type:S,selectors:[["","appImageFallback",""]],hostVars:1,hostBindings:function(x,g){1&x&&h.NdJ("error",function(){return g.convertUrl()}),2&x&&h.Ikx("src",g.src,h.P3R)},inputs:{src:"src"}}),S})();var d=v(11964);function Q(S,m){1&S&&(h.TgZ(0,"div",2),h._UZ(1,"img",3),h.ALo(2,"convertCdnLinkOfGitHub"),h.qZA()),2&S&&(h.xp6(1),h.Q6J("src",h.lcZ(2,1,"azota_assets/svgs/Img2_dat-01.svg"),h.LSH))}let B=(()=>{class S extends D.Q{onError(x){if(this.isRetry){const g=x.target;setTimeout(()=>{1==this.countRetry?(g.src=this.cdnService.getMyCdn(this.imgSrc??""),this.countRetry++):this.countRetry<5?(this.countRetry++,g.src=this.cdnService.getRawCdnLink(this.imgSrc??"")+"?t="+(new Date).getTime()):this.stopStatusObj()},500)}}onLoad(){this.stopStatusObj()}get isLazyLoad(){return void 0!==this.width&&void 0!==this.height}constructor(x,g){super(),this.cdnService=x,this.cd=g,this.noClass=!1,this.isRetry=!0,this.countRetry=1}ngOnInit(){this.initStatusObj(),super.ngOnInit()}}return S.\u0275fac=function(x){return new(x||S)(h.Y36(u.U),h.Y36(h.sBO))},S.\u0275cmp=h.Xpm({type:S,selectors:[["azt-loaded-img"]],inputs:{imgSrc:"imgSrc",id:"id",noClass:"noClass",width:"width",height:"height",isRetry:"isRetry"},features:[h.qOj],decls:3,vars:10,consts:[["class","px-4 py-3 text-center",4,"ngIf"],["appImageFallback","",2,"width","100%",3,"width","height","hidden","load","error"],[1,"px-4","py-3","text-center"],["alt","image_loading_placeholer",3,"src"]],template:function(x,g){1&x&&(h.YNc(0,Q,3,3,"div",0),h.TgZ(1,"img",1),h.NdJ("load",function(){return g.onLoad()})("error",function(I){return g.onError(I)}),h.ALo(2,"mycdn"),h.qZA()),2&x&&(h.Q6J("ngIf",!g.isLazyLoad&&g.statusObj.loading),h.xp6(1),h.Tol(g.id?"img-fluid questionId_"+g.id:g.noClass?"w-auto":"img-fluid"),h.Q6J("width",void 0!==g.width?g.width:null)("height",void 0!==g.height?g.height:null)("hidden",!g.isLazyLoad&&g.statusObj.loading),h.uIk("loading",g.isLazyLoad?"lazy":"eager")("src",h.lcZ(2,8,g.imgSrc),h.LSH))},dependencies:[_.O5,le,d.GT,d.Jc],encapsulation:2}),S})()},63833:(Qe,ce,v)=>{v.d(ce,{$:()=>j});var D=v(39621),h=v(65879),u=v(36922),_=v(96814),le=v(74104),d=v(11964);function Q(I,A){if(1&I&&(h.TgZ(0,"td",10),h._uU(1),h.qZA()),2&I){const O=h.oxw().$implicit,q=h.oxw().$implicit,w=h.oxw(2);h.uIk("rowspan",q.length),h.xp6(1),h.Oqu(w.toNumber(O.index)+1)}}const B=function(I){return{"font-bold":I}};function S(I,A){if(1&I&&(h.ynx(0),h.TgZ(1,"tr"),h.YNc(2,Q,2,2,"td",9),h.TgZ(3,"td",10),h._uU(4),h.ALo(5,"formatFullDateTimeTimezoneByUserUnitPipe"),h.qZA(),h.TgZ(6,"td",11),h._uU(7),h.qZA()(),h.BQk()),2&I){const O=A.$implicit,q=A.index,w=h.oxw().$implicit;h.xp6(2),h.Q6J("ngIf",0==q),h.xp6(2),h.Oqu(h.lcZ(5,4,1e3*O.second)),h.xp6(2),h.Q6J("ngClass",h.VKq(6,B,q==w.length-1)),h.xp6(1),h.Oqu(O.alpha?O.alpha:O.key)}}function m(I,A){if(1&I&&(h.ynx(0),h.YNc(1,S,8,8,"ng-container",8),h.BQk()),2&I){const O=A.$implicit;h.xp6(1),h.Q6J("ngForOf",O)}}function x(I,A){if(1&I&&(h.TgZ(0,"table",4)(1,"tr")(2,"th",5),h._uU(3),h.ALo(4,"mytranslate"),h.qZA(),h.TgZ(5,"th",6),h._uU(6),h.ALo(7,"mytranslate"),h.qZA(),h.TgZ(8,"th",7),h._uU(9),h.ALo(10,"mytranslate"),h.qZA()(),h.YNc(11,m,2,1,"ng-container",8),h.qZA()),2&I){const O=h.oxw();h.xp6(3),h.Oqu(h.lcZ(4,4,"lang_auto_cau_hoi")),h.xp6(3),h.Oqu(h.lcZ(7,6,"lang_auto_thoi_gian")),h.xp6(3),h.Oqu(h.lcZ(10,8,"lang_auto_dap_an")),h.xp6(2),h.Q6J("ngForOf",O.groupObjs)}}function g(I,A){1&I&&(h.TgZ(0,"div",12),h._uU(1),h.ALo(2,"mytranslate"),h.qZA()),2&I&&(h.xp6(1),h.Oqu(h.lcZ(2,1,"lang_auto_khong_co_du_lieu_lam_bai_trac_nghiem_chon_dap_an_dung_cua_thi_sinh")))}let j=(()=>{class I extends D.Q{findReTapQuesions(){var O=this.dictionaryService.getDictionaryByGroupFieldTS(this.dataResultObjs??[],"index");for(var q in O)O.hasOwnProperty(q)&&this.groupObjs.push(O[q])}toNumber(O){return parseInt(O,10)+this.startQuestionIndex-1}ngOnInit(){this.findReTapQuesions(),super.ngOnInit()}constructor(O){super(),this.dictionaryService=O,this.startQuestionIndex=1,this.groupObjs=[],this.timezoneOffset=(new Date).getTimezoneOffset()}}return I.\u0275fac=function(O){return new(O||I)(h.Y36(u.E))},I.\u0275cmp=h.Xpm({type:I,selectors:[["azt-test-result-tracking"]],inputs:{startQuestionIndex:"startQuestionIndex",dataResultObjs:"dataResultObjs",dataScrollObjs:"dataScrollObjs"},features:[h.qOj],decls:7,vars:5,consts:[[3,"label"],[1,"overflow-x-auto","mt-5"],["id","tracktable","class","table table-bordered",4,"ngIf","ngIfElse"],["noData",""],["id","tracktable",1,"table","table-bordered"],["id","questionNum",1,"w-24","text-center"],["id","timeStamp",1,"w-56","text-center"],["id","answerLabel",1,"w-24","text-center"],[4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],[1,"text-center"],[1,"text-center",3,"ngClass"],[1,"alert","alert-secondary","p-5"]],template:function(O,q){if(1&O&&(h.TgZ(0,"mat-tab-group")(1,"mat-tab",0),h.ALo(2,"mytranslate"),h.TgZ(3,"div",1),h.YNc(4,x,12,10,"table",2),h.YNc(5,g,3,3,"ng-template",null,3,h.W1O),h.qZA()()()),2&O){const w=h.MAs(6);h.xp6(1),h.s9C("label",h.lcZ(2,3,"lang_auto_chi_tiet_chon_dap_an")),h.xp6(3),h.Q6J("ngIf",q.groupObjs.length>0)("ngIfElse",w)}},dependencies:[_.mk,_.sg,_.O5,le.uX,le.SP,d.bT,d.kg],encapsulation:2}),I})()},70723:(Qe,ce,v)=>{v.d(ce,{o:()=>Q});var D=v(39621),h=v(65879),u=v(77988),_=v(92596),le=v(44589),d=v(11964);let Q=(()=>{class B extends D.Q{constructor(){super(...arguments),this.id="",this.linkUrl="",this.fileName="",this.qrCodeDownloadLink=""}bindUrlToQrCode(){}onChangeURL(m){this.qrCodeDownloadLink=m}downloadQrCode(){try{var m=document.createElement("a");document.body.appendChild(m),m.setAttribute("href",this.qrCodeDownloadLink.changingThisBreaksApplicationSecurity),m.setAttribute("download",""!=this.fileName?this.commonService.createFileNameExportFile([this.fileName])+".jpg":this.commonService.createFileNameExportFile(["azota-qr-code-"])+".jpg"),m.click()}catch{console.log("Download qrcode error")}}}return B.\u0275fac=function(){let S;return function(x){return(S||(S=h.n5z(B)))(x||B)}}(),B.\u0275cmp=h.Xpm({type:B,selectors:[["azt-download-qr-code"]],inputs:{id:"id",linkUrl:"linkUrl",fileName:"fileName"},features:[h.qOj],decls:27,vars:12,consts:[["azt-track-service","download-qr-code-hiQXy_iTc",1,"btn","btn-outline-primary","btn-transparent","p-1",3,"matMenuTriggerFor","matTooltip","click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-6","h-6"],["x","3","y","3","width","5","height","5","rx","1"],["x","16","y","3","width","5","height","5","rx","1"],["x","3","y","16","width","5","height","5","rx","1"],["d","M21 16h-3a2 2 0 0 0-2 2v3"],["d","M21 21v.01"],["d","M12 7v3a2 2 0 0 1-2 2H7"],["d","M3 12h.01"],["d","M12 3h.01"],["d","M12 16v.01"],["d","M16 12h1"],["d","M21 12v.01"],["d","M12 21v-1"],["showQrCode","matMenu"],["azt-track-service","download-qr-code-9t-9Wiu2xv",1,"box","p-3","text-center",3,"click"],[2,"background","#fff","padding","5px"],["colorDark","#2361ad","imageSrc","https://cdn.jsdelivr.net/gh/azota889/storage_public/azota_assets/images/Azota-For-QrCode-01.png",3,"allowEmptyString","qrdata","elementType","width","errorCorrectionLevel","qrCodeURL"],["azt-track-service","download-qr-code-RqVBz6g1z7",1,"btn","btn-outline-primary","btn-transparent","btn-sm","mx-auto","mt-2",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-4","h-4","mr-2"],["d","M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"],["points","7 10 12 15 17 10"],["x1","12","y1","15","x2","12","y2","3"]],template:function(m,x){if(1&m&&(h.TgZ(0,"button",0),h.NdJ("click",function(){return x.bindUrlToQrCode()}),h.ALo(1,"mytranslate"),h.O4$(),h.TgZ(2,"svg",1),h._UZ(3,"rect",2)(4,"rect",3)(5,"rect",4)(6,"path",5)(7,"path",6)(8,"path",7)(9,"path",8)(10,"path",9)(11,"path",10)(12,"path",11)(13,"path",12)(14,"path",13),h.qZA()(),h.kcU(),h.TgZ(15,"mat-menu",null,14)(17,"div",15),h.NdJ("click",function(j){return j.stopPropagation()}),h.TgZ(18,"div",16)(19,"qrcode",17),h.NdJ("qrCodeURL",function(j){return x.onChangeURL(j)}),h.qZA()(),h.TgZ(20,"a",18),h.NdJ("click",function(){return x.downloadQrCode()}),h.O4$(),h.TgZ(21,"svg",19),h._UZ(22,"path",20)(23,"polyline",21)(24,"line",22),h.qZA(),h._uU(25),h.ALo(26,"mytranslate"),h.qZA()()()),2&m){const g=h.MAs(16);h.s9C("matTooltip",h.lcZ(1,8,"lang_auto_quet_hoac_tai_ma_qr_code")),h.Q6J("matMenuTriggerFor",g),h.xp6(19),h.Q6J("allowEmptyString",!0)("qrdata",x.linkUrl)("elementType","url")("width",128)("errorCorrectionLevel","M"),h.xp6(6),h.hij(" ",h.lcZ(26,10,"lang_auto_tai_ve_may")," ")}},dependencies:[u.VK,u.p6,_.gM,le.V,d.bT],encapsulation:2}),B})()},65076:(Qe,ce,v)=>{v.d(ce,{P:()=>oe});var D=v(49671),h=v(69862),u=v(65879),_=v(56223),le=v(69384),d=v(39621),Q=v(94913),B=v(14845),S=v(94281),m=v(8415),x=v(50952),g=v(50503),j=v(58222),I=v(96814),A=v(30617),O=v(92596),q=v(87303),w=v(81373),Y=v(775),K=v(27222),Le=v(11964);const pe=["mnoteContainer"],Xe=["aztMarkNote"];function Ve(F,ne){1&F&&(u.TgZ(0,"span"),u._uU(1),u.ALo(2,"mytranslate"),u.qZA()),2&F&&(u.xp6(1),u.hij(" ",u.lcZ(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function jt(F,ne){1&F&&(u.TgZ(0,"span"),u._uU(1),u.ALo(2,"mytranslate"),u.qZA()),2&F&&(u.xp6(1),u.hij(" ",u.lcZ(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function Ft(F,ne){1&F&&(u.TgZ(0,"span"),u._uU(1),u.ALo(2,"mytranslate"),u.qZA()),2&F&&(u.xp6(1),u.hij(" ",u.lcZ(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function bt(F,ne){if(1&F&&(u.TgZ(0,"div",18),u.YNc(1,Ve,3,3,"span",9),u.YNc(2,jt,3,3,"span",9),u.YNc(3,Ft,3,3,"span",9),u.qZA()),2&F){const k=u.oxw().index,N=u.oxw();u.xp6(1),u.Q6J("ngIf",null==N.form.controls["cau"+k].errors?null:N.form.controls["cau"+k].errors.min),u.xp6(1),u.Q6J("ngIf",null==N.form.controls["cau"+k].errors?null:N.form.controls["cau"+k].errors.max),u.xp6(1),u.Q6J("ngIf",null==N.form.controls["cau"+k].errors?null:N.form.controls["cau"+k].errors.pattern)}}const Ke=function(F){return{border:F}},Zt=function(F){return{"is-invalid":F}};function xe(F,ne){if(1&F){const k=u.EpF();u.TgZ(0,"div",11)(1,"div",12)(2,"mat-icon",13),u.NdJ("click",function(G){const te=u.CHM(k).index,be=u.oxw();return u.KtG(be.toggleVisibility(G,te))}),u.ALo(3,"mytranslate"),u._uU(4,"visibility"),u.qZA(),u.TgZ(5,"span",14),u._uU(6),u.ALo(7,"mytranslate"),u.TgZ(8,"span",15),u.ALo(9,"mytranslate"),u._uU(10),u.ALo(11,"mytranslate"),u.qZA()(),u._UZ(12,"input",16),u.ALo(13,"mytranslate"),u.qZA(),u.YNc(14,bt,4,3,"div",17),u.qZA()}if(2&F){const k=ne.$implicit,N=ne.index,G=u.oxw();let ue;u.Q6J("ngStyle",u.VKq(23,Ke,N==G.questions.length-1?"none":"")),u.xp6(2),u.s9C("matTooltip",u.lcZ(3,13,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),u.xp6(4),u.AsE("",u.lcZ(7,15,"lang_auto_cau")," ",(null!==(ue=k.indexLabel)&&void 0!==ue?ue:0)+1," "),u.xp6(2),u.s9C("matTooltip",u.lcZ(9,17,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),u.xp6(2),u.AsE("(",k.essMaxPoint," ",u.lcZ(11,19,"lang_auto_diem_brackets"),""),u.xp6(2),u.s9C("placeholder",u.lcZ(13,21,"lang_auto_nhap_diem")),u.MGl("formControlName","cau",N,""),u.Q6J("readonly",!G.isBackEnd)("decimal",!0)("ngClass",u.VKq(25,Zt,G.form.controls["cau"+N]&&G.form.controls["cau"+N].invalid)),u.xp6(2),u.Q6J("ngIf",G.form.controls["cau"+N].errors)}}function $e(F,ne){if(1&F){const k=u.EpF();u.TgZ(0,"div",19)(1,"button",20),u.NdJ("click",function(){u.CHM(k);const G=u.oxw();return u.KtG(G.saveDataMarkExercise())}),u._uU(2),u.ALo(3,"mytranslate"),u.ALo(4,"mytranslate"),u.qZA()()}if(2&F){const k=u.oxw();u.xp6(1),u.Q6J("disabled",k.isLoading||k.form.invalid||k.loadingDataCdn&&k.files.length>0),u.xp6(1),u.hij(" ",k.isLoading?u.lcZ(3,2,"lang_auto_dang_luu_doing"):u.lcZ(4,4,"lang_auto_luu_diem")," ")}}function V(F,ne){1&F&&(u.TgZ(0,"span"),u._uU(1),u.ALo(2,"mytranslate"),u.qZA()),2&F&&(u.xp6(1),u.hij(" ",u.lcZ(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function $(F,ne){1&F&&(u.TgZ(0,"span"),u._uU(1),u.ALo(2,"mytranslate"),u.qZA()),2&F&&(u.xp6(1),u.hij(" ",u.lcZ(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function ie(F,ne){1&F&&(u.TgZ(0,"span"),u._uU(1),u.ALo(2,"mytranslate"),u.qZA()),2&F&&(u.xp6(1),u.hij(" ",u.lcZ(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function Ie(F,ne){if(1&F&&(u.TgZ(0,"div",18),u.YNc(1,V,3,3,"span",9),u.YNc(2,$,3,3,"span",9),u.YNc(3,ie,3,3,"span",9),u.qZA()),2&F){const k=u.oxw(2).index,N=u.oxw();u.xp6(1),u.Q6J("ngIf",null==N.form.controls["cau"+k].errors?null:N.form.controls["cau"+k].errors.min),u.xp6(1),u.Q6J("ngIf",null==N.form.controls["cau"+k].errors?null:N.form.controls["cau"+k].errors.max),u.xp6(1),u.Q6J("ngIf",null==N.form.controls["cau"+k].errors?null:N.form.controls["cau"+k].errors.pattern)}}function Pe(F,ne){if(1&F&&(u.TgZ(0,"div",25)(1,"form",26)(2,"label",27),u._uU(3),u.ALo(4,"mytranslate"),u.TgZ(5,"span",15),u.ALo(6,"mytranslate"),u._uU(7),u.ALo(8,"mytranslate"),u.qZA(),u._uU(9,":"),u.qZA(),u._UZ(10,"input",28),u.ALo(11,"mytranslate"),u.YNc(12,Ie,4,3,"div",17),u.qZA()()),2&F){const k=u.oxw(),N=k.index,G=k.$implicit,ue=u.oxw();let te;u.xp6(1),u.Q6J("formGroup",ue.form),u.xp6(1),u.s9C("for","cau_"+N),u.xp6(1),u.AsE("",u.lcZ(4,14,"lang_auto_nhap_diem_cau")," ",(null!==(te=G.indexLabel)&&void 0!==te?te:0)+1," "),u.xp6(2),u.s9C("matTooltip",u.lcZ(6,16,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),u.xp6(2),u.AsE("(",G.essMaxPoint," ",u.lcZ(8,18,"lang_auto_diem_brackets"),""),u.xp6(3),u.s9C("placeholder",u.lcZ(11,20,"lang_auto_nhap_diem")),u.MGl("formControlName","cau",N,""),u.Q6J("readonly",!ue.isBackEnd)("ngClass",u.VKq(22,Zt,ue.form.controls["cau"+N]&&ue.form.controls["cau"+N].invalid))("id","cau_"+N)("decimal",!0),u.xp6(2),u.Q6J("ngIf",ue.form.controls["cau"+N].errors)}}function ke(F,ne){if(1&F&&(u.TgZ(0,"div",21)(1,"div",22),u._UZ(2,"azt-standalone-question",23),u.YNc(3,Pe,13,24,"div",24),u.qZA()()),2&F){const k=ne.$implicit,N=ne.index,G=u.oxw();let ue;u.xp6(1),u.MGl("id","q_",N,""),u.xp6(1),u.Q6J("startQuestionIndex",G.examObj.startQuestionIndex)("follower",G.followerRenderQuest)("displayScreen",G.displayScreen)("examObj",G.examObj)("question",k)("index",null!==(ue=k.indexLabel)&&void 0!==ue?ue:0)("configExam",G.configExam)("expandInfo",G.examObj.expandInfo)("userAnswersObj",G.userAnswersObj)("orgExamObjs",G.orgExamObjs)("place","essay"),u.xp6(1),u.Q6J("ngIf",G.isBackEnd)}}function Be(F,ne){1&F&&(u.TgZ(0,"div",29)(1,"b"),u._uU(2),u.ALo(3,"mytranslate"),u.qZA(),u._uU(4),u.ALo(5,"mytranslate"),u.qZA()),2&F&&(u.xp6(2),u.hij("",u.lcZ(3,2,"lang_auto_anh_bai_lam_tu_luan"),": "),u.xp6(2),u.hij("",u.lcZ(5,4,"lang_auto_khong_co_du_lieu_anh_bai_lam_tu_luan_cua_thi_sinh"),"\n"))}function U(F,ne){if(1&F){const k=u.EpF();u.TgZ(0,"azt-mark-note",31,32),u.NdJ("doneLoadData",function(G){u.CHM(k);const ue=u.oxw(2);return u.KtG(ue.doneLoadData(G))}),u.qZA()}if(2&F){const k=u.oxw(2);u.Q6J("dataMarkNote",k.dataMarkNote)("screenType","exam")("modeView",k.isBackEnd?"teacher":"student")}}function Ce(F,ne){if(1&F&&(u.ynx(0),u.YNc(1,U,2,3,"azt-mark-note",30),u.BQk()),2&F){const k=u.oxw();u.xp6(1),u.Q6J("ngIf",1===k.curSelectedTab||k.changeSelectedTab)}}function H(F,ne){if(1&F){const k=u.EpF();u.TgZ(0,"div",33)(1,"button",34),u.NdJ("click",function(){u.CHM(k);const G=u.oxw();return u.KtG(G.saveDataMarkExercise())}),u._uU(2),u.ALo(3,"mytranslate"),u.ALo(4,"mytranslate"),u.qZA()()}if(2&F){const k=u.oxw();u.xp6(1),u.Q6J("disabled",k.isLoading||k.form.invalid||k.loadingDataCdn&&k.files.length>0),u.xp6(1),u.hij(" ",k.isLoading?u.lcZ(3,2,"lang_auto_dang_luu_doing"):u.lcZ(4,4,"lang_auto_luu_diem")," ")}}const M=function(F){return{display:F}};let oe=(()=>{class F extends d.Q{parseValue(k){return this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")[k]}getMaxPoint(k){var N=0;for(let G=0;G<this.questions.length;G++)if(this.questions[G].id==k){N=this.questions[G].scorePerQuestion??0;break}return N}toggleVisibility(k,N){var G=k.target,ue=document.getElementById(`q_${N}`);ue&&("block"==ue?.style.display?(ue.style.display="none",G&&(G.textContent="visibility_off")):(ue.style.display="block",G&&(G.textContent="visibility")))}isValidPoint(){let k=0;var N=this.form.value;for(var G in N){var ue=Number(G.substring(3));N[G]>this.maxPointPerQuestion[ue]&&k++}return!(k>0)}validateForm(k,N,G,ue){let te="";this.form.get("cau"+ue)?.valueChanges.pipe((0,le.G)()).subscribe(([be,Ae])=>{if(te="string"==typeof Ae&&Ae.includes(",")?Ae.replace(",","."):Ae,isNaN(+te))this.showErrorSnack("lang_auto_yeu_cau_chi_nhap_so"),this.form.controls["cau"+ue].setValue(N);else{let Ue=parseFloat(te);Ue>G&&this.showErrorSnack("lang_auto_khong_nhap_qua_so_diem_toi_da_cua_cau_hoi"),Ue<0&&this.showErrorSnack("lang_auto_ban_dang_nhap_nho_hon_0")}})}uploadBase64ToCDN(k,N){var G=this.baseApiService.dataURItoBlob(k);this.apiUploadService.commonUploadForMarkResult(G,`essay_note_${N}_${this.resultID}.png`,"image/png",1e4).subscribe(ue=>{ue.type!=h.dt.UploadProgress&&(1==ue.success?(this.mnoteJsonData.pages[N].draw=ue.data?.url,this.pagesCount--,0==this.pagesCount&&this.remark(JSON.stringify(this.mnoteJsonData))):this.commonService.snackError("lang_auto_luu_du_lieu_cham_bai_khong_thanh_cong"))})}uploadAll(k){this.pagesCount=0;for(let N=0;N<k.length;N++)k[N].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(JSON.stringify(this.mnoteJsonData));else for(let N=0;N<k.length;N++)k[N].draw&&this.uploadBase64ToCDN(k[N].draw,N)}sendDataToIframe(){const k=document.getElementById("mNote"),N=k?k.contentWindow:null;if(null!==N)if(this.examResultObj.confirmedAt&&this.examResultObj.result){if(this.examResultObj.result){var G=this.commonService.willDeleteParseJson(this.examResultObj.result);if(null!=G){for(let te=0;te<G.pages.length;te++)G.pages[te].backgroundImage&&(G.pages[te].backgroundImage=this.cdnService.getMyCdn(G.pages[te].backgroundImage)),G.pages[te].draw&&(G.pages[te].draw=this.cdnService.getMyCdn(G.pages[te].draw));G=JSON.stringify(G),this.examResultObj.result=G}}var ue=this.checkMapBGImageWithFileLength(this.examResultObj.result??"{}");if(this.jsonData=this.commonService.willDeleteParseJson(ue?this.examResultObj.result??"{}":this.addBGImageByFileUrl(this.examResultObj.result??"{}")),this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let te=0;te<this.jsonData.pages.length;te++)this.jsonData.pages[te].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[te].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[te].backgroundImage)),this.jsonData.pages[te].hasOwnProperty("draw")&&(this.jsonData.pages[te].draw=this.cdnService.getMyCdn(this.jsonData.pages[te].draw));this.jsonData&&(this.jsonData.cmd="initMNote",this.jsonData.mode=this.iframeViewMode,this.jsonData.context="exam"),N.postMessage(this.jsonData,"*")}else{let te=[];this.files.forEach(Ae=>{var Ue=this.cdnService.getMyCdn(Ae.url);Ue&&te.push({backgroundImage:Ue})}),N.postMessage({cmd:"initMNote",pages:te,mode:this.isBackEnd?"edit":"view",context:"exam"},"*"),this.dataMarkNote.answer_obj={id:0,homeworkId:0,studentId:0,point:0,files:te},console.log("%cMyProject%cline:252%cthis.dataMarkNote.answer_obj","color:#fff;background:#ee6f57;padding:3px;border-radius:2px","color:#fff;background:#1f3c88;padding:3px;border-radius:2px","color:#fff;background:rgb(248, 214, 110);padding:3px;border-radius:2px",this.dataMarkNote.answer_obj)}}checkMapBGImageWithFileLength(k){var N=this.commonService.willDeleteParseJson(k);let G=!1;if(0==this.files.length)G=!0;else if(this.files.length>0&&N&&N.pages&&this.files.length==N.pages.length){let ue=0;this.files.forEach((te,be)=>{N.pages[be]&&N.pages[be].backgroundImage&&N.pages[be].backgroundImage.indexOf(te.path)>-1&&ue++}),ue==this.files.length&&(G=!0)}return G}addBGImageByFileUrl(k){var N=this.commonService.willDeleteParseJson(k);return this.files.forEach((G,ue)=>{let te=!1;if(N&&N.pages){for(var be=0;be<N.pages.length;be++)if(N.pages[be]&&N.pages[be].backgroundImage&&N.pages[be].backgroundImage.indexOf(G.path)>-1){te=!0;break}!1===te&&(N.pages[ue]&&N.pages[ue].id==ue?N.pages[ue].backgroundImage=this.cdnService.getMyCdn(G.url??""):N.pages.splice(ue,0,{backgroundImage:this.cdnService.getMyCdn(G.url??"")}))}}),JSON.stringify(N)}getMnoteJsonData(){if(this.permissionService.hasMarkPointPermission("exam",this.examObj.permissionObj)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",this.examObj.permissionObj)){if(!this.isValidPoint())return void this.showErrorSnack("lang_auto_cham_diem_vuot_qua_so_diem_toi_da_vui_long_kiem_tra_lai");if(this.files&&this.files.length>0){const k=document.getElementById("mNote"),N=k?k.contentWindow:null;null!==N&&N.postMessage({cmd:"getMNoteJson"},"*")}else this.isLoading=!0,this.remark("")}else this.showErrorSnack("lang_auto_ban_khong_co_quen_cham_de_thi_nay")}remark(k){for(const ue in this.form.value)"string"==typeof this.form.value[ue]&&this.form.value[ue].includes(",")&&(this.form.value[ue]=this.form.value[ue].replace(",","."));let N=JSON.stringify({type:"exam",id:this.examObj.id,user:this.examObj.tenantId});var G={id:this.resultID,result:k,essayResult:JSON.stringify(this.form.value)};this.examResultService.apiExamResultSaveResultPost(G,N).subscribe(ue=>{1==ue.success?(this.showSuccessSnack("lang_auto_cham_diem_tu_luan_thanh_cong"),this.saveResultEvent.emit(1),this.isLoading=!1):(this.commonService.snackError(ue.message??""),this.saveResultEvent.emit(0),this.isLoading=!1)})}initDataMarkNote(){if(this.examResultObj.result){this.dataMarkNote.answer_obj={id:this.examResultObj.id??0,homeworkId:0,studentId:this.examResultObj.studentId??0,point:0,result:this.examResultObj.result,files:this.examResultObj.files,markedByTeacherId:this.examResultObj.markedByTeacherId,confirmedAt:this.examResultObj.confirmedAt,createdAt:this.examResultObj.createdAt,updatedAt:this.examResultObj.updatedAt,tenantId:this.examResultObj.tenantId};for(let k=0;k<this.files.length;k++)this.files[k].url=this.cdnService.getMyCdn(this.files[k].url??"");this.dataMarkNote.answer_obj={id:0,homeworkId:0,studentId:0,point:0,files:this.serializeJson(this.files)}}}saveDataMarkExercise(){var k=this;return(0,D.Z)(function*(){let N=!1;for(const G in k.form.value)""!==k.form.value[G]&&(N=!0);if(N){for(const G in k.form.value)""===k.form.value[G]&&(k.form.value[G]=0,k.form.controls[G].setValue(0));if(k.isLoading=!0,k.files&&k.files.length>0){k.objectResult=k.MarkNote?.exportDataMarkNote();let G=!1;if(k.objectResult.pages?.length===k.files.length){for(let Ue=0;Ue<k.objectResult.pages.length;Ue++)if(k.objectResult.pages[Ue]&&k.objectResult.pages[Ue].draws?.length)for(let J=0;J<(k.objectResult.pages[Ue].draws?.length??0);J++){let Oe=k.objectResult.pages[Ue].draws?.[J]??{};Oe.src&&Oe.src.includes("base64")&&(G=!0)}G&&(yield k.uploadDrawBase64ToCdn());const ue=k.serializeJson(k.objectResult),te=k.zipDataService.convertContentGzip(ue),be=new Blob([te],{type:"text/plain"}),Ae=new File([be],"txt",{type:"text/plain"});k.apiUploadService.uploadToCdnForHomework(Ae).subscribe(Ue=>{1==Ue.success?k.remark(k.serializeJson({urlDataMark:Ue.data?.url??"",version:"0.1"})):k.showErrorSnack("lang_auto_co_loi_trong_qua_trinh_luu_du_lieu_len_cdn_vui_long_thu_lai")})}}else k.remark("")}else k.showErrorSnack("lang_core_vui_long_nhap_diem_tu_luan")})()}uploadDrawBase64ToCdn(){return new Promise(k=>{let N=[];if(this.objectResult.pages){this.objectResult.pages.forEach(G=>{N.push(!1)});for(let G=0;G<this.objectResult.pages.length;G++)if(this.objectResult.pages[G]&&this.objectResult.pages[G].draws?.length)for(let ue=0;ue<(this.objectResult.pages[G].draws?.length??0);ue++){let te=this.objectResult.pages[G].draws?.[ue]??{};if(te.src&&te.src.includes("base64")){N[G]=!0;let be=this.baseApiService.dataURItoBlob(te.src);this.apiUploadService.commonUploadForMarkResult(be,`essay_note_${G}_${ue}_${this.resultID}.png`,"image/png",1e4).subscribe(Ae=>{Ae.type!=h.dt.UploadProgress&&(te.src=Ae.data?.url,N[G]=!1),N.includes(!0)||k()})}}}})}doneLoadData(k){this.loadingDataCdn=!1}ngOnInit(){this.initDataMarkNote();var k={};let N;this.examResultObj.confirmedAt&&(N=this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")),this.followerRenderQuest.setNumQuest(this.questions.length),this.questions.forEach(ue=>{let te=this.getMaxPoint(ue.id);this.totalMaxPoint+=te,ue.essMaxPoint=te,this.maxPointPerQuestion.push(ue.essMaxPoint)});for(let ue=0;ue<this.questions.length;ue++){var G=`cau${ue}`;k[G]=new _.p4(N?N[G]:"",[_.kI.pattern("^[0-9]((.|,){0,1})[0-9]{0,8}"),_.kI.min(0),_.kI.max(this.questions[ue].essMaxPoint??0)])}this.form=this.fb.group(k),this.form.valueChanges.subscribe(ue=>{let te=JSON.stringify(ue);te!=this.prevData&&(this.prevData=te,this.form.patchValue(ue))}),super.ngOnInit()}constructor(k,N,G,ue,te,be,Ae){super(),this.baseApiService=k,this.fb=N,this.permissionService=G,this.cdnService=ue,this.examResultService=te,this.apiUploadService=be,this.zipDataService=Ae,this.isBackEnd=!0,this.displayScreen=3,this.resultID=0,this.orgExamObjs=[],this.files=[],this.questions=[],this.userAnswersObj={},this.iframeSrc="",this.hasLoadedData=!1,this.iframeViewMode="view",this.curSelectedTab=0,this.changeSelectedTab=!1,this.saveResultEvent=new u.vpe,this.followerRenderQuest=new Q.G,this.form=new _.nJ({}),this.formValue={},this.isLoading=!1,this.totalMaxPoint=0,this.maxPointPerQuestion=[],this.hasSendDataToIframe=!1,this.jsonData={},this.mnoteJsonData={},this.pagesCount=0,this.dataMarkNote={},this.objectResult={},this.loadingDataCdn=!0}}return F.\u0275fac=function(k){return new(k||F)(u.Y36(B._),u.Y36(_.QS),u.Y36(S.$),u.Y36(m.U),u.Y36(x.k),u.Y36(g.$),u.Y36(j.D))},F.\u0275cmp=u.Xpm({type:F,selectors:[["azt-mark-essay-new"]],viewQuery:function(k,N){if(1&k&&(u.Gf(pe,5),u.Gf(Xe,5)),2&k){let G;u.iGM(G=u.CRH())&&(N.mnoteContainer=G.first),u.iGM(G=u.CRH())&&(N.MarkNote=G.first)}},inputs:{isBackEnd:"isBackEnd",displayScreen:"displayScreen",resultID:"resultID",orgExamObjs:"orgExamObjs",files:"files",questions:"questions",userAnswersObj:"userAnswersObj",examResultObj:"examResultObj",iframeSrc:"iframeSrc",hasLoadedData:"hasLoadedData",iframeViewMode:"iframeViewMode",configExam:"configExam",examObj:"examObj",curSelectedTab:"curSelectedTab",changeSelectedTab:"changeSelectedTab"},outputs:{saveResultEvent:"saveResultEvent"},features:[u.qOj],decls:11,vars:10,consts:[["id","essayBoxButtons",1,"flex","items-center","jusitfy-center","flex-col","p-3","rounded-md","border","border-slate-200","dark:border-darkmode-400"],[1,"grid","grid-cols-12","gap-3","pb-3","w-full","border-b","border-slate-200","dark:border-darkmode-400",3,"formGroup"],["class","col-span-12 md:col-span-6 lg:col-span-4 pr-3 border-r border-slate-200 dark:border-darkmode-400",3,"ngStyle",4,"ngFor","ngForOf"],["class","BWrap-one",4,"ngIf"],["id","showQuestionEssay"],["class","essay_qItem",4,"ngFor","ngForOf"],["class","mb-2 mt-2",4,"ngIf"],[1,"card-box","listPhotos",3,"ngStyle"],["mnoteContainer",""],[4,"ngIf"],["class","BWrap",4,"ngIf"],[1,"col-span-12","md:col-span-6","lg:col-span-4","pr-3","border-r","border-slate-200","dark:border-darkmode-400",3,"ngStyle"],[1,"flex","items-center"],["azt-track-service","mark-essay-new-jJ82weJqe",1,"mr-1","flex-none",3,"matTooltip","click"],[1,"mr-1","inline-block","flex-none",2,"min-width","130px"],[1,"maxPoint",3,"matTooltip"],["type","text","appOnlyNumber","","step",".01",1,"form-control",3,"readonly","decimal","placeholder","ngClass","formControlName"],["class","mt-2 text-danger text-xs",4,"ngIf"],[1,"mt-2","text-danger","text-xs"],[1,"BWrap-one"],["azt-track-service","mark-essay-new-qoh8TPOQYx","id","btn-1",1,"mt-3","btn","btn-primary",3,"disabled","click"],[1,"essay_qItem"],[1,"mt-2",2,"display","block",3,"id"],[3,"startQuestionIndex","follower","displayScreen","examObj","question","index","configExam","expandInfo","userAnswersObj","orgExamObjs","place"],["class","block-input","style","margin-bottom: 40px; margin-top: -20px",4,"ngIf"],[1,"block-input",2,"margin-bottom","40px","margin-top","-20px"],[3,"formGroup"],[1,"mr-2","font-medium",3,"for"],["type","text","appOnlyNumber","","step",".01",1,"form-control","form-input","d-inline-flex",3,"readonly","ngClass","id","decimal","placeholder","formControlName"],[1,"mb-2","mt-2"],[3,"dataMarkNote","screenType","modeView","doneLoadData",4,"ngIf"],[3,"dataMarkNote","screenType","modeView","doneLoadData"],["aztMarkNote",""],[1,"BWrap"],["azt-track-service","mark-essay-new-kAM88sxUxu","id","btn-2",1,"mt-3","btn","btn-primary",3,"disabled","click"]],template:function(k,N){1&k&&(u.TgZ(0,"div",0)(1,"form",1),u.YNc(2,xe,15,27,"div",2),u.qZA(),u.YNc(3,$e,5,6,"div",3),u.qZA(),u.TgZ(4,"div",4),u.YNc(5,ke,4,13,"div",5),u.qZA(),u.YNc(6,Be,6,6,"div",6),u.TgZ(7,"div",7,8),u.YNc(9,Ce,2,1,"ng-container",9),u.qZA(),u.YNc(10,H,5,6,"div",10)),2&k&&(u.xp6(1),u.Q6J("formGroup",N.form),u.xp6(1),u.Q6J("ngForOf",N.questions),u.xp6(1),u.Q6J("ngIf",N.isBackEnd),u.xp6(2),u.Q6J("ngForOf",N.questions),u.xp6(1),u.Q6J("ngIf",N.files&&0==N.files.length),u.xp6(1),u.Q6J("ngStyle",u.VKq(8,M,N.files&&0==N.files.length?"none":"block")),u.xp6(2),u.Q6J("ngIf",N.dataMarkNote&&N.dataMarkNote.answer_obj&&N.files&&N.files.length>0),u.xp6(1),u.Q6J("ngIf",N.isBackEnd))},dependencies:[I.mk,I.sg,I.O5,I.PC,A.Hw,O.gM,_._Y,_.Fj,_.JJ,_.JL,_.sg,_.u,q.a,w.Y,Y.M,K.O,Le.bT],styles:["#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]{flex:auto;display:flex;flex-wrap:wrap;padding-bottom:10px;width:100%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-right:5px;display:flex;justify-content:center;align-items:center;padding-right:5px;margin-bottom:5px;width:24%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child, #essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]{color:#838383;margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]:hover{cursor:default}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#585858}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.edit-question-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border-radius:5px;margin-bottom:-15px!important;padding-bottom:0!important}.edit-question-header-right[_ngcontent-%COMP%]{display:flex;align-items:center}.edit-question-header-tag[_ngcontent-%COMP%], .edit-question-header-content[_ngcontent-%COMP%]{margin:5px 10px 10px;padding:5px}.edit-question-header-tag[_ngcontent-%COMP%]:hover, .edit-question-header-content[_ngcontent-%COMP%]:hover{background:rgba(35,97,174,.1803921569);border-radius:5px}.edit-question-header-dr[_ngcontent-%COMP%]{color:#607d8b;margin:0 10px}.edit-question-header-content[_ngcontent-%COMP%]{cursor:pointer}.edit-question-header-point[_ngcontent-%COMP%]{text-align:right}.form-control.is-invalid[_ngcontent-%COMP%]{padding-right:calc(1.5em + .15rem)!important;background-position:right calc(.375em + .02rem) center!important}.form-input[_ngcontent-%COMP%]{height:30px;width:96px}.form-mark[_ngcontent-%COMP%]{margin-left:20px}div#showQuestionEssay[_ngcontent-%COMP%]{width:100%}.BWrap[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;padding-bottom:15px}.essay_qItem[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:30px!important}[type=number][_ngcontent-%COMP%]{appearance:none;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.pr-3[_ngcontent-%COMP%]{padding-right:.75rem}@media screen and (max-width: 1474px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:12px}.maxPoint[_ngcontent-%COMP%]{font-size:10px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 768px){.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 480px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{border-right:none;margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:99%}}"]}),F})()},58334:(Qe,ce,v)=>{v.d(ce,{s:()=>Be});var D=v(69862),h=v(65879),u=v(56223),_=v(69384),le=v(39621),d=v(94913),Q=v(14845),B=v(94281),S=v(8415),m=v(52846),x=v(50952),g=v(50503),j=v(96814),I=v(30617),A=v(92596),O=v(81373),q=v(775),w=v(27222),Y=v(11964);const K=["mnoteContainer"];function Le(U,Ce){1&U&&(h.TgZ(0,"span"),h._uU(1),h.ALo(2,"mytranslate"),h.qZA()),2&U&&(h.xp6(1),h.hij(" ",h.lcZ(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function pe(U,Ce){1&U&&(h.TgZ(0,"span"),h._uU(1),h.ALo(2,"mytranslate"),h.qZA()),2&U&&(h.xp6(1),h.hij(" ",h.lcZ(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function Xe(U,Ce){1&U&&(h.TgZ(0,"span"),h._uU(1),h.ALo(2,"mytranslate"),h.qZA()),2&U&&(h.xp6(1),h.hij(" ",h.lcZ(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function Ve(U,Ce){if(1&U&&(h.TgZ(0,"div",18),h.YNc(1,Le,3,3,"span",19),h.YNc(2,pe,3,3,"span",19),h.YNc(3,Xe,3,3,"span",19),h.qZA()),2&U){const H=h.oxw().index,M=h.oxw();h.xp6(1),h.Q6J("ngIf",null==M.form.controls["cau"+H].errors?null:M.form.controls["cau"+H].errors.min),h.xp6(1),h.Q6J("ngIf",null==M.form.controls["cau"+H].errors?null:M.form.controls["cau"+H].errors.max),h.xp6(1),h.Q6J("ngIf",null==M.form.controls["cau"+H].errors?null:M.form.controls["cau"+H].errors.pattern)}}const jt=function(U){return{border:U}},Ft=function(U){return{"is-invalid":U}};function bt(U,Ce){if(1&U){const H=h.EpF();h.TgZ(0,"div",11)(1,"div",12)(2,"mat-icon",13),h.NdJ("click",function(oe){const ne=h.CHM(H).index,k=h.oxw();return h.KtG(k.toggleVisibility(oe,ne))}),h.ALo(3,"mytranslate"),h._uU(4,"visibility"),h.qZA(),h.TgZ(5,"span",14),h._uU(6),h.ALo(7,"mytranslate"),h.TgZ(8,"span",15),h.ALo(9,"mytranslate"),h._uU(10),h.ALo(11,"mytranslate"),h.qZA()(),h._UZ(12,"input",16),h.ALo(13,"mytranslate"),h.qZA(),h.YNc(14,Ve,4,3,"div",17),h.qZA()}if(2&U){const H=Ce.$implicit,M=Ce.index,oe=h.oxw();let F;h.Q6J("ngStyle",h.VKq(23,jt,M==oe.questions.length-1?"none":"")),h.xp6(2),h.s9C("matTooltip",h.lcZ(3,13,"lang_auto_anhien_phan_bai_lam_cua_cau_hoi_nay")),h.xp6(4),h.AsE("",h.lcZ(7,15,"lang_auto_cau")," ",(null!==(F=H.indexLabel)&&void 0!==F?F:0)+1," "),h.xp6(2),h.s9C("matTooltip",h.lcZ(9,17,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),h.xp6(2),h.AsE("(",H.essMaxPoint," ",h.lcZ(11,19,"lang_auto_diem_brackets"),""),h.xp6(2),h.s9C("placeholder",h.lcZ(13,21,"lang_auto_nhap_diem")),h.MGl("formControlName","cau",M,""),h.Q6J("readonly",!oe.isBackEnd)("decimal",!0)("ngClass",h.VKq(25,Ft,oe.form.controls["cau"+M]&&oe.form.controls["cau"+M].invalid)),h.xp6(2),h.Q6J("ngIf",oe.form.controls["cau"+M].errors)}}function Ke(U,Ce){if(1&U){const H=h.EpF();h.TgZ(0,"div",20)(1,"button",21),h.NdJ("click",function(){h.CHM(H);const oe=h.oxw();return h.KtG(oe.getMnoteJsonData())}),h._uU(2),h.ALo(3,"mytranslate"),h.ALo(4,"mytranslate"),h.qZA()()}if(2&U){const H=h.oxw();h.xp6(1),h.Q6J("disabled",H.isLoading||H.form.invalid),h.xp6(1),h.hij(" ",H.isLoading?h.lcZ(3,2,"lang_auto_dang_luu_doing"):h.lcZ(4,4,"lang_auto_luu_diem")," ")}}function Zt(U,Ce){1&U&&(h.TgZ(0,"span"),h._uU(1),h.ALo(2,"mytranslate"),h.qZA()),2&U&&(h.xp6(1),h.hij(" ",h.lcZ(2,1,"lang_mark_essay_please_enter_a_score_greater_than_or_equal_to_0")," "))}function xe(U,Ce){1&U&&(h.TgZ(0,"span"),h._uU(1),h.ALo(2,"mytranslate"),h.qZA()),2&U&&(h.xp6(1),h.hij(" ",h.lcZ(2,1,"lang_mark_essay_please_enter_a_score_less_than_or_equal_to_the_score_of_the_question")," "))}function $e(U,Ce){1&U&&(h.TgZ(0,"span"),h._uU(1),h.ALo(2,"mytranslate"),h.qZA()),2&U&&(h.xp6(1),h.hij(" ",h.lcZ(2,1,"lang_mark_essay_please_do_not_enter_more_than_8_numbers_after_the_decimal_point")," "))}function V(U,Ce){if(1&U&&(h.TgZ(0,"div",18),h.YNc(1,Zt,3,3,"span",19),h.YNc(2,xe,3,3,"span",19),h.YNc(3,$e,3,3,"span",19),h.qZA()),2&U){const H=h.oxw(2).index,M=h.oxw();h.xp6(1),h.Q6J("ngIf",null==M.form.controls["cau"+H].errors?null:M.form.controls["cau"+H].errors.min),h.xp6(1),h.Q6J("ngIf",null==M.form.controls["cau"+H].errors?null:M.form.controls["cau"+H].errors.max),h.xp6(1),h.Q6J("ngIf",null==M.form.controls["cau"+H].errors?null:M.form.controls["cau"+H].errors.pattern)}}function $(U,Ce){if(1&U&&(h.TgZ(0,"div",26)(1,"form",27)(2,"label",28),h._uU(3),h.ALo(4,"mytranslate"),h.TgZ(5,"span",15),h.ALo(6,"mytranslate"),h._uU(7),h.ALo(8,"mytranslate"),h.qZA(),h._uU(9,":"),h.qZA(),h._UZ(10,"input",29),h.ALo(11,"mytranslate"),h.YNc(12,V,4,3,"div",17),h.qZA()()),2&U){const H=h.oxw(),M=H.index,oe=H.$implicit,F=h.oxw();let ne;h.xp6(1),h.Q6J("formGroup",F.form),h.xp6(1),h.s9C("for","cau_"+M),h.xp6(1),h.AsE("",h.lcZ(4,14,"lang_auto_nhap_diem_cau")," ",(null!==(ne=oe.indexLabel)&&void 0!==ne?ne:0)+1," "),h.xp6(2),h.s9C("matTooltip",h.lcZ(6,16,"lang_auto_diem_toi_da_cho_cau_hoi_nay_theo_thang_diem_brackets")),h.xp6(2),h.AsE("(",oe.essMaxPoint," ",h.lcZ(8,18,"lang_auto_diem_brackets"),""),h.xp6(3),h.s9C("placeholder",h.lcZ(11,20,"lang_auto_nhap_diem")),h.MGl("formControlName","cau",M,""),h.Q6J("readonly",!F.isBackEnd)("ngClass",h.VKq(22,Ft,F.form.controls["cau"+M]&&F.form.controls["cau"+M].invalid))("id","cau_"+M)("decimal",!0),h.xp6(2),h.Q6J("ngIf",F.form.controls["cau"+M].errors)}}function ie(U,Ce){if(1&U&&(h.TgZ(0,"div",22)(1,"div",23),h._UZ(2,"azt-standalone-question",24),h.YNc(3,$,13,24,"div",25),h.qZA()()),2&U){const H=Ce.$implicit,M=Ce.index,oe=h.oxw();let F;h.xp6(1),h.MGl("id","q_",M,""),h.xp6(1),h.Q6J("startQuestionIndex",oe.examObj.startQuestionIndex)("follower",oe.followerRenderQuest)("displayScreen",oe.displayScreen)("examObj",oe.examObj)("question",H)("index",null!==(F=H.indexLabel)&&void 0!==F?F:0)("configExam",oe.configExam)("expandInfo",oe.examObj.expandInfo)("userAnswersObj",oe.userAnswersObj)("place","essay"),h.xp6(1),h.Q6J("ngIf",oe.isBackEnd)}}function Ie(U,Ce){1&U&&(h.TgZ(0,"div",30)(1,"b"),h._uU(2),h.ALo(3,"mytranslate"),h.qZA(),h._uU(4),h.ALo(5,"mytranslate"),h.qZA()),2&U&&(h.xp6(2),h.hij("",h.lcZ(3,2,"lang_auto_anh_bai_lam_tu_luan"),": "),h.xp6(2),h.Oqu(h.lcZ(5,4,"lang_auto_khong_co_du_lieu_anh_bai_lam_tu_luan_cua_thi_sinh")))}function Pe(U,Ce){if(1&U){const H=h.EpF();h.TgZ(0,"div",31)(1,"button",32),h.NdJ("click",function(){h.CHM(H);const oe=h.oxw();return h.KtG(oe.getMnoteJsonData())}),h._uU(2),h.ALo(3,"mytranslate"),h.ALo(4,"mytranslate"),h.qZA()()}if(2&U){const H=h.oxw();h.xp6(1),h.Q6J("disabled",H.isLoading||H.form.invalid),h.xp6(1),h.hij(" ",H.isLoading?h.lcZ(3,2,"lang_auto_dang_luu_doing"):h.lcZ(4,4,"lang_auto_luu_diem")," ")}}const ke=function(U){return{display:U}};let Be=(()=>{class U extends le.Q{parseValue(H){return this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")[H]}getMaxPoint(H){var M=0;for(let oe=0;oe<this.questions.length;oe++)if(this.questions[oe].id==H){M=this.questions[oe].scorePerQuestion??0;break}return M}toggleVisibility(H,M){var oe=H.target,F=document.getElementById(`q_${M}`);F&&("block"==F?.style.display?(F.style.display="none",oe&&(oe.textContent="visibility_off")):(F.style.display="block",oe&&(oe.textContent="visibility")))}isValidPoint(){let H=0;var M=this.form.value;for(var oe in M){var F=Number(oe.substring(3));M[oe]>this.maxPointPerQuestion[F]&&H++}return!(H>0)}validateForm(H,M,oe,F){let ne="";this.form.get("cau"+F)?.valueChanges.pipe((0,_.G)()).subscribe(([k,N])=>{if(ne="string"==typeof N&&N.includes(",")?N.replace(",","."):N,isNaN(+ne))this.showErrorSnack("lang_auto_yeu_cau_chi_nhap_so"),this.form.controls["cau"+F].setValue(M);else{let G=parseFloat(ne);G>oe&&this.showErrorSnack("lang_auto_khong_nhap_qua_so_diem_toi_da_cua_cau_hoi"),G<0&&this.showErrorSnack("lang_auto_ban_dang_nhap_nho_hon_0")}})}uploadBase64ToCDN(H,M){var oe=this.baseApiService.dataURItoBlob(H);this.apiUploadService.commonUploadForMarkResult(oe,`essay_note_${M}_${this.resultID}.png`,"image/png",1e4).subscribe(F=>{F.type!=D.dt.UploadProgress&&(1==F.success?(this.mnoteJsonData.pages[M].draw=F.data?.url,this.pagesCount--,0==this.pagesCount&&this.remark(JSON.stringify(this.mnoteJsonData))):this.commonService.snackError("lang_auto_luu_du_lieu_cham_bai_khong_thanh_cong"))})}uploadAll(H){this.pagesCount=0;for(let M=0;M<H.length;M++)H[M].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(JSON.stringify(this.mnoteJsonData));else for(let M=0;M<H.length;M++)H[M].draw&&this.uploadBase64ToCDN(H[M].draw,M)}sendDataToIframe(){const H=document.getElementById("mNote"),M=H?H.contentWindow:null;if(null!==M)if(this.examResultObj.confirmedAt&&this.examResultObj.result){if(this.examResultObj.result){var oe=this.commonService.willDeleteParseJson(this.examResultObj.result);if(null!=oe){for(let ne=0;ne<oe.pages.length;ne++)oe.pages[ne].backgroundImage&&(oe.pages[ne].backgroundImage=this.cdnService.getMyCdn(oe.pages[ne].backgroundImage)),oe.pages[ne].draw&&(oe.pages[ne].draw=this.cdnService.getMyCdn(oe.pages[ne].draw));oe=JSON.stringify(oe),this.examResultObj.result=oe}}var F=this.checkMapBGImageWithFileLength(this.examResultObj.result??"{}");if(this.jsonData=this.commonService.willDeleteParseJson(F?this.examResultObj.result??"{}":this.addBGImageByFileUrl(this.examResultObj.result??"{}")),this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let ne=0;ne<this.jsonData.pages.length;ne++)this.jsonData.pages[ne].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[ne].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[ne].backgroundImage)),this.jsonData.pages[ne].hasOwnProperty("draw")&&(this.jsonData.pages[ne].draw=this.cdnService.getMyCdn(this.jsonData.pages[ne].draw));this.jsonData&&(this.jsonData.cmd="initMNote",this.jsonData.mode=this.iframeViewMode,this.jsonData.context="exam"),M.postMessage(this.jsonData,"*")}else{let ne=[];this.files.forEach(N=>{var G=this.cdnService.getMyCdn(N.url);G&&ne.push({backgroundImage:G})}),M.postMessage({cmd:"initMNote",pages:ne,mode:this.isBackEnd?"edit":"view",context:"exam"},"*"),this.dataMarkNote.answer_obj={id:0,homeworkId:0,studentId:0,point:0,files:ne},console.log("%cMyProject%cline:252%cthis.dataMarkNote.answer_obj","color:#fff;background:#ee6f57;padding:3px;border-radius:2px","color:#fff;background:#1f3c88;padding:3px;border-radius:2px","color:#fff;background:rgb(248, 214, 110);padding:3px;border-radius:2px",this.dataMarkNote.answer_obj)}}checkMapBGImageWithFileLength(H){var M=this.commonService.willDeleteParseJson(H);let oe=!1;if(0==this.files.length)oe=!0;else if(this.files.length>0&&M&&M.pages&&this.files.length==M.pages.length){let F=0;this.files.forEach((ne,k)=>{M.pages[k]&&M.pages[k].backgroundImage&&M.pages[k].backgroundImage.indexOf(ne.path)>-1&&F++}),F==this.files.length&&(oe=!0)}return oe}addBGImageByFileUrl(H){var M=this.commonService.willDeleteParseJson(H);return this.files.forEach((oe,F)=>{let ne=!1;if(M&&M.pages){for(var k=0;k<M.pages.length;k++)if(M.pages[k]&&M.pages[k].backgroundImage&&M.pages[k].backgroundImage.indexOf(oe.path)>-1){ne=!0;break}!1===ne&&(M.pages[F]&&M.pages[F].id==F?M.pages[F].backgroundImage=this.cdnService.getMyCdn(oe.url??""):M.pages.splice(F,0,{backgroundImage:this.cdnService.getMyCdn(oe.url??"")}))}}),JSON.stringify(M)}getMnoteJsonData(){if(this.permissionService.hasMarkPointPermission("exam",this.examObj.permissionObj)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",this.examObj.permissionObj)){if(!this.isValidPoint())return void this.showErrorSnack("lang_auto_cham_diem_vuot_qua_so_diem_toi_da_vui_long_kiem_tra_lai");{let H=!1;for(const M in this.form.value)""!==this.form.value[M]&&(H=!0);if(!H)return void this.showErrorSnack("lang_core_vui_long_nhap_diem_tu_luan");for(const M in this.form.value)""===this.form.value[M]&&(this.form.value[M]=0,this.form.controls[M].setValue(0));if(this.files&&this.files.length>0){const M=document.getElementById("mNote"),oe=M?M.contentWindow:null;null!==oe&&oe.postMessage({cmd:"getMNoteJson"},"*")}else this.isLoading=!0,this.remark("")}}else this.showErrorSnack("lang_auto_ban_khong_co_quen_cham_de_thi_nay")}remark(H){if(this.checkMapBGImageWithFileLength(H)){for(const ne in this.form.value)"string"==typeof this.form.value[ne]&&this.form.value[ne].includes(",")&&(this.form.value[ne]=this.form.value[ne].replace(",","."));let F=JSON.stringify({type:"exam",id:this.examObj.id,user:this.examObj.tenantId});var oe={id:this.resultID,result:H,essayResult:JSON.stringify(this.form.value)};this.examResultService.apiExamResultSaveResultPost(oe,F).subscribe(ne=>{1==ne.success?(this.showSuccessSnack("lang_auto_cham_diem_tu_luan_thanh_cong"),this.saveResultEvent.emit(1),this.isLoading=!1):(this.commonService.snackError(ne.message??""),this.saveResultEvent.emit(0),this.isLoading=!1)})}else this.showErrorSnack("lang_auto_cham_diem_tu_luan_loi_du_lieu_bai_tu_luan_dang_duoc_tai_len_vui_long_tai_lai_trang_va_doi_trong_giay_lat"),this.saveResultEvent.emit(0),this.isLoading=!1}ngOnInit(){this.iframeSrc=this.envService.getEnvValue("classliveUrl")??"";var H={};let M;this.examResultObj.confirmedAt&&(M=this.commonService.willDeleteParseJson(this.examResultObj.essayResult??"{}")),this.followerRenderQuest.setNumQuest(this.questions.length),this.questions.forEach(F=>{let ne=this.getMaxPoint(F.id);this.totalMaxPoint+=ne,F.essMaxPoint=ne,this.maxPointPerQuestion.push(F.essMaxPoint)});for(let F=0;F<this.questions.length;F++){var oe=`cau${F}`;H[oe]=new u.p4(M?M[oe]:"",[u.kI.pattern("^[0-9]((.|,){0,1})[0-9]{0,8}"),u.kI.min(0),u.kI.max(this.questions[F].essMaxPoint??0)])}this.form=this.fb.group(H),this.form.valueChanges.subscribe(F=>{let ne=JSON.stringify(F);ne!=this.prevData&&(this.prevData=ne,this.form.patchValue(F))}),super.ngOnInit()}ngAfterViewInit(){window.addEventListener("message",this.handleIframe)}constructor(H,M,oe,F,ne,k,N){super(),this.baseApiService=H,this.fb=M,this.permissionService=oe,this.cdnService=F,this.envService=ne,this.examResultService=k,this.apiUploadService=N,this.isBackEnd=!0,this.displayScreen=3,this.resultID=0,this.files=[],this.questions=[],this.userAnswersObj={},this.iframeSrc="",this.hasLoadedData=!1,this.iframeViewMode="view",this.saveResultEvent=new h.vpe,this.followerRenderQuest=new d.G,this.form=new u.nJ({}),this.formValue={},this.isLoading=!1,this.totalMaxPoint=0,this.maxPointPerQuestion=[],this.hasSendDataToIframe=!1,this.jsonData={},this.mnoteJsonData={},this.pagesCount=0,this.dataMarkNote={},this.handleIframe=G=>{"MNoteJson"==G.data.cmd&&(this.isLoading=!0,this.mnoteJsonData=G.data.data,this.uploadAll(this.mnoteJsonData.pages)),"MNoteLoadComplete"==G.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,this.sendDataToIframe()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}}return U.\u0275fac=function(H){return new(H||U)(h.Y36(Q._),h.Y36(u.QS),h.Y36(B.$),h.Y36(S.U),h.Y36(m.D),h.Y36(x.k),h.Y36(g.$))},U.\u0275cmp=h.Xpm({type:U,selectors:[["azt-mark-essay"]],viewQuery:function(H,M){if(1&H&&h.Gf(K,5),2&H){let oe;h.iGM(oe=h.CRH())&&(M.mnoteContainer=oe.first)}},inputs:{isBackEnd:"isBackEnd",displayScreen:"displayScreen",resultID:"resultID",files:"files",questions:"questions",userAnswersObj:"userAnswersObj",examResultObj:"examResultObj",iframeSrc:"iframeSrc",hasLoadedData:"hasLoadedData",iframeViewMode:"iframeViewMode",configExam:"configExam",examObj:"examObj"},outputs:{saveResultEvent:"saveResultEvent"},features:[h.qOj],decls:12,vars:12,consts:[["id","essayBoxButtons",1,"flex","items-center","jusitfy-center","flex-col","p-3","rounded-md","border","border-slate-200","dark:border-darkmode-400"],[1,"grid","grid-cols-12","gap-3","pb-3","w-full","border-b","border-slate-200","dark:border-darkmode-400",3,"formGroup"],["class","col-span-12 md:col-span-6 lg:col-span-4 pr-3 border-r border-slate-200 dark:border-darkmode-400",3,"ngStyle",4,"ngFor","ngForOf"],["class","BWrap-one",4,"ngIf"],["id","showQuestionEssay"],["class","essay_qItem",4,"ngFor","ngForOf"],["class","mb-2 mt-2",4,"ngIf"],[1,"card-box","listPhotos",3,"ngStyle"],["mnoteContainer",""],["id","mNote","frameborder","0",2,"width","100%","height","100vh",3,"src"],["class","BWrap",4,"ngIf"],[1,"col-span-12","md:col-span-6","lg:col-span-4","pr-3","border-r","border-slate-200","dark:border-darkmode-400",3,"ngStyle"],[1,"flex","items-center"],["azt-track-service","mark-essay-new-jJ82weJqe",1,"mr-1","flex-none",3,"matTooltip","click"],[1,"mr-1","inline-block","flex-none",2,"min-width","130px"],[1,"maxPoint",3,"matTooltip"],["type","text","appOnlyNumber","","step",".01",1,"form-control",3,"readonly","decimal","placeholder","ngClass","formControlName"],["class","mt-2 text-danger text-xs",4,"ngIf"],[1,"mt-2","text-danger","text-xs"],[4,"ngIf"],[1,"BWrap-one"],["azt-track-service","mark-essay-TM1aspmGv4","id","btn-1",1,"mt-3","btn","btn-primary",3,"disabled","click"],[1,"essay_qItem"],[1,"mt-2",2,"display","block",3,"id"],[3,"startQuestionIndex","follower","displayScreen","examObj","question","index","configExam","expandInfo","userAnswersObj","place"],["class","block-input","style"," margin-bottom: 40px; margin-top: -20px;",4,"ngIf"],[1,"block-input",2,"margin-bottom","40px","margin-top","-20px"],[3,"formGroup"],[1,"mr-2","font-medium",3,"for"],["type","text","appOnlyNumber","","step",".01",1,"form-control","form-input","d-inline-flex",3,"readonly","ngClass","id","decimal","placeholder","formControlName"],[1,"mb-2","mt-2"],[1,"BWrap"],["azt-track-service","mark-essay-RBBGLVIph5","id","btn-2",1,"mt-3","btn","btn-primary",3,"disabled","click"]],template:function(H,M){1&H&&(h.TgZ(0,"div",0)(1,"form",1),h.YNc(2,bt,15,27,"div",2),h.qZA(),h.YNc(3,Ke,5,6,"div",3),h.qZA(),h.TgZ(4,"div",4),h.YNc(5,ie,4,12,"div",5),h.qZA(),h.YNc(6,Ie,6,6,"div",6),h.TgZ(7,"div",7,8),h._UZ(9,"iframe",9),h.ALo(10,"safe"),h.qZA(),h.YNc(11,Pe,5,6,"div",10)),2&H&&(h.xp6(1),h.Q6J("formGroup",M.form),h.xp6(1),h.Q6J("ngForOf",M.questions),h.xp6(1),h.Q6J("ngIf",M.isBackEnd),h.xp6(2),h.Q6J("ngForOf",M.questions),h.xp6(1),h.Q6J("ngIf",M.files&&0==M.files.length),h.xp6(1),h.Q6J("ngStyle",h.VKq(10,ke,M.files&&0==M.files.length?"none":"block")),h.xp6(2),h.Q6J("src",h.lcZ(10,8,M.iframeSrc),h.uOi),h.xp6(2),h.Q6J("ngIf",M.isBackEnd))},dependencies:[j.mk,j.sg,j.O5,j.PC,I.Hw,A.gM,u._Y,u.Fj,u.JJ,u.JL,u.sg,u.u,O.Y,q.M,w.O,Y.bT,Y.yl],styles:["#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]{flex:auto;display:flex;flex-wrap:wrap;padding-bottom:10px;width:100%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-right:5px;display:flex;justify-content:center;align-items:center;padding-right:5px;margin-bottom:5px;width:24%}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 5px;height:30px;border-radius:3px;padding-left:5px;width:60px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child, #essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]{color:#838383;margin-right:3px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   .maxPoint[_ngcontent-%COMP%]:hover{cursor:default}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#585858}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.form-control.is-invalid[_ngcontent-%COMP%]{padding-right:calc(1.5em + .15rem)!important;background-position:right calc(.375em + .02rem) center!important}.form-input[_ngcontent-%COMP%]{height:30px;width:96px}.form-mark[_ngcontent-%COMP%]{margin-left:20px}div#showQuestionEssay[_ngcontent-%COMP%]{width:100%}.BWrap[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;padding-bottom:15px}.essay_qItem[_ngcontent-%COMP%]:last-child > div[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:30px!important}[type=number][_ngcontent-%COMP%]{appearance:none;appearance:textfield;-webkit-appearance:none;-moz-appearance:textfield}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.pr-3[_ngcontent-%COMP%]{padding-right:.75rem}@media screen and (max-width: 1474px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:12px}.maxPoint[_ngcontent-%COMP%]{font-size:10px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 768px){.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:48%}}@media screen and (max-width: 480px){#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{border-right:none;margin-bottom:5px}.stt[_ngcontent-%COMP%]{font-size:13px}#essayBoxButtons[_ngcontent-%COMP%]   .listSTT[_ngcontent-%COMP%]   .col-wrap[_ngcontent-%COMP%]{width:99%}}"]}),U})()},41715:(Qe,ce,v)=>{v.d(ce,{ay:()=>j});class D{constructor(){this.x=0,this.y=0}toBase64String(){return(new O).writeCvPoint2u(this).toBase64String()}}class h{constructor(){this.x=0,this.y=0}toBase64String(){return(new O).writeCvPoint2f(this).toBase64String()}}class u{constructor(){this.x=0,this.y=0,this.width=0,this.height=0}toBase64String(){return(new O).writeCvRect2f(this).toBase64String()}}class _{constructor(){this.center=new h,this.filled=!1}toBase64String(){return(new O).writeAnswerCircle(this).toBase64String()}}class le{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}toBase64String(){return(new O).writeTableAnswer(this).toBase64String()}}class d{constructor(){this.top=new h,this.left=new h,this.bottom=new h,this.right=new h}toBase64String(){return(new O).writeResultRect(this).toBase64String()}}class Q{constructor(){this.id=0,this.region=new u}toBase64String(){return(new O).writeCropRegion(this).toBase64String()}}class B{constructor(){this.type=0,this.errorCode=0,this.paperCorner=new d,this.studentId=new le,this.examId=new le,this.answerTable=new le,this.imageWidth=0,this.imageHeight=0,this.imageSize=0,this.cropRegion=[]}toBase64String(){return(new O).writeResultOutput(this).toBase64String()}}class S{constructor(){this.templateType=0,this.imageWidth=0,this.imageHeight=0}toBase64String(){return(new O).writeAnswerSheetInput(this).toBase64String()}}class m{constructor(){this.position=0,this.x=0,this.y=0,this.filledCols=0,this.rows=0}toBase64String(){return(new O).writeSmallAnswerCircle(this).toBase64String()}}class x{constructor(){this.rows=0,this.cols=0,this.radius=0,this.answers=[]}toBase64String(){return(new O).writeSmallTableAnswer(this).toBase64String()}}class g{constructor(){this.studentId=new x,this.examId=new x,this.answerTable=new x}toBase64String(){return(new O).writeDrawData(this).toBase64String()}}class j{constructor(w){this.bytes=w,this.cursor=0,this.length=w.byteLength}updateCursor(w){if(this.cursor=this.cursor+w,this.cursor>this.length)throw new Error("Overflow InputStreaming")}parseUchar(){let w=this.bytes[this.cursor];return this.updateCursor(1),w}parseInt(){let w=this.bytes.buffer.slice(this.cursor,this.cursor+4);return this.updateCursor(4),new DataView(w).getInt32(0)}parseDouble(){let w=this.bytes.buffer.slice(this.cursor,this.cursor+8);return this.updateCursor(8),new DataView(w).getFloat64(0,!0)}parseString(){let w=new TextDecoder("utf-8"),Y=this.cursor,K=this.bytes[this.cursor];for(;0!=K;)this.updateCursor(1),K=this.bytes[this.cursor];let Le=this.bytes.slice(Y,this.cursor),pe=w.decode(Le);return this.updateCursor(1),pe}parseBool(){let w=this.bytes[this.cursor];return this.updateCursor(1),w>0}parseCvPoint2u(){let w=new D;return w.x=this.parseUchar(),w.y=this.parseUchar(),w}parseCvPoint2f(){let w=new h;return w.x=this.parseDouble(),w.y=this.parseDouble(),w}parseCvRect2f(){let w=new u;return w.x=this.parseDouble(),w.y=this.parseDouble(),w.width=this.parseDouble(),w.height=this.parseDouble(),w}parseAnswerCircle(){let w=new _;return w.center=this.parseCvPoint2f(),w.filled=this.parseBool(),w}parseTableAnswer(){let w=new le,Y=0;w.rows=this.parseInt(),w.cols=this.parseInt(),w.radius=this.parseInt(),Y=this.parseInt();for(let K=0;K<Y;K++)w.answers.push(this.parseAnswerCircle());return w}parseResultRect(){let w=new d;return w.top=this.parseCvPoint2f(),w.left=this.parseCvPoint2f(),w.bottom=this.parseCvPoint2f(),w.right=this.parseCvPoint2f(),w}parseCropRegion(){let w=new Q;return w.id=this.parseInt(),w.region=this.parseCvRect2f(),w}parseResultOutput(){let w=new B,Y=0;w.type=this.parseInt(),w.errorCode=this.parseInt(),w.paperCorner=this.parseResultRect(),w.studentId=this.parseTableAnswer(),w.examId=this.parseTableAnswer(),w.answerTable=this.parseTableAnswer(),w.imageWidth=this.parseInt(),w.imageHeight=this.parseInt(),w.imageSize=this.parseInt(),Y=this.parseInt();for(let K=0;K<Y;K++)w.cropRegion.push(this.parseCropRegion());return w}parseAnswerSheetInput(){let w=new S;return w.templateType=this.parseInt(),w.imageWidth=this.parseInt(),w.imageHeight=this.parseInt(),w}parseSmallAnswerCircle(){let w=new m;return w.position=this.parseUchar(),w.x=this.parseUchar(),w.y=this.parseUchar(),w.filledCols=this.parseUchar(),w.rows=this.parseUchar(),w}parseSmallTableAnswer(){let w=new x,Y=0;w.rows=this.parseUchar(),w.cols=this.parseUchar(),w.radius=this.parseUchar(),Y=this.parseInt();for(let K=0;K<Y;K++)w.answers.push(this.parseSmallAnswerCircle());return w}parseDrawData(){let w=new g;return w.studentId=this.parseSmallTableAnswer(),w.examId=this.parseSmallTableAnswer(),w.answerTable=this.parseSmallTableAnswer(),w}}const I=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];class O{constructor(){this.bytes=[]}writeUchar(w){return this.bytes.push(w),this}writeUint8Array(w){for(let Y=0;Y<w.length;Y++)this.bytes.push(w[Y]);return this}writeArrayBuffer(w){let Y=new Uint8Array(w);return this.writeUint8Array(Y),this}writeInt(w){let Y=new ArrayBuffer(4);return new DataView(Y).setUint32(0,w,!1),this.writeArrayBuffer(Y),this}writeDouble(w){let Y=new ArrayBuffer(8);return new DataView(Y).setFloat64(0,w,!0),this.writeArrayBuffer(Y),this}writeString(w){let K=(new TextEncoder).encode(w);return this.writeUint8Array(K),this.writeUchar(0),this}writeBool(w){return this.writeUchar(w?1:0),this}toBase64String(){return function A(q){let Y,w="",K=q.length;for(Y=2;Y<K;Y+=3)w+=I[q[Y-2]>>2],w+=I[(3&q[Y-2])<<4|q[Y-1]>>4],w+=I[(15&q[Y-1])<<2|q[Y]>>6],w+=I[63&q[Y]];return Y===K+1&&(w+=I[q[Y-2]>>2],w+=I[(3&q[Y-2])<<4],w+="=="),Y===K&&(w+=I[q[Y-2]>>2],w+=I[(3&q[Y-2])<<4|q[Y-1]>>4],w+=I[(15&q[Y-1])<<2],w+="="),w}(new Uint8Array(this.bytes))}writeCvPoint2u(w){return this.writeUchar(w.x),this.writeUchar(w.y),this}writeCvPoint2f(w){return this.writeDouble(w.x),this.writeDouble(w.y),this}writeCvRect2f(w){return this.writeDouble(w.x),this.writeDouble(w.y),this.writeDouble(w.width),this.writeDouble(w.height),this}writeAnswerCircle(w){return this.writeCvPoint2f(w.center),this.writeBool(w.filled),this}writeTableAnswer(w){this.writeInt(w.rows),this.writeInt(w.cols),this.writeInt(w.radius),this.writeInt(w.answers.length);for(let Y of w.answers)this.writeAnswerCircle(Y);return this}writeResultRect(w){return this.writeCvPoint2f(w.top),this.writeCvPoint2f(w.left),this.writeCvPoint2f(w.bottom),this.writeCvPoint2f(w.right),this}writeCropRegion(w){return this.writeInt(w.id),this.writeCvRect2f(w.region),this}writeResultOutput(w){this.writeInt(w.type),this.writeInt(w.errorCode),this.writeResultRect(w.paperCorner),this.writeTableAnswer(w.studentId),this.writeTableAnswer(w.examId),this.writeTableAnswer(w.answerTable),this.writeInt(w.imageWidth),this.writeInt(w.imageHeight),this.writeInt(w.imageSize),this.writeInt(w.cropRegion.length);for(let Y of w.cropRegion)this.writeCropRegion(Y);return this}writeAnswerSheetInput(w){return this.writeInt(w.templateType),this.writeInt(w.imageWidth),this.writeInt(w.imageHeight),this}writeSmallAnswerCircle(w){return this.writeUchar(w.position),this.writeUchar(w.x),this.writeUchar(w.y),this.writeUchar(w.filledCols),this.writeUchar(w.rows),this}writeSmallTableAnswer(w){this.writeUchar(w.rows),this.writeUchar(w.cols),this.writeUchar(w.radius),this.writeInt(w.answers.length);for(let Y of w.answers)this.writeSmallAnswerCircle(Y);return this}writeDrawData(w){return this.writeSmallTableAnswer(w.studentId),this.writeSmallTableAnswer(w.examId),this.writeSmallTableAnswer(w.answerTable),this}}},36669:(Qe,ce,v)=>{v.d(ce,{l:()=>le});var D=v(65879),h=v(87384),u=v(58222),_=v(46825);let le=(()=>{class d{addIndexLabelToQuestionObjs(B){for(let S=0;S<(B?.length??0);S++)B?.[S]&&(B[S].indexLabel=S);return B}getEssayQuestionObjs(B){let S=[];for(let m=0;m<(B?.length??0);m++)this.answerTypeService.isEssayAnswer(B?.[m].answerType)&&B?.[m]&&S.push(B[m]);return S}getTrueFalseQuestionObjs(B){let S=[];for(let m=0;m<(B?.length??0);m++)(this.answerTypeService.isOneChoiceAnswer(B?.[m].answerType)||this.answerTypeService.isFillAnswer(B?.[m].answerType))&&B?.[m]&&S.push(B[m]);return S}convertAnswersArr(B){let S={};return 0!=B.length&&B.forEach(m=>{S[`id_${m.QuestionId}`]=m?.AnswerContent?.[0].Content}),S}mapStudentObjWithTestedObj(B,S,m){var x=this.commonService.castObj(B?.studentObj),g=S?.filter(j=>j.userId==m?.parentId);return x&&g&&g.length>0&&(x={...x,offlineMarkObj:g[0].offlineMarkObj,nameImage:g[0].nameImage??""}),m=x}mapStudentObjWithTestedObjForFrontendStudent(B,S,m){var x=this.commonService.castObj(B?.studentObj),g=S?.filter(j=>j.userId==m?.parentId);return x&&g&&g.length>0&&(x={...x,offlineMarkObj:g[0].offlineMarkObj,nameImage:g[0].nameImage??""}),m=x}constructor(B,S,m){this.commonService=B,this.zipDataService=S,this.answerTypeService=m}}return d.\u0275fac=function(B){return new(B||d)(D.LFG(h.v),D.LFG(u.D),D.LFG(_.T))},d.\u0275prov=D.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},44821:(Qe,ce,v)=>{v.d(ce,{V:()=>B});var D=v(19347),h=v(39621),u=v(65879),_=v(41719),le=v(96814),d=v(11964);function Q(S,m){1&S&&(u.TgZ(0,"span"),u.O4$(),u.TgZ(1,"svg",15)(2,"g",16)(3,"g",17),u._UZ(4,"circle",18),u.TgZ(5,"path",19),u._UZ(6,"animateTransform",20),u.qZA()()()()())}let B=(()=>{class S extends h.Q{confirmDelete(){this.initStatusObj(),this.subscriptions.add(this.offlineExamResultService.apiOfflineExamResultDeleteExamResultObjGet(this.examHashId,this.examResultId).subscribe(x=>{1==x.success?(this.dialogRef.close(!0),this.showSuccessSnack("lang_cms_delete_success")):(this.btnCloseDialog(),this.showErrorSnack(x.message??""))}))}btnCloseDialog(){this.dialogRef.close()}ngOnInit(){super.ngOnInit()}constructor(x,g,j){super(),this.offlineExamResultService=x,this.dialogRef=g,this.examHashId="",this.examResultId=0,this.examHashId=j.examHashId,this.examResultId=j.examResultId}}return S.\u0275fac=function(x){return new(x||S)(u.Y36(_.$4),u.Y36(D.so,8),u.Y36(D.WI,8))},S.\u0275cmp=u.Xpm({type:S,selectors:[["app-delete-dialog"]],features:[u.qOj],decls:22,vars:11,consts:[[1,"box",2,"max-width","600px"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"p-5"],[1,"text-md","flex"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-6","h-6","mr-2","text-danger","flex-none"],["d","M3 6h18"],["d","M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"],["d","M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"],["x1","10","y1","11","x2","10","y2","17"],["x1","14","y1","11","x2","14","y2","17"],[1,"mr-1"],[1,"p-3","text-right"],["azt-track-service","delete-dialog-VaCVDZ-8G",1,"btn","btn-secondary","w-24","mr-2",3,"click"],["azt-track-service","delete-dialog-GpxoaJJJor",1,"btn","w-32","btn-danger",3,"disabled","click"],[4,"ngIf"],["width","25","viewBox","-2 -2 42 42","xmlns","http://www.w3.org/2000/svg","stroke","white",1,"w-4","h-4","mr-2"],["fill","none","fill-rule","evenodd"],["transform","translate(1 1)","stroke-width","4"],["stroke-opacity",".5","cx","18","cy","18","r","18"],["d","M36 18c0-9.94-8.06-18-18-18"],["attributeName","transform","type","rotate","from","0 18 18","to","360 18 18","dur","1s","repeatCount","indefinite"]],template:function(x,g){1&x&&(u.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),u.O4$(),u.TgZ(4,"svg",4),u._UZ(5,"path",5)(6,"path",6)(7,"path",7)(8,"line",8)(9,"line",9),u.qZA(),u.kcU(),u.TgZ(10,"div")(11,"span",10),u._uU(12),u.ALo(13,"mytranslate"),u.qZA()()()()(),u.TgZ(14,"div",11)(15,"button",12),u.NdJ("click",function(){return g.btnCloseDialog()}),u._uU(16),u.ALo(17,"mytranslate"),u.qZA(),u.TgZ(18,"button",13),u.NdJ("click",function(){return g.confirmDelete()}),u.YNc(19,Q,7,0,"span",14),u._uU(20),u.ALo(21,"mytranslate"),u.qZA()()()),2&x&&(u.xp6(12),u.Oqu(u.lcZ(13,5,"lang_testbank_are_you_sure_to_delete_this_exam_result")),u.xp6(4),u.hij(" ",u.lcZ(17,7,"lang_cms_common_close_btn")," "),u.xp6(2),u.Q6J("disabled",g.statusObj.loading),u.xp6(1),u.Q6J("ngIf",g.statusObj.loading),u.xp6(1),u.hij(" ",u.lcZ(21,9,"lang_cms_common_confirm_btn")," "))},dependencies:[le.O5,d.bT],encapsulation:2}),S})()},73967:(Qe,ce,v)=>{v.d(ce,{p:()=>Y});var D=v(19347),h=v(39621),u=v(65879),_=v(96814),le=v(23680),d=v(75986),Q=v(64170),B=v(87466),S=v(98525),m=v(92596),x=v(11964);function g(K,Le){if(1&K&&(u.TgZ(0,"div")(1,"div",10)(2,"div",11),u._uU(3),u.qZA(),u._UZ(4,"input",12),u.qZA()()),2&K){const pe=u.oxw().$implicit;u.xp6(3),u.hij(" ",pe.title," "),u.xp6(1),u.s9C("value",pe.contents[0]),u.Q6J("disabled",!0)}}function j(K,Le){if(1&K&&(u.TgZ(0,"div",17)(1,"mat-checkbox",18)(2,"span",19),u._uU(3),u.qZA()()()),2&K){const pe=Le.$implicit;u.xp6(1),u.Q6J("checked",!0)("disabled",!0),u.xp6(1),u.s9C("matTooltip",pe),u.xp6(1),u.Oqu(pe)}}function I(K,Le){if(1&K&&(u.TgZ(0,"div")(1,"div",13)(2,"span",14),u._uU(3),u.qZA()(),u.TgZ(4,"div",15),u.YNc(5,j,4,4,"div",16),u.qZA()()),2&K){const pe=u.oxw().$implicit;u.xp6(3),u.Oqu(pe.title),u.xp6(2),u.Q6J("ngForOf",pe.contents)}}function A(K,Le){if(1&K&&(u.TgZ(0,"mat-radio-button",22)(1,"span",19),u._uU(2),u.qZA()()),2&K){const pe=Le.$implicit;u.Q6J("checked",!0)("disabled",!0),u.xp6(1),u.s9C("matTooltip",pe),u.xp6(1),u.Oqu(pe)}}function O(K,Le){if(1&K&&(u.TgZ(0,"div")(1,"div",13)(2,"span",20),u._uU(3),u.qZA()(),u.TgZ(4,"mat-radio-group",15),u.YNc(5,A,3,4,"mat-radio-button",21),u.qZA()()),2&K){const pe=u.oxw().$implicit;u.xp6(3),u.Oqu(pe.title),u.xp6(2),u.Q6J("ngForOf",pe.contents)}}function q(K,Le){if(1&K){const pe=u.EpF();u.TgZ(0,"div")(1,"div",10)(2,"span",20),u._uU(3),u.qZA()(),u.TgZ(4,"div",23)(5,"mat-form-field",24)(6,"mat-select",25),u.NdJ("valueChange",function(Ve){u.CHM(pe);const jt=u.oxw().$implicit;return u.KtG(jt.contents[0]=Ve)}),u.TgZ(7,"mat-option",26),u._uU(8),u.qZA()()()()()}if(2&K){const pe=u.oxw().$implicit;u.xp6(3),u.Oqu(pe.title),u.xp6(3),u.Q6J("value",pe.contents[0])("disabled",!0),u.xp6(1),u.s9C("value",pe.contents[0]),u.xp6(1),u.Oqu(pe.contents[0])}}function w(K,Le){if(1&K&&(u.ynx(0,8),u.YNc(1,g,5,3,"div",9),u.YNc(2,I,6,2,"div",9),u.YNc(3,O,6,2,"div",9),u.YNc(4,q,9,5,"div",9),u.BQk()),2&K){const pe=Le.$implicit;u.xp6(1),u.Q6J("ngIf",0==pe.type),u.xp6(1),u.Q6J("ngIf",1==pe.type),u.xp6(1),u.Q6J("ngIf",2==pe.type),u.xp6(1),u.Q6J("ngIf",3==pe.type)}}let Y=(()=>{class K extends h.Q{constructor(pe,Xe){super(),this.dialogRef=pe,this.data=Xe}btnCloseDialog(){this.dialogRef.close()}ngOnInit(){super.ngOnInit()}}return K.\u0275fac=function(pe){return new(pe||K)(u.Y36(D.so,8),u.Y36(D.WI))},K.\u0275cmp=u.Xpm({type:K,selectors:[["app-result-info-dialog"]],features:[u.qOj],decls:12,vars:7,consts:[[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],["id","test-info-form-show",1,"p-5"],[1,"text-center","mx-auto"],[1,"text-md","font-medium"],["class","info-field",4,"ngFor","ngForOf"],[1,"p-3","text-right"],["azt-track-service","result-info-dialog-NTVpa2BtGs",1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"info-field"],[4,"ngIf"],[1,"input-group","mt-3"],[1,"input-group-text","whitespace-nowrap","font-medium",2,"min-width","100px","text-align","left"],["type","text",1,"form-control",3,"disabled","value"],[1,"input-group","w-full","mt-3"],[1,"input-group-text","w-full","align-center","font-medium",2,"vertical-align","middle","border-bottom-left-radius","0","border-bottom-right-radius","0","white-space","normal"],[1,"grid","grid-cols-12","gap-3","p-2","ml-0","mr-0","border-row"],["class","col-span-12 sm:col-span-12 md:col-span-4 text-left mb-1",4,"ngFor","ngForOf"],[1,"col-span-12","sm:col-span-12","md:col-span-4","text-left","mb-1"],["color","primary",3,"checked","disabled"],[1,"truncate",2,"vertical-align","middle","color","#1e293c",3,"matTooltip"],[1,"input-group-text","w-full","font-medium",2,"vertical-align","middle","border-bottom-left-radius","0","border-bottom-right-radius","0","white-space","normal"],["color","primary","class","col-span-12 sm:col-span-12 md:col-span-4 text-left mb-1",3,"checked","disabled",4,"ngFor","ngForOf"],["color","primary",1,"col-span-12","sm:col-span-12","md:col-span-4","text-left","mb-1",3,"checked","disabled"],[1,"border-row"],["appearance","fill",1,"border-0"],[3,"value","disabled","valueChange"],[2,"color","#1e293c",3,"value"]],template:function(pe,Xe){1&pe&&(u.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),u._uU(5),u.ALo(6,"mytranslate"),u.qZA()(),u.YNc(7,w,5,4,"ng-container",5),u.qZA()(),u.TgZ(8,"div",6)(9,"button",7),u.NdJ("click",function(){return Xe.btnCloseDialog()}),u._uU(10),u.ALo(11,"mytranslate"),u.qZA()()()),2&pe&&(u.xp6(5),u.hij(" ",u.lcZ(6,3,"lang_testbank_test_config_verify_profile_student")," "),u.xp6(2),u.Q6J("ngForOf",Xe.data),u.xp6(3),u.hij(" ",u.lcZ(11,5,"lang_auto_dong")," "))},dependencies:[_.sg,_.O5,le.ey,d.oG,Q.KE,B.VQ,B.U0,S.gD,m.gM,x.bT],encapsulation:2}),K})()},63987:(Qe,ce,v)=>{v.d(ce,{i:()=>Zt});var D=v(12889),h=v(39621),u=v(44821),_=v(65879),le=v(19347),d=v(58222),Q=v(42014),B=v(41715),S=v(87384),m=v(8415);const g=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",""];let j=(()=>{class xe{constructor(V,$,ie){this.commonService=V,this.zipDataService=$,this.cdnService=ie}drawAzotaFileToCanvas(V,$){return new Promise((ie,Ie)=>{var Pe="",ke=this.commonService.willDeleteParseJson(this.zipDataService.decodeContentGzip(V.images??""));ke&&ke.url&&ke.url.includes(".azt")?this.httpGetAsync(this.cdnService.getMyCdn(ke.url)).then(Be=>{Be&&Be.length>0?Q.decodeScanOfflineFile(Be).then(U=>{let Ce=this._arrayBufferToBase64(U.getWrappedImage()??new Uint8Array),H=U.getWrappedImageExtension(),M=U.scanOfflineData?.scanResult;if(Ce){let oe=new Image;oe.src="data:image/"+H+";base64,"+Ce,oe.crossOrigin="anonymous",oe.onload=()=>{var F=document.createElement("canvas");F.width=oe.width,F.height=oe.height;const ne=F.getContext("2d");ne?.drawImage(oe,0,0,F.width,F.height);let k=V.resultsData?.answerObjs??[];if(M?.examCodeRegion?.circles&&M?.examCodeRegion?.circles.length>0&&this.drawCommonCircles(M?.examCodeRegion?.circles,ne),M?.studentCodeRegion?.circles&&M?.studentCodeRegion?.circles.length>0&&this.drawCommonCircles(M?.studentCodeRegion?.circles,ne),M?.answerRegion?.circles&&M?.answerRegion?.circles.length>0&&this.drawCircles(M?.answerRegion?.circles,ne,k),M?.answerRegion?.essayCircles&&M?.answerRegion?.essayCircles.length>0&&$&&this.drawCommonCircles(M?.answerRegion?.essayCircles,ne),M?.answerRegion?.handwrittenAnswers&&M?.answerRegion?.handwrittenAnswers.length>0){let N=M?.answerRegion?.handwrittenAnswers,G="18px";if(ne){ne.fillStyle="#00ff00",ne.font=G+" Comic Sans MS",ne.textAlign="center";for(let te=0;te<N.length;te++){let be=N[te];this.fillTextAnswerDrawForFileAzt(be.recognizedText??"",ne,k[te],((be.bottomRight.x??0)+(be.topLeft.x??0))/2-3,((be.bottomRight.y??0)+(be.topLeft.y??0))/2+5)}}}Pe=F.toDataURL("image/jpeg",.9),ie({imgUrl:Pe,studentCode:Number(M?.studentCode),subExamCode:Number(M?.subExamCode)})}}else ie({imgUrl:Pe,studentCode:Number(M?.studentCode),subExamCode:Number(M?.subExamCode)})}):ie({imgUrl:Pe,studentCode:0,subExamCode:0})}).catch(Be=>{Ie(Be)}):ie({imgUrl:Pe,studentCode:0,subExamCode:0})})}drawScanFileToCanvas(V){return new Promise($=>{var ie="",Ie=this.commonService.willDeleteParseJson(this.zipDataService.decodeContentGzip(V.images??""));let Pe=Ie?this.cdnService.getMyCdn(Ie.url):"";if(Ie&&Pe){let ke=new Image;ke.src=Pe,ke.crossOrigin="anonymous",ke.onload=()=>{var Be=document.createElement("canvas");Be.width=ke.width,Be.height=ke.height;const U=Be.getContext("2d");U?.drawImage(ke,0,0,Be.width,Be.height);var Ce=V.resultsData?.answerObjs??[],H=this.commonService.willDeleteParseJson(V.resultsData?.pos??"");if("2.0"==H.version)try{let se=Uint8Array.from(atob(H.resultFilledPos),Ee=>Ee.charCodeAt(0)),ee=new B.ay(se).parseDrawData(),De=ee.studentId?.answers??[];for(var M=0;M<De.length;M++)this.tickStudentIdAndExamId(De[M],U,ee.answerTable?.radius??0);let _e=ee.examId?.answers??[];for(M=0;M<_e.length;M++)this.tickStudentIdAndExamId(_e[M],U,ee.answerTable?.radius??0);let de=ee.answerTable?.answers??[];for(M=0;M<de.length;M++)this.answerPaintedRightOrWrong(de[M],U,ee.answerTable?.radius??0,Ce);ie=Be.toDataURL("image/jpeg",.9),$(ie)}catch{this.commonService.snackError("lang_auto_du_lieu_sai_khong_su_ly_duoc_anh_bai_thi_offline"),$("")}else if("3.0"==H.version)try{let se=H.answersHandwritten??[],ee=(se[0].answerRegion.height??0)-20+"px";if(U){U.fillStyle="#00ff00",U.font=ee+" Comic Sans MS",U.textAlign="center";for(let _e=0;_e<se.length;_e++){let de=se[_e],we=this.getTextAnswerDraw(g[-1==de.answer?26:de.answer],U,Ce[_e]);U.fillText(we,(de.answerRegion.x??0)+(de.answerRegion.width??0)/2,(de.answerRegion.y??0)+(de.answerRegion.height??0)/2+5)}}ie=Be.toDataURL("image/jpeg",.9),$(ie)}catch{this.commonService.snackError("lang_auto_du_lieu_sai_khong_su_ly_duoc_anh_bai_thi_offline"),$("")}else{var oe=H.configurationPos.split("_"),F=H.resultFilledPos.split("_"),ne=H.tableAnchorPos.split("_"),k=this.checkWrongOrTrueAnswer(Ce),N=0;for(M=0;M<oe.length;M++)if(1==M||2==M){var G=oe[M].split("*");N+=parseInt(G[1],10)}var ue=0;for(M=0;M<ne.length;M++)if(M>=2){var te={},be={},Ae=ne[M].split("*"),Ue=Ae[0].split(":"),J=Ae[1].split(":"),Oe={},y=oe[M].split("*");Oe.row=parseInt(y[0],10),Oe.col=parseInt(y[1],10),Oe.radius=parseInt(y[2],10),te.x=parseInt(Ue[0],10),te.y=parseInt(Ue[1],10),be.x=parseInt(J[0],10),be.y=parseInt(J[1],10);for(var E=(be.y-te.y)/(Oe.row+1),T=te.y,b=0;b<Oe.row;b++)if((T+=E)>te.y&&T<be.y){var Z=ue<Ce.length?this.checkAnswerStudentRight(ue,Ce):0;ue++,0!=Z&&U&&(U.beginPath(),U.arc(te.x+E*Z,T,Oe.radius,0,2*Math.PI,!1),U.lineWidth=3,U.strokeStyle="#f3c12c",U.stroke())}}var R=0;for(b=0;b<F.length;b++)if("empty"!=F[b]){var W=F[b].split(":"),he={x:parseInt(W[0],10),y:parseInt(W[1],10),line:parseInt(W[2],10)};b<N+k.length&&(b>=N?(U&&(U.beginPath(),U.arc(he.x,he.y,he.line,0,2*Math.PI,!1),U.lineWidth=3,U.strokeStyle=k[R],U.stroke()),R++):U&&(U.beginPath(),U.arc(he.x,he.y,he.line,0,2*Math.PI,!1),U.lineWidth=3,U.strokeStyle="#00ff00",U.stroke()))}ie=Be.toDataURL("image/jpeg",.9),$(ie)}}}else $("")})}_arrayBufferToBase64(V){for(var $="",ie=new Uint8Array(V),Ie=ie.byteLength,Pe=0;Pe<Ie;Pe++)$+=String.fromCharCode(ie[Pe]);return window.btoa($)}httpGetAsync(V){return new Promise(($,ie)=>{try{const Ie=new XMLHttpRequest;Ie.open("GET",V,!0),Ie.responseType="arraybuffer",Ie.onload=Pe=>{if(200===Ie.status||304===Ie.status){const ke=Ie.response;if(ke){const Be=new Uint8Array(ke);$(Be)}else $(new Uint8Array)}else $(new Uint8Array)},Ie.onerror=Pe=>{ie(new Error("lang_core_cant_loading_url"))},Ie.send(null)}catch(Ie){ie(Ie)}})}fillTextAnswerDrawForFileAzt(V,$,ie,Ie,Pe){let ke="";ie&&(V?ie.rightAnswer&&"ESSAY"!=ie.content&&ie.rightAnswer!=V?($.fillStyle="#f3c12c",$.fillText("["+ie.rightAnswer+"]",Ie+15,Pe),$.fillStyle="red",ke=V+"-",Ie-=10):ie.rightAnswer&&"ESSAY"!=ie.content?($.fillStyle="#00ff00",ke+=V):($.fillStyle="red",ke+=V):($.fillStyle="#f3c12c",ke+=ie.rightAnswer)),$.fillText(ke,Ie,Pe)}drawCommonCircles(V,$){V.length>0&&V.forEach(ie=>{if(ie.filled){let Ie=ie.center.x,Pe=ie.center.y;$&&($.beginPath(),$.arc(Ie,Pe,ie.radius+1,0,2*Math.PI,!1),$.lineWidth=2,$.strokeStyle="#00ff00",$.stroke())}})}drawCircles(V,$,ie){let Ie=[],Pe=[];if(ie.length>0)for(let ke=0;ke<ie.length;ke++){let Be=ke+1+""+ie[ke].rightAnswer;this.commonService.filterArray(Ie,Be)||Ie.push(Be),"ESSAY"==ie[ke].content&&Pe.push(ke+1)}V.forEach(ke=>{let Be=Number(ke.label.substring(0,ke.label.length-1)),U="";if(0==Ie.length?U="#00ff00":this.commonService.filterArray(Ie,ke.label)?U=ke.filled?"#00ff00":"#f3c12c":ke.filled&&(U="red"),U&&Be<=ie.length&&!this.commonService.filterArray(Pe,Be)){let Ce=ke.center.x,H=ke.center.y;$&&($.beginPath(),$.arc(Ce,H,ke.radius+1,0,2*Math.PI,!1),$.lineWidth=2,$.strokeStyle=U,$.stroke())}})}checkAnswerStudentRight(V,$){var ie=0;return $[V]&&""!=$[V].rightAnswer&&0==$[V].isRight&&(ie="A"==$[V].rightAnswer?1:"B"==$[V].rightAnswer?2:"C"==$[V].rightAnswer?3:"D"==$[V].rightAnswer?4:"E"==$[V].rightAnswer?5:"F"==$[V].rightAnswer?6:"G"==$[V].rightAnswer?7:"H"==$[V].rightAnswer?8:0),ie}checkWrongOrTrueAnswer(V){for(var $=[],ie=0;ie<V.length;ie++)""!=V[ie].content&&(1==V[ie].isRight?$.push("#00ff00"):0==V[ie].isRight&&$.push("red"));return $}tickStudentIdAndExamId(V,$,ie){var Ie=256*Math.floor((V.position??0)/16)+V.x,Pe=(V.position??0)%16*256+V.y;(V.filledCols??0)>=128&&$&&($.beginPath(),$.arc(Ie,Pe,ie,0,2*Math.PI,!1),$.lineWidth=3,$.strokeStyle="#00ff00",$.stroke())}answerPaintedRightOrWrong(V,$,ie,Ie){var Pe=256*Math.floor((V.position??0)/16)+V.x,ke=(V.position??0)%16*256+V.y,Be=V.rows??0,Ce="#fff0";Ie.length>Be&&((V.filledCols??0)>=128?Ce=1==Ie[Be].isRight?"#00ff00":"red":(V.filledCols??0)%128+1==this.checkAnswerStudentRight(Be,Ie)&&(Ce="#f3c12c"),$&&($.beginPath(),$.arc(Pe,ke,ie,0,2*Math.PI,!1),$.lineWidth=3,$.strokeStyle=Ce,$.stroke()))}getTextAnswerDraw(V,$,ie){let Ie="";return ie&&(V?ie.isRight?($.fillStyle="#00ff00",Ie+=V):($.fillStyle="red",Ie=V+" - ["+ie.rightAnswer+"]"):($.fillStyle="#f3c12c",Ie+=ie.rightAnswer)),Ie}}return xe.\u0275fac=function(V){return new(V||xe)(_.LFG(S.v),_.LFG(d.D),_.LFG(m.U))},xe.\u0275prov=_.Yz7({token:xe,factory:xe.\u0275fac,providedIn:"root"}),xe})();var I=v(96814),A=v(92596),O=v(11964);function q(xe,$e){if(1&xe){const V=_.EpF();_.TgZ(0,"div")(1,"a",15),_.NdJ("click",function(){_.CHM(V);const ie=_.oxw(2);let Ie;return _.KtG(ie.deleteOfflineExamResultObj(null!==(Ie=null==ie.examObj?null:ie.examObj.hashId)&&void 0!==Ie?Ie:"",ie.examResultIdParam))}),_.O4$(),_.TgZ(2,"svg",16),_._UZ(3,"path",17)(4,"path",18)(5,"path",19)(6,"line",20)(7,"line",21),_.qZA(),_._uU(8),_.ALo(9,"mytranslate"),_.qZA()()}2&xe&&(_.xp6(8),_.hij(" ",_.lcZ(9,1,"lang_auto_xoa")," "))}function w(xe,$e){1&xe&&(_.TgZ(0,"span",22),_._uU(1),_.ALo(2,"mytranslate"),_.qZA()),2&xe&&(_.xp6(1),_.hij("",_.lcZ(2,1,"lang_auto_anh_cham"),": "))}function Y(xe,$e){1&xe&&(_.TgZ(0,"span"),_._uU(1),_.ALo(2,"mytranslate"),_.qZA()),2&xe&&(_.xp6(1),_.Oqu(_.lcZ(2,1,"lang_auto_luu_trong_app_mobile")))}function K(xe,$e){1&xe&&(_.ynx(0),_.TgZ(1,"span"),_._uU(2),_.ALo(3,"mytranslate"),_.qZA(),_.BQk()),2&xe&&(_.xp6(2),_.Oqu(_.lcZ(3,1,"lang_test_review_error_get_url_img")))}function Le(xe,$e){1&xe&&(_.O4$(),_.TgZ(0,"svg",29)(1,"g",30)(2,"g",31),_._UZ(3,"circle",32),_.TgZ(4,"path",33),_._UZ(5,"animateTransform",34),_.qZA()()()())}function pe(xe,$e){if(1&xe&&_._UZ(0,"img",35),2&xe){const V=_.oxw(4);_.Akn(V.isMobileWebView?"width: 100% !important;":"height: auto !important;"),_.Q6J("src",V.fileScanUrl,_.LSH)}}function Xe(xe,$e){if(1&xe){const V=_.EpF();_.TgZ(0,"a",26),_.NdJ("click",function(){_.CHM(V);const ie=_.oxw(3);return _.KtG(ie.onShowFile(ie.fileScanUrl))}),_.YNc(1,Le,6,0,"svg",27),_.YNc(2,pe,1,3,"img",28),_.qZA()}if(2&xe){const V=_.oxw(3);_.xp6(1),_.Q6J("ngIf",V.loadingScanUrl),_.xp6(1),_.Q6J("ngIf",!V.loadingScanUrl)}}function Ve(xe,$e){if(1&xe&&(_.TgZ(0,"div",23),_.YNc(1,K,4,3,"ng-container",24),_.YNc(2,Xe,3,2,"ng-template",null,25,_.W1O),_.qZA()),2&xe){const V=_.MAs(3),$=_.oxw(2);_.xp6(1),_.Q6J("ngIf",!$.loadingScanUrl&&!$.fileScanUrl)("ngIfElse",V)}}function jt(xe,$e){if(1&xe&&(_.TgZ(0,"div",3)(1,"div",4)(2,"div",5)(3,"h3",6)(4,"span"),_._uU(5),_.ALo(6,"mytranslate"),_.qZA()(),_.YNc(7,q,10,3,"div",7),_.qZA()(),_.TgZ(8,"div",8)(9,"div",5)(10,"span",9),_.GkF(11,10),_.qZA(),_.TgZ(12,"span",11),_.ALo(13,"mytranslate"),_.GkF(14,10),_.qZA()(),_.TgZ(15,"div",12),_.YNc(16,w,3,3,"span",13),_.YNc(17,Y,3,3,"span",7),_.qZA(),_.YNc(18,Ve,4,2,"div",14),_.qZA()()),2&xe){const V=_.oxw(),$=_.MAs(2),ie=_.MAs(4);_.xp6(5),_.hij(" ",_.lcZ(6,8,"lang_auto_thi_offline")," "),_.xp6(2),_.Q6J("ngIf",V.isDeletableExamResultObj),_.xp6(4),_.Q6J("ngTemplateOutlet",$),_.xp6(1),_.s9C("matTooltip",_.lcZ(13,10,"lang_auto_so_bao_danh")),_.xp6(2),_.Q6J("ngTemplateOutlet",ie),_.xp6(2),_.Q6J("ngIf",!V.isMobileWebView),_.xp6(1),_.Q6J("ngIf",!V.checkHttpLinkImg),_.xp6(1),_.Q6J("ngIf",V.checkHttpLinkImg)}}const Ft=function(xe){return{"text-success":xe}};function bt(xe,$e){if(1&xe&&(_._uU(0),_.ALo(1,"mytranslate"),_.TgZ(2,"span",36),_._uU(3),_.ALo(4,"formatOfflineExamHashIdToNumber"),_.qZA()),2&xe){const V=_.oxw();let $;_.hij(" ",_.lcZ(1,3,"lang_auto_ma_de_thi"),":\xa0 "),_.xp6(2),_.Q6J("ngClass",_.VKq(8,Ft,!(null!=V.offlineMarkObj&&V.offlineMarkObj.isErrorForOfflineMixQuestionHashId))),_.xp6(1),_.Oqu(_.xi3(4,5,null!==($=null==V.offlineMixQuestionObj?null:V.offlineMixQuestionObj.hashId)&&void 0!==$?$:0,3))}}function Ke(xe,$e){if(1&xe&&(_._uU(0),_.ALo(1,"mytranslate"),_.TgZ(2,"span",36),_._uU(3),_.ALo(4,"formatStudentCodeToNumber"),_.qZA()),2&xe){const V=_.oxw();let $;_.hij(" ",_.lcZ(1,3,"lang_testbank_offline_student_identification"),":\xa0 "),_.xp6(2),_.Q6J("ngClass",_.VKq(8,Ft,!(null!=V.offlineMarkObj&&V.offlineMarkObj.isErrorForStudentCode))),_.xp6(1),_.Oqu(_.xi3(4,5,(null!==($=null==V.offlineMarkObj?null:V.offlineMarkObj.studentCode)&&void 0!==$?$:0)<0?0:null==V.offlineMarkObj?null:V.offlineMarkObj.studentCode,6))}}let Zt=(()=>{class xe extends h.Q{checkAzotaFile(V){return!(!V||!V.includes(".azt"))}checkHttpUrl(V){return!!V&&!!/(?:https?):\/\/(\w+:?\w*)?(\S+)(:\d+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/.test(V)}deleteOfflineExamResultObj(V,$){$&&this.dialog.open(u.V,{data:{examHashId:V,examResultId:$},restoreFocus:!1}).afterClosed().subscribe(Ie=>{Ie&&this.goBackWhenDeleteExamResult()})}goBackWhenDeleteExamResult(){this.myNavigationBySpecialQueryString(this.backToLink?this.backToLink:"/admin/testbank/exam-results-list/"+(this.examObj?this.examObj.categoryId:0)+"/"+this.examIdParam+"/0")}onShowFile(V){this.dialog.open(D.F,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:{name:"",mimes:"image/jpeg",url:V,index:0}},restoreFocus:!1})}checkErrorForStudentAndExamCode(){this.examCodeError=!this.offlineMixQuestionObj&&(this.offlineMarkObj?.rawOfflineMixquestionId??0)>0,this.studentCodeError=(this.offlineMarkObj?.studentId??0)<=0&&(this.offlineMarkObj?.rawStudentCode??0)>0}initData(){if(!this.offlineMarkObj)return;let V=this.zipDataService.decodeContentGzip(this.offlineMarkObj?.images??""),$=this.castJsonToObj(V);this.checkHttpLinkImg=this.checkHttpUrl($?.url),this.loadingScanUrl=!0,this.checkAzotaFile($?.url)?this.drawScanExamService.drawAzotaFileToCanvas(this.offlineMarkObj,this.essayExam).then(ie=>{ie.imgUrl?this.fileScanUrl=ie.imgUrl:this.checkHttpLinkImg=!0,this.loadingScanUrl=!1}).catch(ie=>{this.loadingScanUrl=!1}):this.drawScanExamService.drawScanFileToCanvas(this.offlineMarkObj).then(ie=>{ie?this.fileScanUrl=ie:this.checkHttpLinkImg=!0,this.loadingScanUrl=!1}).catch(ie=>{this.loadingScanUrl=!1})}ngOnChanges(){this.initData(),this.checkErrorForStudentAndExamCode()}ngOnInit(){super.ngOnInit()}constructor(V,$,ie){super(),this.dialog=V,this.zipDataService=$,this.drawScanExamService=ie,this.backToLink="",this.essayExam=!1,this.isDeletableExamResultObj=!1,this.fileScanUrl="",this.loadingScanUrl=!1,this.checkHttpLinkImg=!1,this.studentCodeError=!1,this.examCodeError=!1}}return xe.\u0275fac=function(V){return new(V||xe)(_.Y36(le.uw),_.Y36(d.D),_.Y36(j))},xe.\u0275cmp=_.Xpm({type:xe,selectors:[["app-testbank-show-offline-result"]],inputs:{backToLink:"backToLink",examResultIdParam:"examResultIdParam",userIdParam:"userIdParam",studentIdParam:"studentIdParam",examIdParam:"examIdParam",essayExam:"essayExam",examObj:"examObj",offlineMarkObj:"offlineMarkObj",offlineMixQuestionObj:"offlineMixQuestionObj",isDeletableExamResultObj:"isDeletableExamResultObj"},features:[_.qOj,_.TTD],decls:5,vars:1,consts:[["class","info-exam-offline mt-3 mb-3",4,"ngIf"],["viewExamCodeTpl",""],["viewStudentCodeTpl",""],[1,"info-exam-offline","mt-3","mb-3"],[1,"rounded-md","bg-slate-200","dark:bg-darkmode-400","p-3",2,"border-bottom-left-radius","0","border-bottom-right-radius","0"],[1,"flex","items-center"],[1,"text-md","mr-auto"],[4,"ngIf"],[1,"info-exam-body","rounded-md","border","border-slate-200/60","dark:border-darkmode-400","p-2",2,"border-top-left-radius","0","border-top-right-radius","0"],[1,"mr-auto"],[3,"ngTemplateOutlet"],[1,"mr-4",3,"matTooltip"],[1,"items-center","mt-2"],["class","mr-2",4,"ngIf"],["class","text-center mx-auto mt-1",4,"ngIf"],["azt-track-service","show-offline-result-i96BCircs2",1,"text-danger",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"lucide","w-4","h-4","mr-2"],["d","M3 6h18"],["d","M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"],["d","M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"],["x1","10","y1","11","x2","10","y2","17"],["x1","14","y1","11","x2","14","y2","17"],[1,"mr-2"],[1,"text-center","mx-auto","mt-1"],[4,"ngIf","ngIfElse"],["showImgScan",""],["azt-track-service","show-offline-result-tsC_51kcf2",3,"click"],["width","25","viewBox","-2 -2 42 42","xmlns","http://www.w3.org/2000/svg","stroke","rgb(30, 41, 59)","class","w-5 h-5 mr-3",4,"ngIf"],["alt","img",3,"src","style",4,"ngIf"],["width","25","viewBox","-2 -2 42 42","xmlns","http://www.w3.org/2000/svg","stroke","rgb(30, 41, 59)",1,"w-5","h-5","mr-3"],["fill","none","fill-rule","evenodd"],["transform","translate(1 1)","stroke-width","4"],["stroke-opacity",".5","cx","18","cy","18","r","18"],["d","M36 18c0-9.94-8.06-18-18-18"],["attributeName","transform","type","rotate","from","0 18 18","to","360 18 18","dur","1s","repeatCount","indefinite"],["alt","img",3,"src"],[3,"ngClass"]],template:function(V,$){1&V&&(_.YNc(0,jt,19,12,"div",0),_.YNc(1,bt,5,10,"ng-template",null,1,_.W1O),_.YNc(3,Ke,5,10,"ng-template",null,2,_.W1O)),2&V&&_.Q6J("ngIf",$.offlineMarkObj)},dependencies:[I.mk,I.O5,I.tP,A.gM,O.bT,O.t9,O.q7],encapsulation:2}),xe})()},70513:(Qe,ce,v)=>{v.d(ce,{S:()=>Q});var D=v(49671),h=v(65879),u=v(87384),_=v(8415),le=v(50871),d=v(77051);let Q=(()=>{class B{processEssayResultToBase64(m){var x=this;return(0,D.Z)(function*(){for(const g of m.pages??[]){if(g.draw){const j=yield x.exportPdfUtilsService.convertAndRetryToBase64(g.draw);g.draw=j}if(g.backgroundImage){const j=yield x.exportPdfUtilsService.convertAndRetryToBase64(g.backgroundImage);g.backgroundImage=j}}if(m.commentEmoji&&m.commentEmoji.length){let g="https://azota889.github.io/storage_public/mnote/",j=m.commentEmoji.length;for(let I=0;I<j;I++){let A=g+m.commentEmoji[I];const O=yield x.exportPdfUtilsService.convertAndRetryToBase64(A);m.commentEmoji[I]=O}}return m})()}processGroupImagesToBase64(m,x){var g=this;return(0,D.Z)(function*(){if(m&&m?.[0].name?.startsWith("[PDFv2]"))for(const j of m)if(j.questionContentParse&&j.questionContentParse[0].groupUrl&&x.includes(j.indexLabel??-1)){const I=yield g.exportPdfUtilsService.convertAndRetryToBase64(j.questionContentParse[0].groupUrl);j.questionContentParse[0].groupUrl=I}})()}processQuestionImagesToBase64(m){var x=this;return(0,D.Z)(function*(){if(1==m[0].isImage)for(const g of m){const j=yield x.exportPdfUtilsService.convertAndRetryToBase64(g.questionContentParse?.[0].url??"");g.questionContentParse&&(g.questionContentParse[0].url=j)}})()}processQuestionDocxContentToBase64(m){var x=this;return(0,D.Z)(function*(){if(0==m[0].isImage)for(const j of m){var g=x.exportPdfUtilsService.findImageSrcInContent(j.questionContentParse?.[0].content??"");if(g&&!g.includes(";base64")){const I=yield x.exportPdfUtilsService.convertAndRetryToBase64(g);j.questionContentParse?.[0].content?.includes("img")&&I&&(j.questionContentParse[0].content=j.questionContentParse[0].content.replace(g,I))}}})()}convertAnswersArr(m,x){0!=m.length&&m.forEach(g=>{g.QuestionId&&g.AnswerContent&&g.AnswerContent[0]&&g.AnswerContent[0].Content&&(x[`id_${g.QuestionId}`]=g.AnswerContent[0].Content)})}findScaleDirection(m,x){return m/x>=.7070707070707071?"w":"h"}constructor(m,x,g,j){this.commonService=m,this.cdnService=x,this.customQuestionAnswerConfig=g,this.exportPdfUtilsService=j}}return B.\u0275fac=function(m){return new(m||B)(h.LFG(u.v),h.LFG(_.U),h.LFG(le.U),h.LFG(d.V))},B.\u0275prov=h.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"}),B})()},77051:(Qe,ce,v)=>{v.d(ce,{V:()=>Q});var D=v(49671),h=v(65879),u=v(87384),_=v(8415),le=v(46825),d=function(B){return B[B.Cdn=0]="Cdn",B[B.CdnTimestamp=1]="CdnTimestamp",B[B.Rawlink=2]="Rawlink",B[B.RawlinkTimestamp=3]="RawlinkTimestamp",B}(d||{});let Q=(()=>{class B{get blockCropItemClass(){return"__CANVAS_CROP_ITEM"}get blockEssayCropItemClass(){return"_ESSAY"}isSupportedBrowser(){let m=this.commonService.getBrowserType().toString();return!(!["chrome"].includes(m.split(" ")[0].toLowerCase())||parseInt(m.split(" ")[1],10)<80)}getExtensionFile(m){if(!m)return"";var x=m.split(".");return x.length<=1?"":x[x.length-1].toLocaleLowerCase().split("_")[0]}translateMetaTitle(m){let x="Export PDF: ";this.commonService.translateMetaData({title:x+m.data?.examObj?.name,description:x+m.data?.examObj?.name,image:"lang_cms_test_image"})}findImageSrcInContent(m){var x="";if(m.includes("img")){var g=m.indexOf("img"),j=m.indexOf("src=",g),I=m.indexOf('"',Number(j)+5);x=m.substring(Number(j)+5,Number(I))}return x}asyncTimeout(m){return(0,D.Z)(function*(){return`Waited ${yield new Promise(g=>{setTimeout(()=>g(m),m)})} miliseconds`})()}parseEssayMarkResult(m,x){let g=m.filter(A=>this.answerTypeService.isEssayAnswer(A.answerType));if(0!=g.length&&x&&x.essayResult){var j=this.commonService.willDeleteParseJson(x.essayResult);if(j){var I=Object.entries(j);for(let A=0;A<g.length;A++)g[A].essayMarkParsed=I[A][1]}}}convertToBase64(m,x){var g=this;return(0,D.Z)(function*(){let j=m;switch(x){case d.Cdn:j=g.cdnService.getMyCdn(m);break;case d.CdnTimestamp:j=g.cdnService.getMyCdn(m)+"?t="+Date.now();break;case d.RawlinkTimestamp:j=m+"?t="+Date.now()}const A=yield(yield fetch(j)).blob(),O=yield new Promise(q=>{const w=new FileReader;w.readAsDataURL(A),w.onloadend=()=>{q(w.result)}});return O&&"string"==typeof O?O:m})()}convertAndRetryToBase64(m){var x=this;return(0,D.Z)(function*(){let g=x.getExtensionFile(m);if(["pdf","jpg","jpeg","png","gif"].includes(g)){let j;const I=[d.Cdn,d.CdnTimestamp,d.Rawlink,d.RawlinkTimestamp];try{j=yield x.convertToBase64(m,I[0])}catch{try{j=yield x.convertToBase64(m,I[1])}catch{try{j=yield x.convertToBase64(m,I[2])}catch{try{j=yield x.convertToBase64(m,I[3])}catch{console.log("Kh\xf4ng th\u1ec3 convert url n\xe0y th\xe0nh base64 sau v\xe0i l\u1ea7n retry: "+m),j=m}}}}return j}return m})()}eraseCanvas(m){m&&(m.beginPath(),m.rect(0,0,m.canvas.width,m.canvas.height),m.fillStyle="white",m.fill())}addContentToPdf(m,x){m.addImage(x,"JPEG",0,0,m.internal.pageSize.getWidth(),m.internal.pageSize.getHeight())}drawTextWrap(m,x,g,j,I){let A=m.split(" "),O=[],q=A[0];if(x){x.font=I||`${j}px Arial`;for(let w=1;w<A.length;w++){let Y=A[w];x.measureText(q+" "+Y).width<g?q+=" "+Y:(O.push(q),q=Y)}O.push(q)}return O}essayText2LinesArr(m,x,g,j,I){let A=new RegExp("(<br>|<br/>)+","igm"),q=(this.commonService.replaceAllByRegExp(m,A,"<br>")??"").split("<br>"),w=[];for(let Y=0;Y<q.length;Y++)w.push(this.drawTextWrap(q[Y],x,g,j,I));return w}constructor(m,x,g){this.commonService=m,this.cdnService=x,this.answerTypeService=g}}return B.\u0275fac=function(m){return new(m||B)(h.LFG(u.v),h.LFG(_.U),h.LFG(le.T))},B.\u0275prov=h.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"}),B})()},74134:(Qe,ce,v)=>{v.d(ce,{J:()=>q_});var m,D=v(49671),h=v(33182),u=v(60752),_=v(36122),le=v(84537),d=v(87879),Q=v(59058),B=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},S={},x=x||{},g=B||self;function j(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function I(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var O="closure_uid_"+(1e9*Math.random()>>>0),q=0;function w(n,e,t){return n.call.apply(n.bind,arguments)}function Y(n,e,t){if(!n)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,s),n.apply(e,r)}}return function(){return n.apply(e,arguments)}}function K(n,e,t){return(K=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?w:Y).apply(null,arguments)}function Le(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var s=t.slice();return s.push.apply(s,arguments),n.apply(this,s)}}function pe(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(s,r,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[r].apply(s,o)}}function Xe(){this.s=this.s,this.o=this.o}Xe.prototype.s=!1,Xe.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function A(n){Object.prototype.hasOwnProperty.call(n,O)&&n[O]||(n[O]=++q)}(this)},Xe.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const jt=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Ft(n){const e=n.length;if(0<e){const t=Array(e);for(let s=0;s<e;s++)t[s]=n[s];return t}return[]}function bt(n,e){for(let t=1;t<arguments.length;t++){const s=arguments[t];if(j(s)){const r=n.length||0,i=s.length||0;n.length=r+i;for(let o=0;o<i;o++)n[r+o]=s[o]}else n.push(s)}}function Ke(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Ke.prototype.h=function(){this.defaultPrevented=!0};var Zt=function(){if(!g.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{g.addEventListener("test",()=>{},e),g.removeEventListener("test",()=>{},e)}catch{}return n}();function xe(n){return/^[\s\xa0]*$/.test(n)}function $e(){var n=g.navigator;return n&&(n=n.userAgent)?n:""}function V(n){return-1!=$e().indexOf(n)}function $(n){return $[" "](n),n}$[" "]=function(){};var M,n,Ie=V("Opera"),Pe=V("Trident")||V("MSIE"),ke=V("Edge"),Be=ke||Pe,U=V("Gecko")&&!(-1!=$e().toLowerCase().indexOf("webkit")&&!V("Edge"))&&!(V("Trident")||V("MSIE"))&&!V("Edge"),Ce=-1!=$e().toLowerCase().indexOf("webkit")&&!V("Edge");function H(){var n=g.document;return n?n.documentMode:void 0}e:{var oe="",F=(n=$e(),U?/rv:([^\);]+)(\)|;)/.exec(n):ke?/Edge\/([\d\.]+)/.exec(n):Pe?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):Ce?/WebKit\/(\S+)/.exec(n):Ie?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(F&&(oe=F?F[1]:""),Pe){var ne=H();if(null!=ne&&ne>parseFloat(oe)){M=String(ne);break e}}M=oe}var G=g.document&&Pe&&(H()||parseInt(M,10))||void 0;function ue(n,e){if(Ke.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,s=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(U){e:{try{$(e.nodeName);var r=!0;break e}catch{}r=!1}r||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:te[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&ue.$.h.call(this)}}pe(ue,Ke);var te={2:"touch",3:"pen",4:"mouse"};ue.prototype.h=function(){ue.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var be="closure_listenable_"+(1e6*Math.random()|0),Ae=0;function Ue(n,e,t,s,r){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!s,this.la=r,this.key=++Ae,this.fa=this.ia=!1}function J(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Oe(n,e,t){for(const s in n)e.call(t,n[s],s,n)}function E(n){const e={};for(const t in n)e[t]=n[t];return e}const T="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(n,e){let t,s;for(let r=1;r<arguments.length;r++){for(t in s=arguments[r],s)n[t]=s[t];for(let i=0;i<T.length;i++)t=T[i],Object.prototype.hasOwnProperty.call(s,t)&&(n[t]=s[t])}}function Z(n){this.src=n,this.g={},this.h=0}function R(n,e){var t=e.type;if(t in n.g){var i,s=n.g[t],r=jt(s,e);(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(J(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function W(n,e,t,s){for(var r=0;r<n.length;++r){var i=n[r];if(!i.fa&&i.listener==e&&i.capture==!!t&&i.la==s)return r}return-1}Z.prototype.add=function(n,e,t,s,r){var i=n.toString();(n=this.g[i])||(n=this.g[i]=[],this.h++);var o=W(n,e,s,r);return-1<o?(e=n[o],t||(e.ia=!1)):((e=new Ue(e,this.src,i,!!s,r)).ia=t,n.push(e)),e};var he="closure_lm_"+(1e6*Math.random()|0),se={};function ee(n,e,t,s,r){if(s&&s.once)return de(n,e,t,s,r);if(Array.isArray(e)){for(var i=0;i<e.length;i++)ee(n,e[i],t,s,r);return null}return t=$t(t),n&&n[be]?n.O(e,t,I(s)?!!s.capture:!!s,r):De(n,e,t,!1,s,r)}function De(n,e,t,s,r,i){if(!e)throw Error("Invalid event type");var o=I(r)?!!r.capture:!!r,a=Ye(n);if(a||(n[he]=a=new Z(n)),(t=a.add(e,t,s,o,i)).proxy)return t;if(s=function _e(){const e=lt;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=s,s.src=n,s.listener=t,n.addEventListener)Zt||(r=o),void 0===r&&(r=!1),n.addEventListener(e.toString(),s,r);else if(n.attachEvent)n.attachEvent(at(e.toString()),s);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(s)}return t}function de(n,e,t,s,r){if(Array.isArray(e)){for(var i=0;i<e.length;i++)de(n,e[i],t,s,r);return null}return t=$t(t),n&&n[be]?n.P(e,t,I(s)?!!s.capture:!!s,r):De(n,e,t,!0,s,r)}function Ee(n,e,t,s,r){if(Array.isArray(e))for(var i=0;i<e.length;i++)Ee(n,e[i],t,s,r);else s=I(s)?!!s.capture:!!s,t=$t(t),n&&n[be]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=W(i=n.g[e],t,s,r))&&(J(i[t]),Array.prototype.splice.call(i,t,1),0==i.length&&(delete n.g[e],n.h--))):n&&(n=Ye(n))&&(e=n.g[e.toString()],n=-1,e&&(n=W(e,t,s,r)),(t=-1<n?e[n]:null)&&we(t))}function we(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[be])R(e.i,n);else{var t=n.type,s=n.proxy;e.removeEventListener?e.removeEventListener(t,s,n.capture):e.detachEvent?e.detachEvent(at(t),s):e.addListener&&e.removeListener&&e.removeListener(s),(t=Ye(e))?(R(t,n),0==t.h&&(t.src=null,e[he]=null)):J(n)}}}function at(n){return n in se?se[n]:se[n]="on"+n}function lt(n,e){if(n.fa)n=!0;else{e=new ue(e,this);var t=n.listener,s=n.la||n.src;n.ia&&we(n),n=t.call(s,e)}return n}function Ye(n){return(n=n[he])instanceof Z?n:null}var ft="__closure_events_fn_"+(1e9*Math.random()>>>0);function $t(n){return"function"==typeof n?n:(n[ft]||(n[ft]=function(e){return n.handleEvent(e)}),n[ft])}function ut(){Xe.call(this),this.i=new Z(this),this.S=this,this.J=null}function mt(n,e){var t,s=n.J;if(s)for(t=[];s;s=s.J)t.push(s);if(n=n.S,s=e.type||e,"string"==typeof e)e=new Ke(e,n);else if(e instanceof Ke)e.target=e.target||n;else{var r=e;b(e=new Ke(s,n),r)}if(r=!0,t)for(var i=t.length-1;0<=i;i--){var o=e.g=t[i];r=et(o,s,!0,e)&&r}if(r=et(o=e.g=n,s,!0,e)&&r,r=et(o,s,!1,e)&&r,t)for(i=0;i<t.length;i++)r=et(o=e.g=t[i],s,!1,e)&&r}function et(n,e,t,s){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var r=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.fa&&o.capture==t){var a=o.listener,l=o.la||o.src;o.ia&&R(n.i,o),r=!1!==a.call(l,s)&&r}}return r&&!s.defaultPrevented}pe(ut,Xe),ut.prototype[be]=!0,ut.prototype.removeEventListener=function(n,e,t,s){Ee(this,n,e,t,s)},ut.prototype.N=function(){if(ut.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],s=0;s<t.length;s++)J(t[s]);delete n.g[e],n.h--}}this.J=null},ut.prototype.O=function(n,e,t,s){return this.i.add(String(n),e,!1,t,s)},ut.prototype.P=function(n,e,t,s){return this.i.add(String(n),e,!0,t,s)};var qs=g.JSON.stringify;function yo(){var n=vo;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var $r=new class _o{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Zs,n=>n.reset());class Zs{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function rs(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function Gs(n){g.setTimeout(()=>{throw n},0)}let Wt,ln=!1,vo=new class ss{constructor(){this.h=this.g=null}add(e,t){const s=$r.get();s.set(e,t),this.h?this.h.next=s:this.g=s,this.h=s}},tc=()=>{const n=g.Promise.resolve(void 0);Wt=()=>{n.then(If)}};var If=()=>{for(var n;n=yo();){try{n.h.call(n.g)}catch(t){Gs(t)}var e=$r;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}ln=!1};function Wr(n,e){ut.call(this),this.h=n||1,this.g=e||g,this.j=K(this.qb,this),this.l=Date.now()}function wo(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function xo(n,e,t){if("function"==typeof n)t&&(n=K(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=K(n.handleEvent,n)}return 2147483647<Number(e)?-1:g.setTimeout(n,e||0)}function nc(n){n.g=xo(()=>{n.g=null,n.i&&(n.i=!1,nc(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}pe(Wr,ut),(m=Wr.prototype).ga=!1,m.T=null,m.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),mt(this,"tick"),this.ga&&(wo(this),this.start()))}},m.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},m.N=function(){Wr.$.N.call(this),wo(this),delete this.g};class Ef extends Xe{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:nc(this)}N(){super.N(),this.g&&(g.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Qs(n){Xe.call(this),this.h=n,this.g={}}pe(Qs,Xe);var sc=[];function rc(n,e,t,s){Array.isArray(t)||(t&&(sc[0]=t.toString()),t=sc);for(var r=0;r<t.length;r++){var i=ee(e,t[r],s||n.handleEvent,!1,n.h||n);if(!i)break;n.g[i.key]=i}}function ic(n){Oe(n.g,function(e,t){this.g.hasOwnProperty(t)&&we(e)},n),n.g={}}function Jr(){this.g=!0}function is(n,e,t,s){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function Af(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var s=t[n];if(!(2>s.length)){var r=s[1];if(Array.isArray(r)&&!(1>r.length)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<r.length;o++)r[o]=""}}}return qs(t)}catch{return e}}(n,t)+(s?" "+s:"")})}Qs.prototype.N=function(){Qs.$.N.call(this),ic(this)},Qs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Jr.prototype.Ea=function(){this.g=!1},Jr.prototype.info=function(){};var Rn={},oc=null;function Yr(){return oc=oc||new ut}function ac(n){Ke.call(this,Rn.Ta,n)}function Ks(n){const e=Yr();mt(e,new ac(e))}function lc(n,e){Ke.call(this,Rn.STAT_EVENT,n),this.stat=e}function Bt(n){const e=Yr();mt(e,new lc(e,n))}function cc(n,e){Ke.call(this,Rn.Ua,n),this.size=e}function $s(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return g.setTimeout(function(){n()},e)}Rn.Ta="serverreachability",pe(ac,Ke),Rn.STAT_EVENT="statevent",pe(lc,Ke),Rn.Ua="timingevent",pe(cc,Ke);var Hr={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},uc={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function To(){}function dc(){}To.prototype.h=null;var So,Ws={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Io(){Ke.call(this,"d")}function Eo(){Ke.call(this,"c")}function Xr(){}function Js(n,e,t,s){this.l=n,this.j=e,this.m=t,this.W=s||1,this.U=new Qs(this),this.P=Df,this.V=new Wr(n=Be?125:void 0),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new fc}function fc(){this.i=null,this.g="",this.h=!1}pe(Io,Ke),pe(Eo,Ke),pe(Xr,To),Xr.prototype.g=function(){return new XMLHttpRequest},Xr.prototype.i=function(){return{}},So=new Xr;var Df=45e3,bo={},ei={};function Co(n,e,t){n.L=1,n.v=ri(cn(e)),n.s=t,n.S=!0,mc(n,null)}function mc(n,e){n.G=Date.now(),Ys(n),n.A=cn(n.v);var t=n.A,s=n.W;Array.isArray(s)||(s=[String(s)]),Ec(t.i,"t",s),n.C=0,t=n.l.J,n.h=new fc,n.g=$c(n.l,t?e:null,!n.s),0<n.O&&(n.M=new Ef(K(n.Pa,n,n.g),n.O)),rc(n.U,n.g,"readystatechange",n.nb),e=n.I?E(n.I):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.A,n.u,n.s,e)):(n.u="GET",n.g.ha(n.A,n.u,null,e)),Ks(),function Sf(n,e,t,s,r,i){n.info(function(){if(n.g)if(i)for(var o="",a=i.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var f=c[0];c=c[1];var p=f.split("_");o=2<=p.length&&"type"==p[1]?o+(f+"=")+c+"&":o+(f+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+s+") [attempt "+r+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.W,n.s)}function gc(n){return!!n.g&&"GET"==n.u&&2!=n.L&&n.l.Ha}function pc(n,e,t){let r,s=!0;for(;!n.J&&n.C<t.length;){if(r=kf(n,t),r==ei){4==e&&(n.o=4,Bt(14),s=!1),is(n.j,n.m,null,"[Incomplete Response]");break}if(r==bo){n.o=4,Bt(15),is(n.j,n.m,t,"[Invalid Chunk]"),s=!1;break}is(n.j,n.m,r,null),Ao(n,r)}gc(n)&&r!=ei&&r!=bo&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,Bt(16),s=!1),n.i=n.i&&s,s?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),No(e),e.M=!0,Bt(11))):(is(n.j,n.m,t,"[Invalid Chunked Response]"),Nn(n),Hs(n))}function kf(n,e){var t=n.C,s=e.indexOf("\n",t);return-1==s?ei:(t=Number(e.substring(t,s)),isNaN(t)?bo:(s+=1)+t>e.length?ei:(e=e.slice(s,s+t),n.C=s+t,e))}function Ys(n){n.Y=Date.now()+n.P,_c(n,n.P)}function _c(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=$s(K(n.lb,n),e)}function ti(n){n.B&&(g.clearTimeout(n.B),n.B=null)}function Hs(n){0==n.l.H||n.J||Zc(n.l,n)}function Nn(n){ti(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,wo(n.V),ic(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Ao(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||Do(t.i,n)))if(!n.K&&Do(t.i,n)&&3==t.H){try{var s=t.Ja.g.parse(e)}catch{s=null}if(Array.isArray(s)&&3==s.length){var r=s;if(0==r[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;ui(t),li(t)}Ro(t),Bt(18)}}else t.Fa=r[1],0<t.Fa-t.V&&37500>r[2]&&t.G&&0==t.A&&!t.v&&(t.v=$s(K(t.ib,t),6e3));if(1>=Cc(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Fn(t,11)}else if((n.K||t.g==n)&&ui(t),!xe(e))for(r=t.Ja.g.parse(e),e=0;e<r.length;e++){let c=r[e];if(t.V=c[0],c=c[1],2==t.H)if("c"==c[0]){t.K=c[1],t.pa=c[2];const f=c[3];null!=f&&(t.ra=f,t.l.info("VER="+t.ra));const p=c[4];null!=p&&(t.Ga=p,t.l.info("SVER="+t.Ga));const C=c[5];null!=C&&"number"==typeof C&&0<C&&(t.L=s=1.5*C,t.l.info("backChannelRequestTimeoutMs_="+s)),s=t;const z=n.g;if(z){const ae=z.g?z.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ae){var i=s.i;i.g||-1==ae.indexOf("spdy")&&-1==ae.indexOf("quic")&&-1==ae.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(ko(i,i.h),i.h=null))}if(s.F){const ge=z.g?z.g.getResponseHeader("X-HTTP-Session-Id"):null;ge&&(s.Da=ge,tt(s.I,s.F,ge))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var o=n;if((s=t).wa=Kc(s,s.J?s.pa:null,s.Y),o.K){Ac(s.i,o);var a=o,l=s.L;l&&a.setTimeout(l),a.B&&(ti(a),Ys(a)),s.g=o}else Vc(s);0<t.j.length&&ci(t)}else"stop"!=c[0]&&"close"!=c[0]||Fn(t,7);else 3==t.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?Fn(t,7):Po(t):"noop"!=c[0]&&t.h&&t.h.Aa(c),t.A=0)}Ks()}catch{}}function yc(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(j(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function Mf(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(j(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const s in n)e[t++]=s;return e}}}(n),s=function Of(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(j(n)){for(var e=[],t=n.length,s=0;s<t;s++)e.push(n[s]);return e}for(s in e=[],t=0,n)e[t++]=n[s];return e}(n),r=s.length,i=0;i<r;i++)e.call(void 0,s[i],t&&t[i],n)}(m=Js.prototype).setTimeout=function(n){this.P=n},m.nb=function(n){n=n.target;const e=this.M;e&&3==en(n)?e.l():this.Pa(n)},m.Pa=function(n){try{if(n==this.g)e:{const f=en(this.g);var e=this.g.Ia();if(this.g.da(),!(3>f)&&(3!=f||Be||this.g&&(this.h.h||this.g.ja()||Lc(this.g)))){this.J||4!=f||7==e||Ks(),ti(this);var t=this.g.da();this.ca=t;t:if(gc(this)){var s=Lc(this.g);n="";var r=s.length,i=4==en(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){Nn(this),Hs(this);var o="";break t}this.h.i=new g.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,n+=this.h.i.decode(s[e],{stream:i&&e==r-1});s.splice(0,r),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==t,function bf(n,e,t,s,r,i,o){n.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+r+"]: "+e+"\n"+t+"\n"+i+" "+o})}(this.j,this.u,this.A,this.m,this.W,f,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!xe(a)){var c=a;break t}}c=null}if(!(t=c)){this.i=!1,this.o=3,Bt(12),Nn(this),Hs(this);break e}is(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ao(this,t)}this.S?(pc(this,f,o),Be&&this.i&&3==f&&(rc(this.U,this.V,"tick",this.mb),this.V.start())):(is(this.j,this.m,o,null),Ao(this,o)),4==f&&Nn(this),this.i&&!this.J&&(4==f?Zc(this.l,this):(this.i=!1,Ys(this)))}else(function Jf(n){const e={};n=(n.g&&2<=en(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let s=0;s<n.length;s++){if(xe(n[s]))continue;var t=rs(n[s]);const r=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const i=e[r]||[];e[r]=i,i.push(t)}!function y(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(s){return s.join(", ")})})(this.g),400==t&&0<o.indexOf("Unknown SID")?(this.o=3,Bt(12)):(this.o=0,Bt(13)),Nn(this),Hs(this)}}}catch{}},m.mb=function(){if(this.g){var n=en(this.g),e=this.g.ja();this.C<e.length&&(ti(this),pc(this,n,e),this.i&&4!=n&&Ys(this))}},m.cancel=function(){this.J=!0,Nn(this)},m.lb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function Cf(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.L&&(Ks(),Bt(17)),Nn(this),this.o=2,Hs(this)):_c(this,this.Y-n)};var vc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ln(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Ln){this.h=n.h,ni(this,n.j),this.s=n.s,this.g=n.g,si(this,n.m),this.l=n.l;var e=n.i,t=new tr;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),wc(this,t),this.o=n.o}else n&&(e=String(n).match(vc))?(this.h=!1,ni(this,e[1]||"",!0),this.s=Xs(e[2]||""),this.g=Xs(e[3]||"",!0),si(this,e[4]),this.l=Xs(e[5]||"",!0),wc(this,e[6]||"",!0),this.o=Xs(e[7]||"")):(this.h=!1,this.i=new tr(null,this.h))}function cn(n){return new Ln(n)}function ni(n,e,t){n.j=t?Xs(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function si(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function wc(n,e,t){e instanceof tr?(n.i=e,function Uf(n,e){e&&!n.j&&(_n(n),n.i=null,n.g.forEach(function(t,s){var r=s.toLowerCase();s!=r&&(Tc(this,s),Ec(this,r,t))},n)),n.j=e}(n.i,n.h)):(t||(e=er(e,Ff)),n.i=new tr(e,n.h))}function tt(n,e,t){n.i.set(e,t)}function ri(n){return tt(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Xs(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function er(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Rf),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Rf(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Ln.prototype.toString=function(){var n=[],e=this.j;e&&n.push(er(e,xc,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(er(e,xc,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(er(t,"/"==t.charAt(0)?Lf:Nf,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",er(t,Bf)),n.join("")};var xc=/[#\/\?@]/g,Nf=/[#\?:]/g,Lf=/[#\?]/g,Ff=/[#\?@]/g,Bf=/#/g;function tr(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function _n(n){n.g||(n.g=new Map,n.h=0,n.i&&function Pf(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var s=n[t].indexOf("="),r=null;if(0<=s){var i=n[t].substring(0,s);r=n[t].substring(s+1)}else i=n[t];e(i,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Tc(n,e){_n(n),e=os(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Ic(n,e){return _n(n),e=os(n,e),n.g.has(e)}function Ec(n,e,t){Tc(n,e),0<t.length&&(n.i=null,n.g.set(os(n,e),Ft(t)),n.h+=t.length)}function os(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Sc(n){this.l=n||zf,n=g.PerformanceNavigationTiming?0<(n=g.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(g.g&&g.g.Ka&&g.g.Ka()&&g.g.Ka().ec),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(m=tr.prototype).add=function(n,e){_n(this),this.i=null,n=os(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},m.forEach=function(n,e){_n(this),this.g.forEach(function(t,s){t.forEach(function(r){n.call(e,r,s,this)},this)},this)},m.ta=function(){_n(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let s=0;s<e.length;s++){const r=n[s];for(let i=0;i<r.length;i++)t.push(e[s])}return t},m.Z=function(n){_n(this);let e=[];if("string"==typeof n)Ic(this,n)&&(e=e.concat(this.g.get(os(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},m.set=function(n,e){return _n(this),this.i=null,Ic(this,n=os(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},m.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},m.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var s=e[t];const i=encodeURIComponent(String(s)),o=this.Z(s);for(s=0;s<o.length;s++){var r=i;""!==o[s]&&(r+="="+encodeURIComponent(String(o[s]))),n.push(r)}}return this.i=n.join("&")};var zf=10;function bc(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Cc(n){return n.h?1:n.g?n.g.size:0}function Do(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function ko(n,e){n.g?n.g.add(e):n.h=e}function Ac(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Dc(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return Ft(n.i)}Sc.prototype.cancel=function(){if(this.i=Dc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var Vf=class{stringify(n){return g.JSON.stringify(n,void 0)}parse(n){return g.JSON.parse(n,void 0)}};function qf(){this.g=new Vf}function Zf(n,e,t){const s=t||"";try{yc(n,function(r,i){let o=r;I(r)&&(o=qs(r)),e.push(s+i+"="+encodeURIComponent(o))})}catch(r){throw e.push(s+"type="+encodeURIComponent("_badmap")),r}}function ii(n,e,t,s,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(s)}catch{}}function nr(n){this.l=n.fc||null,this.j=n.ob||!1}function oi(n,e){ut.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Oo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}pe(nr,To),nr.prototype.g=function(){return new oi(this.l,this.j)},nr.prototype.i=function(n){return function(){return n}}({}),pe(oi,ut);var Oo=0;function kc(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function sr(n){n.readyState=4,n.l=null,n.j=null,n.A=null,rr(n)}function rr(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(m=oi.prototype).open=function(n,e){if(this.readyState!=Oo)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,rr(this)},m.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||g).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},m.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,sr(this)),this.readyState=Oo},m.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,rr(this)),this.g&&(this.readyState=3,rr(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof g.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;kc(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},m.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?sr(this):rr(this),3==this.readyState&&kc(this)}},m.Za=function(n){this.g&&(this.response=this.responseText=n,sr(this))},m.Ya=function(n){this.g&&(this.response=n,sr(this))},m.ka=function(){this.g&&sr(this)},m.setRequestHeader=function(n,e){this.v.append(n,e)},m.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},m.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(oi.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var Qf=g.JSON.parse;function ht(n){ut.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Oc,this.L=this.M=!1}pe(ht,ut);var Oc="",Kf=/^https?$/i,$f=["POST","PUT"];function Mc(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Pc(n),ai(n)}function Pc(n){n.F||(n.F=!0,mt(n,"complete"),mt(n,"error"))}function Rc(n){if(n.h&&typeof x<"u"&&(!n.C[1]||4!=en(n)||2!=n.da()))if(n.v&&4==en(n))xo(n.La,0,n);else if(mt(n,"readystatechange"),4==en(n)){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var s;if(s=0===o){var r=String(n.I).match(vc)[1]||null;!r&&g.self&&g.self.location&&(r=g.self.location.protocol.slice(0,-1)),s=!Kf.test(r?r.toLowerCase():"")}t=s}if(t)mt(n,"complete"),mt(n,"success");else{n.m=6;try{var i=2<en(n)?n.g.statusText:""}catch{i=""}n.j=i+" ["+n.da()+"]",Pc(n)}}finally{ai(n)}}}function ai(n,e){if(n.g){Nc(n);const t=n.g,s=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||mt(n,"ready");try{t.onreadystatechange=s}catch{}}}function Nc(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(g.clearTimeout(n.A),n.A=null)}function en(n){return n.g?n.g.readyState:0}function Lc(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Oc:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Fc(n){let e="";return Oe(n,function(t,s){e+=s,e+=":",e+=t,e+="\r\n"}),e}function Mo(n,e,t){e:{for(s in t){var s=!1;break e}s=!0}s||(t=Fc(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):tt(n,e,t))}function ir(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Bc(n){this.Ga=0,this.j=[],this.l=new Jr,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=ir("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=ir("baseRetryDelayMs",5e3,n),this.hb=ir("retryDelaySeedMs",1e4,n),this.eb=ir("forwardChannelMaxRetries",2,n),this.xa=ir("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.dc||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Sc(n&&n.concurrentRequestLimit),this.Ja=new qf,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Po(n){if(Uc(n),3==n.H){var e=n.W++,t=cn(n.I);if(tt(t,"SID",n.K),tt(t,"RID",e),tt(t,"TYPE","terminate"),or(n,t),(e=new Js(n,n.l,e)).L=2,e.v=ri(cn(t)),t=!1,g.navigator&&g.navigator.sendBeacon)try{t=g.navigator.sendBeacon(e.v.toString(),"")}catch{}!t&&g.Image&&((new Image).src=e.v,t=!0),t||(e.g=$c(e.l,null),e.g.ha(e.v)),e.G=Date.now(),Ys(e)}Qc(n)}function li(n){n.g&&(No(n),n.g.cancel(),n.g=null)}function Uc(n){li(n),n.u&&(g.clearTimeout(n.u),n.u=null),ui(n),n.i.cancel(),n.m&&("number"==typeof n.m&&g.clearTimeout(n.m),n.m=null)}function ci(n){if(!bc(n.i)&&!n.m){n.m=!0;var e=n.Na;Wt||tc(),ln||(Wt(),ln=!0),vo.add(e,n),n.C=0}}function jc(n,e){var t;t=e?e.m:n.W++;const s=cn(n.I);tt(s,"SID",n.K),tt(s,"RID",t),tt(s,"AID",n.V),or(n,s),n.o&&n.s&&Mo(s,n.o,n.s),t=new Js(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=zc(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),ko(n.i,t),Co(t,s,e)}function or(n,e){n.na&&Oe(n.na,function(t,s){tt(e,s,t)}),n.h&&yc({},function(t,s){tt(e,s,t)})}function zc(n,e,t){t=Math.min(n.j.length,t);var s=n.h?K(n.h.Va,n.h,n):null;e:{var r=n.j;let i=-1;for(;;){const o=["count="+t];-1==i?0<t?(i=r[0].g,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let l=0;l<t;l++){let c=r[l].g;const f=r[l].map;if(c-=i,0>c)i=Math.max(0,r[l].g-100),a=!1;else try{Zf(f,o,"req"+c+"_")}catch{s&&s(f)}}if(a){s=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,s}function Vc(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;Wt||tc(),ln||(Wt(),ln=!0),vo.add(e,n),n.A=0}}function Ro(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=$s(K(n.Ma,n),Gc(n,n.A)),n.A++,0))}function No(n){null!=n.B&&(g.clearTimeout(n.B),n.B=null)}function qc(n){n.g=new Js(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=cn(n.wa);tt(e,"RID","rpc"),tt(e,"SID",n.K),tt(e,"AID",n.V),tt(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&tt(e,"TO",n.qa),tt(e,"TYPE","xmlhttp"),or(n,e),n.o&&n.s&&Mo(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.v=ri(cn(e)),t.s=null,t.S=!0,mc(t,n)}function ui(n){null!=n.v&&(g.clearTimeout(n.v),n.v=null)}function Zc(n,e){var t=null;if(n.g==e){ui(n),No(n),n.g=null;var s=2}else{if(!Do(n.i,e))return;t=e.F,Ac(n.i,e),s=1}if(0!=n.H)if(e.i)if(1==s){t=e.s?e.s.length:0,e=Date.now()-e.G;var r=n.C;mt(s=Yr(),new cc(s,t)),ci(n)}else Vc(n);else if(3==(r=e.o)||0==r&&0<e.ca||!(1==s&&function Yf(n,e){return!(Cc(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=$s(K(n.Na,n,e),Gc(n,n.C)),n.C++,0)))}(n,e)||2==s&&Ro(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),r){case 1:Fn(n,5);break;case 4:Fn(n,10);break;case 3:Fn(n,6);break;default:Fn(n,2)}}function Gc(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Fn(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var s=K(n.pb,n);t||(t=new Ln("//www.google.com/images/cleardot.gif"),g.location&&"http"==g.location.protocol||ni(t,"https"),ri(t)),function Gf(n,e){const t=new Jr;if(g.Image){const s=new Image;s.onload=Le(ii,t,s,"TestLoadImage: loaded",!0,e),s.onerror=Le(ii,t,s,"TestLoadImage: error",!1,e),s.onabort=Le(ii,t,s,"TestLoadImage: abort",!1,e),s.ontimeout=Le(ii,t,s,"TestLoadImage: timeout",!1,e),g.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=n}else e(!1)}(t.toString(),s)}else Bt(2);n.H=0,n.h&&n.h.za(e),Qc(n),Uc(n)}function Qc(n){if(n.H=0,n.ma=[],n.h){const e=Dc(n.i);(0!=e.length||0!=n.j.length)&&(bt(n.ma,e),bt(n.ma,n.j),n.i.i.length=0,Ft(n.j),n.j.length=0),n.h.ya()}}function Kc(n,e,t){var s=t instanceof Ln?cn(t):new Ln(t);if(""!=s.g)e&&(s.g=e+"."+s.g),si(s,s.m);else{var r=g.location;s=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var i=new Ln(null);s&&ni(i,s),e&&(i.g=e),r&&si(i,r),t&&(i.l=t),s=i}return e=n.Da,(t=n.F)&&e&&tt(s,t,e),tt(s,"VER",n.ra),or(n,s),s}function $c(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new ht(t&&n.Ha&&!n.va?new nr({ob:!0}):n.va)).Oa(n.J),e}function Wc(){}function hi(){if(Pe&&!(10<=Number(G)))throw Error("Environmental error: no available transport.")}function Gt(n,e){ut.call(this),this.g=new Bc(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!xe(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!xe(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new as(this)}function Jc(n){Io.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Yc(){Eo.call(this),this.status=1}function as(n){this.g=n}function Yt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Lo(n,e,t){t||(t=0);var s=Array(16);if("string"==typeof e)for(var r=0;16>r;++r)s[r]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(r=0;16>r;++r)s[r]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var i=n.g[3],o=(e=n.g[0])+(i^(t=n.g[1])&((r=n.g[2])^i))+s[0]+3614090360&4294967295;o=(t=(r=(i=(e=(t=(r=(i=(e=(t=(r=(i=(e=(t=(r=(i=(e=(t=(r=(i=(e=(t=(r=(i=(e=(t=(r=(i=(e=(t=(r=(i=(e=(t=(r=(i=(e=(t=(r=(i=(e=(t=(r=(i=(e=(t=(r=(i=(e=(t=(r=(i=(e=(t=(r=(i=(e=(t=(r=(i=(e=t+(o<<7&4294967295|o>>>25))+((o=i+(r^e&(t^r))+s[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=r+(t^i&(e^t))+s[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^r&(i^e))+s[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^t&(r^i))+s[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(r^e&(t^r))+s[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=r+(t^i&(e^t))+s[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^r&(i^e))+s[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^t&(r^i))+s[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(r^e&(t^r))+s[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=r+(t^i&(e^t))+s[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^r&(i^e))+s[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^t&(r^i))+s[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(r^e&(t^r))+s[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=r+(t^i&(e^t))+s[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^r&(i^e))+s[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^i&(t^r))+s[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(t^r&(e^t))+s[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^t&(i^e))+s[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=t+(i^e&(r^i))+s[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^i&(t^r))+s[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(t^r&(e^t))+s[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^t&(i^e))+s[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=t+(i^e&(r^i))+s[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^i&(t^r))+s[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(t^r&(e^t))+s[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^t&(i^e))+s[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=t+(i^e&(r^i))+s[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^i&(t^r))+s[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(t^r&(e^t))+s[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^t&(i^e))+s[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=t+(i^e&(r^i))+s[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(t^r^i)+s[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^t^r)+s[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=r+(i^e^t)+s[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=t+(r^i^e)+s[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^r^i)+s[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^t^r)+s[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=r+(i^e^t)+s[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=t+(r^i^e)+s[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^r^i)+s[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^t^r)+s[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=r+(i^e^t)+s[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=t+(r^i^e)+s[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^r^i)+s[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^t^r)+s[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=r+(i^e^t)+s[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=t+(r^i^e)+s[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(r^(t|~i))+s[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(t^(e|~r))+s[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(i|~t))+s[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=t+(i^(r|~e))+s[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(t|~i))+s[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(t^(e|~r))+s[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(i|~t))+s[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=t+(i^(r|~e))+s[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(t|~i))+s[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(t^(e|~r))+s[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(i|~t))+s[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=t+(i^(r|~e))+s[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(e=t+((o=e+(r^(t|~i))+s[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(t^(e|~r))+s[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((r=i+((o=r+(e^(i|~t))+s[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+s[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+r&4294967295,n.g[3]=n.g[3]+i&4294967295}function We(n,e){this.h=e;for(var t=[],s=!0,r=n.length-1;0<=r;r--){var i=0|n[r];s&&i==e||(t[r]=i,s=!1)}this.g=t}(m=ht.prototype).Oa=function(n){this.M=n},m.ha=function(n,e,t,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():So.g(),this.C=function hc(n){return n.h||(n.h=n.i())}(this.u?this.u:So),this.g.onreadystatechange=K(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(i){return void Mc(this,i)}if(n=t||"",t=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var r in s)t.set(r,s[r]);else{if("function"!=typeof s.keys||"function"!=typeof s.get)throw Error("Unknown input type for opt_headers: "+String(s));for(const i of s.keys())t.set(i,s.get(i))}s=Array.from(t.keys()).find(i=>"content-type"==i.toLowerCase()),r=g.FormData&&n instanceof g.FormData,!(0<=jt($f,e))||s||r||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,o]of t)this.g.setRequestHeader(i,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Nc(this),0<this.B&&((this.L=function Wf(n){return Pe&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=K(this.ua,this)):this.A=xo(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(i){Mc(this,i)}},m.ua=function(){typeof x<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,mt(this,"timeout"),this.abort(8))},m.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,mt(this,"complete"),mt(this,"abort"),ai(this))},m.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ai(this,!0)),ht.$.N.call(this)},m.La=function(){this.s||(this.G||this.v||this.l?Rc(this):this.kb())},m.kb=function(){Rc(this)},m.isActive=function(){return!!this.g},m.da=function(){try{return 2<en(this)?this.g.status:-1}catch{return-1}},m.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},m.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),Qf(e)}},m.Ia=function(){return this.m},m.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(m=Bc.prototype).ra=8,m.H=1,m.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const r=new Js(this,this.l,n);let i=this.s;if(this.U&&(i?(i=E(i),b(i,this.U)):i=this.U),null!==this.o||this.O||(r.I=i,i=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var s=this.j[t];if(void 0===(s="__data__"in s.map&&"string"==typeof(s=s.map.__data__)?s.length:void 0))break;if(4096<(e+=s)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=zc(this,r,e),tt(t=cn(this.I),"RID",n),tt(t,"CVER",22),this.F&&tt(t,"X-HTTP-Session-Id",this.F),or(this,t),i&&(this.O?e="headers="+encodeURIComponent(String(Fc(i)))+"&"+e:this.o&&Mo(t,this.o,i)),ko(this.i,r),this.bb&&tt(t,"TYPE","init"),this.P?(tt(t,"$req",e),tt(t,"SID","null"),r.aa=!0,Co(r,t,null)):Co(r,t,e),this.H=2}}else 3==this.H&&(n?jc(this,n):0==this.j.length||bc(this.i)||jc(this))},m.Ma=function(){if(this.u=null,qc(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=$s(K(this.jb,this),n)}},m.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Bt(10),li(this),qc(this))},m.ib=function(){null!=this.v&&(this.v=null,li(this),Ro(this),Bt(19))},m.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Bt(2)):(this.l.info("Failed to ping google.com"),Bt(1))},m.isActive=function(){return!!this.h&&this.h.isActive(this)},(m=Wc.prototype).Ba=function(){},m.Aa=function(){},m.za=function(){},m.ya=function(){},m.isActive=function(){return!0},m.Va=function(){},hi.prototype.g=function(n,e){return new Gt(n,e)},pe(Gt,ut),Gt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Bt(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=Kc(n,null,n.Y),ci(n)},Gt.prototype.close=function(){Po(this.g)},Gt.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=qs(n),n=t);e.j.push(new class{constructor(n,e){this.g=n,this.map=e}}(e.fb++,n)),3==e.H&&ci(e)},Gt.prototype.N=function(){this.g.h=null,delete this.j,Po(this.g),delete this.g,Gt.$.N.call(this)},pe(Jc,Io),pe(Yc,Eo),pe(as,Wc),as.prototype.Ba=function(){mt(this.g,"a")},as.prototype.Aa=function(n){mt(this.g,new Jc(n))},as.prototype.za=function(n){mt(this.g,new Yc)},as.prototype.ya=function(){mt(this.g,"b")},pe(Yt,function Hf(){this.blockSize=-1}),Yt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Yt.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,s=this.m,r=this.h,i=0;i<e;){if(0==r)for(;i<=t;)Lo(this,n,i),i+=this.blockSize;if("string"==typeof n){for(;i<e;)if(s[r++]=n.charCodeAt(i++),r==this.blockSize){Lo(this,s),r=0;break}}else for(;i<e;)if(s[r++]=n[i++],r==this.blockSize){Lo(this,s),r=0;break}}this.h=r,this.i+=e},Yt.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var s=0;32>s;s+=8)n[t++]=this.g[e]>>>s&255;return n};var Xf={};function Fo(n){return-128<=n&&128>n?function ie(n,e){var t=Xf;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new We([0|e],0>e?-1:0)}):new We([0|n],0>n?-1:0)}function tn(n){if(isNaN(n)||!isFinite(n))return ls;if(0>n)return kt(tn(-n));for(var e=[],t=1,s=0;n>=t;s++)e[s]=n/t|0,t*=Bo;return new We(e,0)}var Bo=4294967296,ls=Fo(0),Uo=Fo(1),Xc=Fo(16777216);function un(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function Jt(n){return-1==n.h}function kt(n){for(var e=n.g.length,t=[],s=0;s<e;s++)t[s]=~n.g[s];return new We(t,~n.h).add(Uo)}function di(n,e){return n.add(kt(e))}function fi(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function ar(n,e){this.g=n,this.h=e}function mi(n,e){if(un(e))throw Error("division by zero");if(un(n))return new ar(ls,ls);if(Jt(n))return e=mi(kt(n),e),new ar(kt(e.g),kt(e.h));if(Jt(e))return e=mi(n,kt(e)),new ar(kt(e.g),e.h);if(30<n.g.length){if(Jt(n)||Jt(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Uo,s=e;0>=s.X(n);)t=eu(t),s=eu(s);var r=cs(t,1),i=cs(s,1);for(s=cs(s,2),t=cs(t,2);!un(s);){var o=i.add(s);0>=o.X(n)&&(r=r.add(t),i=o),s=cs(s,1),t=cs(t,1)}return e=di(n,r.R(e)),new ar(r,e)}for(r=ls;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),s=48>=(s=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,s-48),o=(i=tn(t)).R(e);Jt(o)||0<o.X(n);)o=(i=tn(t-=s)).R(e);un(i)&&(i=Uo),r=r.add(i),n=di(n,o)}return new ar(r,n)}function eu(n){for(var e=n.g.length+1,t=[],s=0;s<e;s++)t[s]=n.D(s)<<1|n.D(s-1)>>>31;return new We(t,n.h)}function cs(n,e){var t=e>>5;e%=32;for(var s=n.g.length-t,r=[],i=0;i<s;i++)r[i]=0<e?n.D(i+t)>>>e|n.D(i+t+1)<<32-e:n.D(i+t);return new We(r,n.h)}(m=We.prototype).ea=function(){if(Jt(this))return-kt(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var s=this.D(t);n+=(0<=s?s:Bo+s)*e,e*=Bo}return n},m.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(un(this))return"0";if(Jt(this))return"-"+kt(this).toString(n);for(var e=tn(Math.pow(n,6)),t=this,s="";;){var r=mi(t,e).g,i=((0<(t=di(t,r.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(un(t=r))return i+s;for(;6>i.length;)i="0"+i;s=i+s}},m.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},m.X=function(n){return Jt(n=di(this,n))?-1:un(n)?0:1},m.abs=function(){return Jt(this)?kt(this):this},m.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],s=0,r=0;r<=e;r++){var i=s+(65535&this.D(r))+(65535&n.D(r)),o=(i>>>16)+(this.D(r)>>>16)+(n.D(r)>>>16);s=o>>>16,t[r]=(o&=65535)<<16|(i&=65535)}return new We(t,-2147483648&t[t.length-1]?-1:0)},m.R=function(n){if(un(this)||un(n))return ls;if(Jt(this))return Jt(n)?kt(this).R(kt(n)):kt(kt(this).R(n));if(Jt(n))return kt(this.R(kt(n)));if(0>this.X(Xc)&&0>n.X(Xc))return tn(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],s=0;s<2*e;s++)t[s]=0;for(s=0;s<this.g.length;s++)for(var r=0;r<n.g.length;r++){var i=this.D(s)>>>16,o=65535&this.D(s),a=n.D(r)>>>16,l=65535&n.D(r);t[2*s+2*r]+=o*l,fi(t,2*s+2*r),t[2*s+2*r+1]+=i*l,fi(t,2*s+2*r+1),t[2*s+2*r+1]+=o*a,fi(t,2*s+2*r+1),t[2*s+2*r+2]+=i*a,fi(t,2*s+2*r+2)}for(s=0;s<e;s++)t[s]=t[2*s+1]<<16|t[2*s];for(s=e;s<2*e;s++)t[s]=0;return new We(t,0)},m.gb=function(n){return mi(this,n).h},m.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],s=0;s<e;s++)t[s]=this.D(s)&n.D(s);return new We(t,this.h&n.h)},m.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],s=0;s<e;s++)t[s]=this.D(s)|n.D(s);return new We(t,this.h|n.h)},m.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],s=0;s<e;s++)t[s]=this.D(s)^n.D(s);return new We(t,this.h^n.h)},hi.prototype.createWebChannel=hi.prototype.g,Gt.prototype.send=Gt.prototype.u,Gt.prototype.open=Gt.prototype.m,Gt.prototype.close=Gt.prototype.close,Hr.NO_ERROR=0,Hr.TIMEOUT=8,Hr.HTTP_ERROR=6,uc.COMPLETE="complete",dc.EventType=Ws,Ws.OPEN="a",Ws.CLOSE="b",Ws.ERROR="c",Ws.MESSAGE="d",ut.prototype.listen=ut.prototype.O,ht.prototype.listenOnce=ht.prototype.P,ht.prototype.getLastError=ht.prototype.Sa,ht.prototype.getLastErrorCode=ht.prototype.Ia,ht.prototype.getStatus=ht.prototype.da,ht.prototype.getResponseJson=ht.prototype.Wa,ht.prototype.getResponseText=ht.prototype.ja,ht.prototype.send=ht.prototype.ha,ht.prototype.setWithCredentials=ht.prototype.Oa,Yt.prototype.digest=Yt.prototype.l,Yt.prototype.reset=Yt.prototype.reset,Yt.prototype.update=Yt.prototype.j,We.prototype.add=We.prototype.add,We.prototype.multiply=We.prototype.R,We.prototype.modulo=We.prototype.gb,We.prototype.compare=We.prototype.X,We.prototype.toNumber=We.prototype.ea,We.prototype.toString=We.prototype.toString,We.prototype.getBits=We.prototype.D,We.fromNumber=tn,We.fromString=function Hc(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return kt(Hc(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=tn(Math.pow(e,8)),s=ls,r=0;r<n.length;r+=8){var i=Math.min(8,n.length-r),o=parseInt(n.substring(r,r+i),e);8>i?(i=tn(Math.pow(e,i)),s=s.R(i).add(tn(o))):s=(s=s.R(t)).add(tn(o))}return s};var em=S.createWebChannelTransport=function(){return new hi},tm=S.getStatEventTarget=function(){return Yr()},jo=S.ErrorCode=Hr,nm=S.EventType=uc,sm=S.Event=Rn,tu=S.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},rm=S.FetchXmlHttpFactory=nr,gi=S.WebChannel=dc,im=S.XhrIo=ht,om=S.Md5=Yt,us=S.Integer=We;const nu="@firebase/firestore";class Ct{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ct.UNAUTHENTICATED=new Ct(null),Ct.GOOGLE_CREDENTIALS=new Ct("google-credentials-uid"),Ct.FIRST_PARTY=new Ct("first-party-uid"),Ct.MOCK_USER=new Ct("mock-user");let hs="9.23.0";const yn=new d.Yd("@firebase/firestore");function zo(){return yn.logLevel}function re(n,...e){if(yn.logLevel<=d.in.DEBUG){const t=e.map(Vo);yn.debug(`Firestore (${hs}): ${n}`,...t)}}function gt(n,...e){if(yn.logLevel<=d.in.ERROR){const t=e.map(Vo);yn.error(`Firestore (${hs}): ${n}`,...t)}}function Ht(n,...e){if(yn.logLevel<=d.in.WARN){const t=e.map(Vo);yn.warn(`Firestore (${hs}): ${n}`,...t)}}function Vo(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function ve(n="Unexpected state"){const e=`FIRESTORE (${hs}) INTERNAL ASSERTION FAILED: `+n;throw gt(e),new Error(e)}function Te(n,e){n||ve()}function me(n,e){return n}const L={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class X extends Q.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Tt{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class su{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class am{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ct.UNAUTHENTICATED))}shutdown(){}}class lm{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class cm{constructor(e){this.t=e,this.currentUser=Ct.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var s=this;let r=this.i;const i=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve();let o=new Tt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Tt,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,D.Z)(function*(){yield c.promise,yield i(s.currentUser)}))},l=c=>{re("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(re("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Tt)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(s=>this.i!==e?(re("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(Te("string"==typeof s.accessToken),new su(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Te(null===e||"string"==typeof e),new Ct(e)}}class um{constructor(e,t,s){this.h=e,this.l=t,this.m=s,this.type="FirstParty",this.user=Ct.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class hm{constructor(e,t,s){this.h=e,this.l=t,this.m=s}getToken(){return Promise.resolve(new um(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(Ct.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ru{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class dm{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){const s=i=>{null!=i.error&&re("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.T;return this.T=i.token,re("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>s(i))};const r=i=>{re("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.I.onInit(i=>r(i)),setTimeout(()=>{if(!this.appCheck){const i=this.I.getImmediate({optional:!0});i?r(i):re("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Te("string"==typeof t.token),this.T=t.token,new ru(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function fm(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}class iu{static A(){const t=62*Math.floor(256/62);let s="";for(;s.length<20;){const r=fm(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<t&&(s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[i]%62))}return s}}function Me(n,e){return n<e?-1:n>e?1:0}function ds(n,e,t){return n.length===e.length&&n.every((s,r)=>t(s,e[r]))}class ct{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new X(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new X(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new X(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new X(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ct.fromMillis(Date.now())}static fromDate(e){return ct.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor(1e6*(e-1e3*t));return new ct(t,s)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Me(this.nanoseconds,e.nanoseconds):Me(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Se{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Se(e)}static min(){return new Se(new ct(0,0))}static max(){return new Se(new ct(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class lr{constructor(e,t,s){void 0===t?t=0:t>e.length&&ve(),void 0===s?s=e.length-t:s>e.length-t&&ve(),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return 0===lr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof lr?e.forEach(s=>{t.push(s)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const i=e.get(r),o=t.get(r);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class qe extends lr{construct(e,t,s){return new qe(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new X(L.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter(r=>r.length>0))}return new qe(t)}static emptyPath(){return new qe([])}}const mm=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class pt extends lr{construct(e,t,s){return new pt(e,t,s)}static isValidIdentifier(e){return mm.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),pt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new pt(["__name__"])}static fromServerFormat(e){const t=[];let s="",r=0;const i=()=>{if(0===s.length)throw new X(L.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;r<e.length;){const a=e[r];if("\\"===a){if(r+1===e.length)throw new X(L.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if("\\"!==l&&"."!==l&&"`"!==l)throw new X(L.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=l,r+=2}else"`"===a?(o=!o,r++):"."!==a||o?(s+=a,r++):(i(),r++)}if(i(),o)throw new X(L.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new pt(t)}static emptyPath(){return new pt([])}}class fe{constructor(e){this.path=e}static fromPath(e){return new fe(qe.fromString(e))}static fromName(e){return new fe(qe.fromString(e).popFirst(5))}static empty(){return new fe(qe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===qe.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return qe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new fe(new qe(e.slice()))}}function lu(n){return new Qt(n.readTime,n.key,-1)}class Qt{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new Qt(Se.min(),fe.empty(),-1)}static max(){return new Qt(Se.max(),fe.empty(),-1)}}function Zo(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=fe.comparator(n.documentKey,e.documentKey),0!==t?t:Me(n.largestBatchId,e.largestBatchId))}const cu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class _m{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function vn(n){return Go.apply(this,arguments)}function Go(){return Go=(0,D.Z)(function*(n){if(n.code!==L.FAILED_PRECONDITION||n.message!==cu)throw n;re("LocalStore","Unexpectedly lost primary lease")}),Go.apply(this,arguments)}class P{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ve(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new P((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(t,i).next(s,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof P?t:P.resolve(t)}catch(t){return P.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):P.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):P.reject(t)}static resolve(e){return new P((t,s)=>{t(e)})}static reject(e){return new P((t,s)=>{s(e)})}static waitFor(e){return new P((t,s)=>{let r=0,i=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++i,o&&i===r&&t()},l=>s(l))}),o=!0,i===r&&t()})}static or(e){let t=P.resolve(!1);for(const s of e)t=t.next(r=>r?P.resolve(r):s());return t}static forEach(e,t){const s=[];return e.forEach((r,i)=>{s.push(t.call(this,r,i))}),this.waitFor(s)}static mapArray(e,t){return new P((s,r)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(f=>{o[c]=f,++a,a===i&&s(o)},f=>r(f))}})}static doWhile(e,t){return new P((s,r)=>{const i=()=>{!0===e()?t().next(()=>{i()},r):s()};i()})}}function wn(n){return"IndexedDbTransactionError"===n.name}let Kt=(()=>{class n{constructor(t,s){this.previousValue=t,s&&(s.sequenceNumberHandler=r=>this.ot(r),this.ut=r=>s.writeSequenceNumber(r))}ot(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ut&&this.ut(t),t}}return n.ct=-1,n})();function hr(n){return null==n}function dr(n){return 0===n&&1/n==-1/0}function yu(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function xn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function vu(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class He{constructor(e,t){this.comparator=e,this.root=t||Ot.EMPTY}insert(e,t){return new He(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ot.BLACK,null,null))}remove(e){return new He(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ot.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(0===s)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(0===r)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,s)=>(e(t,s),!1))}toString(){const e=[];return this.inorderTraversal((t,s)=>(e.push(`${t}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new wi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new wi(this.root,e,this.comparator,!1)}getReverseIterator(){return new wi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new wi(this.root,e,this.comparator,!0)}}class wi{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?s(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ot{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??Ot.RED,this.left=r??Ot.EMPTY,this.right=i??Ot.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,i){return new Ot(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,s),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Ot.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Ot.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ot.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ot.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ve();const e=this.left.check();if(e!==this.right.check())throw ve();return e+(this.isRed()?0:1)}}Ot.EMPTY=null,Ot.RED=!0,Ot.BLACK=!1,Ot.EMPTY=new class{constructor(){this.size=0}get key(){throw ve()}get value(){throw ve()}get color(){throw ve()}get left(){throw ve()}get right(){throw ve()}copy(n,e,t,s,r){return this}insert(n,e,t){return new Ot(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class nt{constructor(e){this.comparator=e,this.data=new He(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,s)=>(e(t),!1))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new wu(this.data.getIterator())}getIteratorFrom(e){return new wu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(s=>{t=t.add(s)}),t}isEqual(e){if(!(e instanceof nt)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(0!==this.comparator(r,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new nt(this.comparator);return t.data=e,t}}class wu{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class zt{constructor(e){this.fields=e,e.sort(pt.comparator)}static empty(){return new zt([])}unionWith(e){let t=new nt(pt.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new zt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ds(this.fields,e.fields,(t,s)=>t.isEqual(s))}}class xu extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class It{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new xu("Invalid base64 string: "+r):r}}(e);return new It(t)}static fromUint8Array(e){const t=function(s){let r="";for(let i=0;i<s.length;++i)r+=String.fromCharCode(s[i]);return r}(e);return new It(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Me(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}It.EMPTY_BYTE_STRING=new It("");const jm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Tn(n){if(Te(!!n),"string"==typeof n){let e=0;const t=jm.exec(n);if(Te(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:dt(n.seconds),nanos:dt(n.nanos)}}function dt(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function hn(n){return"string"==typeof n?It.fromBase64String(n):It.fromUint8Array(n)}function xi(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ti(n){const e=n.mapValue.fields.__previous_value__;return xi(e)?Ti(e):e}function fr(n){const e=Tn(n.mapValue.fields.__local_write_time__.timestampValue);return new ct(e.seconds,e.nanos)}class zm{constructor(e,t,s,r,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class jn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new jn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof jn&&e.projectId===this.projectId&&e.database===this.database}}const In={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function En(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?xi(n)?4:Su(n)?9007199254740991:10:ve()}function sn(n,e){if(n===e)return!0;const t=En(n);if(t!==En(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return fr(n).isEqual(fr(e));case 3:return function(s,r){if("string"==typeof s.timestampValue&&"string"==typeof r.timestampValue&&s.timestampValue.length===r.timestampValue.length)return s.timestampValue===r.timestampValue;const i=Tn(s.timestampValue),o=Tn(r.timestampValue);return i.seconds===o.seconds&&i.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return r=e,hn(n.bytesValue).isEqual(hn(r.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,r){return dt(s.geoPointValue.latitude)===dt(r.geoPointValue.latitude)&&dt(s.geoPointValue.longitude)===dt(r.geoPointValue.longitude)}(n,e);case 2:return function(s,r){if("integerValue"in s&&"integerValue"in r)return dt(s.integerValue)===dt(r.integerValue);if("doubleValue"in s&&"doubleValue"in r){const i=dt(s.doubleValue),o=dt(r.doubleValue);return i===o?dr(i)===dr(o):isNaN(i)&&isNaN(o)}return!1}(n,e);case 9:return ds(n.arrayValue.values||[],e.arrayValue.values||[],sn);case 10:return function(s,r){const i=s.mapValue.fields||{},o=r.mapValue.fields||{};if(yu(i)!==yu(o))return!1;for(const a in i)if(i.hasOwnProperty(a)&&(void 0===o[a]||!sn(i[a],o[a])))return!1;return!0}(n,e);default:return ve()}var r}function mr(n,e){return void 0!==(n.values||[]).find(t=>sn(t,e))}function Sn(n,e){if(n===e)return 0;const t=En(n),s=En(e);if(t!==s)return Me(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return Me(n.booleanValue,e.booleanValue);case 2:return function(r,i){const o=dt(r.integerValue||r.doubleValue),a=dt(i.integerValue||i.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,e);case 3:return Tu(n.timestampValue,e.timestampValue);case 4:return Tu(fr(n),fr(e));case 5:return Me(n.stringValue,e.stringValue);case 6:return function(r,i){const o=hn(r),a=hn(i);return o.compareTo(a)}(n.bytesValue,e.bytesValue);case 7:return function(r,i){const o=r.split("/"),a=i.split("/");for(let l=0;l<o.length&&l<a.length;l++){const c=Me(o[l],a[l]);if(0!==c)return c}return Me(o.length,a.length)}(n.referenceValue,e.referenceValue);case 8:return function(r,i){const o=Me(dt(r.latitude),dt(i.latitude));return 0!==o?o:Me(dt(r.longitude),dt(i.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(r,i){const o=r.values||[],a=i.values||[];for(let l=0;l<o.length&&l<a.length;++l){const c=Sn(o[l],a[l]);if(c)return c}return Me(o.length,a.length)}(n.arrayValue,e.arrayValue);case 10:return function(r,i){if(r===In.mapValue&&i===In.mapValue)return 0;if(r===In.mapValue)return 1;if(i===In.mapValue)return-1;const o=r.fields||{},a=Object.keys(o),l=i.fields||{},c=Object.keys(l);a.sort(),c.sort();for(let f=0;f<a.length&&f<c.length;++f){const p=Me(a[f],c[f]);if(0!==p)return p;const C=Sn(o[a[f]],l[c[f]]);if(0!==C)return C}return Me(a.length,c.length)}(n.mapValue,e.mapValue);default:throw ve()}}function Tu(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return Me(n,e);const t=Tn(n),s=Tn(e),r=Me(t.seconds,s.seconds);return 0!==r?r:Me(t.nanos,s.nanos)}function ms(n){return $o(n)}function $o(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(s){const r=Tn(s);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?hn(n.bytesValue).toBase64():"referenceValue"in n?fe.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(s){let r="[",i=!0;for(const o of s.values||[])i?i=!1:r+=",",r+=$o(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(s){const r=Object.keys(s.fields||{}).sort();let i="{",o=!0;for(const a of r)o?o=!1:i+=",",i+=`${a}:${$o(s.fields[a])}`;return i+"}"}(n.mapValue):ve();var e}function zn(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Wo(n){return!!n&&"integerValue"in n}function gr(n){return!!n&&"arrayValue"in n}function Iu(n){return!!n&&"nullValue"in n}function Eu(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Si(n){return!!n&&"mapValue"in n}function pr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return xn(n.mapValue.fields,(t,s)=>e.mapValue.fields[t]=pr(s)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=pr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Su(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}class Mt{constructor(e){this.value=e}static empty(){return new Mt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!Si(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=pr(t)}setAll(e){let t=pt.emptyPath(),s={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,s,r),s={},r=[],t=a.popLast()}o?s[a.lastSegment()]=pr(o):r.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,s,r)}delete(e){const t=this.field(e.popLast());Si(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return sn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];Si(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){xn(t,(r,i)=>e[r]=i);for(const r of s)delete e[r]}clone(){return new Mt(pr(this.value))}}function Au(n){const e=[];return xn(n.fields,(t,s)=>{const r=new pt([t]);if(Si(s)){const i=Au(s.mapValue).fields;if(0===i.length)e.push(r);else for(const o of i)e.push(r.child(o))}else e.push(r)}),new zt(e)}class st{constructor(e,t,s,r,i,o,a){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new st(e,0,Se.min(),Se.min(),Se.min(),Mt.empty(),0)}static newFoundDocument(e,t,s,r){return new st(e,1,t,Se.min(),s,r,0)}static newNoDocument(e,t){return new st(e,2,t,Se.min(),Se.min(),Mt.empty(),0)}static newUnknownDocument(e,t){return new st(e,3,t,Se.min(),Se.min(),Mt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Se.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Mt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Mt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Se.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof st&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new st(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class bn{constructor(e,t){this.position=e,this.inclusive=t}}function Du(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const i=e[r],o=n.position[r];if(s=i.field.isKeyField()?fe.comparator(fe.fromName(o.referenceValue),t.key):Sn(o,t.data.field(i.field)),"desc"===i.dir&&(s*=-1),0!==s)break}return s}function ku(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!sn(n.position[t],e.position[t]))return!1;return!0}class gs{constructor(e,t="asc"){this.field=e,this.dir=t}}function Zm(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Ou{}class je extends Ou{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,s):new Gm(e,t,s):"array-contains"===t?new $m(e,s):"in"===t?new Fu(e,s):"not-in"===t?new Wm(e,s):"array-contains-any"===t?new Jm(e,s):new je(e,t,s)}static createKeyFieldInFilter(e,t,s){return"in"===t?new Qm(e,s):new Km(e,s)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Sn(t,this.value)):null!==t&&En(this.value)===En(t)&&this.matchesComparison(Sn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return ve()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Je extends Ou{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new Je(e,t)}matches(e){return ps(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft(t=>t.isInequality());return null!==e?e.field:null}ft(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function ps(n){return"and"===n.op}function Yo(n){return function Mu(n){for(const e of n.filters)if(e instanceof Je)return!1;return!0}(n)&&ps(n)}function Ho(n){if(n instanceof je)return n.field.canonicalString()+n.op.toString()+ms(n.value);if(Yo(n))return n.filters.map(e=>Ho(e)).join(",");{const e=n.filters.map(t=>Ho(t)).join(",");return`${n.op}(${e})`}}function Pu(n,e){return n instanceof je?(t=n,(s=e)instanceof je&&t.op===s.op&&t.field.isEqual(s.field)&&sn(t.value,s.value)):n instanceof Je?function(t,s){return s instanceof Je&&t.op===s.op&&t.filters.length===s.filters.length&&t.filters.reduce((r,i,o)=>r&&Pu(i,s.filters[o]),!0)}(n,e):void ve();var t,s}function Nu(n){return n instanceof je?`${(e=n).field.canonicalString()} ${e.op} ${ms(e.value)}`:n instanceof Je?function(e){return e.op.toString()+" {"+e.getFilters().map(Nu).join(" ,")+"}"}(n):"Filter";var e}class Gm extends je{constructor(e,t,s){super(e,t,s),this.key=fe.fromName(s.referenceValue)}matches(e){const t=fe.comparator(e.key,this.key);return this.matchesComparison(t)}}class Qm extends je{constructor(e,t){super(e,"in",t),this.keys=Lu(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Km extends je{constructor(e,t){super(e,"not-in",t),this.keys=Lu(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Lu(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(s=>fe.fromName(s.referenceValue))}class $m extends je{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return gr(t)&&mr(t.arrayValue,this.value)}}class Fu extends je{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&mr(this.value.arrayValue,t)}}class Wm extends je{constructor(e,t){super(e,"not-in",t)}matches(e){if(mr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!mr(this.value.arrayValue,t)}}class Jm extends je{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!gr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(s=>mr(this.value.arrayValue,s))}}class Ym{constructor(e,t=null,s=[],r=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.dt=null}}function Xo(n,e=null,t=[],s=[],r=null,i=null,o=null){return new Ym(n,e,t,s,r,i,o)}function Vn(n){const e=me(n);if(null===e.dt){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(s=>Ho(s)).join(","),t+="|ob:",t+=e.orderBy.map(s=>{return(r=s).field.canonicalString()+r.dir;var r}).join(","),hr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(s=>ms(s)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(s=>ms(s)).join(",")),e.dt=t}return e.dt}function _r(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Zm(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Pu(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!ku(n.startAt,e.startAt)&&ku(n.endAt,e.endAt)}function bi(n){return fe.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}class dn{constructor(e,t=null,s=[],r=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.wt=null,this._t=null}}function _s(n){return new dn(n)}function zu(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function ea(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function Ai(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function ta(n){return null!==n.collectionGroup}function qn(n){const e=me(n);if(null===e.wt){e.wt=[];const t=Ai(e),s=ea(e);if(null!==t&&null===s)t.isKeyField()||e.wt.push(new gs(t)),e.wt.push(new gs(pt.keyField(),"asc"));else{let r=!1;for(const i of e.explicitOrderBy)e.wt.push(i),i.field.isKeyField()&&(r=!0);if(!r){const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new gs(pt.keyField(),i))}}}return e.wt}function Ut(n){const e=me(n);if(!e._t)if("F"===e.limitType)e._t=Xo(e.path,e.collectionGroup,qn(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const i of qn(e))t.push(new gs(i.field,"desc"===i.dir?"asc":"desc"));const s=e.endAt?new bn(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new bn(e.startAt.position,e.startAt.inclusive):null;e._t=Xo(e.path,e.collectionGroup,t,e.filters,e.limit,s,r)}return e._t}function na(n,e){e.getFirstInequalityField(),Ai(n);const t=n.filters.concat([e]);return new dn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Di(n,e,t){return new dn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function yr(n,e){return _r(Ut(n),Ut(e))&&n.limitType===e.limitType}function Vu(n){return`${Vn(Ut(n))}|lt:${n.limitType}`}function sa(n){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(s=>Nu(s)).join(", ")}]`),hr(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(s=>{return`${(r=s).field.canonicalString()} (${r.dir})`;var r}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(s=>ms(s)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(s=>ms(s)).join(",")),`Target(${t})`}(Ut(n))}; limitType=${n.limitType})`}function vr(n,e){return e.isFoundDocument()&&function(t,s){const r=s.key.path;return null!==t.collectionGroup?s.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(r):fe.isDocumentKey(t.path)?t.path.isEqual(r):t.path.isImmediateParentOf(r)}(n,e)&&function(t,s){for(const r of qn(t))if(!r.field.isKeyField()&&null===s.data.field(r.field))return!1;return!0}(n,e)&&function(t,s){for(const r of t.filters)if(!r.matches(s))return!1;return!0}(n,e)&&(s=e,!((t=n).startAt&&!function(r,i,o){const a=Du(r,i,o);return r.inclusive?a<=0:a<0}(t.startAt,qn(t),s)||t.endAt&&!function(r,i,o){const a=Du(r,i,o);return r.inclusive?a>=0:a>0}(t.endAt,qn(t),s)));var t,s}function Zu(n){return(e,t)=>{let s=!1;for(const r of qn(n)){const i=Hm(r,e,t);if(0!==i)return i;s=s||r.field.isKeyField()}return 0}}function Hm(n,e,t){const s=n.field.isKeyField()?fe.comparator(e.key,t.key):function(r,i,o){const a=i.data.field(r),l=o.data.field(r);return null!==a&&null!==l?Sn(a,l):ve()}(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return ve()}}class fn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(void 0!==s)for(const[r,i]of s)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(void 0===r)return this.inner[s]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(void 0===s)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return 1===s.length?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){xn(this.inner,(t,s)=>{for(const[r,i]of s)e(r,i)})}isEmpty(){return vu(this.inner)}size(){return this.innerSize}}const Xm=new He(fe.comparator);function Vt(){return Xm}const Gu=new He(fe.comparator);function wr(...n){let e=Gu;for(const t of n)e=e.insert(t.key,t);return e}function Qu(n){let e=Gu;return n.forEach((t,s)=>e=e.insert(t,s.overlayedDocument)),e}function rn(){return xr()}function Ku(){return xr()}function xr(){return new fn(n=>n.toString(),(n,e)=>n.isEqual(e))}const eg=new He(fe.comparator),tg=new nt(fe.comparator);function Re(...n){let e=tg;for(const t of n)e=e.add(t);return e}const ng=new nt(Me);function $u(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:dr(e)?"-0":e}}function Wu(n){return{integerValue:""+n}}function Ju(n,e){return function hu(n){return"number"==typeof n&&Number.isInteger(n)&&!dr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}(e)?Wu(e):$u(n,e)}class ki{constructor(){this._=void 0}}function sg(n,e,t){return n instanceof ys?function(s,r){const i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return r&&xi(r)&&(r=Ti(r)),r&&(i.fields.__previous_value__=r),{mapValue:i}}(t,e):n instanceof Zn?Hu(n,e):n instanceof Gn?Xu(n,e):function(s,r){const i=Yu(s,r),o=eh(i)+eh(s.gt);return Wo(i)&&Wo(s.gt)?Wu(o):$u(s.serializer,o)}(n,e)}function rg(n,e,t){return n instanceof Zn?Hu(n,e):n instanceof Gn?Xu(n,e):t}function Yu(n,e){return n instanceof vs?Wo(t=e)||(s=t)&&"doubleValue"in s?e:{integerValue:0}:null;var s,t}class ys extends ki{}class Zn extends ki{constructor(e){super(),this.elements=e}}function Hu(n,e){const t=th(e);for(const s of n.elements)t.some(r=>sn(r,s))||t.push(s);return{arrayValue:{values:t}}}class Gn extends ki{constructor(e){super(),this.elements=e}}function Xu(n,e){let t=th(e);for(const s of n.elements)t=t.filter(r=>!sn(r,s));return{arrayValue:{values:t}}}class vs extends ki{constructor(e,t){super(),this.serializer=e,this.gt=t}}function eh(n){return dt(n.integerValue||n.doubleValue)}function th(n){return gr(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class og{constructor(e,t){this.version=e,this.transformResults=t}}class ot{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ot}static exists(e){return new ot(void 0,e)}static updateTime(e){return new ot(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Oi(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class Mi{}function nh(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new xs(n.key,ot.none()):new ws(n.key,n.data,ot.none());{const t=n.data,s=Mt.empty();let r=new nt(pt.comparator);for(let i of e.fields)if(!r.has(i)){let o=t.field(i);null===o&&i.length>1&&(i=i.popLast(),o=t.field(i)),null===o?s.delete(i):s.set(i,o),r=r.add(i)}return new mn(n.key,s,new zt(r.toArray()),ot.none())}}function ag(n,e,t){n instanceof ws?function(s,r,i){const o=s.value.clone(),a=ih(s.fieldTransforms,r,i.transformResults);o.setAll(a),r.convertToFoundDocument(i.version,o).setHasCommittedMutations()}(n,e,t):n instanceof mn?function(s,r,i){if(!Oi(s.precondition,r))return void r.convertToUnknownDocument(i.version);const o=ih(s.fieldTransforms,r,i.transformResults),a=r.data;a.setAll(rh(s)),a.setAll(o),r.convertToFoundDocument(i.version,a).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Ir(n,e,t,s){return n instanceof ws?function(r,i,o,a){if(!Oi(r.precondition,i))return o;const l=r.value.clone(),c=oh(r.fieldTransforms,a,i);return l.setAll(c),i.convertToFoundDocument(i.version,l).setHasLocalMutations(),null}(n,e,t,s):n instanceof mn?function(r,i,o,a){if(!Oi(r.precondition,i))return o;const l=oh(r.fieldTransforms,a,i),c=i.data;return c.setAll(rh(r)),c.setAll(l),i.convertToFoundDocument(i.version,c).setHasLocalMutations(),null===o?null:o.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map(f=>f.field))}(n,e,t,s):(o=t,Oi(n.precondition,i=e)?(i.convertToNoDocument(i.version).setHasLocalMutations(),null):o);var i,o}function lg(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),i=Yu(s.transform,r||null);null!=i&&(null===t&&(t=Mt.empty()),t.set(s.field,i))}return t||null}function sh(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(s=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===s||t&&s&&ds(t,s,(r,i)=>function ig(n,e){return n.field.isEqual(e.field)&&(s=e.transform,(t=n.transform)instanceof Zn&&s instanceof Zn||t instanceof Gn&&s instanceof Gn?ds(t.elements,s.elements,sn):t instanceof vs&&s instanceof vs?sn(t.gt,s.gt):t instanceof ys&&s instanceof ys);var t,s}(r,i))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,s}class ws extends Mi{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class mn extends Mi{constructor(e,t,s,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function rh(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}}),e}function ih(n,e,t){const s=new Map;Te(n.length===t.length);for(let r=0;r<t.length;r++){const i=n[r],o=i.transform,a=e.data.field(i.field);s.set(i.field,rg(o,a,t[r]))}return s}function oh(n,e,t){const s=new Map;for(const r of n){const i=r.transform,o=t.data.field(r.field);s.set(r.field,sg(i,o,e))}return s}class xs extends Mi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ia extends Mi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class oa{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&ag(i,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=Ir(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=Ir(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=Ku();return this.mutations.forEach(r=>{const i=e.get(r.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(r.key)?null:a;const l=nh(o,a);null!==l&&s.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(Se.min())}),s}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Re())}isEqual(e){return this.batchId===e.batchId&&ds(this.mutations,e.mutations,(t,s)=>sh(t,s))&&ds(this.baseMutations,e.baseMutations,(t,s)=>sh(t,s))}}class aa{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){Te(e.mutations.length===s.length);let r=eg;const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,s[o].version);return new aa(e,t,s,r)}}class la{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class ug{constructor(e,t){this.count=e,this.unchangedNames=t}}var vt,Ze;function lh(n){if(void 0===n)return gt("GRPC error has no .code"),L.UNKNOWN;switch(n){case vt.OK:return L.OK;case vt.CANCELLED:return L.CANCELLED;case vt.UNKNOWN:return L.UNKNOWN;case vt.DEADLINE_EXCEEDED:return L.DEADLINE_EXCEEDED;case vt.RESOURCE_EXHAUSTED:return L.RESOURCE_EXHAUSTED;case vt.INTERNAL:return L.INTERNAL;case vt.UNAVAILABLE:return L.UNAVAILABLE;case vt.UNAUTHENTICATED:return L.UNAUTHENTICATED;case vt.INVALID_ARGUMENT:return L.INVALID_ARGUMENT;case vt.NOT_FOUND:return L.NOT_FOUND;case vt.ALREADY_EXISTS:return L.ALREADY_EXISTS;case vt.PERMISSION_DENIED:return L.PERMISSION_DENIED;case vt.FAILED_PRECONDITION:return L.FAILED_PRECONDITION;case vt.ABORTED:return L.ABORTED;case vt.OUT_OF_RANGE:return L.OUT_OF_RANGE;case vt.UNIMPLEMENTED:return L.UNIMPLEMENTED;case vt.DATA_LOSS:return L.DATA_LOSS;default:return ve()}}(Ze=vt||(vt={}))[Ze.OK=0]="OK",Ze[Ze.CANCELLED=1]="CANCELLED",Ze[Ze.UNKNOWN=2]="UNKNOWN",Ze[Ze.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ze[Ze.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ze[Ze.NOT_FOUND=5]="NOT_FOUND",Ze[Ze.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ze[Ze.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ze[Ze.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ze[Ze.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ze[Ze.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ze[Ze.ABORTED=10]="ABORTED",Ze[Ze.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ze[Ze.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ze[Ze.INTERNAL=13]="INTERNAL",Ze[Ze.UNAVAILABLE=14]="UNAVAILABLE",Ze[Ze.DATA_LOSS=15]="DATA_LOSS";class ca{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return Pi}static getOrCreateInstance(){return null===Pi&&(Pi=new ca),Pi}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(t=>t(e))}}let Pi=null;const hg=new us([4294967295,4294967295],0);function uh(n){const e=function ch(){return new TextEncoder}().encode(n),t=new om;return t.update(e),new Uint8Array(t.digest())}function hh(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new us([t,s],0),new us([r,i],0)]}class ua{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new Er(`Invalid padding: ${t}`);if(s<0)throw new Er(`Invalid hash count: ${s}`);if(e.length>0&&0===this.hashCount)throw new Er(`Invalid hash count: ${s}`);if(0===e.length&&0!==t)throw new Er(`Invalid padding when bitmap length is 0: ${t}`);this.It=8*e.length-t,this.Tt=us.fromNumber(this.It)}Et(e,t,s){let r=e.add(t.multiply(us.fromNumber(s)));return 1===r.compare(hg)&&(r=new us([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Tt).toNumber()}At(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;const t=uh(e),[s,r]=hh(t);for(let i=0;i<this.hashCount;i++){const o=this.Et(s,r,i);if(!this.At(o))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new ua(i,r,t);return s.forEach(a=>o.insert(a)),o}insert(e){if(0===this.It)return;const t=uh(e),[s,r]=hh(t);for(let i=0;i<this.hashCount;i++){const o=this.Et(s,r,i);this.Rt(o)}}Rt(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Er extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Sr{constructor(e,t,s,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,br.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new Sr(Se.min(),r,new He(Me),Vt(),Re())}}class br{constructor(e,t,s,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new br(s,t,Re(),Re(),Re())}}class Ri{constructor(e,t,s,r){this.Pt=e,this.removedTargetIds=t,this.key=s,this.bt=r}}class dh{constructor(e,t){this.targetId=e,this.Vt=t}}class fh{constructor(e,t,s=It.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class mh{constructor(){this.St=0,this.Dt=ph(),this.Ct=It.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=Re(),t=Re(),s=Re();return this.Dt.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:ve()}}),new br(this.Ct,this.xt,e,t,s)}Ft(){this.Nt=!1,this.Dt=ph()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class dg{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=Vt(),this.zt=gh(),this.Wt=new He(Me)}Ht(e){for(const t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(const t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,t=>{const s=this.Zt(t);switch(e.state){case 0:this.te(t)&&s.$t(e.resumeToken);break;case 1:s.Ut(),s.kt||s.Ft(),s.$t(e.resumeToken);break;case 2:s.Ut(),s.kt||this.removeTarget(t);break;case 3:this.te(t)&&(s.Kt(),s.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),s.$t(e.resumeToken));break;default:ve()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach((s,r)=>{this.te(r)&&t(r)})}ne(e){var t;const s=e.targetId,r=e.Vt.count,i=this.se(s);if(i){const o=i.target;if(bi(o))if(0===r){const a=new fe(o.path);this.Yt(s,a,st.newNoDocument(a,Se.min()))}else Te(1===r);else{const a=this.ie(s);if(a!==r){const l=this.re(e,a);0!==l&&(this.ee(s),this.Wt=this.Wt.insert(s,2===l?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null===(t=ca.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(c,f,p){var C,z,ae,ge,ye,Ne;const Ge={localCacheCount:f,existenceFilterCount:p.count},Fe=p.unchangedNames;return Fe&&(Ge.bloomFilter={applied:0===c,hashCount:null!==(C=Fe?.hashCount)&&void 0!==C?C:0,bitmapLength:null!==(ge=null===(ae=null===(z=Fe?.bits)||void 0===z?void 0:z.bitmap)||void 0===ae?void 0:ae.length)&&void 0!==ge?ge:0,padding:null!==(Ne=null===(ye=Fe?.bits)||void 0===ye?void 0:ye.padding)&&void 0!==Ne?Ne:0}),Ge}(l,a,e.Vt))}}}}re(e,t){const{unchangedNames:s,count:r}=e.Vt;if(!s||!s.bits)return 1;const{bits:{bitmap:i="",padding:o=0},hashCount:a=0}=s;let l,c;try{l=hn(i).toUint8Array()}catch(f){if(f instanceof xu)return Ht("Decoding the base64 bloom filter in existence filter failed ("+f.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw f}try{c=new ua(l,o,a)}catch(f){return Ht(f instanceof Er?"BloomFilter error: ":"Applying bloom filter failed: ",f),1}return 0===c.It?1:r!==t-this.oe(e.targetId,c)?2:0}oe(e,t){const s=this.Gt.getRemoteKeysForTarget(e);let r=0;return s.forEach(i=>{const o=this.Gt.ue(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;t.vt(a)||(this.Yt(e,i,null),r++)}),r}ce(e){const t=new Map;this.Qt.forEach((i,o)=>{const a=this.se(o);if(a){if(i.current&&bi(a.target)){const l=new fe(a.target.path);null!==this.jt.get(l)||this.ae(o,l)||this.Yt(o,l,st.newNoDocument(l,e))}i.Mt&&(t.set(o,i.Ot()),i.Ft())}});let s=Re();this.zt.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.se(l);return!c||"TargetPurposeLimboResolution"===c.purpose||(a=!1,!1)}),a&&(s=s.add(i))}),this.jt.forEach((i,o)=>o.setReadTime(e));const r=new Sr(e,t,this.Wt,this.jt,s);return this.jt=Vt(),this.zt=gh(),this.Wt=new He(Me),r}Jt(e,t){if(!this.te(e))return;const s=this.ae(e,t.key)?2:0;this.Zt(e).Bt(t.key,s),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,s){if(!this.te(e))return;const r=this.Zt(e);this.ae(e,t)?r.Bt(t,1):r.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),s&&(this.jt=this.jt.insert(t,s))}removeTarget(e){this.Qt.delete(e)}ie(e){const t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new mh,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new nt(Me),this.zt=this.zt.insert(e,t)),t}te(e){const t=null!==this.se(e);return t||re("WatchChangeAggregator","Detected inactive target",e),t}se(e){const t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new mh),this.Gt.getRemoteKeysForTarget(e).forEach(t=>{this.Yt(e,t,null)})}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function gh(){return new He(fe.comparator)}function ph(){return new He(fe.comparator)}const fg={asc:"ASCENDING",desc:"DESCENDING"},mg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},gg={and:"AND",or:"OR"};class pg{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ha(n,e){return n.useProto3Json||hr(e)?e:{value:e}}function Ts(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function _h(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function _g(n,e){return Ts(n,e.toTimestamp())}function _t(n){return Te(!!n),Se.fromTimestamp(function(e){const t=Tn(e);return new ct(t.seconds,t.nanos)}(n))}function da(n,e){return(t=n,new qe(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function yh(n){const e=qe.fromString(n);return Te(Ch(e)),e}function Cr(n,e){return da(n.databaseId,e.path)}function on(n,e){const t=yh(e);if(t.get(1)!==n.databaseId.projectId)throw new X(L.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new X(L.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new fe(wh(t))}function fa(n,e){return da(n.databaseId,e)}function Ar(n){return new qe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function wh(n){return Te(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function xh(n,e,t){return{name:Cr(n,e),fields:t.value.mapValue.fields}}function Ih(n,e){return{documents:[fa(n,e.path)]}}function ga(n,e){const t={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(t.parent=fa(n,s),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=fa(n,s.popLast()),t.structuredQuery.from=[{collectionId:s.lastSegment()}]);const r=function(l){if(0!==l.length)return bh(Je.create(l,"and"))}(e.filters);r&&(t.structuredQuery.where=r);const i=function(l){if(0!==l.length)return l.map(c=>{return{field:Cn((f=c).field),direction:Tg(f.dir)};var f})}(e.orderBy);i&&(t.structuredQuery.orderBy=i);const o=ha(n,e.limit);var a,l;return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(t.structuredQuery.endAt={before:!(l=e.endAt).inclusive,values:l.position}),t}function Eh(n){let e=function vh(n){const e=yh(n);return 4===e.length?qe.emptyPath():wh(e)}(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){Te(1===s);const f=t.from[0];f.allDescendants?r=f.collectionId:e=e.child(f.collectionId)}let i=[];t.where&&(i=function(f){const p=Sh(f);return p instanceof Je&&Yo(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(f=>{return new gs(Is((p=f).field),function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(p.direction));var p}));let a=null;t.limit&&(a=function(f){let p;return p="object"==typeof f?f.value:f,hr(p)?null:p}(t.limit));let l=null;var f;t.startAt&&(l=new bn((f=t.startAt).values||[],!!f.before));let c=null;return t.endAt&&(c=function(f){return new bn(f.values||[],!f.before)}(t.endAt)),function ju(n,e,t,s,r,i,o,a){return new dn(n,e,t,s,r,i,o,a)}(e,r,o,i,a,"F",l,c)}function Sh(n){return void 0!==n.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Is(e.unaryFilter.field);return je.create(t,"==",{doubleValue:NaN});case"IS_NULL":const s=Is(e.unaryFilter.field);return je.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Is(e.unaryFilter.field);return je.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Is(e.unaryFilter.field);return je.create(i,"!=",{nullValue:"NULL_VALUE"});default:return ve()}}(n):void 0!==n.fieldFilter?je.create(Is((e=n).fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ve()}}(e.fieldFilter.op),e.fieldFilter.value):void 0!==n.compositeFilter?function(e){return Je.create(e.compositeFilter.filters.map(t=>Sh(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return ve()}}(e.compositeFilter.op))}(n):ve();var e}function Tg(n){return fg[n]}function Ig(n){return mg[n]}function Eg(n){return gg[n]}function Cn(n){return{fieldPath:n.canonicalString()}}function Is(n){return pt.fromServerFormat(n.fieldPath)}function bh(n){return n instanceof je?function(e){if("=="===e.op){if(Eu(e.value))return{unaryFilter:{field:Cn(e.field),op:"IS_NAN"}};if(Iu(e.value))return{unaryFilter:{field:Cn(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Eu(e.value))return{unaryFilter:{field:Cn(e.field),op:"IS_NOT_NAN"}};if(Iu(e.value))return{unaryFilter:{field:Cn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Cn(e.field),op:Ig(e.op),value:e.value}}}(n):n instanceof Je?function(e){const t=e.getFilters().map(s=>bh(s));return 1===t.length?t[0]:{compositeFilter:{op:Eg(e.op),filters:t}}}(n):ve()}function Sg(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Ch(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class gn{constructor(e,t,s,r,i=Se.min(),o=Se.min(),a=It.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new gn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new gn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new gn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new gn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Ah{constructor(e){this.fe=e}}function pa(n){const e=Eh({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?Di(e,e.limit,"L"):e}class Wn{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(e.booleanValue?1:0);else if("integerValue"in e)this.ye(t,15),t.pe(dt(e.integerValue));else if("doubleValue"in e){const s=dt(e.doubleValue);isNaN(s)?this.ye(t,13):(this.ye(t,15),dr(s)?t.pe(0):t.pe(s))}else if("timestampValue"in e){const s=e.timestampValue;this.ye(t,20),"string"==typeof s?t.Ie(s):(t.Ie(`${s.seconds||""}`),t.pe(s.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(hn(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){const s=e.geoPointValue;this.ye(t,45),t.pe(s.latitude||0),t.pe(s.longitude||0)}else"mapValue"in e?Su(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):ve()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){const s=e.fields||{};this.ye(t,55);for(const r of Object.keys(s))this.Te(r,t),this.me(s[r],t)}Pe(e,t){const s=e.values||[];this.ye(t,50);for(const r of s)this.me(r,t)}ve(e,t){this.ye(t,37),fe.fromName(e).path.forEach(s=>{this.ye(t,60),this.be(s,t)})}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}Wn.Ve=new Wn;class Rg{constructor(){this.rn=new Ta}addToCollectionParentIndex(e,t){return this.rn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(Qt.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(Qt.min())}updateCollectionGroup(e,t,s){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}}class Ta{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new nt(qe.comparator),i=!r.has(s);return this.index[t]=r.add(s),i}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new nt(qe.comparator)).toArray()}}new Uint8Array(0);class Nt{constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}static withCacheSize(e){return new Nt(e,Nt.DEFAULT_COLLECTION_PERCENTILE,Nt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Nt.DEFAULT_COLLECTION_PERCENTILE=10,Nt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Nt.DEFAULT=new Nt(41943040,Nt.DEFAULT_COLLECTION_PERCENTILE,Nt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Nt.DISABLED=new Nt(-1,0,0);class Yn{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new Yn(0)}static Mn(){return new Yn(-1)}}class jg{constructor(){this.changes=new fn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,st.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return void 0!==s?P.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class qg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ed{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(s=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(null!==s&&Ir(s.mutation,r,zt.empty(),ct.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.getLocalViewOfDocuments(e,s,Re()).next(()=>s))}getLocalViewOfDocuments(e,t,s=Re()){const r=rn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,s).next(i=>{let o=wr();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const s=rn();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,Re()))}populateOverlays(e,t,s){const r=[];return s.forEach(i=>{t.has(i)||r.push(i)}),this.documentOverlayCache.getOverlays(e,r).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,s,r){let i=Vt();const o=xr(),a=xr();return t.forEach((l,c)=>{const f=s.get(c.key);r.has(c.key)&&(void 0===f||f.mutation instanceof mn)?i=i.insert(c.key,c):void 0!==f?(o.set(c.key,f.mutation.getFieldMask()),Ir(f.mutation,c,f.mutation.getFieldMask(),ct.now())):o.set(c.key,zt.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,f)=>o.set(c,f)),t.forEach((c,f)=>{var p;return a.set(c,new qg(f,null!==(p=o.get(c))&&void 0!==p?p:null))}),a))}recalculateAndSaveOverlays(e,t){const s=xr();let r=new He((o,a)=>o-a),i=Re();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(null===c)return;let f=s.get(l)||zt.empty();f=a.applyToLocalView(c,f),s.set(l,f);const p=(r.get(a.batchId)||Re()).add(l);r=r.insert(a.batchId,p)})}).next(()=>{const o=[],a=r.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,f=l.value,p=Ku();f.forEach(C=>{if(!i.has(C)){const z=nh(t.get(C),s.get(C));null!==z&&p.set(C,z),i=i.add(C)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,p))}return P.waitFor(o)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,t,s){return fe.isDocumentKey((r=t).path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):ta(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s):this.getDocumentsMatchingCollectionQuery(e,t,s);var r}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next(i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-i.size):P.resolve(rn());let a=-1,l=i;return o.next(c=>P.forEach(c,(f,p)=>(a<p.largestBatchId&&(a=p.largestBatchId),i.get(f)?P.resolve():this.remoteDocumentCache.getEntry(e,f).next(C=>{l=l.insert(f,C)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,Re())).next(f=>({batchId:a,changes:Qu(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new fe(t)).next(s=>{let r=wr();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,s){const r=t.collectionGroup;let i=wr();return this.indexManager.getCollectionParents(e,r).next(o=>P.forEach(o,a=>{const l=(c=t,f=a.child(r),new dn(f,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt));var c,f;return this.getDocumentsMatchingCollectionQuery(e,l,s).next(c=>{c.forEach((f,p)=>{i=i.insert(f,p)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,s){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next(i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,r))).next(i=>{r.forEach((a,l)=>{const c=l.getKey();null===i.get(c)&&(i=i.insert(c,st.newInvalidDocument(c)))});let o=wr();return i.forEach((a,l)=>{const c=r.get(a);void 0!==c&&Ir(c.mutation,l,zt.empty(),ct.now()),vr(t,l)&&(o=o.insert(a,l))}),o})}}class Zg{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return P.resolve(this.cs.get(t))}saveBundleMetadata(e,t){var s;return this.cs.set(t.id,{id:(s=t).id,version:s.version,createTime:_t(s.createTime)}),P.resolve()}getNamedQuery(e,t){return P.resolve(this.hs.get(t))}saveNamedQuery(e,t){return this.hs.set(t.name,{name:(s=t).name,query:pa(s.bundledQuery),readTime:_t(s.readTime)}),P.resolve();var s}}class Gg{constructor(){this.overlays=new He(fe.comparator),this.ls=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){const s=rn();return P.forEach(t,r=>this.getOverlay(e,r).next(i=>{null!==i&&s.set(r,i)})).next(()=>s)}saveOverlays(e,t,s){return s.forEach((r,i)=>{this.we(e,t,i)}),P.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.ls.get(s);return void 0!==r&&(r.forEach(i=>this.overlays=this.overlays.remove(i)),this.ls.delete(s)),P.resolve()}getOverlaysForCollection(e,t,s){const r=rn(),i=t.length+1,o=new fe(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>s&&r.set(l.getKey(),l)}return P.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let i=new He((c,f)=>c-f);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>s){let f=i.get(c.largestBatchId);null===f&&(f=rn(),i=i.insert(c.largestBatchId,f)),f.set(c.getKey(),c)}}const a=rn(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,f)=>a.set(c,f)),!(a.size()>=r)););return P.resolve(a)}we(e,t,s){const r=this.overlays.get(s.key);if(null!==r){const o=this.ls.get(r.largestBatchId).delete(s.key);this.ls.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new la(t,s));let i=this.ls.get(t);void 0===i&&(i=Re(),this.ls.set(t,i)),this.ls.set(t,i.add(s.key))}}class Ia{constructor(){this.fs=new nt(Dt.ds),this.ws=new nt(Dt._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){const s=new Dt(e,t);this.fs=this.fs.add(s),this.ws=this.ws.add(s)}gs(e,t){e.forEach(s=>this.addReference(s,t))}removeReference(e,t){this.ys(new Dt(e,t))}ps(e,t){e.forEach(s=>this.removeReference(s,t))}Is(e){const t=new fe(new qe([])),s=new Dt(t,e),r=new Dt(t,e+1),i=[];return this.ws.forEachInRange([s,r],o=>{this.ys(o),i.push(o.key)}),i}Ts(){this.fs.forEach(e=>this.ys(e))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const t=new fe(new qe([])),s=new Dt(t,e),r=new Dt(t,e+1);let i=Re();return this.ws.forEachInRange([s,r],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Dt(e,0),s=this.fs.firstAfterOrEqual(t);return null!==s&&e.isEqual(s.key)}}class Dt{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return fe.comparator(e.key,t.key)||Me(e.As,t.As)}static _s(e,t){return Me(e.As,t.As)||fe.comparator(e.key,t.key)}}class Qg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new nt(Dt.ds)}checkEmpty(e){return P.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,s,r){const i=this.vs;this.vs++;const o=new oa(i,t,s,r);this.mutationQueue.push(o);for(const a of r)this.Rs=this.Rs.add(new Dt(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return P.resolve(o)}lookupMutationBatch(e,t){return P.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){const r=this.bs(t+1),i=r<0?0:r;return P.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new Dt(t,0),r=new Dt(t,Number.POSITIVE_INFINITY),i=[];return this.Rs.forEachInRange([s,r],o=>{const a=this.Ps(o.As);i.push(a)}),P.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new nt(Me);return t.forEach(r=>{const i=new Dt(r,0),o=new Dt(r,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([i,o],a=>{s=s.add(a.As)})}),P.resolve(this.Vs(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let i=s;fe.isDocumentKey(i)||(i=i.child(""));const o=new Dt(new fe(i),0);let a=new nt(Me);return this.Rs.forEachWhile(l=>{const c=l.key.path;return!!s.isPrefixOf(c)&&(c.length===r&&(a=a.add(l.As)),!0)},o),P.resolve(this.Vs(a))}Vs(e){const t=[];return e.forEach(s=>{const r=this.Ps(s);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){Te(0===this.Ss(t.batchId,"removed")),this.mutationQueue.shift();let s=this.Rs;return P.forEach(t.mutations,r=>{const i=new Dt(r.key,t.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Rs=s})}Cn(e){}containsKey(e,t){const s=new Dt(t,0),r=this.Rs.firstAfterOrEqual(s);return P.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return P.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){const t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Kg{constructor(e){this.Ds=e,this.docs=new He(fe.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),i=r?r.size:0,o=this.Ds(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return P.resolve(s?s.document.mutableCopy():st.newInvalidDocument(t))}getEntries(e,t){let s=Vt();return t.forEach(r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():st.newInvalidDocument(r))}),P.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let i=Vt();const o=t.path,a=new fe(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:f}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Zo(lu(f),s)<=0||(r.has(f.key)||vr(t,f))&&(i=i.insert(f.key,f.mutableCopy()))}return P.resolve(i)}getAllFromCollectionGroup(e,t,s,r){ve()}Cs(e,t){return P.forEach(this.docs,s=>t(s))}newChangeBuffer(e){return new $g(this)}getSize(e){return P.resolve(this.size)}}class $g extends jg{constructor(e){super(),this.os=e}applyChanges(e){const t=[];return this.changes.forEach((s,r)=>{r.isValidDocument()?t.push(this.os.addEntry(e,r)):this.os.removeEntry(s)}),P.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class Wg{constructor(e){this.persistence=e,this.xs=new fn(t=>Vn(t),_r),this.lastRemoteSnapshotVersion=Se.min(),this.highestTargetId=0,this.Ns=0,this.ks=new Ia,this.targetCount=0,this.Ms=Yn.kn()}forEachTarget(e,t){return this.xs.forEach((s,r)=>t(r)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.Ns&&(this.Ns=t),P.resolve()}Fn(e){this.xs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ms=new Yn(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.Fn(t),P.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,s){let r=0;const i=[];return this.xs.forEach((o,a)=>{a.sequenceNumber<=t&&null===s.get(a.targetId)&&(this.xs.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),P.waitFor(i).next(()=>r)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){const s=this.xs.get(t)||null;return P.resolve(s)}addMatchingKeys(e,t,s){return this.ks.gs(t,s),P.resolve()}removeMatchingKeys(e,t,s){this.ks.ps(t,s);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(o=>{i.push(r.markPotentiallyOrphaned(e,o))}),P.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),P.resolve()}getMatchingKeysForTargetId(e,t){const s=this.ks.Es(t);return P.resolve(s)}containsKey(e,t){return P.resolve(this.ks.containsKey(t))}}class Ea{constructor(e,t){this.$s={},this.overlays={},this.Os=new Kt(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new Wg(this),this.indexManager=new Rg,this.remoteDocumentCache=new Kg(s=>this.referenceDelegate.Ls(s)),this.serializer=new Ah(t),this.qs=new Zg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Gg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.$s[e.toKey()];return s||(s=new Qg(t,this.referenceDelegate),this.$s[e.toKey()]=s),s}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,s){re("MemoryPersistence","Starting transaction:",e);const r=new Jg(this.Os.next());return this.referenceDelegate.Us(),s(r).next(i=>this.referenceDelegate.Ks(r).next(()=>i)).toPromise().then(i=>(r.raiseOnCommittedEvent(),i))}Gs(e,t){return P.or(Object.values(this.$s).map(s=>()=>s.containsKey(e,t)))}}class Jg extends _m{constructor(e){super(),this.currentSequenceNumber=e}}class qi{constructor(e){this.persistence=e,this.Qs=new Ia,this.js=null}static zs(e){return new qi(e)}get Ws(){if(this.js)return this.js;throw ve()}addReference(e,t,s){return this.Qs.addReference(s,t),this.Ws.delete(s.toString()),P.resolve()}removeReference(e,t,s){return this.Qs.removeReference(s,t),this.Ws.add(s.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),P.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach(r=>this.Ws.add(r.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(i=>this.Ws.add(i.toString()))}).next(()=>s.removeTargetData(e,t))}Us(){this.js=new Set}Ks(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.Ws,s=>{const r=fe.fromPath(s);return this.Hs(e,r).next(i=>{i||t.removeEntry(r,Se.min())})}).next(()=>(this.js=null,t.apply(e)))}updateLimboDocument(e,t){return this.Hs(e,t).next(s=>{s?this.Ws.delete(t.toString()):this.Ws.add(t.toString())})}Ls(e){return 0}Hs(e,t){return P.or([()=>P.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class Aa{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Fi=s,this.Bi=r}static Li(e,t){let s=Re(),r=Re();for(const i of t.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Aa(e,t.fromCache,s,r)}}class nd{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,s,r){return this.Ki(e,t).next(i=>i||this.Gi(e,t,r,s)).next(i=>i||this.Qi(e,t))}Ki(e,t){if(zu(t))return P.resolve(null);let s=Ut(t);return this.indexManager.getIndexType(e,s).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=Di(t,null,"F"),s=Ut(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next(i=>{const o=Re(...i);return this.Ui.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,s).next(l=>{const c=this.ji(t,a);return this.zi(t,c,o,l.readTime)?this.Ki(e,Di(t,null,"F")):this.Wi(e,c,t,l)}))})))}Gi(e,t,s,r){return zu(t)||r.isEqual(Se.min())?this.Qi(e,t):this.Ui.getDocuments(e,s).next(i=>{const o=this.ji(t,i);return this.zi(t,o,s,r)?this.Qi(e,t):(zo()<=d.in.DEBUG&&re("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),sa(t)),this.Wi(e,o,t,function au(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=Se.fromTimestamp(1e9===s?new ct(t+1,0):new ct(t,s));return new Qt(r,fe.empty(),e)}(r,-1)))})}ji(e,t){let s=new nt(Zu(e));return t.forEach((r,i)=>{vr(e,i)&&(s=s.add(i))}),s}zi(e,t,s,r){if(null===e.limit)return!1;if(s.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Qi(e,t){return zo()<=d.in.DEBUG&&re("QueryEngine","Using full collection scan to execute query:",sa(t)),this.Ui.getDocumentsMatchingQuery(e,t,Qt.min())}Wi(e,t,s,r){return this.Ui.getDocumentsMatchingQuery(e,s,r).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}class Hg{constructor(e,t,s,r){this.persistence=e,this.Hi=t,this.serializer=r,this.Ji=new He(Me),this.Yi=new fn(i=>Vn(i),_r),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(s)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ed(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ji))}}function rd(n,e){return Da.apply(this,arguments)}function Da(){return Da=(0,D.Z)(function*(n,e){const t=me(n);return yield t.persistence.runTransaction("Handle user change","readonly",s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next(i=>(r=i,t.tr(e),t.mutationQueue.getAllMutationBatches(s))).next(i=>{const o=[],a=[];let l=Re();for(const c of r){o.push(c.batchId);for(const f of c.mutations)l=l.add(f.key)}for(const c of i){a.push(c.batchId);for(const f of c.mutations)l=l.add(f.key)}return t.localDocuments.getDocuments(s,l).next(c=>({er:c,removedBatchIds:o,addedBatchIds:a}))})})}),Da.apply(this,arguments)}function id(n){const e=me(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Bs.getLastRemoteSnapshotVersion(t))}function tp(n,e){const t=me(n);return t.persistence.runTransaction("Get next mutation batch","readonly",s=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function Cs(n,e,t){return ka.apply(this,arguments)}function ka(){return ka=(0,D.Z)(function*(n,e,t){const s=me(n),r=s.Ji.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield s.persistence.runTransaction("Release target",i,o=>s.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!wn(o))throw o;re("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}s.Ji=s.Ji.remove(e),s.Yi.delete(r.target)}),ka.apply(this,arguments)}function Qi(n,e,t){const s=me(n);let r=Se.min(),i=Re();return s.persistence.runTransaction("Execute query","readonly",o=>function(a,l,c){const f=me(a),p=f.Yi.get(c);return void 0!==p?P.resolve(f.Ji.get(p)):f.Bs.getTargetData(l,c)}(s,o,Ut(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,s.Bs.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>s.Hi.getDocumentsMatchingQuery(o,e,t?r:Se.min(),t?i:Re())).next(a=>(function cd(n,e,t){let s=n.Xi.get(e)||Se.min();t.forEach((r,i)=>{i.readTime.compareTo(s)>0&&(s=i.readTime)}),n.Xi.set(e,s)}(s,function qu(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}(e),a),{documents:a,ir:i})))}class Na{constructor(){this.activeTargetIds=function ra(){return ng}()}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class dd{constructor(){this.Hr=new Na,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,s){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new Na,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class rp{Yr(e){}shutdown(){}}class fd{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){re("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){re("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Wi=null;function Fa(){return null===Wi?Wi=268435456+Math.round(2147483648*Math.random()):Wi++,"0x"+Wi.toString(16)}const ip={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class op{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}const Lt="WebChannelConnection";class ap extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.mo=(e.ssl?"https":"http")+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,s,r,i){const o=Fa(),a=this.To(e,t);re("RestConnection",`Sending RPC '${e}' ${o}:`,a,s);const l={};return this.Eo(l,r,i),this.Ao(e,a,l,s).then(c=>(re("RestConnection",`Received RPC '${e}' ${o}: `,c),c),c=>{throw Ht("RestConnection",`RPC '${e}' ${o} failed with error: `,c,"url: ",a,"request:",s),c})}vo(e,t,s,r,i,o){return this.Io(e,t,s,r,i)}Eo(e,t,s){e["X-Goog-Api-Client"]="gl-js/ fire/"+hs,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,i)=>e[i]=r),s&&s.headers.forEach((r,i)=>e[i]=r)}To(e,t){return`${this.mo}/v1/${t}:${ip[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,s,r){const i=Fa();return new Promise((o,a)=>{const l=new im;l.setWithCredentials(!0),l.listenOnce(nm.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case jo.NO_ERROR:const f=l.getResponseJson();re(Lt,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(f)),o(f);break;case jo.TIMEOUT:re(Lt,`RPC '${e}' ${i} timed out`),a(new X(L.DEADLINE_EXCEEDED,"Request time out"));break;case jo.HTTP_ERROR:const p=l.getStatus();if(re(Lt,`RPC '${e}' ${i} failed with status:`,p,"response text:",l.getResponseText()),p>0){let C=l.getResponseJson();Array.isArray(C)&&(C=C[0]);const z=C?.error;if(z&&z.status&&z.message){const ae=function(ge){const ye=ge.toLowerCase().replace(/_/g,"-");return Object.values(L).indexOf(ye)>=0?ye:L.UNKNOWN}(z.status);a(new X(ae,z.message))}else a(new X(L.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new X(L.UNAVAILABLE,"Connection failed."));break;default:ve()}}finally{re(Lt,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(r);re(Lt,`RPC '${e}' ${i} sending request:`,r),l.send(t,"POST",c,s,15)})}Ro(e,t,s){const r=Fa(),i=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=em(),a=tm(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.xmlHttpFactory=new rm({})),this.Eo(l.initMessageHeaders,t,s),l.encodeInitMessageHeaders=!0;const f=i.join("");re(Lt,`Creating RPC '${e}' stream ${r}: ${f}`,l);const p=o.createWebChannel(f,l);let C=!1,z=!1;const ae=new op({ro:ye=>{z?re(Lt,`Not sending because RPC '${e}' stream ${r} is closed:`,ye):(C||(re(Lt,`Opening RPC '${e}' stream ${r} transport.`),p.open(),C=!0),re(Lt,`RPC '${e}' stream ${r} sending:`,ye),p.send(ye))},oo:()=>p.close()}),ge=(ye,Ne,Ge)=>{ye.listen(Ne,Fe=>{try{Ge(Fe)}catch(St){setTimeout(()=>{throw St},0)}})};return ge(p,gi.EventType.OPEN,()=>{z||re(Lt,`RPC '${e}' stream ${r} transport opened.`)}),ge(p,gi.EventType.CLOSE,()=>{z||(z=!0,re(Lt,`RPC '${e}' stream ${r} transport closed`),ae.wo())}),ge(p,gi.EventType.ERROR,ye=>{z||(z=!0,Ht(Lt,`RPC '${e}' stream ${r} transport errored:`,ye),ae.wo(new X(L.UNAVAILABLE,"The operation could not be completed")))}),ge(p,gi.EventType.MESSAGE,ye=>{var Ne;if(!z){const Ge=ye.data[0];Te(!!Ge);const St=Ge.error||(null===(Ne=Ge[0])||void 0===Ne?void 0:Ne.error);if(St){re(Lt,`RPC '${e}' stream ${r} received error:`,St);const xt=St.status;let it=function(ns){const Tf=vt[ns];if(void 0!==Tf)return lh(Tf)}(xt),qt=St.message;void 0===it&&(it=L.INTERNAL,qt="Unknown error status: "+xt+" with message "+St.message),z=!0,ae.wo(new X(it,qt)),p.close()}else re(Lt,`RPC '${e}' stream ${r} received:`,Ge),ae._o(Ge)}}),ge(a,sm.STAT_EVENT,ye=>{ye.stat===tu.PROXY?re(Lt,`RPC '${e}' stream ${r} detected buffering proxy`):ye.stat===tu.NOPROXY&&re(Lt,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{ae.fo()},0),ae}}function Ji(){return typeof document<"u"?document:null}function Br(n){return new pg(n,!0)}class Ba{constructor(e,t,s=1e3,r=1.5,i=6e4){this.ii=e,this.timerId=t,this.Po=s,this.bo=r,this.Vo=i,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const t=Math.floor(this.So+this.ko()),s=Math.max(0,Date.now()-this.Co),r=Math.max(0,t-s);r>0&&re("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.So} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,r,()=>(this.Co=Date.now(),e())),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class gd{constructor(e,t,s,r,i,o,a,l){this.ii=e,this.$o=s,this.Oo=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new Ba(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}stop(){var e=this;return(0,D.Z)(function*(){e.Uo()&&(yield e.close(0))})()}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,()=>this.zo()))}Wo(e){this.Ho(),this.stream.send(e)}zo(){var e=this;return(0,D.Z)(function*(){if(e.Ko())return e.close(0)})()}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}close(e,t){var s=this;return(0,D.Z)(function*(){s.Ho(),s.Jo(),s.qo.cancel(),s.Fo++,4!==e?s.qo.reset():t&&t.code===L.RESOURCE_EXHAUSTED?(gt(t.toString()),gt("Using maximum backoff delay to prevent overloading the backend."),s.qo.xo()):t&&t.code===L.UNAUTHENTICATED&&3!==s.state&&(s.authCredentialsProvider.invalidateToken(),s.appCheckCredentialsProvider.invalidateToken()),null!==s.stream&&(s.Yo(),s.stream.close(),s.stream=null),s.state=e,yield s.listener.ao(t)})()}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,r])=>{this.Fo===t&&this.Zo(s,r)},s=>{e(()=>{const r=new X(L.UNKNOWN,"Fetching auth token failed: "+s.message);return this.tu(r)})})}Zo(e,t){const s=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo(()=>{s(()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,()=>(this.Ko()&&(this.state=3),Promise.resolve())),this.listener.uo()))}),this.stream.ao(r=>{s(()=>this.tu(r))}),this.stream.onMessage(r=>{s(()=>this.onMessage(r))})}Go(){var e=this;this.state=5,this.qo.No((0,D.Z)(function*(){e.state=0,e.start()}))}tu(e){return re("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget(()=>this.Fo===e?t():(re("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class lp extends gd{constructor(e,t,s,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();const t=function vg(n,e){let t;if("targetChange"in e){const s="NO_CHANGE"===(l=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===l?1:"REMOVE"===l?2:"CURRENT"===l?3:"RESET"===l?4:ve(),r=e.targetChange.targetIds||[],i=function(l,c){return l.useProto3Json?(Te(void 0===c||"string"==typeof c),It.fromBase64String(c||"")):(Te(void 0===c||c instanceof Uint8Array),It.fromUint8Array(c||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){const c=void 0===l.code?L.UNKNOWN:lh(l.code);return new X(c,l.message||"")}(o);t=new fh(s,r,i,a||null)}else if("documentChange"in e){const s=e.documentChange,r=on(n,s.document.name),i=_t(s.document.updateTime),o=s.document.createTime?_t(s.document.createTime):Se.min(),a=new Mt({mapValue:{fields:s.document.fields}}),l=st.newFoundDocument(r,i,o,a);t=new Ri(s.targetIds||[],s.removedTargetIds||[],l.key,l)}else if("documentDelete"in e){const s=e.documentDelete,r=on(n,s.document),i=s.readTime?_t(s.readTime):Se.min(),o=st.newNoDocument(r,i);t=new Ri([],s.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const s=e.documentRemove,r=on(n,s.document);t=new Ri([],s.removedTargetIds||[],r,null)}else{if(!("filter"in e))return ve();{const s=e.filter,{count:r=0,unchangedNames:i}=s,o=new ug(r,i);t=new dh(s.targetId,o)}}var l;return t}(this.serializer,e),s=function(r){if(!("targetChange"in r))return Se.min();const i=r.targetChange;return i.targetIds&&i.targetIds.length?Se.min():i.readTime?_t(i.readTime):Se.min()}(e);return this.listener.nu(t,s)}su(e){const t={};t.database=Ar(this.serializer),t.addTarget=function(r,i){let o;const a=i.target;if(o=bi(a)?{documents:Ih(r,a)}:{query:ga(r,a)},o.targetId=i.targetId,i.resumeToken.approximateByteSize()>0){o.resumeToken=_h(r,i.resumeToken);const l=ha(r,i.expectedCount);null!==l&&(o.expectedCount=l)}else if(i.snapshotVersion.compareTo(Se.min())>0){o.readTime=Ts(r,i.snapshotVersion.toTimestamp());const l=ha(r,i.expectedCount);null!==l&&(o.expectedCount=l)}return o}(this.serializer,e);const s=function xg(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ve()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);s&&(t.labels=s),this.Wo(t)}iu(e){const t={};t.database=Ar(this.serializer),t.removeTarget=e,this.Wo(t)}}class cp extends gd{constructor(e,t,s,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){if(Te(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();const t=function wg(n,e){return n&&n.length>0?(Te(void 0!==e),n.map(t=>function(s,r){let i=_t(s.updateTime?s.updateTime:r);return i.isEqual(Se.min())&&(i=_t(r)),new og(i,s.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),s=_t(e.commitTime);return this.listener.cu(s,t)}return Te(!e.writeResults||0===e.writeResults.length),this.ru=!0,this.listener.au()}hu(){const e={};e.database=Ar(this.serializer),this.Wo(e)}uu(e){const t={streamToken:this.lastStreamToken,writes:e.map(s=>function Dr(n,e){let t;if(e instanceof ws)t={update:xh(n,e.key,e.value)};else if(e instanceof xs)t={delete:Cr(n,e.key)};else if(e instanceof mn)t={update:xh(n,e.key,e.data),updateMask:Sg(e.fieldMask)};else{if(!(e instanceof ia))return ve();t={verify:Cr(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(s=>function(r,i){const o=i.transform;if(o instanceof ys)return{fieldPath:i.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Zn)return{fieldPath:i.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Gn)return{fieldPath:i.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof vs)return{fieldPath:i.field.canonicalString(),increment:o.gt};throw ve()}(0,s))),e.precondition.isNone||(t.currentDocument=void 0!==(r=e.precondition).updateTime?{updateTime:_g(n,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:ve()),t;var r}(this.serializer,s))};this.Wo(t)}}class up extends class{}{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.lu=!1}fu(){if(this.lu)throw new X(L.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,s){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.connection.Io(e,t,s,r,i)).catch(r=>{throw"FirebaseError"===r.name?(r.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new X(L.UNKNOWN,r.toString())})}vo(e,t,s,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.vo(e,t,s,i,o,r)).catch(i=>{throw"FirebaseError"===i.name?(i.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new X(L.UNKNOWN,i.toString())})}terminate(){this.lu=!0}}class dp{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve())))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(gt(t),this.mu=!1):re("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class fp{constructor(e,t,s,r,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=i,this.Pu.Yr(a=>{s.enqueueAndForget((0,D.Z)(function*(){var l;On(o)&&(re("RemoteStore","Restarting streams for network reachability change."),yield(l=(0,D.Z)(function*(c){const f=me(c);f.vu.add(4),yield As(f),f.bu.set("Unknown"),f.vu.delete(4),yield Ur(f)}),function(c){return l.apply(this,arguments)})(o))}))}),this.bu=new dp(s,r)}}function Ur(n){return ja.apply(this,arguments)}function ja(){return ja=(0,D.Z)(function*(n){if(On(n))for(const e of n.Ru)yield e(!0)}),ja.apply(this,arguments)}function As(n){return za.apply(this,arguments)}function za(){return za=(0,D.Z)(function*(n){for(const e of n.Ru)yield e(!1)}),za.apply(this,arguments)}function Yi(n,e){const t=me(n);t.Au.has(e.targetId)||(t.Au.set(e.targetId,e),Za(t)?qa(t):ks(t).Ko()&&Va(t,e))}function jr(n,e){const t=me(n),s=ks(t);t.Au.delete(e),s.Ko()&&pd(t,e),0===t.Au.size&&(s.Ko()?s.jo():On(t)&&t.bu.set("Unknown"))}function Va(n,e){if(n.Vu.qt(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Se.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ks(n).su(e)}function pd(n,e){n.Vu.qt(e),ks(n).iu(e)}function qa(n){n.Vu=new dg({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),le:e=>n.Au.get(e)||null,ue:()=>n.datastore.serializer.databaseId}),ks(n).start(),n.bu.gu()}function Za(n){return On(n)&&!ks(n).Uo()&&n.Au.size>0}function On(n){return 0===me(n).vu.size}function _d(n){n.Vu=void 0}function mp(n){return Ga.apply(this,arguments)}function Ga(){return Ga=(0,D.Z)(function*(n){n.Au.forEach((e,t)=>{Va(n,e)})}),Ga.apply(this,arguments)}function gp(n,e){return Qa.apply(this,arguments)}function Qa(){return Qa=(0,D.Z)(function*(n,e){_d(n),Za(n)?(n.bu.Iu(e),qa(n)):n.bu.set("Unknown")}),Qa.apply(this,arguments)}function pp(n,e,t){return Ka.apply(this,arguments)}function Ka(){return Ka=(0,D.Z)(function*(n,e,t){if(n.bu.set("Online"),e instanceof fh&&2===e.state&&e.cause)try{yield(s=(0,D.Z)(function*(r,i){const o=i.cause;for(const a of i.targetIds)r.Au.has(a)&&(yield r.remoteSyncer.rejectListen(a,o),r.Au.delete(a),r.Vu.removeTarget(a))}),function(r,i){return s.apply(this,arguments)})(n,e)}catch(s){re("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),s),yield Hi(n,s)}else if(e instanceof Ri?n.Vu.Ht(e):e instanceof dh?n.Vu.ne(e):n.Vu.Xt(e),!t.isEqual(Se.min()))try{const s=yield id(n.localStore);t.compareTo(s)>=0&&(yield function(r,i){const o=r.Vu.ce(i);return o.targetChanges.forEach((a,l)=>{if(a.resumeToken.approximateByteSize()>0){const c=r.Au.get(l);c&&r.Au.set(l,c.withResumeToken(a.resumeToken,i))}}),o.targetMismatches.forEach((a,l)=>{const c=r.Au.get(a);if(!c)return;r.Au.set(a,c.withResumeToken(It.EMPTY_BYTE_STRING,c.snapshotVersion)),pd(r,a);const f=new gn(c.target,a,l,c.sequenceNumber);Va(r,f)}),r.remoteSyncer.applyRemoteEvent(o)}(n,t))}catch(s){re("RemoteStore","Failed to raise snapshot:",s),yield Hi(n,s)}var s}),Ka.apply(this,arguments)}function Hi(n,e,t){return $a.apply(this,arguments)}function $a(){return $a=(0,D.Z)(function*(n,e,t){if(!wn(e))throw e;n.vu.add(1),yield As(n),n.bu.set("Offline"),t||(t=()=>id(n.localStore)),n.asyncQueue.enqueueRetryable((0,D.Z)(function*(){re("RemoteStore","Retrying IndexedDB access"),yield t(),n.vu.delete(1),yield Ur(n)}))}),$a.apply(this,arguments)}function yd(n,e){return e().catch(t=>Hi(n,t,e))}function Ds(n){return Wa.apply(this,arguments)}function Wa(){return Wa=(0,D.Z)(function*(n){const e=me(n),t=Mn(e);let s=e.Eu.length>0?e.Eu[e.Eu.length-1].batchId:-1;for(;_p(e);)try{const r=yield tp(e.localStore,s);if(null===r){0===e.Eu.length&&t.jo();break}s=r.batchId,yp(e,r)}catch(r){yield Hi(e,r)}vd(e)&&wd(e)}),Wa.apply(this,arguments)}function _p(n){return On(n)&&n.Eu.length<10}function yp(n,e){n.Eu.push(e);const t=Mn(n);t.Ko()&&t.ou&&t.uu(e.mutations)}function vd(n){return On(n)&&!Mn(n).Uo()&&n.Eu.length>0}function wd(n){Mn(n).start()}function vp(n){return Ja.apply(this,arguments)}function Ja(){return Ja=(0,D.Z)(function*(n){Mn(n).hu()}),Ja.apply(this,arguments)}function wp(n){return Ya.apply(this,arguments)}function Ya(){return Ya=(0,D.Z)(function*(n){const e=Mn(n);for(const t of n.Eu)e.uu(t.mutations)}),Ya.apply(this,arguments)}function xp(n,e,t){return Ha.apply(this,arguments)}function Ha(){return Ha=(0,D.Z)(function*(n,e,t){const s=n.Eu.shift(),r=aa.from(s,e,t);yield yd(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield Ds(n)}),Ha.apply(this,arguments)}function Tp(n,e){return Xa.apply(this,arguments)}function Xa(){return Xa=(0,D.Z)(function*(n,e){var t;e&&Mn(n).ou&&(yield(t=(0,D.Z)(function*(s,r){if(function ah(n){switch(n){default:return ve();case L.CANCELLED:case L.UNKNOWN:case L.DEADLINE_EXCEEDED:case L.RESOURCE_EXHAUSTED:case L.INTERNAL:case L.UNAVAILABLE:case L.UNAUTHENTICATED:return!1;case L.INVALID_ARGUMENT:case L.NOT_FOUND:case L.ALREADY_EXISTS:case L.PERMISSION_DENIED:case L.FAILED_PRECONDITION:case L.ABORTED:case L.OUT_OF_RANGE:case L.UNIMPLEMENTED:case L.DATA_LOSS:return!0}}(i=r.code)&&i!==L.ABORTED){const o=s.Eu.shift();Mn(s).Qo(),yield yd(s,()=>s.remoteSyncer.rejectFailedWrite(o.batchId,r)),yield Ds(s)}var i}),function(s,r){return t.apply(this,arguments)})(n,e)),vd(n)&&wd(n)}),Xa.apply(this,arguments)}function xd(n,e){return el.apply(this,arguments)}function el(){return el=(0,D.Z)(function*(n,e){const t=me(n);t.asyncQueue.verifyOperationInProgress(),re("RemoteStore","RemoteStore received new credentials");const s=On(t);t.vu.add(3),yield As(t),s&&t.bu.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.vu.delete(3),yield Ur(t)}),el.apply(this,arguments)}function nl(){return nl=(0,D.Z)(function*(n,e){const t=me(n);e?(t.vu.delete(2),yield Ur(t)):e||(t.vu.add(2),yield As(t),t.bu.set("Unknown"))}),nl.apply(this,arguments)}function ks(n){return n.Su||(n.Su=function(e,t,s){const r=me(e);return r.fu(),new lp(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)}(n.datastore,n.asyncQueue,{uo:mp.bind(null,n),ao:gp.bind(null,n),nu:pp.bind(null,n)}),n.Ru.push(function(){var e=(0,D.Z)(function*(t){t?(n.Su.Qo(),Za(n)?qa(n):n.bu.set("Unknown")):(yield n.Su.stop(),_d(n))});return function(t){return e.apply(this,arguments)}}())),n.Su}function Mn(n){return n.Du||(n.Du=function(e,t,s){const r=me(e);return r.fu(),new cp(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)}(n.datastore,n.asyncQueue,{uo:vp.bind(null,n),ao:Tp.bind(null,n),au:wp.bind(null,n),cu:xp.bind(null,n)}),n.Ru.push(function(){var e=(0,D.Z)(function*(t){t?(n.Du.Qo(),yield Ds(n)):(yield n.Du.stop(),n.Eu.length>0&&(re("RemoteStore",`Stopping write stream with ${n.Eu.length} pending writes`),n.Eu=[]))});return function(t){return e.apply(this,arguments)}}())),n.Du}class sl{constructor(e,t,s,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new Tt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,s,r,i){const o=Date.now()+s,a=new sl(e,t,o,r,i);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new X(L.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Os(n,e){if(gt("AsyncQueue",`${e}: ${n}`),wn(n))return new X(L.UNAVAILABLE,`${e}: ${n}`);throw n}class Ms{constructor(e){this.comparator=e?(t,s)=>e(t,s)||fe.comparator(t.key,s.key):(t,s)=>fe.comparator(t.key,s.key),this.keyedMap=wr(),this.sortedSet=new He(this.comparator)}static emptySet(e){return new Ms(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,s)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ms)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const s=new Ms;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}class Td{constructor(){this.Cu=new He(fe.comparator)}track(e){const t=e.doc.key,s=this.Cu.get(t);s?0!==e.type&&3===s.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==s.type?this.Cu=this.Cu.insert(t,{type:s.type,doc:e.doc}):2===e.type&&2===s.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===s.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===s.type?this.Cu=this.Cu.remove(t):1===e.type&&2===s.type?this.Cu=this.Cu.insert(t,{type:1,doc:s.doc}):0===e.type&&1===s.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):ve():this.Cu=this.Cu.insert(t,e)}xu(){const e=[];return this.Cu.inorderTraversal((t,s)=>{e.push(s)}),e}}class Ps{constructor(e,t,s,r,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,s,r,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Ps(e,t,Ms.emptySet(t),o,s,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&yr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}class Ip{constructor(){this.Nu=void 0,this.listeners=[]}}class Ep{constructor(){this.queries=new fn(e=>Vu(e),yr),this.onlineState="Unknown",this.ku=new Set}}function rl(n,e){return il.apply(this,arguments)}function il(){return il=(0,D.Z)(function*(n,e){const t=me(n),s=e.query;let r=!1,i=t.queries.get(s);if(i||(r=!0,i=new Ip),r)try{i.Nu=yield t.onListen(s)}catch(o){const a=Os(o,`Initialization of query '${sa(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.listeners.push(e),e.Mu(t.onlineState),i.Nu&&e.$u(i.Nu)&&ll(t)}),il.apply(this,arguments)}function ol(n,e){return al.apply(this,arguments)}function al(){return al=(0,D.Z)(function*(n,e){const t=me(n),s=e.query;let r=!1;const i=t.queries.get(s);if(i){const o=i.listeners.indexOf(e);o>=0&&(i.listeners.splice(o,1),r=0===i.listeners.length)}if(r)return t.queries.delete(s),t.onUnlisten(s)}),al.apply(this,arguments)}function Sp(n,e){const t=me(n);let s=!1;for(const r of e){const o=t.queries.get(r.query);if(o){for(const a of o.listeners)a.$u(r)&&(s=!0);o.Nu=r}}s&&ll(t)}function bp(n,e,t){const s=me(n),r=s.queries.get(e);if(r)for(const i of r.listeners)i.onError(t);s.queries.delete(e)}function ll(n){n.ku.forEach(e=>{e.next()})}class cl{constructor(e,t,s){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=s||{}}$u(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)3!==r.type&&s.push(r);e=new Ps(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){return!e.fromCache||(!this.options.Ku||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}Uu(e){e=Ps.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class Sd{constructor(e){this.key=e}}class bd{constructor(e){this.key=e}}class Cd{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=Re(),this.mutatedKeys=Re(),this.tc=Zu(e),this.ec=new Ms(this.tc)}get nc(){return this.Yu}sc(e,t){const s=t?t.ic:new Td,r=t?t.ec:this.ec;let i=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1;const l="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((f,p)=>{const C=r.get(f),z=vr(this.query,p)?p:null,ae=!!C&&this.mutatedKeys.has(C.key),ge=!!z&&(z.hasLocalMutations||this.mutatedKeys.has(z.key)&&z.hasCommittedMutations);let ye=!1;C&&z?C.data.isEqual(z.data)?ae!==ge&&(s.track({type:3,doc:z}),ye=!0):this.rc(C,z)||(s.track({type:2,doc:z}),ye=!0,(l&&this.tc(z,l)>0||c&&this.tc(z,c)<0)&&(a=!0)):!C&&z?(s.track({type:0,doc:z}),ye=!0):C&&!z&&(s.track({type:1,doc:C}),ye=!0,(l||c)&&(a=!0)),ye&&(z?(o=o.add(z),i=ge?i.add(f):i.delete(f)):(o=o.delete(f),i=i.delete(f)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const f="F"===this.query.limitType?o.last():o.first();o=o.delete(f.key),i=i.delete(f.key),s.track({type:1,doc:f})}return{ec:o,ic:s,zi:a,mutatedKeys:i}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s){const r=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const i=e.ic.xu();i.sort((c,f)=>function(p,C){const z=ae=>{switch(ae){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ve()}};return z(p)-z(C)}(c.type,f.type)||this.tc(c.doc,f.doc)),this.oc(s);const o=t?this.uc():[],a=0===this.Zu.size&&this.current?1:0,l=a!==this.Xu;return this.Xu=a,0!==i.length||l?{snapshot:new Ps(this.query,e.ec,r,i,e.mutatedKeys,0===a,l,!1,!!s&&s.resumeToken.approximateByteSize()>0),cc:o}:{cc:o}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new Td,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach(t=>this.Yu=this.Yu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Yu=this.Yu.delete(t)),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=Re(),this.ec.forEach(s=>{this.ac(s.key)&&(this.Zu=this.Zu.add(s.key))});const t=[];return e.forEach(s=>{this.Zu.has(s)||t.push(new bd(s))}),this.Zu.forEach(s=>{e.has(s)||t.push(new Sd(s))}),t}hc(e){this.Yu=e.ir,this.Zu=Re();const t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return Ps.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class Dp{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class kp{constructor(e){this.key=e,this.fc=!1}}class Op{constructor(e,t,s,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.dc={},this.wc=new fn(a=>Vu(a),yr),this._c=new Map,this.mc=new Set,this.gc=new He(fe.comparator),this.yc=new Map,this.Ic=new Ia,this.Tc={},this.Ec=new Map,this.Ac=Yn.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}function Mp(n,e){return ul.apply(this,arguments)}function ul(){return ul=(0,D.Z)(function*(n,e){const t=function Pl(n){const e=me(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ad.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=zp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Np.bind(null,e),e.dc.nu=Sp.bind(null,e.eventManager),e.dc.Pc=bp.bind(null,e.eventManager),e}(n);let s,r;const i=t.wc.get(e);if(i)s=i.targetId,t.sharedClientState.addLocalQueryTarget(s),r=i.view.lc();else{const o=yield function bs(n,e){const t=me(n);return t.persistence.runTransaction("Allocate target","readwrite",s=>{let r;return t.Bs.getTargetData(s,e).next(i=>i?(r=i,P.resolve(r)):t.Bs.allocateTargetId(s).next(o=>(r=new gn(e,o,"TargetPurposeListen",s.currentSequenceNumber),t.Bs.addTargetData(s,r).next(()=>r))))}).then(s=>{const r=t.Ji.get(s.targetId);return(null===r||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ji=t.Ji.insert(s.targetId,s),t.Yi.set(e,s.targetId)),s})}(t.localStore,Ut(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);s=o.targetId,r=yield function hl(n,e,t,s,r){return dl.apply(this,arguments)}(t,e,s,"current"===a,o.resumeToken),t.isPrimaryClient&&Yi(t.remoteStore,o)}return r}),ul.apply(this,arguments)}function dl(){return dl=(0,D.Z)(function*(n,e,t,s,r){n.Rc=(p,C,z)=>{return(ae=(0,D.Z)(function*(ge,ye,Ne,Ge){let Fe=ye.view.sc(Ne);Fe.zi&&(Fe=yield Qi(ge.localStore,ye.query,!1).then(({documents:it})=>ye.view.sc(it,Fe)));const St=Ge&&Ge.targetChanges.get(ye.targetId),xt=ye.view.applyChanges(Fe,ge.isPrimaryClient,St);return Tl(ge,ye.targetId,xt.cc),xt.snapshot}),function(ge,ye,Ne,Ge){return ae.apply(this,arguments)})(n,p,C,z);var ae};const i=yield Qi(n.localStore,e,!0),o=new Cd(e,i.ir),a=o.sc(i.documents),l=br.createSynthesizedTargetChangeForCurrentChange(t,s&&"Offline"!==n.onlineState,r),c=o.applyChanges(a,n.isPrimaryClient,l);Tl(n,t,c.cc);const f=new Dp(e,t,o);return n.wc.set(e,f),n._c.has(t)?n._c.get(t).push(e):n._c.set(t,[e]),c.snapshot}),dl.apply(this,arguments)}function Pp(n,e){return fl.apply(this,arguments)}function fl(){return fl=(0,D.Z)(function*(n,e){const t=me(n),s=t.wc.get(e),r=t._c.get(s.targetId);if(r.length>1)return t._c.set(s.targetId,r.filter(i=>!yr(i,e))),void t.wc.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(s.targetId),t.sharedClientState.isActiveQueryTarget(s.targetId)||(yield Cs(t.localStore,s.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(s.targetId),jr(t.remoteStore,s.targetId),Rs(t,s.targetId)}).catch(vn))):(Rs(t,s.targetId),yield Cs(t.localStore,s.targetId,!0))}),fl.apply(this,arguments)}function ml(){return ml=(0,D.Z)(function*(n,e,t){const s=function Rl(n){const e=me(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Lp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Fp.bind(null,e),e}(n);try{const r=yield function(i,o){const a=me(i),l=ct.now(),c=o.reduce((C,z)=>C.add(z.key),Re());let f,p;return a.persistence.runTransaction("Locally write mutations","readwrite",C=>{let z=Vt(),ae=Re();return a.Zi.getEntries(C,c).next(ge=>{z=ge,z.forEach((ye,Ne)=>{Ne.isValidDocument()||(ae=ae.add(ye))})}).next(()=>a.localDocuments.getOverlayedDocuments(C,z)).next(ge=>{f=ge;const ye=[];for(const Ne of o){const Ge=lg(Ne,f.get(Ne.key).overlayedDocument);null!=Ge&&ye.push(new mn(Ne.key,Ge,Au(Ge.value.mapValue),ot.exists(!0)))}return a.mutationQueue.addMutationBatch(C,l,ye,o)}).next(ge=>{p=ge;const ye=ge.applyToLocalDocumentSet(f,ae);return a.documentOverlayCache.saveOverlays(C,ge.batchId,ye)})}).then(()=>({batchId:p.batchId,changes:Qu(f)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),function(i,o,a){let l=i.Tc[i.currentUser.toKey()];l||(l=new He(Me)),l=l.insert(o,a),i.Tc[i.currentUser.toKey()]=l}(s,r.batchId,t),yield pn(s,r.changes),yield Ds(s.remoteStore)}catch(r){const i=Os(r,"Failed to persist write");t.reject(i)}}),ml.apply(this,arguments)}function Ad(n,e){return gl.apply(this,arguments)}function gl(){return gl=(0,D.Z)(function*(n,e){const t=me(n);try{const s=yield function ep(n,e){const t=me(n),s=e.snapshotVersion;let r=t.Ji;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Zi.newChangeBuffer({trackRemovals:!0});r=t.Ji;const a=[];e.targetChanges.forEach((f,p)=>{const C=r.get(p);if(!C)return;a.push(t.Bs.removeMatchingKeys(i,f.removedDocuments,p).next(()=>t.Bs.addMatchingKeys(i,f.addedDocuments,p)));let z=C.withSequenceNumber(i.currentSequenceNumber);var ae,ge,ye;null!==e.targetMismatches.get(p)?z=z.withResumeToken(It.EMPTY_BYTE_STRING,Se.min()).withLastLimboFreeSnapshotVersion(Se.min()):f.resumeToken.approximateByteSize()>0&&(z=z.withResumeToken(f.resumeToken,s)),r=r.insert(p,z),ge=z,ye=f,(0===(ae=C).resumeToken.approximateByteSize()||ge.snapshotVersion.toMicroseconds()-ae.snapshotVersion.toMicroseconds()>=3e8||ye.addedDocuments.size+ye.modifiedDocuments.size+ye.removedDocuments.size>0)&&a.push(t.Bs.updateTargetData(i,z))});let l=Vt(),c=Re();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,f))}),a.push(function od(n,e,t){let s=Re(),r=Re();return t.forEach(i=>s=s.add(i)),e.getEntries(n,s).next(i=>{let o=Vt();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(r=r.add(a)),l.isNoDocument()&&l.version.isEqual(Se.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||0===l.version.compareTo(c.version)&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):re("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{nr:o,sr:r}})}(i,o,e.documentUpdates).next(f=>{l=f.nr,c=f.sr})),!s.isEqual(Se.min())){const f=t.Bs.getLastRemoteSnapshotVersion(i).next(p=>t.Bs.setTargetsMetadata(i,i.currentSequenceNumber,s));a.push(f)}return P.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.Ji=r,i))}(t.localStore,e);e.targetChanges.forEach((r,i)=>{const o=t.yc.get(i);o&&(Te(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.fc=!0:r.modifiedDocuments.size>0?Te(o.fc):r.removedDocuments.size>0&&(Te(o.fc),o.fc=!1))}),yield pn(t,s,e)}catch(s){yield vn(s)}}),gl.apply(this,arguments)}function Dd(n,e,t){const s=me(n);if(s.isPrimaryClient&&0===t||!s.isPrimaryClient&&1===t){const r=[];s.wc.forEach((i,o)=>{const a=o.view.Mu(e);a.snapshot&&r.push(a.snapshot)}),function(i,o){const a=me(i);a.onlineState=o;let l=!1;a.queries.forEach((c,f)=>{for(const p of f.listeners)p.Mu(o)&&(l=!0)}),l&&ll(a)}(s.eventManager,e),r.length&&s.dc.nu(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}function Np(n,e,t){return pl.apply(this,arguments)}function pl(){return pl=(0,D.Z)(function*(n,e,t){const s=me(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.yc.get(e),i=r&&r.key;if(i){let o=new He(fe.comparator);o=o.insert(i,st.newNoDocument(i,Se.min()));const a=Re().add(i),l=new Sr(Se.min(),new Map,new He(Me),o,a);yield Ad(s,l),s.gc=s.gc.remove(i),s.yc.delete(e),Il(s)}else yield Cs(s.localStore,e,!1).then(()=>Rs(s,e,t)).catch(vn)}),pl.apply(this,arguments)}function Lp(n,e){return _l.apply(this,arguments)}function _l(){return _l=(0,D.Z)(function*(n,e){const t=me(n),s=e.batch.batchId;try{const r=yield function Xg(n,e){const t=me(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const r=e.batch.keys(),i=t.Zi.newChangeBuffer({trackRemovals:!0});return function(o,a,l,c){const f=l.batch,p=f.keys();let C=P.resolve();return p.forEach(z=>{C=C.next(()=>c.getEntry(a,z)).next(ae=>{const ge=l.docVersions.get(z);Te(null!==ge),ae.version.compareTo(ge)<0&&(f.applyToRemoteDocument(ae,l),ae.isValidDocument()&&(ae.setReadTime(l.commitVersion),c.addEntry(ae)))})}),C.next(()=>o.mutationQueue.removeMutationBatch(a,f))}(t,s,e,i).next(()=>i.apply(s)).next(()=>t.mutationQueue.performConsistencyCheck(s)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(o){let a=Re();for(let l=0;l<o.mutationResults.length;++l)o.mutationResults[l].transformResults.length>0&&(a=a.add(o.batch.mutations[l].key));return a}(e))).next(()=>t.localDocuments.getDocuments(s,r))})}(t.localStore,e);xl(t,s,null),wl(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),yield pn(t,r)}catch(r){yield vn(r)}}),_l.apply(this,arguments)}function Fp(n,e,t){return yl.apply(this,arguments)}function yl(){return yl=(0,D.Z)(function*(n,e,t){const s=me(n);try{const r=yield function(i,o){const a=me(i);return a.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let c;return a.mutationQueue.lookupMutationBatch(l,o).next(f=>(Te(null!==f),c=f.keys(),a.mutationQueue.removeMutationBatch(l,f))).next(()=>a.mutationQueue.performConsistencyCheck(l)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(l,c,o)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,c)).next(()=>a.localDocuments.getDocuments(l,c))})}(s.localStore,e);xl(s,e,t),wl(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),yield pn(s,r)}catch(r){yield vn(r)}}),yl.apply(this,arguments)}function wl(n,e){(n.Ec.get(e)||[]).forEach(t=>{t.resolve()}),n.Ec.delete(e)}function xl(n,e,t){const s=me(n);let r=s.Tc[s.currentUser.toKey()];if(r){const i=r.get(e);i&&(t?i.reject(t):i.resolve(),r=r.remove(e)),s.Tc[s.currentUser.toKey()]=r}}function Rs(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n._c.get(e))n.wc.delete(s),t&&n.dc.Pc(s,t);n._c.delete(e),n.isPrimaryClient&&n.Ic.Is(e).forEach(s=>{n.Ic.containsKey(s)||kd(n,s)})}function kd(n,e){n.mc.delete(e.path.canonicalString());const t=n.gc.get(e);null!==t&&(jr(n.remoteStore,t),n.gc=n.gc.remove(e),n.yc.delete(t),Il(n))}function Tl(n,e,t){for(const s of t)s instanceof Sd?(n.Ic.addReference(s.key,e),Up(n,s)):s instanceof bd?(re("SyncEngine","Document no longer in limbo: "+s.key),n.Ic.removeReference(s.key,e),n.Ic.containsKey(s.key)||kd(n,s.key)):ve()}function Up(n,e){const t=e.key,s=t.path.canonicalString();n.gc.get(t)||n.mc.has(s)||(re("SyncEngine","New document in limbo: "+t),n.mc.add(s),Il(n))}function Il(n){for(;n.mc.size>0&&n.gc.size<n.maxConcurrentLimboResolutions;){const e=n.mc.values().next().value;n.mc.delete(e);const t=new fe(qe.fromString(e)),s=n.Ac.next();n.yc.set(s,new kp(t)),n.gc=n.gc.insert(t,s),Yi(n.remoteStore,new gn(Ut(_s(t.path)),s,"TargetPurposeLimboResolution",Kt.ct))}}function pn(n,e,t){return El.apply(this,arguments)}function El(){return El=(0,D.Z)(function*(n,e,t){const s=me(n),r=[],i=[],o=[];var a;s.wc.isEmpty()||(s.wc.forEach((a,l)=>{o.push(s.Rc(l,e,t).then(c=>{if((c||t)&&s.isPrimaryClient&&s.sharedClientState.updateQueryState(l.targetId,c?.fromCache?"not-current":"current"),c){r.push(c);const f=Aa.Li(l.targetId,c);i.push(f)}}))}),yield Promise.all(o),s.dc.nu(r),yield(a=(0,D.Z)(function*(l,c){const f=me(l);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>P.forEach(c,C=>P.forEach(C.Fi,z=>f.persistence.referenceDelegate.addReference(p,C.targetId,z)).next(()=>P.forEach(C.Bi,z=>f.persistence.referenceDelegate.removeReference(p,C.targetId,z)))))}catch(p){if(!wn(p))throw p;re("LocalStore","Failed to update sequence numbers: "+p)}for(const p of c){const C=p.targetId;if(!p.fromCache){const z=f.Ji.get(C),ge=z.withLastLimboFreeSnapshotVersion(z.snapshotVersion);f.Ji=f.Ji.insert(C,ge)}}}),function(l,c){return a.apply(this,arguments)})(s.localStore,i))}),El.apply(this,arguments)}function jp(n,e){return Sl.apply(this,arguments)}function Sl(){return Sl=(0,D.Z)(function*(n,e){const t=me(n);if(!t.currentUser.isEqual(e)){re("SyncEngine","User change. New user:",e.toKey());const s=yield rd(t.localStore,e);t.currentUser=e,(r=t).Ec.forEach(o=>{o.forEach(a=>{a.reject(new X(L.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),r.Ec.clear(),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),yield pn(t,s.er)}var r}),Sl.apply(this,arguments)}function zp(n,e){const t=me(n),s=t.yc.get(e);if(s&&s.fc)return Re().add(s.key);{let r=Re();const i=t._c.get(e);if(!i)return r;for(const o of i){const a=t.wc.get(o);r=r.unionWith(a.view.nc)}return r}}class Xi{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,D.Z)(function*(){t.serializer=Br(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return function sd(n,e,t,s){return new Hg(n,e,t,s)}(this.persistence,new nd,e.initialUser,this.serializer)}createPersistence(e){return new Ea(qi.zs,this.serializer)}createSharedClientState(e){return new dd}terminate(){var e=this;return(0,D.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Ns{initialize(e,t){var s=this;return(0,D.Z)(function*(){s.localStore||(s.localStore=e.localStore,s.sharedClientState=e.sharedClientState,s.datastore=s.createDatastore(t),s.remoteStore=s.createRemoteStore(t),s.eventManager=s.createEventManager(t),s.syncEngine=s.createSyncEngine(t,!e.synchronizeTabs),s.sharedClientState.onlineStateHandler=r=>Dd(s.syncEngine,r,1),s.remoteStore.remoteSyncer.handleCredentialChange=jp.bind(null,s.syncEngine),yield function tl(n,e){return nl.apply(this,arguments)}(s.remoteStore,s.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Ep}createDatastore(e){const t=Br(e.databaseInfo.databaseId),s=new ap(e.databaseInfo);return new up(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return t=this.localStore,s=this.datastore,r=e.asyncQueue,i=a=>Dd(this.syncEngine,a,0),o=fd.D()?new fd:new rp,new fp(t,s,r,i,o);var t,s,r,i,o}createSyncEngine(e,t){return function(s,r,i,o,a,l,c){const f=new Op(s,r,i,o,a,l);return c&&(f.vc=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,D.Z)(function*(t){const s=me(t);re("RemoteStore","RemoteStore shutting down."),s.vu.add(5),yield As(s),s.Pu.shutdown(),s.bu.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}class eo{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):gt("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class e_{constructor(e,t,s,r){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=Ct.UNAUTHENTICATED,this.clientId=iu.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(s,function(){var o=(0,D.Z)(function*(a){re("FirestoreClient","Received user=",a.uid),yield i.authCredentialListener(a),i.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(s,o=>(re("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}getConfiguration(){var e=this;return(0,D.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new X(L.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Tt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,D.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(s){const r=Os(s,"Failed to shutdown persistence");t.reject(r)}})),t.promise}}function to(n,e){return Nl.apply(this,arguments)}function Nl(){return Nl=(0,D.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),re("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener(function(){var r=(0,D.Z)(function*(i){s.isEqual(i)||(yield rd(e.localStore,i),s=i)});return function(i){return r.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),Nl.apply(this,arguments)}function Ll(n,e){return Fl.apply(this,arguments)}function Fl(){return Fl=(0,D.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield function Bl(n){return Ul.apply(this,arguments)}(n);re("FirestoreClient","Initializing OnlineComponentProvider");const s=yield n.getConfiguration();yield e.initialize(t,s),n.setCredentialChangeListener(r=>xd(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>xd(e.remoteStore,i)),n._onlineComponents=e}),Fl.apply(this,arguments)}function Ul(){return Ul=(0,D.Z)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){re("FirestoreClient","Using user provided OfflineComponentProvider");try{yield to(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function Ld(n){return"FirebaseError"===n.name?n.code===L.FAILED_PRECONDITION||n.code===L.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}(t))throw t;Ht("Error using user provided cache. Falling back to memory cache: "+t),yield to(n,new Xi)}}else re("FirestoreClient","Using default OfflineComponentProvider"),yield to(n,new Xi);return n._offlineComponents}),Ul.apply(this,arguments)}function no(n){return jl.apply(this,arguments)}function jl(){return jl=(0,D.Z)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(re("FirestoreClient","Using user provided OnlineComponentProvider"),yield Ll(n,n._uninitializedComponentsProvider._online)):(re("FirestoreClient","Using default OnlineComponentProvider"),yield Ll(n,new Ns))),n._onlineComponents}),jl.apply(this,arguments)}function Ls(n){return Vl.apply(this,arguments)}function Vl(){return Vl=(0,D.Z)(function*(n){const e=yield no(n),t=e.eventManager;return t.onListen=Mp.bind(null,e.syncEngine),t.onUnlisten=Pp.bind(null,e.syncEngine),t}),Vl.apply(this,arguments)}function Vd(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const qd=new Map;function ql(n,e,t){if(!t)throw new X(L.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Zd(n){if(!fe.isDocumentKey(n))throw new X(L.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Gd(n){if(fe.isDocumentKey(n))throw new X(L.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ro(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":ve()}function ze(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new X(L.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ro(n);throw new X(L.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}class Kd{constructor(e){var t,s;if(void 0===e.host){if(void 0!==e.ssl)throw new X(L.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new X(L.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function c_(n,e,t,s){if(!0===e&&!0===s)throw new X(L.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=Vd(null!==(s=e.experimentalLongPollingOptions)&&void 0!==s?s:{}),function(r){if(void 0!==r.timeoutSeconds){if(isNaN(r.timeoutSeconds))throw new X(L.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new X(L.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new X(L.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class zr{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Kd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new X(L.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new X(L.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Kd(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new am;switch(t.type){case"firstParty":return new hm(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new X(L.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=qd.get(e);t&&(re("ComponentProvider","Removing Datastore"),qd.delete(e),t.terminate())}(this),Promise.resolve()}}class yt{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new an(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new yt(this.firestore,e,this._key)}}class Pt{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new Pt(this.firestore,e,this._query)}}class an extends Pt{constructor(e,t,s){super(e,t,_s(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new yt(this.firestore,null,new fe(e))}withConverter(e){return new an(this.firestore,e,this._path)}}function Vr(n,e,...t){if(n=(0,Q.m9)(n),ql("collection","path",e),n instanceof zr){const s=qe.fromString(e,...t);return Gd(s),new an(n,null,s)}{if(!(n instanceof yt||n instanceof an))throw new X(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(qe.fromString(e,...t));return Gd(s),new an(n.firestore,null,s)}}function Fs(n,e,...t){if(n=(0,Q.m9)(n),1===arguments.length&&(e=iu.A()),ql("doc","path",e),n instanceof zr){const s=qe.fromString(e,...t);return Zd(s),new yt(n,null,new fe(s))}{if(!(n instanceof yt||n instanceof an))throw new X(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(qe.fromString(e,...t));return Zd(s),new yt(n.firestore,n instanceof an?n.converter:null,new fe(s))}}class h_{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new Ba(this,"async_queue_retry"),this.Xc=()=>{const t=Ji();t&&re("AsyncQueue","Visibility state changed to "+t.visibilityState),this.qo.Mo()};const e=Ji();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const t=Ji();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise(()=>{});const t=new Tt;return this.ta(()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qc.push(e),this.ea()))}ea(){var e=this;return(0,D.Z)(function*(){if(0!==e.Qc.length){try{yield e.Qc[0](),e.Qc.shift(),e.qo.reset()}catch(t){if(!wn(t))throw t;re("AsyncQueue","Operation failed with retryable error: "+t)}e.Qc.length>0&&e.qo.No(()=>e.ea())}})()}ta(e){const t=this.Gc.then(()=>(this.Hc=!0,e().catch(s=>{throw this.Wc=s,this.Hc=!1,gt("INTERNAL UNHANDLED ERROR: ",function(i){let o=i.message||"";return i.stack&&(o=i.stack.includes(i.message)?i.stack:i.message+"\n"+i.stack),o}(s)),s}).then(s=>(this.Hc=!1,s))));return this.Gc=t,t}enqueueAfterDelay(e,t,s){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);const r=sl.createAndSchedule(this,e,t,s,i=>this.na(i));return this.zc.push(r),r}Zc(){this.Wc&&ve()}verifyOperationInProgress(){}sa(){var e=this;return(0,D.Z)(function*(){let t;do{t=e.Gc,yield t}while(t!==e.Gc)})()}ia(e){for(const t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then(()=>{this.zc.sort((t,s)=>t.targetTimeMs-s.targetTimeMs);for(const t of this.zc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()})}oa(e){this.Yc.push(e)}na(e){const t=this.zc.indexOf(e);this.zc.splice(t,1)}}function Zl(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const s=e;for(const r of["next","error","complete"])if(r in s&&"function"==typeof s[r])return!0;return!1}(n)}class rt extends zr{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new h_,this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Wd(this),this._firestoreClient.terminate()}}function Gl(n,e){const t="object"==typeof n?n:(0,_.getApp)(),s="string"==typeof n?n:e||"(default)",r=(0,_._getProvider)(t,"firestore").getImmediate({identifier:s});if(!r._initialized){const i=(0,Q.P0)("firestore");i&&function u_(n,e,t,s={}){var r;const i=(n=ze(n,zr))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==i.host&&i.host!==o&&Ht("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),s.mockUserToken){let a,l;if("string"==typeof s.mockUserToken)a=s.mockUserToken,l=Ct.MOCK_USER;else{a=(0,Q.Sg)(s.mockUserToken,null===(r=n._app)||void 0===r?void 0:r.options.projectId);const c=s.mockUserToken.sub||s.mockUserToken.user_id;if(!c)throw new X(L.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Ct(c)}n._authCredentials=new lm(new su(a,l))}}(r,...i)}return r}function wt(n){return n._firestoreClient||Wd(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Wd(n){var e,t,s;const r=n._freezeSettings(),i=(a=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new zm(n._databaseId,a,n._persistenceKey,(c=r).host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,Vd(c.experimentalLongPollingOptions),c.useFetchStreams));var a,c;n._firestoreClient=new e_(n._authCredentials,n._appCheckCredentials,n._queue,i),null!==(t=r.cache)&&void 0!==t&&t._offlineComponentProvider&&null!==(s=r.cache)&&void 0!==s&&s._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.cache.kind,_offline:r.cache._offlineComponentProvider,_online:r.cache._onlineComponentProvider})}class Xn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Xn(It.fromBase64String(e))}catch(t){throw new X(L.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Xn(It.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Bs{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new X(L.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new pt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Hd{constructor(e){this._methodName=e}}class Ql{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new X(L.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new X(L.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Me(this._lat,e._lat)||Me(this._long,e._long)}}const g_=/^__.*__$/;class p_{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return null!==this.fieldMask?new mn(e,this.data,this.fieldMask,t,this.fieldTransforms):new ws(e,this.data,t,this.fieldTransforms)}}function ef(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ve()}}class io{constructor(e,t,s,r,i,o){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,void 0===i&&this.ua(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new io(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;const s=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:s,la:!1});return r.fa(e),r}da(e){var t;const s=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:s,la:!1});return r.ua(),r}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return ao(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(ef(this.ca)&&g_.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class __{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||Br(e)}ya(e,t,s,r=!1){return new io({ca:e,methodName:t,ga:s,path:pt.emptyPath(),la:!1,ma:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Us(n){const e=n._freezeSettings(),t=Br(n._databaseId);return new __(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Kl(n,e,t,s,r,i={}){const o=n.ya(i.merge||i.mergeFields?2:0,e,t,r);Wl("Data must be an object, but it was:",o,s);const a=of(s,o);let l,c;if(i.merge)l=new zt(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const f=[];for(const p of i.mergeFields){const C=Gr(e,p,t);if(!o.contains(C))throw new X(L.INVALID_ARGUMENT,`Field '${C}' is specified in your field mask but missing from your input data.`);lf(f,C)||f.push(C)}l=new zt(f),c=o.fieldTransforms.filter(p=>l.covers(p.field))}else l=null,c=o.fieldTransforms;return new p_(new Mt(a),l,c)}function es(n,e){if(af(n=(0,Q.m9)(n)))return Wl("Unsupported field value:",e,n),of(n,e);if(n instanceof Hd)return function(t,s){if(!ef(s.ca))throw s._a(`${t._methodName}() can only be used with update() and set()`);if(!s.path)throw s._a(`${t._methodName}() is not currently supported inside arrays`);const r=t._toFieldTransform(s);r&&s.fieldTransforms.push(r)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.la&&4!==e.ca)throw e._a("Nested arrays are not supported");return function(t,s){const r=[];let i=0;for(const o of t){let a=es(o,s.wa(i));null==a&&(a={nullValue:"NULL_VALUE"}),r.push(a),i++}return{arrayValue:{values:r}}}(n,e)}return function(t,s){if(null===(t=(0,Q.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Ju(s.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const r=ct.fromDate(t);return{timestampValue:Ts(s.serializer,r)}}if(t instanceof ct){const r=new ct(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Ts(s.serializer,r)}}if(t instanceof Ql)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Xn)return{bytesValue:_h(s.serializer,t._byteString)};if(t instanceof yt){const r=s.databaseId,i=t.firestore._databaseId;if(!i.isEqual(r))throw s._a(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:da(t.firestore._databaseId||s.databaseId,t._key.path)}}throw s._a(`Unsupported field value: ${ro(t)}`)}(n,e)}function of(n,e){const t={};return vu(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):xn(n,(s,r)=>{const i=es(r,e.ha(s));null!=i&&(t[s]=i)}),{mapValue:{fields:t}}}function af(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof ct||n instanceof Ql||n instanceof Xn||n instanceof yt||n instanceof Hd)}function Wl(n,e,t){if(!af(t)||"object"!=typeof(s=t)||null===s||Object.getPrototypeOf(s)!==Object.prototype&&null!==Object.getPrototypeOf(s)){const s=ro(t);throw e._a("an object"===s?n+" a custom object":n+" "+s)}var s}function Gr(n,e,t){if((e=(0,Q.m9)(e))instanceof Bs)return e._internalPath;if("string"==typeof e)return oo(n,e);throw ao("Field path arguments must be of type string or ",n,!1,void 0,t)}const x_=new RegExp("[~\\*/\\[\\]]");function oo(n,e,t){if(e.search(x_)>=0)throw ao(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Bs(...e.split("."))._internalPath}catch{throw ao(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ao(n,e,t,s,r){const i=s&&!s.isEmpty(),o=void 0!==r;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${s}`),o&&(l+=` in document ${r}`),l+=")"),new X(L.INVALID_ARGUMENT,a+n+l)}function lf(n,e){return n.some(t=>t.isEqual(e))}class Jl{constructor(e,t,s,r,i){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new yt(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new T_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(lo("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class T_ extends Jl{data(){return super.data()}}function lo(n,e){return"string"==typeof e?oo(n,e):e instanceof Bs?e._internalPath:e._delegate._internalPath}function cf(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new X(L.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Yl{}class I_ extends Yl{}function uf(n,e,...t){let s=[];e instanceof Yl&&s.push(e),s=s.concat(t),function(r){const i=r.filter(a=>a instanceof js).length,o=r.filter(a=>a instanceof Qr).length;if(i>1||i>0&&o>0)throw new X(L.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const r of s)n=r._apply(n);return n}class Qr extends I_{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new Qr(e,t,s)}_apply(e){const t=this._parse(e);return gf(e._query,t),new Pt(e.firestore,e.converter,na(e._query,t))}_parse(e){const t=Us(e.firestore);return function(r,i,o,a,l,c,f){let p;if(l.isKeyField()){if("array-contains"===c||"array-contains-any"===c)throw new X(L.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if("in"===c||"not-in"===c){mf(f,c);const C=[];for(const z of f)C.push(ff(a,r,z));p={arrayValue:{values:C}}}else p=ff(a,r,f)}else"in"!==c&&"not-in"!==c&&"array-contains-any"!==c||mf(f,c),p=function rf(n,e,t,s=!1){return es(t,n.ya(s?4:3,e))}(o,"where",f,"in"===c||"not-in"===c);return je.create(l,c,p)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}function hf(n,e,t){const s=e,r=lo("where",n);return Qr._create(r,s,t)}class js extends Yl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new js(e,t)}_parse(e){const t=this._queryConstraints.map(s=>s._parse(e)).filter(s=>s.getFilters().length>0);return 1===t.length?t[0]:Je.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(s,r){let i=s;const o=r.getFlattenedFilters();for(const a of o)gf(i,a),i=na(i,a)}(e._query,t),new Pt(e.firestore,e.converter,na(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function ff(n,e,t){if("string"==typeof(t=(0,Q.m9)(t))){if(""===t)throw new X(L.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ta(e)&&-1!==t.indexOf("/"))throw new X(L.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const s=e.path.child(qe.fromString(t));if(!fe.isDocumentKey(s))throw new X(L.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return zn(n,new fe(s))}if(t instanceof yt)return zn(n,t._key);throw new X(L.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ro(t)}.`)}function mf(n,e){if(!Array.isArray(n)||0===n.length)throw new X(L.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function gf(n,e){if(e.isInequality()){const s=Ai(n),r=e.field;if(null!==s&&!s.isEqual(r))throw new X(L.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${s.toString()}' and '${r.toString()}'`);const i=ea(n);null!==i&&function pf(n,e,t){if(!t.isEqual(e))throw new X(L.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}(0,r,i)}const t=function(s,r){for(const i of s)for(const o of i.getFlattenedFilters())if(r.indexOf(o.op)>=0)return o.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new X(L.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class E_{convertValue(e,t="none"){switch(En(e)){case 0:return null;case 1:return e.booleanValue;case 2:return dt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(hn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw ve()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return xn(e,(r,i)=>{s[r]=this.convertValue(i,t)}),s}convertGeoPoint(e){return new Ql(dt(e.latitude),dt(e.longitude))}convertArray(e,t){return(e.values||[]).map(s=>this.convertValue(s,t))}convertServerTimestamp(e,t){switch(t){case"previous":const s=Ti(e);return null==s?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(fr(e));default:return null}}convertTimestamp(e){const t=Tn(e);return new ct(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=qe.fromString(e);Te(Ch(s));const r=new jn(s.get(1),s.get(3)),i=new fe(s.popFirst(5));return r.isEqual(t)||gt(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class ts{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class zs extends Jl{constructor(e,t,s,r,i,o){super(e,t,s,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new fo(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(lo("DocumentSnapshot.get",e));if(null!==s)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}}class fo extends zs{data(e={}){return super.data(e)}}class Vs{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new ts(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(s=>{e.call(t,new fo(this._firestore,this._userDataWriter,s.key,s,new ts(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new X(L.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,r){if(s._snapshot.oldDocs.isEmpty()){let i=0;return s._snapshot.docChanges.map(o=>({type:"added",doc:new fo(s._firestore,s._userDataWriter,o.doc.key,o.doc,new ts(s._snapshot.mutatedKeys.has(o.doc.key),s._snapshot.fromCache),s.query.converter),oldIndex:-1,newIndex:i++}))}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(o=>r||3!==o.type).map(o=>{const a=new fo(s._firestore,s._userDataWriter,o.doc.key,o.doc,new ts(s._snapshot.mutatedKeys.has(o.doc.key),s._snapshot.fromCache),s.query.converter);let l=-1,c=-1;return 0!==o.type&&(l=i.indexOf(o.doc.key),i=i.delete(o.doc.key)),1!==o.type&&(i=i.add(o.doc),c=i.indexOf(o.doc.key)),{type:b_(o.type),doc:a,oldIndex:l,newIndex:c}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function b_(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ve()}}class Pn extends E_{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new yt(this.firestore,null,t)}}function yf(n){n=ze(n,Pt);const e=ze(n.firestore,rt),t=wt(e),s=new Pn(e);return cf(n._query),function zd(n,e,t={}){const s=new Tt;return n.asyncQueue.enqueueAndForget((0,D.Z)(function*(){return function(r,i,o,a,l){const c=new eo({next:p=>{i.enqueueAndForget(()=>ol(r,f)),p.fromCache&&"server"===a.source?l.reject(new X(L.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(p)},error:p=>l.reject(p)}),f=new cl(o,c,{includeMetadataChanges:!0,Ku:!0});return rl(r,f)}(yield Ls(n),n.asyncQueue,e,t,s)})),s.promise}(t,n._query).then(r=>new Vs(e,s,n,r))}function vf(n,e,t){n=ze(n,yt);const s=ze(n.firestore,rt),r=function Xl(n,e,t){let s;return s=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,s}(n.converter,e,t);return Kr(s,[Kl(Us(s),"setDoc",n._key,r,null!==n.converter,t).toMutation(n._key,ot.none())])}function mo(n,...e){var t,s,r;n=(0,Q.m9)(n);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Zl(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(Zl(e[o])){const p=e[o];e[o]=null===(t=p.next)||void 0===t?void 0:t.bind(p),e[o+1]=null===(s=p.error)||void 0===s?void 0:s.bind(p),e[o+2]=null===(r=p.complete)||void 0===r?void 0:r.bind(p)}let l,c,f;if(n instanceof yt)c=ze(n.firestore,rt),f=_s(n._key.path),l={next:p=>{e[o]&&e[o](ec(c,n,p))},error:e[o+1],complete:e[o+2]};else{const p=ze(n,Pt);c=ze(p.firestore,rt),f=p._query;const C=new Pn(c);l={next:z=>{e[o]&&e[o](new Vs(c,C,p,z))},error:e[o+1],complete:e[o+2]},cf(n._query)}return function(p,C,z,ae){const ge=new eo(ae),ye=new cl(C,ge,z);return p.asyncQueue.enqueueAndForget((0,D.Z)(function*(){return rl(yield Ls(p),ye)})),()=>{ge.Dc(),p.asyncQueue.enqueueAndForget((0,D.Z)(function*(){return ol(yield Ls(p),ye)}))}}(wt(c),f,a,l)}function Kr(n,e){return function(t,s){const r=new Tt;return t.asyncQueue.enqueueAndForget((0,D.Z)(function*(){return function Rp(n,e,t){return ml.apply(this,arguments)}(yield function zl(n){return no(n).then(e=>e.syncEngine)}(t),s,r)})),r.promise}(wt(n),e)}function ec(n,e,t){const s=t.docs.get(e._key),r=new Pn(n);return new zs(n,r,e._key,s,new ts(t.hasPendingWrites,t.fromCache),e.converter)}!function(n,e=!0){hs=_.SDK_VERSION,(0,_._registerComponent)(new le.wA("firestore",(t,{instanceIdentifier:s,options:r})=>{const i=t.getProvider("app").getImmediate(),o=new rt(new cm(t.getProvider("auth-internal")),new dm(t.getProvider("app-check-internal")),function(a,l){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new X(L.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new jn(a.options.projectId,l)}(i,s),i);return r=Object.assign({useFetchStreams:e},r),o._setSettings(r),o},"PUBLIC").setMultipleInstances(!0)),(0,_.registerVersion)(nu,"3.13.0",n),(0,_.registerVersion)(nu,"3.13.0","esm2017")}();var Et=v(65592),xf=v(20553),po=v(65879),j_=v(86309),z_=v(63934),V_=v(87384);let q_=(()=>{class n{examSessions_read(t){var s=this;return new Et.y(r=>{this.getFirestoreDb(!1).subscribe(function(){var i=(0,D.Z)(function*(o){if(o&&1==o.success)try{var a=yield s._getDocument(o.data,"exam_sessions/"+t,s.getUserId());r.next({success:1,data:a,message:"successful"}),r.complete()}catch(c){console.log(c),r.next({success:0,data:"",message:""+c}),r.complete()}else r.next({success:0,data:"",message:o.message}),r.complete()});return function(o){return i.apply(this,arguments)}}())})}examSessions_write(t,s){var r=this;return new Et.y(i=>{this.getFirestoreDb(!1).subscribe(function(){var o=(0,D.Z)(function*(a){if(a&&1==a.success)try{var l=yield r._saveDocument(a.data,"exam_sessions/"+t,r.getUserId(),s);i.next({success:1,data:l,message:"successful"}),i.complete()}catch(f){console.log(f),i.next({success:0,data:"",message:""+f}),i.complete()}else i.next({success:0,data:"",message:a.message}),i.complete()});return function(a){return o.apply(this,arguments)}}())})}examSessions_writeUserMap(t,s){var r=this;return new Et.y(i=>{this.getFirestoreDbForStudentExam(!1,t).subscribe(function(){var o=(0,D.Z)(function*(a){if(a&&1==a.success&&a.data)try{var l=yield r._saveDocumentMerge(a.data,"exam_sessions/"+t,"user_map",s);i.next({success:1,data:l,message:"successful"}),i.complete()}catch(f){console.log(f),i.next({success:0,data:"",message:""+f}),i.complete()}else i.next({success:0,data:"",message:a.message}),i.complete()});return function(a){return o.apply(this,arguments)}}())})}examSessions_delete(t){var s=this;return new Et.y(r=>{this.getFirestoreDb(!1).subscribe(function(){var i=(0,D.Z)(function*(o){if(o&&1==o.success)try{yield s._removeDocument(o.data,"exam_sessions/"+t,s.getUserId()),r.next({success:1,data:"",message:"successful"}),r.complete()}catch(l){console.log(l),r.next({success:0,data:"",message:""+l}),r.complete()}else r.next({success:0,data:"",message:o.message}),r.complete()});return function(o){return i.apply(this,arguments)}}())})}examSessions_subscribeUserMap(t){var s=this;return new Et.y(r=>{this.getFirestoreDbForTeacherExam(!1,t).subscribe(function(){var i=(0,D.Z)(function*(o){if(o&&1==o.success)try{var a=s.myOnSnapshot(o.data,"exam_sessions/"+t,"user_map",f=>{r.next({success:1,data:f,message:"successful"}),r.complete()});s.addUnsubscribe("exam_sessions_"+t,a)}catch(f){console.log(f),r.next({success:0,data:void 0,message:""+f}),r.complete()}else r.next({success:0,data:void 0,message:o.message}),r.complete()});return function(o){return i.apply(this,arguments)}}())})}examSessions_subscribe(t){var s=this;return new Et.y(r=>{this.getFirestoreDb(!1).subscribe(function(){var i=(0,D.Z)(function*(o){if(o&&1==o.success)try{var a=s.myOnSnapshot(o.data,"exam_sessions/"+t,s.getUserId(),f=>{r.next({success:1,data:f,message:"successful"}),r.complete()});s.addUnsubscribe("exam_sessions_"+t,a)}catch(f){console.log(f),r.next({success:0,data:void 0,message:""+f}),r.complete()}else r.next({success:0,data:void 0,message:o.message}),r.complete()});return function(o){return i.apply(this,arguments)}}())})}examSessions_unsubscribe(t){this.removeAllunsubscribe("exam_sessions_"+t)}examSessions_subscribeWithQuery(t,s){var r=this;return new Et.y(s&&3==s.length?i=>{this.getFirestoreDb(!1).subscribe(function(){var o=(0,D.Z)(function*(a){if(a&&1==a.success)try{var l=r.myOnSnapshotCollectionWithQuery(a.data,"exam_sessions/"+t,s,p=>{i.next({success:1,data:p,message:"successful"}),i.complete()});r.addUnsubscribe("exam_sessions_"+t,l)}catch(p){console.log(p),i.next({success:0,data:void 0,message:""+p}),i.complete()}else i.next({success:0,data:void 0,message:a.message}),i.complete()});return function(a){return o.apply(this,arguments)}}())}:i=>{i.next({success:0,data:void 0,message:"EXCEPTION Query Param not valid"}),i.complete(),i.next({success:0,message:"EXCEPTION Query Param not valid"})})}examLiveTeachers_student_subscribe(t){var s=this;return new Et.y(r=>{this.getFirestoreDbForStudentExam(!1,t).subscribe(function(){var i=(0,D.Z)(function*(o){if(o&&1==o.success)try{var a=s.myOnSnapshotCollection(o.data,"exam_live_teachers/"+t,l=>{r.next({success:1,data:l})});s.addUnsubscribe("exam_live_teachers_"+t,a)}catch(l){console.log(l),r.next({success:0,message:"EXCEPTION",ex:l.toString()})}else r.next(o)});return function(o){return i.apply(this,arguments)}}())})}examLiveTeachers_student_unbsubscribe(t){this.removeAllunsubscribe("exam_live_teachers_"+t)}examLiveTeachers_teacher_saveChange(t,s){var r=this;return new Et.y(i=>{this.getFirestoreDbForTeacherExam(!1,t).subscribe(function(){var o=(0,D.Z)(function*(a){if(a&&1==a.success)try{var l=yield r._saveDocument(a.data,"exam_live_teachers/"+t,r.getUserId(),s);i.next({success:1,data:l})}catch(c){console.log(c),i.next({success:0,message:"EXCEPTION",ex:c.toString()})}else i.next(a)});return function(a){return o.apply(this,arguments)}}())})}examLives_teacher_getDocumentByUserIds(t,s){var r=this;return new Et.y(i=>{this.getFirestoreDbForTeacherExam(!1,t).subscribe(function(){var o=(0,D.Z)(function*(a){if(a&&1==a.success)try{var l=yield r._getDocuments(a.data,"exam_lives/"+t,s);i.next({success:1,data:l})}catch(c){console.log(c),i.next({success:0,message:"EXCEPTION",ex:c.toString()})}else i.next(a)});return function(a){return o.apply(this,arguments)}}())})}examLiveStudents_student_subscribe(t){var s=this;return new Et.y(r=>{this.getFirestoreDbForStudentExam(!1,t).subscribe(function(){var i=(0,D.Z)(function*(o){if(o&&1==o.success)try{var a=s.myOnSnapshot(o.data,"exam_live_students/"+t,s.getUserId(),l=>{r.next({success:1,data:l})});s.addUnsubscribe("exam_live_students_"+t,a)}catch(l){console.log(l),r.next({success:0,message:"EXCEPTION",ex:l.toString()})}else r.next(o)});return function(o){return i.apply(this,arguments)}}())})}examLiveStudents_student_unbsubscribe(t){this.removeAllunsubscribe("exam_live_students_"+t)}examLiveStudents_teacher_subscribe(t,s){var r=this;return new Et.y(i=>{this.getFirestoreDbForTeacherExam(!1,t).subscribe(function(){var o=(0,D.Z)(function*(a){if(a&&1==a.success)try{var l=r.myOnSnapshot(a.data,"exam_live_students/"+t,s,c=>{i.next({success:1,data:c})});r.addUnsubscribe("exam_live_students_"+t,l)}catch(c){console.log(c),i.next({success:0,message:"EXCEPTION",ex:c.toString()})}else i.next(a)});return function(a){return o.apply(this,arguments)}}())})}examLiveStudents_teacher_unbsubscribe(t){this.removeAllunsubscribe("exam_live_students_"+t)}examLiveStudents_student_saveChange(t,s){var r=this;return new Et.y(i=>{this.getFirestoreDbForStudentExam(!1,t).subscribe(function(){var o=(0,D.Z)(function*(a){if(a&&1==a.success)try{var l=yield r._saveDocument(a.data,"exam_live_students/"+t,r.getUserId(),s);i.next({success:1,data:l})}catch(c){console.log(c),i.next({success:0,message:"EXCEPTION",ex:c.toString()})}else i.next(a)});return function(a){return o.apply(this,arguments)}}())})}examLiveStudents_teacher_saveChange(t,s,r){var i=this;return new Et.y(o=>{this.getFirestoreDbForTeacherExam(!1,t).subscribe(function(){var a=(0,D.Z)(function*(l){if(l&&1==l.success)try{var c=yield i._saveDocumentMerge(l.data,"exam_live_students/"+t,s,r);o.next({success:1,data:c})}catch(f){console.log(f),o.next({success:0,message:"EXCEPTION",ex:f.toString()})}else o.next(l)});return function(l){return a.apply(this,arguments)}}())})}getFirestoreDb(t){return new Et.y(s=>{var r=this.createFirestoreKey("firestore_db"),i=this.getLocalFirestoreDb(r);null!=i&&0==t?(s.next({success:1,data:i,message:"successful"}),s.complete()):this.firestoreServiceApi.apiFirestoreGetSimpleTokenGet().subscribe(a=>{a&&1==a.success?(0,u._p)(this.getAuthApp(),a?.data?.token??"").then(()=>{var c=Gl(this.app);this.setLocalFirestoreDb(r,c),s.next({success:1,data:c,message:"successful"}),s.complete()}).catch(c=>{"auth/invalid-custom-token"===c.code?(s.next({success:0,data:void 0,message:"EXPIRED"}),s.complete()):(s.next({success:0,data:void 0,message:"AUTH_ERROR"}),s.complete())}):(s.next({success:0,data:void 0,message:a.message??""}),s.complete())})})}getFirestoreDbForStudentExam(t,s){return new Et.y(r=>{var i=this.createFirestoreKey("firestore_db_student_"+s),o=this.getLocalFirestoreDb(i);null!=o&&0==t?(r.next({success:1,data:o,message:"successful"}),r.complete()):this.firestoreServiceApi.apiFirestoreGetStudentExamTokenGet(s).subscribe(l=>{l&&1==l.success?(0,u._p)(this.getAuthApp(),l?.data?.token??"").then(()=>{var f=Gl(this.app);this.setLocalFirestoreDb(i,f),r.next({success:1,data:f,message:"successful"}),r.complete()}).catch(f=>{"auth/invalid-custom-token"===f.code?(r.next({success:0,data:void 0,message:"EXPIRED"}),r.complete()):(r.next({success:0,data:void 0,message:"AUTH_ERROR"}),r.complete())}):(r.next({success:0,data:void 0,message:l.message??""}),r.complete())})})}getFirestoreDbForTeacherExam(t,s){return new Et.y(r=>{var i=this.createFirestoreKey("firestore_db_teacher_"+s),o=this.getLocalFirestoreDb(i);null!=o&&0==t?(r.next({success:1,data:o,message:"successful"}),r.complete()):this.firestoreServiceApi.apiFirestoreGetTeacherExamTokenGet(s).subscribe(l=>{l&&1==l.success?(0,u._p)(this.getAuthApp(),l?.data?.token??"").then(()=>{var f=Gl(this.app);this.setLocalFirestoreDb(i,f),r.next({success:1,data:f,message:"successful"}),r.complete()}).catch(f=>{"auth/invalid-custom-token"===f.code?(r.next({success:0,data:void 0,message:"EXPIRED"}),r.complete()):(r.next({success:0,data:void 0,message:"AUTH_ERROR"}),r.complete())}):(r.next({success:0,data:void 0,message:l.message??""}),r.complete())})})}signInUserByToken(t){return new Et.y(s=>{(0,u._p)(this.getAuthApp(),t).then(()=>{s.next({success:1,data:"",message:"successful"}),s.complete()}).catch(r=>{"auth/invalid-custom-token"===r.code?(s.next({success:0,data:"",message:"EXPIRED"}),s.complete()):(s.next({success:0,data:"",message:"AUTH_ERROR"}),s.complete())})})}setLocalFirestoreDb(t,s){this.firestoreDbs[t]=s}getLocalFirestoreDb(t){if(this.firestoreDbs.hasOwnProperty(t))return this.firestoreDbs[t]}removeLocalFirestoreDb(t){this.firestoreDbs.hasOwnProperty(t)&&delete this.firestoreDbs[t]}createFirestoreKey(t){return this.userService.getUserObj().id+"_"+t}getUserId(){return this.userService.getUserObj().id?.toString()??"0"}addUnsubscribe(t,s){t=this.getUserId()+"_"+t,this.listSubscribers.hasOwnProperty(t)||(this.listSubscribers[t]=[]),this.listSubscribers[t].push(s)}removeAllunsubscribe(t){if(t=this.getUserId()+"_"+t,this.listSubscribers.hasOwnProperty(t)){for(var s=0;s<this.listSubscribers[t].length;s++)this.listSubscribers[t][s]();delete this.listSubscribers[t]}}_saveDocument(t,s,r,i){var o=this;return(0,D.Z)(function*(){return s=o.getBaseFirestore()+"/"+s,yield vf(Fs(t,s,r),o.commonSerivce.myClone(i)),r})()}_saveDocumentMerge(t,s,r,i){var o=this;return(0,D.Z)(function*(){return s=o.getBaseFirestore()+"/"+s,yield vf(Fs(t,s,r),o.commonSerivce.myClone(i),{merge:!0}),r})()}_getCollection(t,s){var r=this;return(0,D.Z)(function*(){s=r.getBaseFirestore()+"/"+s;const i=Vr(t,s);return(yield yf(i)).docs.map(l=>l.data())})()}_getDocument(t,s,r){var i=this;return(0,D.Z)(function*(){s=i.getBaseFirestore()+"/"+s;const o=Fs(t,s,r),a=yield function C_(n){n=ze(n,yt);const e=ze(n.firestore,rt);return function jd(n,e,t={}){const s=new Tt;return n.asyncQueue.enqueueAndForget((0,D.Z)(function*(){return function(r,i,o,a,l){const c=new eo({next:p=>{i.enqueueAndForget(()=>ol(r,f));const C=p.docs.has(o);!C&&p.fromCache?l.reject(new X(L.UNAVAILABLE,"Failed to get document because the client is offline.")):C&&p.fromCache&&a&&"server"===a.source?l.reject(new X(L.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(p)},error:p=>l.reject(p)}),f=new cl(_s(o.path),c,{includeMetadataChanges:!0,Ku:!0});return rl(r,f)}(yield Ls(n),n.asyncQueue,e,t,s)})),s.promise}(wt(e),n._key).then(t=>ec(e,n,t))}(o);return a.exists()?a.data():null})()}_getDocuments(t,s,r){var i=this;return(0,D.Z)(function*(){var o={};s=i.getBaseFirestore()+"/"+s;const a=uf(Vr(t,s),hf(function m_(){return new Bs("__name__")}(),"in",r));return(yield yf(a)).forEach(c=>{o[c.id]=c.data()}),o})()}_removeDocument(t,s,r){var i=this;return(0,D.Z)(function*(){s=i.getBaseFirestore()+"/"+s,yield function A_(n){return Kr(ze(n.firestore,rt),[new xs(n._key,ot.none())])}(Fs(t,s,r))})()}myOnSnapshot(t,s,r,i){return mo(Fs(t,s=this.getBaseFirestore()+"/"+s,r),a=>{i(a.data())})}myOnSnapshotCollection(t,s,r){return mo(Vr(t,s=this.getBaseFirestore()+"/"+s),function(){var o=(0,D.Z)(function*(a){var l=[];a.forEach(c=>{l.push(c.data())}),r(l)});return function(a){return o.apply(this,arguments)}}())}myOnSnapshotOnlyChangeInCollection(t,s,r){return mo(Vr(t,s=this.getBaseFirestore()+"/"+s),function(){var o=(0,D.Z)(function*(a){var l=[];a.docChanges().forEach(c=>{l.push(c.doc.data())}),r(l)});return function(a){return o.apply(this,arguments)}}())}myOnSnapshotCollectionWithQuery(t,s,r,i){return mo(uf(Vr(t,s=this.getBaseFirestore()+"/"+s),hf(r[0],r[1],r[2])),function(){var l=(0,D.Z)(function*(c){var f=[];c.docChanges().forEach(p=>{f.push(p.doc.data())}),i(f)});return function(c){return l.apply(this,arguments)}}())}getBaseFirestore(){return xf.N.firestoreBase}getInitApp(){return this.app}getAuthApp(){return(0,u.v0)(this.app)}constructor(t,s,r){this.firestoreServiceApi=t,this.userService=s,this.commonSerivce=r,this.firestoreDbs={},this.listSubscribers={},this.app=(0,h.ZF)(xf.N.firestoreConfig_app1,"firestoreapp")}}return n.\u0275fac=function(t){return new(t||n)(po.LFG(j_.C),po.LFG(z_.K),po.LFG(V_.v))},n.\u0275prov=po.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()},41003:(Qe,ce,v)=>{v.d(ce,{Ip:()=>S,JR:()=>Q,Le:()=>h,O8:()=>D,a3:()=>u,fI:()=>_,uG:()=>d});const D="00B050",h="f44336",u="_@COLOR@_",_="_@COLOR_END@_";function le(m,x,g){return m.replace(new RegExp(x,"g"),g)}function d(m,x="math",g=" xmlns"){if(!m)return"";const I=m.split(`<${x}`);return[["<span class=\"qv_string_eng_ans\" style='([^']+)'>([^<]*)<span style='([^']+)'>([A-Z])</span></span>",'<b><u below="$4"> $2</u></b>'],["([^>])(\r\n|\r|\n)([^<])","$1<br/>$3"]].forEach(A=>{for(let O=0;O<I.length;O++)if(I[O].startsWith(g)){const q=I[O].split(`</${x}>`);q.length>0&&(q[1]=le(q[1],A[0],A[1])),I[O]=q.join(`</${x}>`)}else I[O]=le(I[O],A[0],A[1])}),I.join(`<${x}`)}function Q(m){return m.forEach(x=>{x.content=d(x.content);for(let g=0;g<x.answers.length;g++)x.answers[g]=d(x.answers[g])}),m}const B=[{key:"TABLE",value:'<w:tblPr><w:tblStyle w:val="TableGrid" /><w:tblpPr w:leftFromText="180" w:rightFromText="180" w:vertAnchor="text" w:tblpXSpec="right" w:tblpY="1" /><w:tblOverlap w:val="never" /><w:tblW w:w="0" w:type="auto" /><w:tblBorders><w:insideV w:val="none" w:sz="0" w:space="0" w:color="auto" /></w:tblBorders><w:tblCellMar><w:top w:w="113" w:type="dxa" /><w:left w:w="397" w:type="dxa" /><w:bottom w:w="113" w:type="dxa" /><w:right w:w="397" w:type="dxa" /></w:tblCellMar><w:tblLook w:val="0600" w:firstRow="0" w:lastRow="0" w:firstColumn="0" w:lastColumn="0" w:noHBand="1" w:noVBand="1" /></w:tblPr>'},{key:"CORRECT",value:`<w:tcPr><w:tcW w:w="0" w:type="auto" /><w:tcBorders><w:top w:val="single" w:sz="4" w:space="0" w:color="FFFFFF" /><w:left w:val="single" w:sz="4" w:space="0" w:color="FFFFFF" /><w:bottom w:val="single" w:sz="4" w:space="0" w:color="FFFFFF" /><w:right w:val="single" w:sz="4" w:space="0" w:color="${u}" /></w:tcBorders><w:vAlign w:val="center" /></w:tcPr>`},{key:"KEY_RESULT",value:`<w:tcPr><w:tcW w:w="0" w:type="auto" /><w:tcBorders><w:top w:val="single" w:sz="4" w:space="0" w:color="${u}" /><w:left w:val="single" w:sz="4" w:space="0" w:color="FFFFFF" /><w:bottom w:val="single" w:sz="4" w:space="0" w:color="${u}" /><w:right w:val="single" w:sz="4" w:space="0" w:color="${_}" /></w:tcBorders><w:vAlign w:val="center" /></w:tcPr>`},{key:"FILL_RESULT",value:`<w:tcPr><w:tcW w:w="0" w:type="auto" /><w:tcBorders><w:top w:val="single" w:sz="4" w:space="0" w:color="${u}" /><w:left w:val="single" w:sz="4" w:space="0" w:color="FFFFFF" /><w:bottom w:val="single" w:sz="4" w:space="0" w:color="${u}" /><w:right w:val="single" w:sz="4" w:space="0" w:color="${u}" /></w:tcBorders><w:vAlign w:val="center" /></w:tcPr>`},{key:"HEADER_TABLE",value:'<w:tblPr><w:tblW w:w="0" w:type="auto"/><w:jc w:val="center"/><w:tblBorders><w:top w:val="single" w:sz="4" w:space="0" w:color="auto"/><w:left w:val="single" w:sz="4" w:space="0" w:color="auto"/><w:bottom w:val="single" w:sz="4" w:space="0" w:color="auto"/><w:right w:val="single" w:sz="4" w:space="0" w:color="auto"/><w:insideH w:val="single" w:sz="4" w:space="0" w:color="auto"/><w:insideV w:val="single" w:sz="4" w:space="0" w:color="auto"/></w:tblBorders><w:tblLook w:val="04A0" w:firstRow="1" w:lastRow="0" w:firstColumn="1" w:lastColumn="0" w:noHBand="0" w:noVBand="1"/></w:tblPr>'},{key:"HEADER_TABLE_NO_BORDER",value:'<w:tblPr><w:tblW w:w="0" w:type="auto"/><w:jc w:val="center"/><w:tblLook w:val="04A0" w:firstRow="1" w:lastRow="0" w:firstColumn="1" w:lastColumn="0" w:noHBand="0" w:noVBand="1"/></w:tblPr>'},{key:"HEADER_TABLE_TR",value:'<w:trPr><w:jc w:val="center" /></w:trPr>'},{key:"HEADER_TABLE_LEFT",value:'<w:tcPr><w:tcW w:w="3528" w:type="dxa" /></w:tcPr>'},{key:"HEADER_TABLE_RIGHT",value:'<w:tcPr><w:tcW w:w="7262" w:type="dxa" /><w:hideMark /></w:tcPr>'},{key:"TB_RESULT_TXT",value:'<w:pPr><w:jc w:val="center" /></w:pPr>'},{key:"TB_RESULT_POINT",value:'<w:pPr><w:jc w:val="center" /></w:pPr>'},{key:"TB_RESULT_COMMENT",value:"<w:pPr><w:rPr><w:i /><w:iCs /></w:rPr></w:pPr>"},{key:"LINE_CENTER",value:'<w:pPr><w:jc w:val="center" /></w:pPr>'}];class S{static get(x,g=[]){const j=B.find(I=>I.key===x);if(j){let I=j.value;for(const A of g)I=le(I,A.key,A.value);return btoa(I)}return""}static makeHeaderTable(x,g,j=!0){const I=document.createElement("table"),A=document.createElement("tr");I.appendChild(A);const O=document.createElement("td"),q=document.createElement("td");A.appendChild(O),A.appendChild(q),I.setAttribute("docx-style",S.get(j?"HEADER_TABLE":"HEADER_TABLE_NO_BORDER")),A.setAttribute("docx-style",S.get("HEADER_TABLE_TR")),O.setAttribute("docx-style",S.get("HEADER_TABLE_LEFT")),q.setAttribute("docx-style",S.get("HEADER_TABLE_RIGHT"));const w=document.createElement("span"),Y=document.createElement("span");return x.forEach(K=>{if("string"==typeof K){const Le=document.createElement("br"),pe=document.createElement("b");pe.innerText=K,pe.appendChild(Le),w.appendChild(pe)}else w.appendChild(K)}),g.forEach(K=>{if("string"==typeof K){const Le=document.createElement("br"),pe=document.createElement("b");pe.innerText=K,pe.appendChild(Le),Y.appendChild(pe)}else Y.appendChild(K)}),O.appendChild(w),q.appendChild(Y),I.outerHTML}static createLineBold(x){const g=document.createElement("p"),j=document.createElement("b");return j.innerText=x,g.appendChild(j),g}static createLineCenterBold(x){const g=document.createElement("p"),j=document.createElement("b");return g.setAttribute("docx-style",S.get("LINE_CENTER")),j.innerText=x,g.appendChild(j),g}static createLineCenterItalicized(x){const g=document.createElement("p"),j=document.createElement("i");return g.setAttribute("docx-style",S.get("LINE_CENTER")),j.innerText=x,g.appendChild(j),g}}},38801:(Qe,ce,v)=>{v.d(ce,{M:()=>u});var D=v(65879),h=v(52846);let u=(()=>{class _{constructor(d){this.envService=d}getTmpVersionMonitor(){var d=this.envService.getEnvValue("classliveUrl"),Q="1.0";if(d){var B=d.split("=");B.length>1&&(Q=B[1])}return"https://azota889.github.io/storage_public/almo/listactive.js?ver="+Q}getMNoteVer(){var d=this.envService.getEnvValue("classliveUrl"),Q="1.0";if(d){var B=d.split("=");B.length>1&&(Q=B[1])}return Q}checkValidForSetUpMonitor(){return!0}}return _.\u0275fac=function(d){return new(d||_)(D.LFG(h.D))},_.\u0275prov=D.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},32955:(Qe,ce,v)=>{v.d(ce,{p:()=>u});var D=v(65879),h=v(87384);let u=(()=>{class _{constructor(d){this.commonService=d}partQuestionSearchText(d){let Q=d.content??"",B=d.answers?.findIndex(S=>d.answerResult?.includes(S.key??""));if(void 0!==B&&-1!=B){let S=d.answers?.map(m=>m.content??"")??[];Q+="\n"+this.commonService.getCorrectAnsTxt(S,B)}return this.commonService.parseQuestionContent(Q)}partQuestionSearchTextByQuestionForm(d){let Q=d.questionContent??"";const B=this.commonService.myParseJson(d.answerConfig??""),S=this.commonService.myParseJson(d?.answerResult??"[]")??[""];let m=B?.findIndex(x=>S.includes(x.key??""));if(void 0!==m&&-1!=m){let x=B?.map(g=>g.content??"")??[];Q+="\n"+this.commonService.getCorrectAnsTxt(x,m)}return this.commonService.parseQuestionContent(Q)}}return _.\u0275fac=function(d){return new(d||_)(D.LFG(h.v))},_.\u0275prov=D.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},33853:(Qe,ce,v)=>{v.d(ce,{e:()=>Ue});var D=v(85965),h=v(3760),u=v(10548),_=v(19347),le=v(39621),d=v(65879),Q=v(96814),B=v(30251),S=v(11964);function m(J,Oe){if(1&J&&(d.TgZ(0,"li"),d._uU(1),d.qZA()),2&J){const y=Oe.$implicit;d.xp6(1),d.hij("* ",y.message,"")}}function x(J,Oe){1&J&&(d.TgZ(0,"span",10),d._uU(1),d.ALo(2,"mytranslate"),d.TgZ(3,"span",11),d._uU(4),d.ALo(5,"mytranslate"),d.qZA(),d._uU(6),d.ALo(7,"mytranslate"),d.ALo(8,"mytranslate"),d.qZA()),2&J&&(d.xp6(1),d.hij(" ",d.lcZ(2,4,"lang_auto_click")," "),d.xp6(3),d.hij('"',d.lcZ(5,6,"lang_auto_tai_ve"),'"'),d.xp6(2),d.AsE(" ",d.lcZ(7,8,"lang_auto_de_tai_ve")," ",d.lcZ(8,10,"lang_auto_cac_bai_lam_da_tao_thanh_cong"),". "))}function g(J,Oe){if(1&J){const y=d.EpF();d.TgZ(0,"button",19),d.NdJ("click",function(){d.CHM(y);const T=d.oxw();return d.KtG(T.onPressTrue())}),d._uU(1),d.ALo(2,"mytranslate"),d.qZA()}2&J&&(d.xp6(1),d.hij(" ",d.lcZ(2,1,"lang_auto_tai_ve")," "))}let j=(()=>{class J extends le.Q{onPressTrue(){this.dialogRef.close(!0)}constructor(y,E){super(),this.data=y,this.dialogRef=E,this.result=y.result}}return J.\u0275fac=function(y){return new(y||J)(d.Y36(_.WI),d.Y36(_.so,8))},J.\u0275cmp=d.Xpm({type:J,selectors:[["app-push-error-student-export-docx"]],features:[d.qOj],decls:32,vars:23,consts:[[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box-header","bg-slate-100","dark:bg-darkmode-400"],[1,"header-left"],[1,"header-right"],["azt-track-service","push-error-student-export-xUXBRZF-kY1",1,"btn","btn-transparent","btn-outline-danger","btn-sm",3,"mat-dialog-close"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-4","h-4","lucide"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"box-content"],[1,"box-title"],[1,"box-description"],[3,"defaultHeight"],[1,"box-list"],[4,"ngFor","ngForOf"],["class","box-title",4,"ngIf"],[1,"p-3","text-right"],["azt-track-service","push-error-student-export-PEAaBsdI7jR",1,"btn","w-24","btn-secondary","mr-3",3,"mat-dialog-close"],["azt-track-service","push-error-student-export-cI-G2ar81ss","class","btn w-24 btn-primary",3,"click",4,"ngIf"],["azt-track-service","push-error-student-export-cI-G2ar81ss",1,"btn","w-24","btn-primary",3,"click"]],template:function(y,E){1&y&&(d.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),d._uU(4),d.ALo(5,"mytranslate"),d.qZA(),d.TgZ(6,"div",4)(7,"a",5),d.O4$(),d.TgZ(8,"svg",6),d._UZ(9,"line",7)(10,"line",8),d.qZA()()()(),d.kcU(),d.TgZ(11,"div",9)(12,"span",10),d._uU(13),d.ALo(14,"mytranslate"),d.TgZ(15,"span",11),d._uU(16),d.qZA(),d._uU(17),d.ALo(18,"lowercase"),d.ALo(19,"mytranslate"),d.qZA(),d.TgZ(20,"span",10),d._uU(21),d.ALo(22,"mytranslate"),d.qZA(),d.TgZ(23,"azt-mat-dialog-content",12)(24,"ul",13),d.YNc(25,m,2,1,"li",14),d.qZA()(),d.YNc(26,x,9,12,"span",15),d.qZA(),d.TgZ(27,"div",16)(28,"a",17),d._uU(29),d.ALo(30,"mytranslate"),d.qZA(),d.YNc(31,g,3,3,"button",18),d.qZA()()()),2&y&&(d.xp6(4),d.Oqu(d.lcZ(5,11,"lang_auto_xay_ra_loi_trong_qua_trinh_xuat_docx")),d.xp6(9),d.hij(" ",d.lcZ(14,13,"lang_auto_he_thong_tao_thanh_cong_cho")," "),d.xp6(3),d.AsE("",E.result.datas.length,"/",E.result.errs.length+E.result.datas.length,""),d.xp6(1),d.hij(" ",d.lcZ(18,15,d.lcZ(19,17,"lang_auto_hoc_sinh"))," "),d.xp6(4),d.hij(" ",d.lcZ(22,19,"lang_auto_danh_sach_hoc_sinh_khong_the_tao_file_ket_qua"),": "),d.xp6(2),d.Q6J("defaultHeight",60),d.xp6(2),d.Q6J("ngForOf",E.result.errs),d.xp6(1),d.Q6J("ngIf",E.result.datas.length>0),d.xp6(3),d.hij(" ",d.lcZ(30,21,"lang_cms_common_close_btn")," "),d.xp6(2),d.Q6J("ngIf",E.result.datas.length>0))},dependencies:[Q.sg,Q.O5,_.ZT,B.O,Q.i8,S.bT],styles:[".box[_ngcontent-%COMP%]{max-width:600px}.box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-radius:.375rem}.box-content[_ngcontent-%COMP%]{padding:10px 20px}.box-title[_ngcontent-%COMP%]{display:block;font-weight:500;font-size:15px;padding:10px 0}.box-description[_ngcontent-%COMP%]{color:rgb(var(--color-primary))}.box-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:#f44336}"]}),J})();var I=v(56223),A=v(60723),O=v(50626),q=v(92596),w=v(90654),Y=v(775),K=v(52544),Le=v(7544),pe=v(68234);function Xe(J,Oe){if(1&J&&(d.TgZ(0,"span",32),d._uU(1),d.qZA()),2&J){const y=d.oxw();let E;d.xp6(1),d.Oqu(null!==(E=null==y.studentsInClassResults[0].classObj?null:y.studentsInClassResults[0].classObj.name)&&void 0!==E?E:"")}}function Ve(J,Oe){if(1&J&&(d.TgZ(0,"div",37)(1,"div",19),d._UZ(2,"input",38),d.TgZ(3,"label",39,40),d._uU(5),d.qZA()()()),2&J){const y=Oe.$implicit,E=d.MAs(4),T=d.oxw(2);let b;d.Q6J("hidden",1===T.studentsInClassResults.length),d.xp6(2),d.MGl("id","select-classroom-export__",null==y.classObj?null:y.classObj.id,""),d.Q6J("value",null==y.classObj?null:y.classObj.id),d.xp6(1),d.MGl("for","select-classroom-export__",null==y.classObj?null:y.classObj.id,""),d.Q6J("matTooltip",null!==(b=null==y.classObj?null:y.classObj.name)&&void 0!==b?b:"")("isDisabledTooltip",!1)("matTooltipDisabled",E.isDisabled),d.xp6(2),d.Oqu(null==y.classObj?null:y.classObj.name)}}const jt=function(J,Oe){return{"box-classrooms":J,"box-max-classrooms":Oe}};function Ft(J,Oe){if(1&J&&(d.TgZ(0,"div",33)(1,"ng-scrollbar",34)(2,"div",35),d.YNc(3,Ve,6,8,"div",36),d.qZA()()()),2&J){const y=d.oxw();let E;d.Q6J("ngClass",d.WLB(3,jt,(null==(E=y.form.get("listStudents"))?null:E.controls.length)>21||y.studentsInClassResults.length>18,(null==(E=y.form.get("listStudents"))?null:E.controls.length)<=21&&y.studentsInClassResults.length>18)),d.xp6(1),d.Q6J("visibility","hover"),d.xp6(2),d.Q6J("ngForOf",y.studentsInClassResults)}}function bt(J,Oe){if(1&J&&(d.TgZ(0,"label",39,40),d._uU(2),d.qZA()),2&J){const y=d.MAs(1),E=d.oxw().$implicit;let T,b,Z;d.MGl("for","select-classroom-export__",null==(T=E.get("id"))?null:T.value,""),d.Q6J("matTooltip",null!==(b=null==(b=E.get("label"))?null:b.value)&&void 0!==b?b:"")("isDisabledTooltip",!1)("matTooltipDisabled",y.isDisabled),d.xp6(2),d.Oqu(null==(Z=E.get("label"))?null:Z.value)}}function Ke(J,Oe){if(1&J&&(d.TgZ(0,"label",46),d._UZ(1,"img",47),d.qZA()),2&J){const y=d.oxw().$implicit;let E,T;d.MGl("for","select-classroom-export__",null==(E=y.get("id"))?null:E.value,""),d.xp6(1),d.Q6J("nameImages",null==(T=y.get("nameImages"))?null:T.value)}}function Zt(J,Oe){if(1&J){const y=d.EpF();d.TgZ(0,"div",41)(1,"div",42)(2,"input",43),d.NdJ("change",function(){d.CHM(y);const T=d.oxw();return d.KtG(T.onChangeStudentOption())}),d.qZA(),d.YNc(3,bt,3,5,"label",44),d.YNc(4,Ke,2,2,"label",45),d.qZA()()}if(2&J){const y=Oe.$implicit;let E,T,b;d.xp6(1),d.Q6J("formGroup",y),d.xp6(1),d.MGl("id","select-classroom-export__",null==(E=y.get("id"))?null:E.value,""),d.xp6(1),d.Q6J("ngIf",(null==(T=y.get("label"))?null:T.value)||!(null!=(T=y.get("isImage"))&&T.value)),d.xp6(1),d.Q6J("ngIf",!(null!=(b=y.get("label"))&&b.value)&&(null==(b=y.get("isImage"))?null:b.value))}}function xe(J,Oe){1&J&&(d.TgZ(0,"span",28),d._uU(1),d.ALo(2,"mytranslate"),d.qZA()),2&J&&(d.xp6(1),d.hij("* ",d.lcZ(2,1,"lang_core_chon_it_nhat_mot_hoc_sinh"),""))}function $e(J,Oe){if(1&J){const y=d.EpF();d.TgZ(0,"div",51),d.NdJ("click",function(){d.CHM(y);const T=d.oxw(2);return d.KtG(T.showAskInfo=!0)}),d._uU(1),d.ALo(2,"mytranslate"),d.qZA()}2&J&&(d.xp6(1),d.hij("+ ",d.lcZ(2,1,"lang_testbank_test_config_add_information"),""))}function V(J,Oe){if(1&J&&(d.TgZ(0,"div"),d._UZ(1,"add-info-print",52),d.qZA()),2&J){const y=d.oxw(2);d.xp6(1),d.Q6J("form",y.form)}}function $(J,Oe){1&J&&(d.TgZ(0,"span",55),d._uU(1),d.ALo(2,"mytranslate"),d.qZA()),2&J&&(d.xp6(1),d.hij("(",d.lcZ(2,1,"lang_auto_cac_thong_tin_khong_bat_buoc"),")"))}function ie(J,Oe){if(1&J){const y=d.EpF();d.TgZ(0,"div",53),d.NdJ("click",function(){d.CHM(y);const T=d.oxw(2);return d.KtG(T.showAskInfo=!1)}),d._uU(1),d.ALo(2,"mytranslate"),d.ALo(3,"lowercase"),d.ALo(4,"mytranslate"),d.YNc(5,$,3,3,"span",54),d.qZA()}if(2&J){const y=d.oxw(2);d.xp6(1),d.AsE(" ",d.lcZ(2,3,"lang_auto_huy")," ",d.lcZ(3,5,d.lcZ(4,7,"lang_testbank_test_config_add_information"))," "),d.xp6(4),d.Q6J("ngIf",y.isAskInfo&&y.showAskInfo)}}function Ie(J,Oe){if(1&J&&(d.TgZ(0,"div")(1,"span",48),d._uU(2),d.ALo(3,"mytranslate"),d.qZA(),d.YNc(4,$e,3,3,"div",49),d.YNc(5,V,2,1,"div",27),d.YNc(6,ie,6,9,"div",50),d.qZA()),2&J){const y=d.oxw();d.xp6(2),d.AsE("* ",d.lcZ(3,5,"lang_core_so_hoc_sinh_da_duoc_lua_chon")," : ",y.countStudentSelect,""),d.xp6(2),d.Q6J("ngIf",y.isAskInfo&&!y.showAskInfo),d.xp6(1),d.Q6J("ngIf",y.isAskInfo&&y.showAskInfo),d.xp6(1),d.Q6J("ngIf",y.isAskInfo&&y.showAskInfo)}}function Pe(J,Oe){1&J&&(d.TgZ(0,"div")(1,"div",16)(2,"span",28),d._uU(3),d.ALo(4,"mytranslate"),d.qZA()()()),2&J&&(d.xp6(3),d.hij("* ",d.lcZ(4,1,"lang_testbank_exam_result_there_is_no_result_in_exam"),""))}let ke=(()=>{class J extends le.Q{confirmAction(){const y=this.form.value,E=this.studentsInClassResults.find(T=>T.classObj?.id===y.classId);if(E){const T=y.listStudents.filter(b=>b.choose).map(b=>b.id);E.results=E.results?.filter(b=>T.includes(b.reId)),E.schoolName=this.showAskInfo?y.schoolName:void 0,E.subjectName=this.showAskInfo?y.subjectName:void 0,this.dialogRef.close(E)}else this.dialogRef.close()}setChangeSelectAll(){const y=this.form.get("selectAll");if(y){y.setValue(!y.value);const E=this.form.get("listStudents");E&&E.controls.forEach(T=>{T.get("choose").setValue(y.value)}),this.countStudentSelect=y.value?E.controls.length:0}}onChangeStudentOption(){const y=this.form.get("listStudents");let E=!0,T=0;y&&y.controls.forEach(Z=>{!1===Z.get("choose").value?E=!1:T++});const b=this.form.get("selectAll");b&&b.setValue(E),this.countStudentSelect=T}setupArrayStudent(y){this.currNameClass=y.classObj?.name??"";const E=this.form.get("listStudents");if(E){E.clear();let T=y.results??[];if(void 0!==y.classObj?.sortType){let b=y.classObj?.sortType;T=0==b?this.sortService.sortFirstNameStudents(this.commonService.myClone(T)):99==b?this.sortService.sortTimeDESC(this.commonService.myClone(T)):this.sortService.sortArrayByMultipleObjectKeyAsc(this.commonService.myClone(T),"pos","id")}T.forEach(b=>{(b.confirmedAt||!this.data.examHasEssay&&1==b.status)&&E.push(this.fb.group({isImage:new I.p4(b.nameImages),nameImages:new I.p4(b.nameImages),label:new I.p4(b.fullName),id:new I.p4(b.reId),choose:new I.p4(!1)}))})}}classroomChange(y){this.setupArrayStudent(y)}ngOnInit(){if(super.ngOnInit(),this.studentsInClassResults.length>0){let y=this.studentsInClassResults[0];this.form=this.fb.group({classId:new I.p4(y.classObj?.id,[I.kI.required]),selectAll:new I.p4(!1),listStudents:this.fb.array([]),schoolName:new I.p4(""),subjectName:new I.p4("")}),this.setupArrayStudent(y),this.form.get("classId").valueChanges.subscribe(T=>{const b=this.form.get("selectAll");b&&b.setValue(!1),this.countStudentSelect=0;const Z=this.studentsInClassResults.find(R=>R.classObj?.id===T);Z&&this.setupArrayStudent(Z)})}}constructor(y,E,T,b){super(),this.fb=y,this.sortService=E,this.data=T,this.dialogRef=b,this.studentsInClassResults=[],this.form=new I.nJ({}),this.countStudentSelect=0,this.showAskInfo=!1,this.currNameClass="",this.isAskInfo=T.isAskInfo,this.studentsInClassResults=T.studentsInClassResults.map(Z=>({...Z,results:Z.results?.map(R=>({...R,reId:A.G.generateIdRequired(10)}))}))}}return J.\u0275fac=function(y){return new(y||J)(d.Y36(I.qu),d.Y36(O.K),d.Y36(_.WI),d.Y36(_.so,8))},J.\u0275cmp=d.Xpm({type:J,selectors:[["app-select-student-to-export-docx"]],features:[d.qOj],decls:50,vars:35,consts:[[1,"box"],[1,"border-b","border-slate-200/60","dark:border-darkmode-400"],[1,"box-header","bg-slate-100","dark:bg-darkmode-400"],[1,"header-left"],[1,"header-right"],["azt-track-service","select-student-export-sMT2Np4C_Vf",1,"btn","btn-transparent","btn-outline-danger","btn-sm",3,"mat-dialog-close"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-4","h-4","lucide"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"box-content"],[3,"formGroup","hidden"],[1,"col-span-12",3,"hidden"],[1,"mb-3","mt-3","font-medium","flex","items-center","px-3"],["class","text-only-class",4,"ngIf"],["class","box-min-classrooms",3,"ngClass",4,"ngIf"],[3,"hidden"],[1,"col-span-12","mt-2","px-3"],[1,"font-medium","flex","items-center"],[1,"col-span-12","mt-2","mb-2","px-3","pt-0"],[1,"form-check","mr-10"],["id","select-all-students","type","checkbox",1,"form-check-input",3,"checked","change"],["for","select-all-students",1,"form-check-label"],[1,"box-students"],["pointerEventsMethod","scrollbar",2,"width","100%","height","100%",3,"visibility"],[1,"grid","grid-cols-12","p-3",2,"align-items","center"],["class","col-span-12 md:col-span-4 mt-2","formArrayName","listStudents",4,"ngFor","ngForOf"],["class","err-color",4,"ngIf"],[4,"ngIf"],[1,"err-color"],[1,"p-3","text-right"],["azt-track-service","select-student-export-H_SWYi6hbiY",1,"btn","w-24","btn-secondary","mr-3",3,"mat-dialog-close"],["azt-track-service","select-student-export-FAs4GdQImfT",1,"btn","w-24","btn-primary",3,"disabled","click"],[1,"text-only-class"],[1,"box-min-classrooms",3,"ngClass"],["track","vertical","pointerEventsMethod","scrollbar",3,"visibility"],[1,"grid","grid-cols-12","p-3","pt-0",2,"align-items","center"],["class","col-span-12 md:col-span-4 mt-2",3,"hidden",4,"ngFor","ngForOf"],[1,"col-span-12","md:col-span-4","mt-2",3,"hidden"],["formControlName","classId","type","radio",1,"form-check-input",3,"id","value"],[1,"form-check-label","truncate",3,"matTooltip","isDisabledTooltip","matTooltipDisabled","for"],["c","isDisabled"],["formArrayName","listStudents",1,"col-span-12","md:col-span-4","mt-2"],[1,"form-check","mr-10",3,"formGroup"],["formControlName","choose","type","checkbox",1,"form-check-input",3,"id","change"],["class","form-check-label truncate",3,"matTooltip","isDisabledTooltip","matTooltipDisabled","for",4,"ngIf"],["class","form-check-label truncate",3,"for",4,"ngIf"],[1,"form-check-label","truncate",3,"for"],["appDrawNameImage","",1,"img-name-fluid",3,"nameImages"],[1,"note-color"],["azt-track-service","select-student-export-RBRnT8RJQO0","class","mt-1 font-medium more-info-color",3,"click",4,"ngIf"],["azt-track-service","select-student-export-u8TMFqclpqj","class","mt-2 font-medium more-info-color",3,"click",4,"ngIf"],["azt-track-service","select-student-export-RBRnT8RJQO0",1,"mt-1","font-medium","more-info-color",3,"click"],[3,"form"],["azt-track-service","select-student-export-u8TMFqclpqj",1,"mt-2","font-medium","more-info-color",3,"click"],["class","ms-1 font-medium text-xs text-slate-500",4,"ngIf"],[1,"ms-1","font-medium","text-xs","text-slate-500"]],template:function(y,E){if(1&y&&(d.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),d._uU(4),d.ALo(5,"mytranslate"),d.qZA(),d.TgZ(6,"div",4)(7,"a",5),d.O4$(),d.TgZ(8,"svg",6),d._UZ(9,"line",7)(10,"line",8),d.qZA()()()(),d.kcU(),d.TgZ(11,"div",9)(12,"form",10)(13,"div",11)(14,"div",12),d._uU(15),d.ALo(16,"mytranslate"),d.YNc(17,Xe,2,1,"span",13),d.qZA()(),d.YNc(18,Ft,4,6,"div",14),d.TgZ(19,"div",15)(20,"div",16)(21,"div",17),d._uU(22),d.ALo(23,"mytranslate"),d.qZA()(),d.TgZ(24,"div",18)(25,"div",19)(26,"input",20),d.NdJ("change",function(){return E.setChangeSelectAll()}),d.qZA(),d.TgZ(27,"label",21),d._uU(28),d.ALo(29,"mytranslate"),d.qZA()()(),d.TgZ(30,"div",22)(31,"ng-scrollbar",23)(32,"div",24),d.YNc(33,Zt,5,4,"div",25),d.qZA()()(),d.TgZ(34,"div",16),d.YNc(35,xe,3,3,"span",26),d.YNc(36,Ie,7,7,"div",27),d.qZA()(),d.TgZ(37,"div",15)(38,"div",16)(39,"span",28),d._uU(40),d.ALo(41,"mytranslate"),d.qZA()()()(),d.YNc(42,Pe,5,3,"div",27),d.qZA(),d.TgZ(43,"div",29)(44,"a",30),d._uU(45),d.ALo(46,"mytranslate"),d.qZA(),d.TgZ(47,"button",31),d.NdJ("click",function(){return E.confirmAction()}),d._uU(48),d.ALo(49,"mytranslate"),d.qZA()()()()),2&y){let T,b,Z,R;d.xp6(4),d.Oqu(d.lcZ(5,21,"lang_testbank_what_to_export_select_students_export")),d.xp6(8),d.Q6J("formGroup",E.form)("hidden",0===E.studentsInClassResults.length),d.xp6(1),d.Q6J("hidden",1===E.studentsInClassResults.length&&null==E.studentsInClassResults[0].classObj),d.xp6(2),d.hij(" ",d.lcZ(16,23,"lang_core_chon_lop_xuat_bai_lam_hoc_sinh"),": "),d.xp6(2),d.Q6J("ngIf",1===E.studentsInClassResults.length),d.xp6(1),d.Q6J("ngIf",E.studentsInClassResults.length>1),d.xp6(1),d.Q6J("hidden",0===(null==(T=E.form.get("listStudents"))?null:T.controls.length)),d.xp6(3),d.hij("",d.lcZ(23,25,"lang_core_chon_hoc_sinh_xuat_bai_lam"),":"),d.xp6(4),d.Q6J("checked",null==(b=E.form.get("selectAll"))?null:b.value),d.xp6(2),d.Oqu(d.lcZ(29,27,"lang_auto_chon_tat_ca")),d.xp6(3),d.Q6J("visibility","hover"),d.xp6(2),d.Q6J("ngForOf",null==(Z=E.form.get("listStudents"))?null:Z.controls),d.xp6(2),d.Q6J("ngIf",0===E.countStudentSelect),d.xp6(1),d.Q6J("ngIf",E.countStudentSelect>0),d.xp6(1),d.Q6J("hidden",(null==(R=E.form.get("listStudents"))?null:R.controls.length)>0),d.xp6(3),d.hij("* ",d.lcZ(41,29,"lang_auto_chua_co_thi_sinh_du_thi"),""),d.xp6(2),d.Q6J("ngIf",0===E.studentsInClassResults.length),d.xp6(3),d.hij(" ",d.lcZ(46,31,"lang_cms_common_close_btn")," "),d.xp6(2),d.Q6J("disabled",0===E.countStudentSelect),d.xp6(1),d.hij(" ",d.lcZ(49,33,"lang_cms_common_confirm_btn")," ")}},dependencies:[Q.mk,Q.sg,Q.O5,_.ZT,q.gM,w.KC,I._Y,I.Fj,I.Wl,I._,I.JJ,I.JL,I.sg,I.u,I.CE,Y.M,K.L,Le.Q,pe.z,Q.i8,S.bT],styles:[".box[_ngcontent-%COMP%]{max-width:800px}.box-content[_ngcontent-%COMP%]{padding:10px}.box-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;border-radius:.375rem}.err-color[_ngcontent-%COMP%]{color:#f44336;font-size:small;font-weight:500}.note-color[_ngcontent-%COMP%]{font-size:small;font-weight:500}.truncate[_ngcontent-%COMP%]{display:inline-block;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;max-width:150px}.more-info-color[_ngcontent-%COMP%]{color:rgb(var(--color-primary));cursor:pointer}.text-only-class[_ngcontent-%COMP%]{color:#546e7a;margin-left:5px;font-weight:400}.box-students[_ngcontent-%COMP%]{height:15vh;overflow:hidden}.box-classrooms[_ngcontent-%COMP%]{height:10vh;overflow:hidden}.box-min-classrooms[_ngcontent-%COMP%]{height:45px}.box-max-classrooms[_ngcontent-%COMP%]{height:15vh;overflow:hidden}"]}),J})();var Be=v(86670),U=v(41003),Ce=v(43216),H=v(78386),M=v(8415),oe=v(58222),F=v(77051),ne=v(46825),k=v(70513),N=v(1914),G=v(87384),ue=v(90467),te=v(71284),be=v(67517),Ae=v(32839);let Ue=(()=>{class J{processHomeworks(y,E){return new Promise((T,b)=>{this.reset(),this.logger.start(this.commonService.myTranslateInstant("lang_cms_common_loading")),this.answerService.apiAnswerGetStudentsHomeworkGet(E).subscribe(Z=>{1==Z.success?(this.logger.remove(),this.dialog.open(ke,{width:"750px",restoreFocus:!1,data:{studentsInClassResults:[{classObj:Z.data?.classroomObj,results:Z.data?.studentObjs}],isAskInfo:!1}}).afterClosed().subscribe(R=>{if(R){this.logger.start(`${this.commonService.myTranslateInstant("lang_auto_chuan_bi_xuat_ket_qua_cho")} ${1===R.results.length?"":R.results.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const W=new Ce.O(!0);this.logger.pushChild(W),this.loadLibAction(W).then(()=>{this.logger.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang_tao_tep_tin_ket_qua_bai_lam_cho")} ${1===R.results.length?"":R.results.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const he=new Ce.O(!0);this.logger.pushChild(he);const se=new h.Q(1,{function:(ee,De,_e)=>{he.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")} ${1===De?"":"th\u1ee9 "+(ee+1)} ${_e?": "+_e:""}`)}});R.results.forEach(ee=>{const De=new Ce.O;he.pushChild(De),se.addTask(this,this.makeFileHomework,[E,ee,De],ee.fullName??"")}),se.start().then(ee=>{he.remove(),0===ee.errs.length?this.finishHomework(R.classObj.name??"",Z.data?.homeworkObj?.name??"",ee,T,b):(this.logger.remove(),this.dialog.open(j,{data:{result:ee},restoreFocus:!1}).afterClosed().subscribe(De=>{De&&(this.logger.start(`${this.commonService.myTranslateInstant("lang_testbank_export_pdf_by_user_processing")} ...`),this.finishHomework(R.classObj.name??"",Z.data?.homeworkObj?.name??"",ee,T,b))}))})}).catch(he=>{this.logger.remove(),b(he)})}})):(this.logger.remove(),b(new Error(this.commonService.myTranslateInstant(Z.message))))})})}processClasses(y,E){return new Promise((T,b)=>{let Z;switch(this.reset(),this.logger.start(this.commonService.myTranslateInstant("lang_cms_common_loading")),E){case"highest":Z=this.testedListApiService.getTestedHighestMark("export_tool",y);break;case"first":Z=this.testedListApiService.getTestedFirstMark("export_tool",y);break;default:Z=this.testedListApiService.getTestedLastMark("export_tool",y)}Z.subscribe(R=>{if(1==R.success){this.logger.remove();let W=!1;if(R.data?.questionObjs){let se=R.data?.questionObjs.filter(ee=>this.answerTypeService.isEssayAnswer(ee.answerType));se&&se.length&&(W=!0)}let he=R.data?.studentsInClassResults??[];R.data?.studentsNotInClassResults&&R.data?.studentsNotInClassResults?.length>0&&he.push({classObj:{name:this.commonService.myTranslateInstant("lang_auto_tu_do")??"",id:0,teacherId:0,countStudents:0,grade:0,showAddStudent:0},results:R.data.studentsNotInClassResults}),this.dialog.open(ke,{data:{studentsInClassResults:he,examHasEssay:W,isAskInfo:!0},restoreFocus:!1,width:"750px"}).afterClosed().subscribe(se=>{se?(this.expandInfoParse=this.commonService.castJsonToObj(R.data?.examObj?.expandInfo??"{}")??{},this.logger.start(`${this.commonService.myTranslateInstant("lang_auto_xuat_ket_qua_cho")} ${1===se.results?.length?"":se.results?.length} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`),this.processConvertDataClassroom(y,se,se.classObj?.name??"",R.data?.examObj).then(()=>{this.logger.remove(),T()}).catch(De=>{this.logger.remove(),b(De)})):(this.logger.remove(),T())})}else this.logger.remove(),b(new Error(this.commonService.myTranslateInstant(R.message)??""))})})}processUser(y,E,T,b,Z,R=!0,W,he){return new Promise((se,ee)=>{this.reset(),Z=Z||this.logger,Z?.start(`${this.commonService.myTranslateInstant("lang_auto_chuan_bi_xuat_ket_qua_cho")} ${this.commonService.myTranslateInstant("lang_auto_hoc_sinh")}`);const De=new Ce.O(!0);Z?.pushChild(De),this.loadLibAction(De).then(()=>{Z?.pushMsg(this.commonService.myTranslateInstant("lang_cms_common_loading")??""),this.examResultService.apiExamResultGetLastResultGet(y,T??"",b??"",E).subscribe(_e=>{if(1==_e.success){this.expandInfoParse=this.commonService.castJsonToObj(_e.data?.examObj?.expandInfo??"{}")??{},Z?.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang")} ${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")}`);let de=this.commonService.myTranslateInstant("lang_auto_tu_do")??"";const Ee=_e.data?.studentObj;Z?.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang")} ${this.commonService.myTranslateInstant("lang_auto_tao_tep_tin_cho_hoc_sinh")} ${Ee?.fullName??""}`);let we="";we=_e.data?.classroomObj?_e.data?.classroomObj.name??de:de;const at=_e.data?.examTracks,lt=_e.data?.examObj,Ye=_e.data?.examResultObj,ft=this.commonService.castJsonToClassObjs(Be.v,JSON.stringify(_e.data?.questionObjs))??[];for(let et=0;et<ft.length;et++)ft[et].indexLabel=et+(lt?.startQuestionIndex??1),ft[et].correctAnswer=this.commonService.filterArray(_e.data?.correctQuestionIds,ft[et].id);const $t={};let ut=this.commonService.castJsonToObj(_e.data?.examResultObj?.answers??"");this.exportPdfConvertDataService.convertAnswersArr(ut??[],$t);const mt=new Ce.O;Z?.pushChild(mt),this.processConvertDataUser(mt,ft,Ee,Ye).then(et=>{et&&this.convertDataMarkNote(et?.resultTeacherDraw).then(qs=>{this.loadTeacherDrawResult(qs,Z??new Ce.O,Ee?.fullName??this.commonService.myTranslateInstant("lang_cms_test_offline_title")??"").then(_o=>{et=_o,mt.remove();const yo=new Ce.O(!0,this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_file_word"));Z?.pushChild(yo);let ss=[];ss.push({content:this.getLineInfoData(we,lt,at,Ye,Ee,ft,et,W,he).join("<br/>")+"<br/><br/><br/>",answers:[]}),ss=ss.concat(this.startGenUserLineFile(Ye,ft,et)),azotaDocx.exportToDocxBinary({questions:(0,U.JR)(ss),additionalParams:{isHeadless:!0}}).then($r=>{const Zs=new Blob([$r],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let rs=this.commonService.createFileNameExportFile([Ee?.fullName??this.commonService.myTranslateInstant("lang_cms_test_offline_title")??"",Ye?.id?Ye.id.toString():""])+"_test_result";if(R)if(et.mediaAnswerWraps.concat(et.mediaWraps).length>0){const Gs=new D;Gs.file(rs+".docx",Zs),et.mediaAnswerWraps.concat(et.mediaWraps).forEach(Wt=>{const ln=new Blob([Wt]);Gs.file("attachments/"+Wt.name,ln)}),Gs.generateAsync({type:"blob"}).then(Wt=>{let ln=this.commonService.createFileNameExportFile([we,rs])+"_attachments_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(Wt,ln),Z?.remove(),se()},Wt=>{Z?.remove(),se(Wt)})}else this.shareFileFlutterService.shareFileWithBlob(Zs,rs+".docx"),Z?.remove(),se();else Z?.remove(),se({name:rs,blob:Zs,medias:et.mediaAnswerWraps.concat(et.mediaWraps)})})})})}).catch(et=>{Z?.remove(),ee(et)})}else Z?.remove(),ee(new Error(this.commonService.myTranslateInstant(_e.message)))})}).catch(_e=>{Z?.remove(),ee(_e)})})}finishClassroom(y,E,T,b,Z){if(T.length>1){const R=new D;T.forEach(W=>{W.medias.length>0?(R.file(W.name+"/"+W.name+".docx",W.blob),W.medias.forEach(he=>{const se=new Blob([he]);R.file(W.name+"/attachments/"+he.name,se)})):R.file(W.name+".docx",W.blob)}),R.generateAsync({type:"blob"}).then(W=>{let he=this.commonService.createFileNameExportFile([y,E])+"_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(W,he),b()},W=>{b(W)})}else if(T[0].medias.length>0){const R=new D;R.file(T[0].name+"/"+T[0].name+".docx",T[0].blob),T[0].medias.forEach(W=>{const he=new Blob([W]);R.file(T[0].name+"/attachments/"+W.name,he)}),R.generateAsync({type:"blob"}).then(W=>{let he=this.commonService.createFileNameExportFile([y,E])+"_attachments_exam_result.zip";this.shareFileFlutterService.shareFileWithBlob(W,he),b()},W=>{b(W)})}else this.shareFileFlutterService.shareFileWithBlob(T[0].blob,T[0].name+".docx"),b()}finishHomework(y,E,T,b,Z){if(1===T.datas.length)if(T.datas[0].medias.length>0){const R=new D;R.file(T.datas[0].name+"/"+T.datas[0].name+".docx",T.datas[0].blob),T.datas[0].medias.forEach(W=>{const he=new Blob([W]);R.file(T.datas[0].name+"/attachments/"+W.name,he)}),R.generateAsync({type:"blob"}).then(W=>{let he=this.commonService.createFileNameExportFile([y,T.datas[0].name])+"_attachments_exam_result.zip";this.logger.remove(),this.shareFileFlutterService.shareFileWithBlob(W,he),b()},W=>{this.logger.remove(),b(W)})}else this.shareFileFlutterService.shareFileWithBlob(T.datas[0].blob,T.datas[0].name+".docx"),this.logger.remove(),b();else{this.logger.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_nen_zip_cac_bai_lam_cua_hoc_sinh")??"");const R=new D;T.datas.forEach(W=>{W.medias.length>0?(R.file("results/"+W.name+"/"+W.name+".docx",W.blob),W.medias.forEach(he=>{const se=new Blob([he]);R.file("results/"+W.name+"/attachments/"+he.name,se)})):R.file("results/"+W.name+".docx",W.blob)}),R.generateAsync({type:"blob"}).then(W=>{let he=this.commonService.createFileNameExportFile([y,E])+"_homework_result.zip";this.shareFileFlutterService.shareFileWithBlob(W,he),this.logger.remove(),b()},W=>{this.logger.remove(),Z(W)})}}makeFileHomework(y,E,T){return new Promise((b,Z)=>{T.start(this.commonService.myTranslateInstant("lang_cms_common_loading")??""),this.answerService.apiAnswerGetObjGet(y,E.answer?.id??0).subscribe(R=>{if(T.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_giai_nen_ket_qua_bai_lam")??""),this.zipDataService.convertSubmittedAnswersObj(R.data?.answerObj),R.data?.answerObj){T.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_tep_tin")??"");let he=this.commonService.castJsonToObj(R.data.answerObj.result??"")??{};this.convertDataMarkNote(he).then(se=>{this.loadTeacherDrawResult(se,T,E.fullName??"").then(ee=>{T.pushMsg(this.commonService.myTranslateInstant("lang_auto_dang_khoi_tao_tep_tin")??"");let De=[];[`<b>${this.commonService.myTranslateInstant("lang_auto_ho_va_ten")}</b>: ${R.data?.studentObj?.fullName} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_lop_hoc")}</b>: ${R.data?.classroomObj?.name} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_bai_tap")}</b>: ${R.data?.homeworkObj?.name} <br/>`,`<b>${this.commonService.myTranslateInstant("lang_auto_ma_bai_lam")}</b>: ${R.data?.answerObj?.id} <br/>`].forEach(de=>{De.push({content:de,answers:[]})});let _e=this.commonService.castJsonToObj(R.data?.answerObj?.resultNote??"");if(_e){const de=[{mark:1e3,lang:"lang_auto_dat"},{mark:1001,lang:"lang_auto_chua_dat"},{mark:2e3,lang:"lang_auto_hoan_thanh"},{mark:2001,lang:"lang_auto_chua_hoan_thanh"},{mark:3e3,lang:"lang_auto_hoan_thanh_tot"}],Ee=document.createElement("p");Ee.innerText=this.commonService.myTranslateInstant("lang_point")??"",Ee.setAttribute("docx-style",U.Ip.get("TB_RESULT_TXT"));const we=document.createElement("p");let at=R.data?.answerObj?.point;de.forEach(ft=>{ft.mark===at&&(at=this.commonService.myTranslateInstant(ft.lang))}),we.innerText=at?.toString()??"",we.setAttribute("docx-style",U.Ip.get("TB_RESULT_POINT"));const lt=document.createElement("p");lt.setAttribute("docx-style",U.Ip.get("TB_RESULT_TXT")),lt.innerText=this.commonService.myTranslateInstant("lang_homework_homework_frontend_submit_homework_comment")??"";const Ye=document.createElement("span");Ye.setAttribute("docx-style",U.Ip.get("TB_RESULT_COMMENT")),0===_e?.IsHideMark&&(Ye.innerText=this.getTextContentInTagHTML(_e.Note),ee.resultTeacherDraw?.commentEmoji&&(Ye.appendChild(document.createElement("br")),ee.resultTeacherDraw.commentEmoji.forEach(ft=>{if(ee.canvasList[ft]){const $t=new Image;$t.src=ee.canvasList[ft].toDataURL(),$t.style.width=ee.canvasList[ft].width/5+"px",$t.style.height=ee.canvasList[ft].height/5+"px",Ye.appendChild($t)}}))),De.push({content:U.Ip.makeHeaderTable([Ee,we],[lt,Ye]),answers:[]})}De=De.concat(this.getLineImageAnswer(ee)),azotaDocx.exportToDocxBinary({questions:(0,U.JR)(De),additionalParams:{isHeadless:!0}}).then(de=>{T.remove();const Ee=new Blob([de],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});let we=`${this.commonService.convertVietnameseToEnglish(E.fullName??"")}_${R.data?.answerObj?.id??0}`;b({name:we,blob:Ee,medias:ee.mediaAnswerWraps.concat(ee.mediaWraps)})})}).catch(ee=>{T.remove(),Z(ee)})})}else T.remove(),Z(new Error(this.commonService.myTranslateInstant("lang_auto_khong_tai_duoc_ket_qua_hoc_sinh")))})})}processConvertDataClassroom(y,E,T,b){return new Promise((Z,R)=>{const W=new h.Q(1,{function:(se,ee)=>{this.logger.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_xuat_ket_qua_cho_hoc_sinh")}${1===ee?"":` (${se+1}/${ee})`}`),this.logger.percent=se/ee}},1e3),he=[];E.results?.forEach(se=>{W.addTask(this,()=>new Promise((ee,De)=>{const _e=new Ce.O(!0,"");this.logger.pushChild(_e),this.processUser(y,Number(se.resultId),se.userId,se.studentId?.toString(),_e,!1,E.schoolName,E.subjectName).then(de=>{de?(_e.remove(),he.push(de),ee()):(_e.remove(),De(new Error))}).catch(de=>{_e.remove(),De(de)})}))}),W.start().then(se=>{se.errs.length>0?(this.logger.remove(),se.datas=he,this.dialog.open(j,{data:{result:se},restoreFocus:!1}).afterClosed().subscribe(ee=>{ee&&(this.logger.start(`${this.commonService.myTranslateInstant("lang_testbank_export_pdf_by_user_processing")} ...`),this.finishClassroom(T,b?.name??"",he,Z,R))})):this.finishClassroom(T,b?.name??"",he,Z,R)})})}processConvertDataUser(y,E,T,b){return new Promise((Z,R)=>{let W={canvasList:[],mediaWraps:[],mediaAnswerWraps:[],isExportAnsMedia:!0};y.start();const _e=new h.Q(1,{function:(de,Ee,we)=>{y.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_trinh")} ${de+1}/${Ee}: ${we}`)}});_e.addTask(this,()=>new Promise((de,Ee)=>{const we=new Ce.O(!0);y.pushChild(we),this.questionRenderService.parseRenderQuestions(E,at=>{we.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_do_tai_du_lieu_cau_hoi")}: ${Math.floor(at)}%`)},void 0,50,!0).then(()=>{we.remove(),de()}).catch(at=>{const lt=Ye=>{Object.prototype.hasOwnProperty.call(Ye,"type")&&"LOAD_IMAGE"===Ye.type?Ee(new Error(`${Ye.message} ${this.commonService.trimMidLimitLength(Ye.data[0],30)}`)):Ee(at)};we.remove(),Array.isArray(at)?lt(at[0]):lt(at)})}),[],this.commonService.myTranslateInstant("lang_auto_tai_du_lieu_cau_hoi")),b&&b.result&&_e.addTask(this,()=>new Promise((de,Ee)=>{this.loadTeacherDrawResult(this.commonService.castJsonToObj(b?.result??"")??{},y,T?.fullName??"").then(we=>{W=we,de()}).catch(we=>{Ee(we)})}),[],this.commonService.myTranslateInstant("lang_auto_tai_du_lieu_cham_tu_luan_cua_giao_vien")),_e.addTask(this,()=>new Promise((de,Ee)=>{T?this.loadNameImage(T).then(we=>{T=we,de()}).catch(we=>{Ee(we)}):Ee(new Error)}),[],this.commonService.myTranslateInstant("lang_auto_tai_hinh_anh_ten_hoc_sinh")),W.isExportMedia&&_e.addTask(this,()=>new Promise((de,Ee)=>{const we=new Ce.O(!0);y.pushChild(we);const at=new h.Q(3,{function:(lt,Ye)=>{we.pushMsg(`${this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin")} (${lt}/${Ye})`)}},100);E.forEach(lt=>{lt.attachments&&lt.attachments.length>0&&lt.attachments.forEach(Ye=>{at.addTask(this,this.loadAztFile,[Ye,W,"att"])})}),at.start().then(lt=>{0===lt.errs.length?(we.remove(),de()):(we.remove(),Ee(lt.errs[0]))})}),[],this.commonService.myTranslateInstant("lang_core_dang_tai_tep_tin_dinh_kem")),_e.start().then(de=>{y.remove(),0===de.errs.length?(this.exportPdfUtilsService.parseEssayMarkResult(E,b),Z(W)):R(de.errs[0])})})}hasMultiple(y){let E=!1;for(let T=0;T<y.length;T++)if(this.answerTypeService.isOneChoiceAnswer(y[T].answerType)){E=!0;break}return E}hasEssay(y){let E=!1;for(let T=0;T<y.length;T++)if(this.answerTypeService.isEssayAnswer(y[T].answerType)){E=!0;break}return E}getLineInfoData(y,E,T,b,Z,R,W,he,se){const ee=[];ee.push(U.Ip.makeHeaderTable([U.Ip.createLineCenterBold(he||`{ ${this.commonService.myTranslateInstant("lang_testbank_utils_footer_infomation_school")?.toUpperCase()} }`)],[U.Ip.createLineCenterBold(E?.name??"{"+this.commonService.myTranslateInstant("lang_notify_list_tested")?.toUpperCase()+"}"),U.Ip.createLineCenterBold(se||"{"+this.commonService.myTranslateInstant("lang_auto_mon_hoc")?.toUpperCase()+"}"),U.Ip.createLineCenterBold(E?.minutes&&E?.minutes>0?(this.commonService.myTranslateInstant("lang_auto_thoi_gian_lam_bai")??"")+": "+E?.minutes+" "+this.commonService.myTranslateInstant("lang_auto_minute")+" ("+this.commonService.myTranslateInstant("lang_core_khong_ke_thoi_gian_giao_de")+")":this.commonService.myTranslateInstant("lang_auto_thoi_gian_lam_bai")+": "+this.commonService.myTranslateInstant("lang_auto_khong_gioi_han"))]));const De=R.filter(_e=>this.answerTypeService.isEssayAnswer(_e.answerType)).length;return Z&&Z.nameImages&&parseInt(Z?.id??"0")<=0?ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_thi_sinh")}</b>: <img src="${Z?.nameImages.url}" />`):ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_thi_sinh")}</b>: ${Z?.fullName}`),ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_lop")}</b>: ${y}`),E?.subjectMarks&&b?.subjectMarkValues&&b.subjectMarkValues.forEach((_e,de)=>{ee.push(`<b>${this.commonService.myTranslateInstant("lang_combine_exam_component")}${de+1} </b>: ${_e}/10`)}),this.hasMultiple(R)&&ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_trac_nghiem")}</b>: ${b?.trueFalseMark} (${b?.rightAnswer}/${(b?.totalQuestion??0)-De} ${this.commonService.myTranslateInstant("lang_auto_cau_brackets")}`),this.hasEssay(R)&&ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_tu_luan")}</b>: ${b?.essayMark+" ("+De+" "+this.commonService.myTranslateInstant("lang_auto_cau_brackets")}`),this.hasEssay(R)&&W.resultTeacherDraw&&ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_file_da_nop")}</b>: ${this.commonService.castJsonToObj(b?.files??"")?.length??"0"}`),T&&0!=E?.autoMonitor&&(ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_lan_thoat_man_hinh")}</b>: ${T.exitFullScreen}`),ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_so_lan_thoat_trinh_duyet")}</b>: ${T.blurWindow}`)),ee.push(`<b>${this.commonService.myTranslateInstant("lang_auto_ma_bai_lam")}</b>: ${b?.id}`),ee}startGenUserLineFile(y,E,T){let b=[];const Z=this.commonService.castJsonToObj(y?.answers??"");return Z&&E.forEach(R=>{R.attachments&&T.isExportMedia&&R.attachments.forEach(he=>{b.push({content:`[${this.commonService.myTranslateInstant("lang_core_dinh_kem_file_tai")} attachments/${he.name}]`,answers:[]})}),b=b.concat(this.genLineQuestion(R));const W=this.mapQuestResultObj(R,Z??[]);switch(R.answerType){case 1:b=b.concat(this.genLineAnswerType1(R,W));break;case 3:b=b.concat(this.genLineAnswerType3(R,W));break;case 4:b=b.concat(this.genLineAnswerType4(R,W))}}),this.hasEssay(E)&&(b=b.concat(this.getLineImageAnswer(T))),b}genLineQuestion(y){const E=[];let b={content:"<b>"+(this.expandInfoParse.label??this.commonService.myTranslateInstant("lang_auto_cau"))+" "+(y.indexLabel??1)+".</b> "+(y.content?.includes("<img")?"<br>":"")+y.content,answers:this.convertAnswerQuestion(y.answers??[])};return E.push(b),E}mapQuestResultObj(y,E){return E.find(b=>b.QuestionId===y.id)||{QuestionId:y.id??0,AnswerContent:[]}}convertAnswerQuestion(y){let E=[];return y.forEach(T=>{E.push("<b>     "+(T.alpha?T.alpha:T.key)+".</b> "+T.content)}),E}genLineAnswerType1(y,E){const T=document.createElement("table"),b=y.correctAnswer?U.O8:U.Le;T.setAttribute("docx-style",U.Ip.get("TABLE"));const Z=[],R=document.createElement("tr");T.appendChild(R);const W=document.createElement("td");W.setAttribute("docx-style",U.Ip.get("CORRECT",[{key:U.a3,value:b}]));const he=document.createElement("span"),se=y.answers?y.answers.filter(_e=>y.answerResult?.includes(_e.key)).map(_e=>_e.alpha??_e.key).join(" & "):y.answerResult?.join(" & ");he.innerText=(this.commonService.myTranslateInstant("lang_auto_dap_an_dung")??"")+": "+se,he.setAttribute("color",b),W.appendChild(he),R.appendChild(W);const ee=document.createElement("span"),De=document.createElement("span");return ee.innerText="\u2713",ee.setAttribute("color",U.O8),De.innerText="\u2717",De.setAttribute("color",U.Le),y.answers?.forEach((_e,de)=>{const Ee=document.createElement("td"),we=document.createElement("span"),at=[{key:U.a3,value:b}];at.push({key:U.fI,value:de+1===y.answers?.length?b:"FFFFFF"}),Ee.setAttribute("docx-style",U.Ip.get("KEY_RESULT",at)),we.innerText=_e.alpha??_e.key,E.AnswerContent.filter(Ye=>Ye.Content===_e.key).length>0&&Ee.appendChild(y.correctAnswer?ee:De),Ee.appendChild(we),R.appendChild(Ee)}),Z.push({content:`<br>${T.outerHTML}<br><br><br><br>`,answers:[]}),Z}genLineAnswerType3(y,E){const T=[];return T.push({content:`<b>${this.capitalized(this.commonService.myTranslateInstant("lang_auto_cau_tra_loi"))}:</b><br/>`,answers:[]}),0===E.AnswerContent.length?T.push({content:`<span>${this.commonService.myTranslateInstant("lang_auto_thi_sinh_khong_nhap_thong_tin")}</span>`,answers:[]}):E.AnswerContent.forEach(b=>{T.push({content:`<span>${b.Content}</span>`,answers:[]})}),T.push({content:`<b>${this.commonService.myTranslateInstant("lang_auto_da_cham")}: ${y.essayMarkParsed} ${this.commonService.myTranslateInstant("lang_auto_diem_toi_da")}: ${y.scorePerQuestion})</b>`,answers:[]}),T}genLineAnswerType4(y,E){const T=document.createElement("table"),b=y.correctAnswer?U.O8:U.Le;T.setAttribute("docx-style",U.Ip.get("TABLE"));const Z=[],R=document.createElement("tr");R.setAttribute("docx-style",U.Ip.get("TR")),T.appendChild(R);const W=document.createElement("td");W.setAttribute("docx-style",U.Ip.get("CORRECT",[{key:U.a3,value:b}]));const he=document.createElement("span");he.innerText=(this.commonService.myTranslateInstant("lang_auto_dap_an_dung")??"")+": ["+y.answerResult?.join(";")+"]",he.setAttribute("color",b),W.appendChild(he),R.appendChild(W),0===E.AnswerContent.length&&E.AnswerContent.push({Index:0,Content:this.commonService.myTranslateInstant("lang_auto_thi_sinh_khong_thong_tin")??""});const se=document.createElement("td"),ee=document.createElement("span");return se.setAttribute("docx-style",U.Ip.get("FILL_RESULT",[{key:U.a3,value:b}])),ee.innerText=E.AnswerContent.map(_e=>_e.Content).join(";"),se.appendChild(ee),R.appendChild(se),Z.push({content:`<br>${T.outerHTML}<br><br><br><br>`,answers:[]}),Z}loadNameImage(y){return new Promise((E,T)=>{y&&y.nameImages&&parseInt(y?.id??"0")<=0?this.checkDrawImgNameService.getBase64Url(y.nameImages).then(b=>{b&&y.nameImages&&(y.nameImages.url=b),E(y)}).catch(b=>{T(b)}):E(y)})}loadScriptAction(y=0){return new Promise((E,T)=>{this.commonService.loadScriptPromises([{source:this.cdnService.registerJsCdn("min.azota_docx_script"),name:"min.azota_docx_script"}]).then(()=>{setTimeout(()=>{window.hasOwnProperty("azotaDocx")&&typeof azotaDocx<"u"&&azotaDocx&&E(),++y>3?T(new Error(this.commonService.myTranslateInstant("lang_auto_tai_thu_vien_that_bao_vui_long_load_lai_trang_de_thu_lai"))):this.loadScriptAction(y)},500)}).catch(b=>{T(b)})})}loadCssFrameAction(){return new Promise(y=>{const E=document.createElement("div"),T=b=>{const Z=document.createElement("span");return Z.style.fontFamily=b,Z.innerText="Aa",Z};E.appendChild(T("font_chu_dep")),E.appendChild(T("font_chu_dep_z")),E.appendChild(T("font_chu_in")),E.appendChild(T("font_chu_in_nghieng")),E.appendChild(T("font_chu_in_dam")),E.style.opacity="0",document.body.appendChild(E),setTimeout(()=>{E.remove(),y()},2e3)})}loadLibAction(y){return new Promise((E,T)=>{const b=new h.Q(1,{function:(Z,R,W)=>{y.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_tien_trinh")} ${Z+1}/${R}: ${W}`)}});b.addTask(this,this.loadScriptAction,[],this.commonService.myTranslateInstant("lang_auto_tai_thu_vien")),b.addTask(this,this.loadCssFrameAction,[],this.commonService.myTranslateInstant("lang_auto_tai_tai_nguyen")),b.start().then(Z=>{y.remove(),Z.errs.length>0?T(Z.errs[0]):E()})})}reset(){}checkUrlIsImage(y){return null!=y.match(/\.(jpeg|jpg|png|gif)$/)}loadAztFile(y,E,T){return new Promise((b,Z)=>{fetch(this.cdnService.getRawCdnLink(y.url??"")).then(R=>{R.ok?R.blob().then(W=>{const se=new File([W],y.name??"",{type:y.mimes});"ans"===T?E.isExportAnsMedia&&E.mediaAnswerWraps.push(se):E.isExportMedia&&E.mediaWraps.push(se),b()}):Z(new Error(`${this.commonService.myTranslateInstant("lang_core_khong_the_tai_tep_tin_dinh_kem")} ${y.name}`))}).catch(()=>{Z(new Error(`${this.commonService.myTranslateInstant("lang_core_khong_the_tai_tep_tin_dinh_kem")} ${y.name}`))})})}wrapLoadMedia(y,E){return this.checkUrlIsImage(y)?(0,u.dr)(y,E):new Promise((T,b)=>{T(void 0)})}replaceImageToBase64(y,E,T,b,Z,R){return new Promise((W,he)=>{Object.prototype.hasOwnProperty.call(y,E)&&"string"==typeof y[E]?this.wrapLoadMedia(y[E],Z).then(se=>{if(se){const ee=document.createElement("canvas");ee.width=se.width,ee.height=se.height,ee.getContext("2d")?.drawImage(se,0,0),y[E]=T.canvasList.push(ee)-1,W()}else{R=R?R+1:1;let ee=y[E].split(".");ee=ee.length>0?ee[ee.length-1]:"mp3";const De=this.commonService.createFileNameExportFile([this.commonService.myTranslateInstant("lang_core_file_dinh_kem_o_vi_tri")??"",R.toString(),b])+"."+ee;this.loadAztFile({name:this.commonService.replaceAll(De,"_"," ")??"",url:y[E],path:"",extension:"",mimes:"",size:"0"},T,"ans").then(()=>{W()}).catch(_e=>{he(new Error(this.commonService.myTranslateInstant(_e.message)+(b.length>0?" : "+b:"")))})}}).catch(se=>{he(new Error(this.commonService.myTranslateInstant(se.message)+(b.length>0?" : "+b:"")))}):he(new Error(this.commonService.myTranslateInstant("lang_auto_tai_hinh_anh_khong_thanh_cong")+(b.length>0?" : "+b:"")))})}loadTeacherDrawResult(y,E,T){return new Promise((b,Z)=>{const R={canvasList:[],mediaWraps:[],mediaAnswerWraps:[],isExportAnsMedia:!0},W=new h.Q(3,{function:(he,se)=>{E.pushMsg(`${this.commonService.myTranslateInstant("lang_auto_dang_xu_ly_hinh_anh")} (${he+1}/${se})`)}});if(R.resultTeacherDraw=y,R.resultTeacherDraw){R.resultTeacherDraw.pages?.forEach((se,ee)=>{W.addTask(this,this.replaceImageToBase64,[se,"backgroundImage",R,T,this.cdnService,ee]),se.draw&&W.addTask(this,this.replaceImageToBase64,[se,"draw",R,T,this.cdnService,ee])});const he=this.commonService.castJsonToObj(R.resultTeacherDraw.staticTextConfig??"");if(R.resultTeacherConfig=he,R.resultTeacherConfig&&R.resultTeacherConfig.urlImgCorrect&&R.resultTeacherConfig.urlImgWrong&&(R.resultTeacherConfig.urlImgCorrect=(R.resultTeacherConfig.type?"":"assets/images/classlive/")+R.resultTeacherConfig.urlImgCorrect,R.resultTeacherConfig.urlImgWrong=(R.resultTeacherConfig.type?"":"assets/images/classlive/")+R.resultTeacherConfig.urlImgWrong,W.addTask(this,this.replaceImageToBase64,[R.resultTeacherConfig,"urlImgCorrect",R,T]),W.addTask(this,this.replaceImageToBase64,[R.resultTeacherConfig,"urlImgWrong",R,T])),R.resultTeacherDraw.commentEmoji&&R.resultTeacherDraw.commentEmoji.length>0)for(let se=0;se<R.resultTeacherDraw.commentEmoji.length;se++)R.resultTeacherDraw.commentEmoji[se]="https://azota889.github.io/storage_public/mnote/"+R.resultTeacherDraw.commentEmoji[se],W.addTask(this,this.replaceImageToBase64,[R.resultTeacherDraw.commentEmoji,se,R,T])}W.start().then(he=>{0===he.errs.length?b(R):Z(he.errs[0])})})}capitalized(y){return y?y.charAt(0).toUpperCase()+y.slice(1):""}wrapText(y,E,T,b,Z,R){const W=document.createElement("span");W.innerHTML=this.commonService.removeXssInHtml(E),(E=W.innerText.replace(/<div>/g,"\n").replace(/<\/div>/g,"").replace(/_divbrdiv_/g,"\n").replace(/_divdiv_/g,"")).split("\n").forEach(se=>{for(var ee=se.split(" "),De="",_e=0;_e<ee.length;_e++){var de=De+ee[_e]+" ";y.measureText(de).width>Z&&_e>0?(y.fillText(De,T,b),De=ee[_e]+" ",b+=R):De=de}y.fillText(De,T,b)})}getLineImageAnswer(y){const E=[];return y.mediaAnswerWraps&&y.isExportAnsMedia&&y.mediaAnswerWraps.forEach(T=>{E.push({content:`<span color="2196f3">{${this.commonService.myTranslateInstant("lang_core_dinh_kem_file_tai")} attachments/${T.name}}</span>`,answers:[]})}),y.resultTeacherDraw&&y.resultTeacherDraw.pages?.forEach(T=>{let b=y.canvasList[Number(T.backgroundImage)];if(b){const Z=document.createElement("canvas");Z.width=T.width??1,Z.height=T.height??1;const R=Z.getContext("2d");if(R){R.fillStyle="#FFFFFF",R.fillRect(0,0,Z.width,Z.height);let se=document.createElement("canvas"),ee=se.getContext("2d");0!==T.rotation&&ee?(90===Math.abs(T.rotation??0)?(se.width=b.height,se.height=b.width):(se.width=b.width,se.height=b.height),ee.translate(se.width/2,se.height/2),ee.rotate(((T.rotation??0)>0?1:-1)*(T.rotation??0)*Math.PI/180),ee.drawImage(b,-b.width/2,-b.height/2),ee.restore()):se=b;const De=Z.height/se.height*se.width;if(R.drawImage(se,0,0,se.width,se.height,(Z.width-De)/2,0,De,Z.height/se.height*se.height),T.draw){const Ee=y.canvasList[Number(T.draw)];Ee&&R.drawImage(Ee,0,0)}if(T.staticText&&T.staticText.length>0&&T.staticText.forEach(Ee=>{if(R.font=`${y.resultTeacherConfig?.fontSize}px ${y.resultTeacherConfig?.fontText}`,R.fillStyle=y.resultTeacherConfig?.fontColor??"#000000",y.resultTeacherConfig?.useCorrectText&&"correct"==Ee.value&&this.wrapText(R,y.resultTeacherConfig?.textCorrect??"",Ee.x,Ee.y,Z.width-Ee.x,25),y.resultTeacherConfig?.useCorrectText&&"wrong"==Ee.value&&this.wrapText(R,y.resultTeacherConfig?.textWrong??"",Ee.x,Ee.y,Z.width-Ee.x,25),!y.resultTeacherConfig?.useCorrectText&&"correct"==Ee.value){const we=y.canvasList[Number(y.resultTeacherConfig?.urlImgCorrect)];we&&R.drawImage(we,0,0,we.width,we.height,Ee.x,Ee.y,30,30)}if(!y.resultTeacherConfig?.useWrongText&&"wrong"==Ee.value){const we=y.canvasList[Number(y.resultTeacherConfig?.urlImgWrong)];we&&R.drawImage(we,0,0,we.width,we.height,Ee.x,Ee.y,30,30)}}),T.objText&&T.objText.length>0){let Ee=300;T.objText.forEach(we=>{R.font=`${parseFloat(we.textStyle.size)}px ${we.textStyle.font}`,R.fillStyle=we.textStyle.color,R.textAlign=we.textStyle.align??"center",R.lineWidth=we.textStyle.width??Ee,this.wrapText(R,we.value,we.x,we.y,Z.width-we.x,25)})}}const W=693,he=W/Z.width;E.push({content:`<img src="${Z.toDataURL()}" style="width:${W}px;height:${Z.height*he}px" /><br/>`,answers:[]})}}),0===E.length?E.push({content:`<br/><br/>${U.Ip.createLineCenterBold(this.commonService.myTranslateInstant("lang_auto_khong_co_anh_bai_lam_tu_luan")??"").outerHTML}<br/><br/>`,answers:[]}):E.unshift({content:`<br/>${U.Ip.createLineCenterBold(this.commonService.myTranslateInstant("lang_auto_anh_bai_lam_tu_luan")??"").outerHTML}<br/>`,answers:[]}),E}convertDataMarkNote(y){return new Promise((E,T)=>{y&&y.urlDataMark?this.cdnService.loadTextCdn(y.urlDataMark).subscribe(b=>{const Z=this.zipDataService.decodeContentGzip(b),R=this.commonService.castJsonToObj(Z);y.pages=[];let W={};R?.pages.forEach((ee,De)=>{let _e={width:ee.width,height:ee.height,draw:ee.draws?.[0]?.src??void 0,backgroundImage:ee.backgroundSrc,rotation:ee.backgroundRotate,objText:[],staticText:[]};ee.childData?.length&&ee.childData.forEach((de,Ee)=>{if("UIQuickMark"==de.className&&(_e.staticText?.push({x:de.x+5,y:de.y+(de.height+5+de.fontSize)/2,value:"type_right"===de.type?"correct":"wrong"}),0===Ee&&(W={txtCommentFont:de.fontFace?.family??"font_chu_dep",useCorrectText:!0,useWrongText:!0,correctWidth:de.width,correctHeight:de.height,wrongWidth:de.width,wrongHeight:de.height,fontText:de.fontFace?.family??"font_chu_dep",fontColor:"red",fontSize:de.fontSize??30,textWrong:"s",textCorrect:"\u0111",type:"v2"})),!W.urlImgWrong&&"type_wrong"==de.type&&(W.urlImgWrong=de.imageSrc),!W.urlImgCorrect&&"type_right"==de.type&&(W.urlImgCorrect=de.imageSrc),!W.textWrong&&"type_wrong"==de.type&&(W.textWrong=de.textContent),!W.textCorrect&&"type_right"==de.type&&(W.textCorrect=de.textContent),W.useCorrectText=!W.urlImgCorrect,W.useWrongText=!W.urlImgWrong,"UIText"===de.className){let we=this.getStyleContent(de.textContent);_e.objText?.push({x:de.x+15,y:de.y+15,value:de.textContent,textStyle:{size:de.fontSize?de.fontSize:we?.fontSize,align:we?.textAlign??"left",color:we?.color,fill:!0,font:we?.fontFamily}})}}),y.pages?.push(_e)}),y.staticTextConfig=this.commonService.serializeJson(W),E(y)}):E(y??{})})}getStyleContent(y){let E=document.createElement("div");E.innerHTML=y;let T=E.querySelector("p"),b=E.querySelector("span");return b?{fontSize:b.style.fontSize,color:b.style.color,fontFamily:b.style.fontFamily,textAlign:T?.style.textAlign??"left"}:void 0}getTextContentInTagHTML(y){return(new DOMParser).parseFromString(y,"text/html").body.textContent??y}constructor(y,E,T,b,Z,R,W,he,se,ee,De,_e,de){this.dialog=y,this.checkDrawImgNameService=E,this.cdnService=T,this.zipDataService=b,this.exportPdfUtilsService=Z,this.answerTypeService=R,this.exportPdfConvertDataService=W,this.questionRenderService=he,this.commonService=se,this.answerService=ee,this.examResultService=De,this.testedListApiService=_e,this.shareFileFlutterService=de,this.logger=new Ce.O,this.expandInfoParse={}}get percent(){return this.logger.percent}get keyLoading(){return this.logger.lines}get isLoading(){return this.logger.run??!1}}return J.\u0275fac=function(y){return new(y||J)(d.LFG(_.uw),d.LFG(H.k),d.LFG(M.U),d.LFG(oe.D),d.LFG(F.V),d.LFG(ne.T),d.LFG(k.S),d.LFG(N.L),d.LFG(G.v),d.LFG(ue.P6),d.LFG(te.kS),d.LFG(be.x),d.LFG(Ae.g))},J.\u0275prov=d.Yz7({token:J,factory:J.\u0275fac,providedIn:"root"}),J})()},43216:(Qe,ce,v)=>{v.d(ce,{O:()=>D});class D{pushChild(u){this.child.push(u)}pushMsg(u){this.msg=u}start(u){this.run=!0,u&&(this.msg=u)}remove(){this.run=!1,this.msg="",this.child=[],this.percent=void 0}get lines(){const u=[];return this.msg&&""!==this.msg&&u.push(this.msg),`<p>${u.concat(this.lineChild).join("</p><p>")}</p>`}get lineChild(){let u=[];return this.child.filter(_=>_.run).forEach(_=>{u=u.concat(_.lines)}),u}constructor(u=!1,_="",le){this.run=u,this.msg=_,this.percent=le,this.child=[]}}},4779:(Qe,ce,v)=>{v.d(ce,{n:()=>d});var D=v(65879),h=v(87384),u=v(50626),_=v(31518),le=v(46825);let d=(()=>{class Q{_saveSortTypeOfSetting(S){this.browserStorageService.saveSimpleStorage(this.sortByStorageKey,S)}_removeSortTypeOfSetting(){this.browserStorageService.removeSimpleStorage(this.sortByStorageKey)}_getSortTypeOfSetting(S){return this.browserStorageService.getSimpleStorage(this.sortByStorageKey)==S}_getCurrentSortTypeOfSetting(){return this._getSortTypeOfSetting("isSortByNameAsc")?"isSortByNameAsc":this._getSortTypeOfSetting("isSortByMarkDesc")?"isSortByMarkDesc":this._getSortTypeOfSetting("isSortByTimeDesc")?"isSortByTimeDesc":void 0}_filterExamResultObjsByFilterSettingObjByClassroom(S,m){var x=[];return m.forEach(g=>{g.results=this._filterExamResultObjsByFilterSettingObjNotInClassroom(S,g.results??new Array),x.push(g)}),x}_filterExamResultObjsByFilterSettingObjNotInClassroom(S,m){var x=[];if(S.isMarked||S.isNotMarked||S.isOnTest||S.isNotSubmit||S.isNotTested)for(var g of m){let j=!1,I=S.isOnTest||S.isNotSubmit;S.isMarked&&1==g.isMarked&&(!I||!(1!=g.status&&(g.isMarked||g.isNotMarked)))&&(j=!0),S.isNotMarked&&1==g.isNotMarked&&(!I||!(1!=g.status&&(g.isMarked||g.isNotMarked)))&&(j=!0),S.isOnTest&&(1==g.isOnTest||0==g.status&&(g.isMarked||g.isNotMarked))&&(j=!0),S.isNotTested&&1==g.isNotTested&&(j=!0),S.isNotSubmit&&(1==g.isNotSubmit||-1==g.status&&(g.isMarked||g.isNotMarked))&&(j=!0),j&&x.push(g)}else x=m;return x}_searchExamResultObjsByFullNameInClassroom(S,m){var x=[];return this.commonService.myClone(S).forEach(j=>{var I=this._searchExamResultObjsByFullNameNotInClassroom(j.results??[],m);I.length>0&&(j.results=I,x.push(j))}),x}_searchExamResultObjsByFullNameNotInClassroom(S,m){m=this.commonService.convertVietnameseToEnglish(m).toLowerCase();var x=[];return S.forEach(g=>{-1!=this.commonService.convertVietnameseToEnglish(g.fullName??"").toLowerCase().indexOf(m)&&x.push(g)}),x}_sortExamResultObjsBySettingObjByClassroom(S,m,x){return"isSortByNameAsc"==x?this.sortService.sortFirstNameStudentsInClass(S):"isSortByTimeDesc"==x?this.sortService.sortTimeStudentsInClass(S,1):"isSortByMarkDesc"==x?this.sortService.sortMarkStudentsInClass(S,1,m):this._sortExamResultObjsBySortTypeOfClassroom(S)}_sortExamResultObjsBySettingObjNotInClassroom(S,m,x){return"isSortByNameAsc"==x?this.sortService.sortFirstNameStudents(S):"isSortByTimeDesc"==x?this.sortService.sortTimeDESC(S):"isSortByMarkDesc"==x?this.sortService.sortMarkDESC(S,m):S}_sortExamResultObjsBySortTypeOfClassroom(S){var m=this.commonService.myClone(S);return m.forEach((x,g)=>{x.results=0==x.classObj?.sortType?this.sortService.sortFirstNameStudents(x.results??[]):this.sortService.sortArrayByMultipleObjectKeyAsc(x.results??[],"pos","id"),m[g]=x}),m}_changeExamResultStatusForAllClassroom(S,m,x){var g=[];return S.forEach((j,I)=>{j.results=this._changeExamResultStatusForOneClassroom(j.results??new Array,m),j={indexCounter:I,...j,countSubmitted:x?j.classObj?.countSubmitted:this._countTotalSubmittedOfExamResultObjs(j.results??new Array)},g.push(j)}),g}_changeExamResultStatusForOneClassroom(S,m){var x=[...S];return x.forEach((g,j)=>{g.confirmedAt&&""!=g.confirmedAt&&g.resultId&&g.resultId>0?g.isMarked=!0:g.resultId&&g.resultId>0&&(!g.confirmedAt||""==g.confirmedAt)?g.isNotMarked=!0:g.resultId&&0!=g.resultId||!g.startedTest||""==g.startedTest||0!=g.status?g.resultId&&0!=g.resultId||!g.startedTest||""==g.startedTest||-1!=g.status?null==g.startedTest&&(g.isNotTested=!0):g.isNotSubmit=!0:g.isOnTest=!0,x[j]=g}),x.forEach((g,j)=>{g.files&&""!=g.files&&!Array.isArray(g.files)&&(g.filesParse=this.commonService.myParseJson(g.files)),x[j]=g}),x}_countTotalSubmittedOfExamResultObjs(S){var m=0;return S.forEach(x=>{(x.isMarked||x.isNotMarked)&&m++}),m}_counterTotalEssayOfQuestionObjs(S){let m=0;return S.forEach(x=>{this.answerTypeService.isEssayAnswer(x.answerType&&x.answerType)&&m++}),m}_checkCounterEssayQuestionObjs(S){let m=0;return S.forEach(x=>{x.isEssay&&m++}),m}constructor(S,m,x,g){this.commonService=S,this.sortService=m,this.browserStorageService=x,this.answerTypeService=g,this.sortByStorageKey="exam_list_sort_by"}}return Q.\u0275fac=function(S){return new(S||Q)(D.LFG(h.v),D.LFG(u.K),D.LFG(_.z),D.LFG(le.T))},Q.\u0275prov=D.Yz7({token:Q,factory:Q.\u0275fac,providedIn:"root"}),Q})()},67517:(Qe,ce,v)=>{v.d(ce,{x:()=>x});var D=v(65592),h=v(65879),u=v(87384),_=v(71284),le=v(94281),d=v(38474),Q=v(31518),B=v(51026),S=v(67854),m=v(4779);let x=(()=>{class g{constructor(I,A,O,q,w,Y,K,Le){this.commonService=I,this.examPageResultService=A,this.permissionService=O,this.globalService=q,this.browserStorageService=w,this.gzipHelper=Y,this.homeworkExamService=K,this.examResultListSortService=Le}getTestedUserObjs(I,A,O){return this.globalService.startIntervalFunc(I),this.getTestedOfExamResult(I,A,"default",O)}getTestedLastMark(I,A,O){return this.globalService.startIntervalFunc(I),this.getTestedOfExamResult(I,A,"last",void 0,O)}getTestedHighestMark(I,A,O){return this.globalService.startIntervalFunc(I),this.getTestedOfExamResult(I,A,"highest",void 0,O)}getTestedFirstMark(I,A,O){return this.globalService.startIntervalFunc(I),this.getTestedOfExamResult(I,A,"first",void 0,O)}getTestedAllResult(I,A,O){return this.globalService.startIntervalFunc(I),this.getTestedOfExamResult(I,A,"all",void 0,O)}getTestedOfExamResult(I,A,O,q,w){return new D.y(Y=>{let K="tested_list_result_v2_"+A,Le=this.browserStorageService.getSimpleSessionStorage(K)??"",pe=this.gzipHelper.resultContentSupport(Le),Xe=pe&&this.commonService.willDeleteParseJson(pe)?this.commonService.willDeleteParseJson(pe):void 0;q&&Le&&Xe?(Y.next({status:200,success:1,data:Xe,message:"successful"}),Y.complete()):this.examPageResultService.apiExamPageResultGetObjV2Get(A).subscribe(Ve=>{if(1==Ve.success){let Ft=Ve.data?.serverSecond??0,bt=Ve.data?.examObj,Ke=Ve.data?.classroomWithAvatarAndStudentObjs??new Array,Zt=Ve.data?.totalAttended??0,xe=Ve.data?.examQuestionObjs??new Array,$e=Ve.data?.examCreatorObj,V=Ve.data?.offlineExamObj,$=Ve.data?.hasEssayQuestion,ie=Ve.data?.totalQuestion??0,Ie=Ve.data?.offlineMixQuestionObjs,Pe=Ve.data?.canResetStudentCode,ke=Ve.data?.hasCreateStudentCode,Be=Ve.data?.fileTypeStr??"";this.permissionService.hasViewExamPermission("exam",bt?.permissionObj)||this.permissionService.hasConfigAndMarkClassroomPermission("exam",bt?.permissionObj)?this.getAllExamResultObjs(I,[],A,"",U=>{if(U.hasOwnProperty("success")&&1==U.success){let Ce=this.mergeStudentWithAvatar(U.studentWithResultObjs??[]),H={},M=[];Ce?.forEach(te=>{let be=te.parentId??"0";H.hasOwnProperty(be)?H[be].push(...te.examResultObjs??[]):H[be]=te.examResultObjs??[],M=M.concat(H[be])});let oe=bt?this.filterExamResultOnTest(M,bt,Ft):{},F=[],ne=[];if(this.homeworkExamService.mustInClassroom(bt?.whoAllow??0)&&Ke.length>0)for(let te=0;te<Ke.length;te++){let be=Ke[te].classroomObj,Ae=Ke[te].studentObjs??[],Ue=[];if(Ae.length>0)for(let J=0;J<Ae.length;J++){let Oe=Ae[J].parentId??"0";this.commonService.filterArray(ne,Ae[J].parentId)||ne.push(Ae[J].parentId??"0"),H.hasOwnProperty(Oe)&&(Array.isArray(Ae[J].examResultObjs)||(Ae[J].examResultObjs=[]),Ae[J].examResultObjs=this.findExamResultOfStudent(H[Oe],Ae[J].id??"0"));let y=oe.hasOwnProperty(Ae[J].parentId??0)?oe[Ae[J].parentId??0]:0;if("all"==O)if(Ae[J].examResultObjs?.length)Ae[J].examResultObjs?.forEach((E,T)=>{let b=this.commonService.castJsonToObj(JSON.stringify(E));b&&(b.resultId=b.testStatus&&b.testStatus>0?b.id:0);let Z=this.createStudentWithResult(Ae[J],b,y,ie,T,Ae[J].examResultObjs?.length??0);Ue.push(Z)});else{let E=this.createStudentWithResult(Ae[J],void 0,y,ie,-1,0);Ue.push(E)}else{let E=this.filterExamResultByType(Ae[J].examResultObjs??[],O),T=E.hasOwnProperty(Ae[J].parentId??0)?E[Ae[J].parentId??0]:void 0,Z=this.createStudentWithResult(Ae[J],T,y,ie,(T&&null!=T.indexTest&&T.indexTest>=0?T.indexTest:"first"==O?0:(Ae[J].examResultObjs?.length??0)-1)??0,Ae[J].examResultObjs?.length??0);Ue.push(Z)}}F.push({classObj:be,results:Ue})}let k=[],N=this.commonService.myClone(Ce)??[];for(let te=0;te<N?.length;te++)if(!this.commonService.filterArray(ne,N[te].parentId)){let be=oe.hasOwnProperty(N[te].parentId??0)?oe[N[te].parentId??0]:0;if("all"==O)if(N[te].examResultObjs?.length)N[te].examResultObjs?.forEach((Ae,Ue)=>{let J=this.commonService.castJsonToObj(JSON.stringify(Ae));J&&(J.resultId=J.testStatus&&J.testStatus>0?J.id:0);let Oe=this.createStudentWithResult(N[te],J,be,ie,Ue,N[te].examResultObjs?.length??0);k.push(Oe)});else{let Ae=this.createStudentWithResult(N[te],void 0,be,ie,-1,0);k.push(Ae)}else{let Ae=this.filterExamResultByType(N[te].examResultObjs??[],O),Ue=Ae.hasOwnProperty(N[te].parentId??0)?Ae[N[te].parentId??0]:void 0,Oe=this.createStudentWithResult(N[te],Ue,be,ie,(Ue&&null!=Ue?.indexTest&&Ue.indexTest>=0?Ue.indexTest:"first"==O?0:(N[te].examResultObjs?.length??0)-1)??0,N[te].examResultObjs?.length??0);k.push(Oe)}}"all"!=O&&k.sort((te,be)=>this.compareTwoDate(te.createdAt??"",be.createdAt??""));let G=0;(F.length||k.length)&&(F.forEach(te=>{te.results?.forEach(be=>{let Ae=this.getMaxGroupId(be.groupPoints??[]);G<Ae&&(G=Ae)})}),k.forEach(te=>{let be=this.getMaxGroupId(te.groupPoints??[]);G<be&&(G=be)})),"export_tool"==I&&w?.length&&(F=F.filter(te=>this.commonService.filterArray(w,te.classObj?.id)),this.commonService.filterArray(w,-1)||(k=[]));let ue={studentsInClassResults:F.length>0?F:[],studentsNotInClassResults:k.length>0?k:[],totalAttended:Zt,totalQuestion:ie,totalUsers:0,examCreatorObj:$e,offlineMixQuestionObjs:Ie,examObj:bt,hasEssayQuestion:$,offlineExamObj:V,canResetStudentCode:Pe,hasCreateStudentCode:ke,questionObjs:xe,fileTypeStr:Be,errorConfigClassroomPermission:Ve.data?.errorConfigClassroomPermission,errorMessage:Ve.data?.errorMessage,maxGroupId:G};if("export_tool"!=I){let te=this.gzipHelper.zipBigContent(JSON.stringify(ue));this.browserStorageService.saveSimpleSessionStorage(K,te)}Y.next({status:200,success:1,data:ue,message:"successful"}),Y.complete()}else Y.next({status:U.code,success:0,data:null,message:U.message??""}),Y.complete()}):(Y.next({status:200,success:1,data:{studentsInClassResults:[],studentsNotInClassResults:[],totalAttended:Zt,totalQuestion:ie,hasEssayQuestion:$,totalUsers:0,examCreatorObj:$e,offlineMixQuestionObjs:Ie,examObj:bt,offlineExamObj:V,canResetStudentCode:Pe,hasCreateStudentCode:ke,questionObjs:xe,fileTypeStr:Ve.data?.fileTypeStr,errorConfigClassroomPermission:Ve.data?.errorConfigClassroomPermission,errorMessage:Ve.data?.errorMessage,maxGroupId:0},message:"successful"}),Y.complete())}else Y.next({status:Ve.code,success:0,data:null,message:Ve.message??""}),Y.complete()})})}getAllExamResultObjs(I,A,O,q,w){this.examPageResultService.apiExamPageResultGetObjsV2Get(O,"test_review"==I||"export_tool"==I?"export":"tested_list",q).subscribe(K=>{1==K.success?(K.data?.objs&&A.push(...K.data.objs),K.data?.nextPage?this.globalService.isStopIntervalFunc(I)?w({studentWithResultObjs:A,success:1}):setTimeout(()=>{this.getAllExamResultObjs(I,A,O,K.data?.nextPage??"",w)},300):w({studentWithResultObjs:A,success:1})):w({code:K.code,studentWithResultObjs:[],success:0,message:K.message??""})})}compareTwoDate(I,A){var O=new Date(I).getTime();O=isNaN(O)?0:O;var q=new Date(A).getTime();return O-(q=isNaN(q)?0:q)>0?1:O-q<0?-1:0}filterExamResultOnTest(I,A,O){var q={};return I.forEach(w=>{var Y=this.commonService.myClone(w)??{};if(Y.testStatus)q[Y.userId??0]=Y.testStatus;else if(Y.startedTest&&O)if(A.endTime){var K=Math.floor(new Date(A.endTime).getTime()/1e3);q[Y.userId??0]=O<=K+60*(A.minutes??0)+600?0:-1}else{var Le=Y.startedTest?Math.floor(new Date(Y.startedTest).getTime()/1e3):0;q[Y.userId??0]=O<=Le+86400?0:-1}else q[Y.userId??0]=0}),q}filterExamResultByType(I,A){var O={};if(I.length>1)I.forEach((w,Y)=>{var K=this.commonService.myClone(w);w.testStatus&&(K.resultId=K.id,K.indexTest=Y,"default"==A&&(O[K.userId??0]=K),"last"==A&&(O[K.userId??0]=K),"first"==A&&(O.hasOwnProperty(K.userId??0)||(O[K.userId??0]=K)),"highest"==A)&&(O.hasOwnProperty(K.userId??0)?(O[K.userId??0].mark??-1)<=(K.mark??-1)&&(O[K.userId??0]=K):O[K.userId??0]=K)});else{var q=this.commonService.myClone(I[0]??{});q.resultId=q.testStatus?q.id:0,q.indexTest=0,O[q.userId??0]=q}return O}findExamResultOfStudent(I,A){var O=[];return I.forEach(q=>{(q.studentId==A||null==q.studentId)&&O.push(q)}),O}addResultIdToExamResult(I){var A=[];return I.forEach(O=>{var q=this.commonService.myClone(O)??{};q.resultId=q.id,q.testStatus&&A.push(q)}),A}compareLengthWithExamQuestion(I,A){var O=this.commonService.myClone(I);if(A>0&&I.length<A)for(var q=0;q<A-I.length;q++)O.push("");return O}mergeStudentWithAvatar(I){var A=[];return I.forEach(O=>{var q=A.filter(Y=>Y.parentId==O.parentId);if(q&&0!=q.length)for(var w=0;w<A.length;w++)A[w].parentId==O.parentId&&(A[w].examResultObjs=A[w].examResultObjs?.concat(O.examResultObjs??[]));else A.push(O)}),A}createStudentWithResult(I,A,O,q,w,Y){return{id:I.id,userId:I.parentId,studentId:I.id,identificationNumber:A?.examResultStatisticObj?.offlineMarkInfoObj?.studentCode??0,offlineMixQuestionHashId:A?.offlineMark?.rawOfflineMixquestionId??0,studentCode:A?.offlineMark?.studentCode??0,gender:I.gender,fullName:I.fullName,avatar:I.avatar,birthday:I.birthday,resultId:A?.hasOwnProperty("resultId")?A.resultId:0,answers:A?.hasOwnProperty("answers")?A.answers:null,rightAnswer:A?.hasOwnProperty("rightAnswer")?A.rightAnswer:0,totalQuestion:A?.hasOwnProperty("totalQuestion")?A.totalQuestion:0,mark:A?.hasOwnProperty("mark")?A?.mark:null,trueFalseMark:A?.hasOwnProperty("trueFalseMark")?A.trueFalseMark:null,essayMark:A?.hasOwnProperty("essayMark")?A.essayMark:null,files:A?.hasOwnProperty("files")?A.files:null,infors:A?.hasOwnProperty("infors")?A?.infors:null,confirmedAt:A?.hasOwnProperty("confirmedAt")?A?.confirmedAt:null,startedTest:A?.hasOwnProperty("startedTest")?A?.startedTest:null,createdAt:A?.hasOwnProperty("createdAt")?A.createdAt:null,allResultObjs:this.addResultIdToExamResult(I.examResultObjs??[]),answeredQuestions:A?.hasOwnProperty("answeredQuestions")?A.answeredQuestions:[],groupPoints:this.getGroupPoints(A?.answeredQuestions?A?.answeredQuestions:[]),classroomIds:[],eventTracks:{exitCount:A?.examTrackObj?.exitFullScreen,blurCount:A?.examTrackObj?.blurWindow},status:O,nameImages:I.nameImages,nameImage:"",answerMixObjs:this.compareLengthWithExamQuestion(A?.answerMixObjs??[],q)??[],testedTime:w+1,totalTestTime:Y,subjectMarkValues:A?.subjectMarks,isOffline:A?.isOffline??!1,countEssayQuestion:this.examResultListSortService._checkCounterEssayQuestionObjs(A?.hasOwnProperty("answeredQuestions")&&A?.answeredQuestions?A.answeredQuestions:[])}}getGroupPoints(I){let A=[];return I.forEach(O=>{let q=!1;for(let w=0;w<A.length;w++)A[w].id==O.groupId&&(q=!0,A[w].point+=O.correct&&O.scorePerQuestion?O.scorePerQuestion:0);!q&&O.groupId&&A.push({id:O.groupId,point:O.correct&&O.scorePerQuestion?O.scorePerQuestion:0})}),A.sort((O,q)=>(O.id??0)-(q.id??0)),A}getMaxGroupId(I){let A=[];return I.forEach(O=>{O.id&&!this.commonService.filterArray(A,O.id)&&A.push(O.id)}),A.length}}return g.\u0275fac=function(I){return new(I||g)(h.LFG(u.v),h.LFG(_.DR),h.LFG(le.$),h.LFG(d.U),h.LFG(Q.z),h.LFG(B.n),h.LFG(S.j),h.LFG(m.n))},g.\u0275prov=h.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()},67898:(Qe,ce,v)=>{v.d(ce,{W:()=>h});var D=v(65879);let h=(()=>{class u{processData(le){let d=[],Q=[];if(le)for(var B=0;B<le.length;B++)if("scroll"!=le[B][0]){var S={index:le[B][0],alpha:le[B][1],key:le[B][2],questionId:Number(le[B][3]),second:Number(le[B][4])};d.push(S)}else{var m={scrollPos:Number(le[B][1]),second:Number(le[B][2])};Q.push(m)}return[d,Q]}}return u.\u0275fac=function(le){return new(le||u)},u.\u0275prov=D.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},42014:function(Qe,ce,v){var D=this&&this.__awaiter||function(le,d,Q,B){return new(Q||(Q=Promise))(function(m,x){function g(A){try{I(B.next(A))}catch(O){x(O)}}function j(A){try{I(B.throw(A))}catch(O){x(O)}}function I(A){A.done?m(A.value):function S(m){return m instanceof Q?m:new Q(function(x){x(m)})}(A.value).then(g,j)}I((B=B.apply(le,d||[])).next())})};Object.defineProperty(ce,"__esModule",{value:!0}),ce.decodeScanOfflineFile=ce.decode=void 0;const h=v(42588);ce.decode=function u(le){return D(this,void 0,void 0,function*(){return h.AzotaFileDecode.decode(le)})},ce.decodeScanOfflineFile=function _(le){return D(this,void 0,void 0,function*(){return h.AzotaFileDecode.decodeScanOfflineFile(le)})}},23597:(Qe,ce,v)=>{Object.defineProperty(ce,"__esModule",{value:!0}),ce.AzotaFile=ce.FileType=void 0;const D=v(34416),h=v(99025);class u{}ce.FileType=u,u.scanOffline="scanOffline";class _{constructor(){}static fromZipFolder(d){let Q=new _;return Q.folder=d,Q.readAztMain(),Q}readAztMain(){let d=this.folder.getUtf8Text("main.json");if(null==d)throw new D.InvalidAztFileException("Couldn't found main.json file");this.aztMain=h.AztMain.fromJsonString(d)}}ce.AzotaFile=_},42588:function(Qe,ce,v){var D=this&&this.__awaiter||function(d,Q,B,S){return new(B||(B=Promise))(function(x,g){function j(O){try{A(S.next(O))}catch(q){g(q)}}function I(O){try{A(S.throw(O))}catch(q){g(q)}}function A(O){O.done?x(O.value):function m(x){return x instanceof B?x:new B(function(g){g(x)})}(O.value).then(j,I)}A((S=S.apply(d,Q||[])).next())})};Object.defineProperty(ce,"__esModule",{value:!0}),ce.AzotaFileDecode=void 0;const h=v(81831),u=v(34850),_=v(23597);class le{static decode(Q){return D(this,void 0,void 0,function*(){return h.ZipFolder.fromZip(Q).then(B=>{let S=_.AzotaFile.fromZipFolder(B);return S.aztMain.fileType==_.FileType.scanOffline?u.ScanOfflineFile.fromZipFolder(S.folder):S})})}static decodeScanOfflineFile(Q){return le.decode(Q).then(B=>B)}}ce.AzotaFileDecode=le},99025:(Qe,ce,v)=>{Object.defineProperty(ce,"__esModule",{value:!0}),ce.AztMain=void 0;const D=v(33516);class h{static fromJsonString(_){return h.fromJson(JSON.parse(_))}static fromJson(_){return(0,D.plainToInstance)(h,_)}}ce.AztMain=h},34416:(Qe,ce)=>{Object.defineProperty(ce,"__esModule",{value:!0}),ce.InvalidAztFileException=void 0;class v extends Error{constructor(h){super(h)}}ce.InvalidAztFileException=v},59096:(Qe,ce,v)=>{Object.defineProperty(ce,"__esModule",{value:!0}),ce.Point2d=ce.DrawingRectangle=ce.DrawingCircle=ce.AnswerRegionResult=ce.StudentCodeRegionResult=ce.ExamCodeRegionResult=ce.ScanOfflineResult=ce.ScanOfflineData=void 0;const D=v(33516);class h{static fromJsonString(x){return h.fromJson(JSON.parse(x))}static fromJson(x){return(0,D.plainToInstance)(h,x)}}ce.ScanOfflineData=h,ce.ScanOfflineResult=class u{},ce.ExamCodeRegionResult=class _{},ce.StudentCodeRegionResult=class le{},ce.AnswerRegionResult=class d{},ce.DrawingCircle=class Q{},ce.DrawingRectangle=class B{},ce.Point2d=class S{}},34850:(Qe,ce,v)=>{Object.defineProperty(ce,"__esModule",{value:!0}),ce.ScanOfflineFile=void 0;const D=v(23597),h=v(34416),u=v(59096);class _ extends D.AzotaFile{constructor(){super()}static fromZipFolder(d){let Q=new _;if(Q.folder=d,Q.readAztMain(),Q.aztMain.fileType!=D.FileType.scanOffline)throw new h.InvalidAztFileException(`fileType must be ${D.FileType.scanOffline}`);let S=d.getUtf8Text(Q.aztMain.detailPath);if(null==S)throw new h.InvalidAztFileException(`Couldn't found ${S} file`);return Q.scanOfflineData=u.ScanOfflineData.fromJsonString(S),Q}getWrappedImage(){var d,Q;return null==(null===(Q=null===(d=this.scanOfflineData)||void 0===d?void 0:d.scanResult)||void 0===Q?void 0:Q.wrappedScanFilePath)?null:this.folder.getBinary(this.scanOfflineData.scanResult.wrappedScanFilePath)}getWrappedImageExtension(){var d,Q;let B=null===(Q=null===(d=this.scanOfflineData)||void 0===d?void 0:d.scanResult)||void 0===Q?void 0:Q.wrappedScanFilePath;return null==B?null:B.substring(B.lastIndexOf("."))}}ce.ScanOfflineFile=_},81831:function(Qe,ce,v){var D=this&&this.__awaiter||function(_,le,d,Q){return new(d||(d=Promise))(function(S,m){function x(I){try{j(Q.next(I))}catch(A){m(A)}}function g(I){try{j(Q.throw(I))}catch(A){m(A)}}function j(I){I.done?S(I.value):function B(S){return S instanceof d?S:new d(function(m){m(S)})}(I.value).then(x,g)}j((Q=Q.apply(_,le||[])).next())})};Object.defineProperty(ce,"__esModule",{value:!0}),ce.ZipFolder=void 0;const h=v(85965);class u{constructor(le){this.files=new Map,le.forEach((d,Q)=>{this.files.set(Q,d)})}static fromZip(le){return D(this,void 0,void 0,function*(){let Q=yield(new h).loadAsync(le).then(B=>{const S=[];return B.forEach(function(m){let x=B.file(m);x&&S.push(x.async("uint8array").then(g=>({path:m,data:g})))}),S});return Promise.all(Q).then(B=>{let S=new Map;return B.forEach(m=>{S.set(m.path,m.data)}),new u(S)})})}setBinary(le,d){this.files.set(le,d)}setUtf8Text(le,d){let Q=(new TextEncoder).encode(d);this.files.set(le,Q)}getBinary(le){var d;return null!==(d=this.files.get(le))&&void 0!==d?d:null}getUtf8Text(le){let d=this.files.get(le);return null===d?null:(new TextDecoder).decode(d)}toDocx(){return D(this,void 0,void 0,function*(){const le=new h;for(let[d,Q]of Array.from(this.files))le.file(d,Q,{binary:!0});return le.generateAsync({type:"uint8array",compression:"DEFLATE",compressionOptions:{level:9}})})}toBlob(){return D(this,void 0,void 0,function*(){const le=new h;for(let[d,Q]of Array.from(this.files))le.file(d,Q,{binary:!0});return le.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}})})}}ce.ZipFolder=u}}]);