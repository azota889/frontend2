(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[844],{3760:(S,M,l)=>{"use strict";l.d(M,{Q:()=>C});class C{constructor(m,a,i,u){this.tasks=new Array,this.count_task_root_done=0,this.task_runner=new Array,this.task_runner_index=-1,this.all_tasks=0,this.count_task_item_done=0,this.is_runner=!1,this.wrap_counter=0,this.wrap_counter_done=0,this.limit_one_process=m,this.result_common={datas:[],errs:[]},this.actionLogItem=a,this.delay_time=i||1e3,this.endWithError=u??!1}addTask(m,a,i,u){var c=i||[];if(!this.is_runner){const p=()=>new Promise(n=>{this.wrap_counter++,this.actionLogItem&&this.all_tasks>0&&this.actionLogItem.function.call({},this.wrap_counter_done,this.all_tasks,...this.actionLogItem.params?this.actionLogItem.params:[],u),a.call(m,...c).then(e=>{this.wrap_counter_done++,n({status:!0,value:e})}).catch(e=>{this.wrap_counter_done++,n({status:!1,error:e})})});this.all_tasks++;let o=new Array;if(this.tasks.length>0?o=this.tasks[this.tasks.length-1]:this.tasks.push(o),o.length<this.limit_one_process)o.push({task:p,name:u});else{let n=new Array;n.push({task:p,name:u}),this.tasks.push(n)}}}start(){return new Promise(m=>{0===this.tasks.length&&(this.clear(),m({datas:[],errs:[]})),this.result_common={datas:[],errs:[]},this.task_runner_index=-1,this.count_task_root_done=0,this.count_task_item_done=0,this.is_runner=!0,this.runnerItem(m)})}restart(){this.result_common={datas:[],errs:[]},this.clear()}clear(){this.count_task_root_done=0,this.count_task_item_done=0,this.tasks=[],this.all_tasks=0,this.task_runner_index=-1,this.wrap_counter=0,this.wrap_counter_done=0,this.is_runner=!1}runnerItem(m){this.task_runner_index++,this.task_runner=this.tasks[this.task_runner_index],this.task_runner&&this.task_runner.length>0?Promise.all(this.task_runner.map(a=>a.task.call(this))).then(a=>{this.count_task_root_done++,a.forEach(i=>{this.count_task_item_done++,i.status&&i.value?this.result_common.datas.push(i.value):i.error&&this.result_common.errs.push(i.error)}),this.result_common.errs.length>0&&this.endWithError&&(this.is_runner=!1,this.clear(),m(this.result_common)),this.count_task_item_done===this.all_tasks?(this.is_runner=!1,this.clear(),m(this.result_common)):setTimeout(()=>{this.runnerItem(m)},this.delay_time)}):(this.is_runner=!1,this.count_task_root_done++,this.clear(),m(this.result_common))}}},60013:(S,M,l)=>{"use strict";l.d(M,{G:()=>C});let C=(()=>{class v{static openLoadingEffect(a){v.getDomElement().style.display="flex",setTimeout(()=>{v.changeMsgLoadingEffect(a)},50)}static closeLoadingEffect(a){return new Promise(i=>{setTimeout(()=>{const u=v.getDomElement();u&&(u.style.display="none"),i(!0)},a)})}static changeMsgLoadingEffect(a){v.getDomContent().innerText=a}static getDomContent(){return document.getElementById(v.idStatusContent)??document.createElement("span")}static getDomElement(){return document.getElementById(v.idComponent)??this.createDomElement()}static createDomElement(){const a=document.createElement("div");return a.id=v.idComponent,a.setAttribute("style","position: fixed;display: flex;width: 100vw;height: 100%;background: #000000c7;color: #ffffff;font-size: 20px;font-weight: lighter;justify-content: center;align-items: center;cursor: progress;z-index: 9999;top: 0;left: 0;"),a.style.display="none",a.innerHTML=`\n        <div class="text-center" style="height: 85%; overflow-x: auto;">\n            <div class="flex justify-center mt-5">\n                <svg width="20" viewBox="0 0 58 58" xmlns="http://www.w3.org/2000/svg">\n                    <g fill="none" fill-rule="evenodd">\n                        <g transform="translate(2 1)" stroke="currentColor" stroke-width="1.5">\n                            <circle cx="42.601" cy="11.462" r="5" fill-opacity="1" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="1;0;0;0;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="49.063" cy="27.063" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;1;0;0;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="42.601" cy="42.663" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;1;0;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="27" cy="49.125" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;1;0;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="11.399" cy="42.663" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;1;0;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="4.938" cy="27.063" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;0;1;0;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="11.399" cy="11.462" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;0;0;1;0" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                            <circle cx="27" cy="5" r="5" fill-opacity="0" fill="currentColor">\n                                <animate attributeName="fill-opacity" begin="0s" dur="1.3s" values="0;0;0;0;0;0;0;1" calcMode="linear" repeatCount="indefinite"></animate>\n                            </circle>\n                        </g>\n                    </g>\n                </svg>\n            </div>\n            <div style="margin-top: 10px;position: relative;">\n                <span id="${v.idStatusContent}"></span>\n            </div>\n        </div>`,document.body.appendChild(a),a}}return v.idComponent="azt-status-loading-effect",v.idStatusContent="azt-status-loading-effect-content",v})()},25679:(S,M,l)=>{"use strict";l.d(M,{n:()=>p});var C=l(49671),v=l(69862),m=l(3760),a=l(65879),i=l(87384),u=l(50503);const c=l(47246);let p=(()=>{class o{constructor(e,r){this.commonService=e,this.apiUploadService=r,this.dataRaws=[],this.stringFirstOld=["zCv:"],this.stringFirst="zCo:"}getValueContentQuestion(e){return this.commonService.castJsonToObj(e)??[]}getAllMatchWithContent(e){let t,r=[];for(;null!==(t=o.searchPattern.exec(e));)r.includes(t[0])||r.push(t[0]);return r}getRawContent(e,r){return new Promise((t,s)=>{const _=this.dataRaws.findIndex(f=>f.l===e);-1===_?fetch(e).then(f=>f.blob()).then(f=>f.arrayBuffer()).then(f=>{const g=c.inflate(f),y=this.commonService.castJsonToObj((new TextDecoder).decode(g));this.dataRaws.push({l:e,d:y??[]}),y&&y[r]?t(y[r]):s()}).catch(()=>{s()}):this.dataRaws[_].d&&this.dataRaws[_].d[r]?t(this.dataRaws[_].d[r]):s()})}uploadRawContent(e){return new Promise((r,t)=>{const s=JSON.stringify(e),_=(new TextEncoder).encode(s),f=c.deflate(_),g=new Blob([f],{type:"application/octet-stream"}),y=new File([g],"question_save_mathtype.gz",{type:"application/octet-stream"});this.apiUploadService.uploadToCdnQuestionRawMathTypeData(y).subscribe(w=>{w.type!=v.dt.UploadProgress&&(1==w.success&&w.data?r(w.data.url??""):t(new Error("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi[SPLIT_LANG] [SPLIT_LANG]"+w.message)))})})}encodeContent(e){let r=this.getAllMatchWithContent(e),t=[];for(let s=0;s<r.length;s++){let f=r[s].replace(o.searchPattern,"$1");f.startsWith(this.stringFirst)||t.push({l:f,i:t.length})}return{content:e,raws:t}}decodeContent(e){var r=this;return(0,C.Z)(function*(){let t=r.getAllMatchWithContent(e);for(let s=0;s<t.length;s++){const _=t[s];let f=_.replace(o.searchPattern,"$1");for(let g=0;g<r.stringFirstOld.length;g++)if(f.startsWith(r.stringFirstOld[g])){e=r.commonService.replaceAll(e,_,"")??"";continue}if(f.startsWith(r.stringFirst)){let g=r.commonService.castJsonToObj(atob(f.replace(r.stringFirst,"")));if(g){let y=yield r.getRawContent(g.l,g.i);e=r.commonService.replaceAll(e,f,y)??""}}}return e})()}encodeQuestion(e){return new Promise(r=>{var t=this.getValueContentQuestion(e.questionContent??""),s=this.getValueContentQuestion(e.answerConfig??""),_=e.answerMedia??"";if(0===t.length||0===s.length)return void r(e);let f=this.encodeContent(t[0].content),g=[];s.forEach((h,E)=>{g.push({i:E,d:this.encodeContent(h.content)})});let y=this.encodeContent(_);var w=0;let d=[];for(let h=0;h<f.raws.length;h++)f.raws[h].i=w,w++,d.push(f.raws[h]);for(let h=0;h<y.raws.length;h++)y.raws[h].i=w,w++,d.push(y.raws[h]);g.forEach(h=>{for(let E=0;E<h.d.raws.length;E++)h.d.raws[E].i=w,w++,d.push(h.d.raws[E])}),d.length>0?this.uploadRawContent(d.map(h=>h.l)).then(h=>{f.raws.forEach(E=>{let P=this.stringFirst+btoa(JSON.stringify({l:h,i:E.i}));t[0].content=this.commonService.replaceAll(t[0].content,E.l,P)??""}),y.raws.forEach(E=>{let P=this.stringFirst+btoa(JSON.stringify({l:h,i:E.i}));_=this.commonService.replaceAll(_,E.l,P)??""}),g.forEach(E=>{E.d.raws.forEach(P=>{let k=this.stringFirst+btoa(JSON.stringify({l:h,i:P.i}));s[E.i].content=this.commonService.replaceAll(s[E.i].content,P.l,k)??""})}),e.questionContent=JSON.stringify(t),e.answerConfig=JSON.stringify(s),e.answerMedia=_,r(e)}).catch(()=>{r(e)}):r(e)})}decodeQuestion(e){return new Promise(r=>{const t=new m.Q(3);if(t.addTask(this,()=>new Promise(s=>{this.decodeContent(e.content??"").then(_=>{e.content=_,s(!0)}).catch(()=>{s(!1)})})),t.addTask(this,()=>new Promise(s=>{this.decodeContent(e.help??"").then(_=>{e.help=_,s(!0)}).catch(()=>{s(!1)})})),e.answers)for(let s=0;s<e.answers.length;s++)t.addTask(this,()=>new Promise(_=>{e.answers&&this.decodeContent(e.answers[s].content??"").then(f=>{e.answers&&(e.answers[s].content=f),_(!0)}).catch(()=>{_(!1)})}));t.start().then(()=>{r()})})}}return o.searchPattern=/data-azt-math-raw=[\\"']+([^"']+)["']/g,o.\u0275fac=function(e){return new(e||o)(a.LFG(i.z),a.LFG(u.W))},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},66131:(S,M,l)=>{"use strict";l.d(M,{h:()=>p});var C=l(3760),v=l(8720),m=l(91404),a=l(65879),i=l(8415),u=l(87384),c=l(25679);let p=(()=>{class o{pushImage(e,r,t){if(t){let s=new RegExp("<div id='"+e+"'[^>]+></div>","g");t.content&&(t.content=t.content.replace(s,r??"")),t.answers&&t.answers.forEach(_=>{_.content=_.content?.replace(s,r??"")}),t.help&&(t.help=t.help.replace(s,r??"")),t.groupInfo&&t.groupInfo.groupContent&&(t.groupInfo.groupContent=t.groupInfo.groupContent.replace(s,r??""))}}parseRenderQuestions(e,r,t,s,_,f){return new Promise((g,y)=>{const d=new C.Q(25,{function:(h,E)=>{const P=(h+25)/E*100;r&&r(P>=100?99:P)}},s??1e3);e.forEach(h=>{d.addTask(this,this.parseRenderQuestion,[h,t,_,f])}),d.start().then(h=>{if(h.errs.length>0){const E=[];h.errs.forEach(P=>{let k=E.find(R=>R.type===P.type);k||E.push(P),k?.data.concat(P.data)}),y(E)}else g(e)})})}parseRenderQuestion(e,r,t,s){return new Promise((_,f)=>{var g=new m.W(this.cdnService,this.commonService,r||new v.v,d=>{f(d)});g.callbackPushImage=(d,h)=>{this.pushImage(d,h,e)},g.caller=this;const w=new C.Q(s?1:20,void 0,0);e.content&&w.addTask(this,()=>new Promise(d=>{e.content=g.render(this.commonService.removeBracket(e.content??""),()=>{d()})})),e.answers&&e.answers.forEach(d=>{w.addTask(this,()=>new Promise(h=>{d.content=g.render(d.content||"",()=>{h()})}))}),e.help&&w.addTask(this,()=>new Promise(d=>{e.help=g.render(e.help,()=>{d()})})),e.groupInfo&&e.groupInfo.groupContent&&w.addTask(this,()=>new Promise(d=>{e.groupInfo&&e.groupInfo.groupContent?e.groupInfo.groupContent=g.render(this.commonService.removeBracket(e.groupInfo.groupContent),()=>{d()}):d()})),t&&w.addTask(this,()=>new Promise(d=>{this.dataAztMathRawHelper.decodeQuestion(e).then(()=>{d()})})),w.start().then(d=>{d.errs.length>0||_()})})}constructor(e,r,t){this.cdnService=e,this.commonService=r,this.dataAztMathRawHelper=t}}return o.\u0275fac=function(e){return new(e||o)(a.LFG(i.E),a.LFG(u.z),a.LFG(c.n))},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},89188:(S,M,l)=>{"use strict";l.d(M,{s:()=>v});var C=l(65879);let v=(()=>{class m{constructor(i){this.el=i,this.answerSizeManager=0,this.process()}ngOnChanges(i){i.answerSizeManager&&i.answerSizeManager.currentValue!==i.answerSizeManager.previousValue&&i.answerSizeManager.currentValue>=1&&this.process()}process(){this.onElementLoaded().then(i=>{const u=this.el.nativeElement,c=u.children,p=[];for(let n=0;n<c.length;n++)p.push(this.getSizeWidthElement(c[n]));let o=1;[2,4].forEach(n=>{this.isLayout(i.width,p,n)&&(o=n)}),u.classList.remove("row");for(let n=0;n<c.length;n++){const e=c[n];e.classList.remove("col-sm-12"),e.classList.remove("col-md-6")}u.classList.add("layout"),u.classList.add("layout-"+o)})}isLayout(i,u,c){const p=Math.floor(i/c);for(const o of u)if(o+m.PADDING_ITEM>p)return!1;return!0}onElementLoaded(){return new Promise((i,u)=>{let c=!1;for(let p=0;p<=10;p++)setTimeout(()=>{if(!c){const o=this.actionGetSizeBox();o.width>0&&o.height&&(c=!0,i(o))}10===p&&!c&&u(new Error)},100*p)})}actionGetSizeBox(){return this.el.nativeElement.getBoundingClientRect()}getSizeWidthElement(i){let u=0;for(let c=0;c<i.children.length;c++)u+=i.children[c].getBoundingClientRect().width;return u}}return m.PADDING_ITEM=40,m.\u0275fac=function(i){return new(i||m)(C.Y36(C.SBq))},m.\u0275dir=C.lG2({type:m,selectors:[["","answerSizeManager",""]],inputs:{answerSizeManager:"answerSizeManager"},features:[C.TTD]}),m})()},32839:(S,M,l)=>{"use strict";l.d(M,{g:()=>c});var C=l(10217),m=l(60013),a=l(65879),i=l(9853),u=l(87384);let c=(()=>{class p{constructor(n,e){this.mobileWebviewService=n,this.commonService=e}shareFileWithBlob(n,e){if(this.commonService.isMobileWebview(void 0)){m.G.openLoadingEffect(this.commonService.myTranslateInstant("lang_auto_dang_lay_du_lieu_tu_he_thong")??"");let r=new FileReader;r.readAsDataURL(n),r.onloadend=()=>{let t=r.result;"string"==typeof t&&(this.mobileWebviewService.sendShareFileBase64(e,String(t)),m.G.closeLoadingEffect(100))}}else C.saveAs(n,e)}shareFileWithBase64(n,e){this.commonService.isMobileWebview(void 0)?this.mobileWebviewService.sendShareFileBase64(e,n):C.saveAs(n,e)}}return p.\u0275fac=function(n){return new(n||p)(a.LFG(i.r),a.LFG(u.z))},p.\u0275prov=a.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})()},10217:function(S,M){var l,v;void 0!==(v="function"==typeof(l=function(){"use strict";function a(n,e,r){var t=new XMLHttpRequest;t.open("GET",n),t.responseType="blob",t.onload=function(){o(t.response,e,r)},t.onerror=function(){console.error("could not download file")},t.send()}function i(n){var e=new XMLHttpRequest;e.open("HEAD",n,!1);try{e.send()}catch{}return 200<=e.status&&299>=e.status}function u(n){try{n.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(e)}}var c="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,p=c.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),o=c.saveAs||("object"!=typeof window||window!==c?function(){}:"download"in HTMLAnchorElement.prototype&&!p?function(n,e,r){var t=c.URL||c.webkitURL,s=document.createElement("a");s.download=e=e||n.name||"download",s.rel="noopener","string"==typeof n?(s.href=n,s.origin===location.origin?u(s):i(s.href)?a(n,e,r):u(s,s.target="_blank")):(s.href=t.createObjectURL(n),setTimeout(function(){t.revokeObjectURL(s.href)},4e4),setTimeout(function(){u(s)},0))}:"msSaveOrOpenBlob"in navigator?function(n,e,r){if(e=e||n.name||"download","string"!=typeof n)navigator.msSaveOrOpenBlob(function m(n,e){return typeof e>"u"?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\ufeff",n],{type:n.type}):n}(n,r),e);else if(i(n))a(n,e,r);else{var t=document.createElement("a");t.href=n,t.target="_blank",setTimeout(function(){u(t)})}}:function(n,e,r,t){if((t=t||open("","_blank"))&&(t.document.title=t.document.body.innerText="downloading..."),"string"==typeof n)return a(n,e,r);var s="application/octet-stream"===n.type,_=/constructor/i.test(c.HTMLElement)||c.safari,f=/CriOS\/[\d]+/.test(navigator.userAgent);if((f||s&&_||p)&&typeof FileReader<"u"){var g=new FileReader;g.onloadend=function(){var d=g.result;d=f?d:d.replace(/^data:[^;]*;/,"data:attachment/file;"),t?t.location.href=d:location=d,t=null},g.readAsDataURL(n)}else{var y=c.URL||c.webkitURL,w=y.createObjectURL(n);t?t.location=w:location.href=w,t=null,setTimeout(function(){y.revokeObjectURL(w)},4e4)}});c.saveAs=o.saveAs=o,S.exports=o})?l.apply(M,[]):l)&&(S.exports=v)}}]);