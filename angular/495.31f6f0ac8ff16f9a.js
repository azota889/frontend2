"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[495],{29225:(H,k,f)=>{f.d(k,{Z:()=>h});var t=f(5e3),e=f(93075),b=f(55330),D=f(60284),A=f(43147),B=f(50690),O=f(74202),U=f(69808),S=f(75477),R=f(74650),_=f(76224),d=f(1033);const m=function(a){return[a]};function v(a,p){1&a&&(t.TgZ(0,"div",24)(1,"a",25),t.ALo(2,"mylocalize"),t._UZ(3,"img",26),t.ALo(4,"convertCdnLinkOfGitHub"),t.qZA()()),2&a&&(t.xp6(1),t.Q6J("routerLink",t.VKq(6,m,t.lcZ(2,2,"/admin/dashboard"))),t.xp6(2),t.Q6J("src",t.lcZ(4,4,"azota_assets/images/logo.svg"),t.LSH))}function C(a,p){if(1&a){const s=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){t.CHM(s);const c=t.oxw(2);return t.KtG(c.goBack())}),t.O4$(),t.TgZ(1,"svg",28),t._UZ(2,"polyline",29),t.qZA()()}}function T(a,p){if(1&a){const s=t.EpF();t.TgZ(0,"button",30),t.NdJ("click",function(){t.CHM(s);const c=t.oxw(2);return t.KtG(c.goBackDialog())}),t.O4$(),t.TgZ(1,"svg",28),t._UZ(2,"polyline",29),t.qZA()()}}function y(a,p){1&a&&t._UZ(0,"div",31)}function x(a,p){if(1&a&&(t.ynx(0),t._UZ(1,"input",32),t.ALo(2,"mytranslate"),t.BQk()),2&a){const s=t.oxw(2);t.xp6(1),t.s9C("placeholder",t.lcZ(2,2,"lang_auto_nhap_ten")+" ..."),t.Q6J("formControl",s.examName)}}function P(a,p){if(1&a){const s=t.EpF();t.TgZ(0,"div",31)(1,"button",33),t.NdJ("click",function(){t.CHM(s);const c=t.oxw(2);return t.KtG(c.clickHandelCancel())}),t._uU(2),t.ALo(3,"mytranslate"),t.qZA(),t.TgZ(4,"button",34),t.NdJ("click",function(){t.CHM(s);const c=t.oxw(2);return t.KtG(c.clickHandelConfirm())}),t._uU(5),t.ALo(6,"mytranslate"),t.qZA()()}if(2&a){const s=t.oxw(2);t.xp6(2),t.hij(" ",t.lcZ(3,2,"lang_auto_huy")," "),t.xp6(3),t.hij(" ",t.lcZ(6,4,s.confirmTitle)," ")}}function n(a,p){if(1&a&&(t.ynx(0),t._UZ(1,"input",35),t.ALo(2,"mytranslate"),t.BQk()),2&a){const s=t.oxw(2);t.xp6(1),t.s9C("placeholder",t.lcZ(2,2,"lang_auto_nhap_ten")+" ..."),t.Q6J("formControl",s.examName)}}function l(a,p){if(1&a){const s=t.EpF();t.TgZ(0,"div",36)(1,"button",37),t.NdJ("click",function(){t.CHM(s);const c=t.oxw(2);return t.KtG(c.clickHandelCancel())}),t._uU(2),t.ALo(3,"mytranslate"),t.qZA(),t.TgZ(4,"button",38),t.NdJ("click",function(){t.CHM(s);const c=t.oxw(2);return t.KtG(c.clickHandelConfirm())}),t._uU(5),t.ALo(6,"mytranslate"),t.qZA()()}2&a&&(t.xp6(2),t.hij(" ",t.lcZ(3,2,"lang_auto_huy")," "),t.xp6(3),t.hij(" ",t.lcZ(6,4,"lang_auto_tiep_tuc")," "))}function g(a,p){if(1&a&&(t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",3),t.YNc(7,v,5,8,"div",7),t.YNc(8,C,3,0,"button",8),t.YNc(9,T,3,0,"button",9),t.qZA()(),t.TgZ(10,"div",10)(11,"div",11),t.YNc(12,y,1,0,"div",12),t.TgZ(13,"div",13),t.YNc(14,x,3,4,"ng-container",14),t.qZA(),t.YNc(15,P,7,6,"div",12),t.qZA()(),t.TgZ(16,"div",6)(17,"div",15)(18,"div",16),t._UZ(19,"azt-switch-language"),t.qZA(),t.TgZ(20,"div",16),t._UZ(21,"header-notice-box"),t.qZA(),t.TgZ(22,"div",17),t._UZ(23,"header-account-menu",18),t.qZA()()(),t.TgZ(24,"div",19)(25,"div",20)(26,"div",21),t.YNc(27,n,3,4,"ng-container",14),t.qZA(),t.YNc(28,l,7,6,"div",22),t.qZA()()(),t.TgZ(29,"div",23),t.Hsn(30),t.qZA()()()()()),2&a){const s=t.oxw();t.xp6(7),t.Q6J("ngIf",!s.isMobileWebView),t.xp6(1),t.Q6J("ngIf",!s.checkBackDialog&&""!=s.headerBackTolink),t.xp6(1),t.Q6J("ngIf",s.checkBackDialog),t.xp6(3),t.Q6J("ngIf",s.showConfirmButton),t.xp6(2),t.Q6J("ngIf",s.showInput),t.xp6(1),t.Q6J("ngIf",s.showConfirmButton),t.xp6(8),t.Q6J("isTeacherDashboard",!0),t.xp6(4),t.Q6J("ngIf",s.showInput),t.xp6(1),t.Q6J("ngIf",s.showConfirmButton)}}const u=["*"];let h=(()=>{class a extends b.Q{constructor(s,o,c){super(c),this.processNoticeService=s,this.baseApiService=o,this.commonService=c,this.headerBackTolink="",this.headerTitle="",this.confirmTitle="lang_auto_tiep_tuc",this.checkBackDialog=!1,this.showConfirmButton=!1,this.showInput=!1,this.examName=new e.p4,this.handleConfirm=new t.vpe,this.handleCancel=new t.vpe,this.handleBackDialog=new t.vpe,this.isLogin=!1,this.isMobileWebView=!1}goBack(){this.commonService.myNavigationBySpecialQueryString(this.headerBackTolink)}clickHandelCancel(){this.handleCancel.emit()}clickHandelConfirm(){this.handleConfirm.emit()}goBackDialog(){this.handleBackDialog.emit()}openMenuMobile(){let s=document.getElementById("toggle-menu");null==s||s.classList.add("mobile-menu--active")}closeMenuMobile(){let s=document.getElementById("toggle-menu");null==s||s.classList.remove("mobile-menu--active")}ngOnInit(){super.ngOnInit(),window.scrollTo(0,0),this.isLogin=this.baseApiService.isLogin(),this.isMobileWebView=this.commonService.isMobileWebview()}}return a.\u0275fac=function(s){return new(s||a)(t.Y36(D.e),t.Y36(A._),t.Y36(B.v))},a.\u0275cmp=t.Xpm({type:a,selectors:[["editor-layout"]],inputs:{headerBackTolink:"headerBackTolink",headerTitle:"headerTitle",confirmTitle:"confirmTitle",checkBackDialog:"checkBackDialog",showConfirmButton:"showConfirmButton",showInput:"showInput",examName:"examName"},outputs:{handleConfirm:"handleConfirm",handleCancel:"handleCancel",handleBackDialog:"handleBackDialog"},features:[t.qOj],ngContentSelectors:u,decls:1,vars:1,consts:[["id","azt-layout","class","azt-layout",4,"ngIf"],["id","azt-layout",1,"azt-layout"],[1,"azt-body",2,"padding","0"],[1,"flex"],[1,"content","relative",2,"padding","0","border-radius","0"],[1,"top-bar","py-2","bg-white","dark:bg-darkmode-600","px-3","grid","grid-cols-12","gap-3",2,"height","auto","z-index","0","display","grid"],[1,"col-span-6","md:col-span-2"],["class","mr-3",4,"ngIf"],["azt-track-service","editor-layout-sjSDq2slMU","class","btn btn-transparent",3,"click",4,"ngIf"],["azt-track-service","editor-layout-0LcNE2-_PP","class","btn btn-transparent",3,"click",4,"ngIf"],[1,"col-span-12","md:col-span-8","azt-hidden","md:block"],[1,"flex","items-center"],["class","mr-2","style","width: 25%;",4,"ngIf"],[1,"mr-auto",2,"width","50%","padding-right","10px"],[4,"ngIf"],[1,"flex","items-center","justify-end","pr-4"],[1,"dropdown","mr-2","sm:mr-4"],[1,"dropdown","w-8","h-8"],[3,"isTeacherDashboard"],[1,"col-span-12","md:col-span-8","block","md:hidden"],[1,"flex","items-center","w-full",2,"flex-wrap","wrap"],[1,"mr-auto",2,"width","55%"],["class","mr-2 ml-auto",4,"ngIf"],[1,"azt-content"],[1,"mr-3"],["azt-track-service","editor-layout-fIGchmLIEg",3,"routerLink"],["alt","logo","width","95px",3,"src"],["azt-track-service","editor-layout-sjSDq2slMU",1,"btn","btn-transparent",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"lucide","w-5","h-5"],["points","15 18 9 12 15 6"],["azt-track-service","editor-layout-0LcNE2-_PP",1,"btn","btn-transparent",3,"click"],[1,"mr-2",2,"width","25%"],["type","text",1,"form-control",2,"text-align","center","border","0","box-shadow","none",3,"formControl","placeholder"],["azt-track-service","editor-layout-80eT0Nmtel",1,"btn","btn-secondary","w-20","mr-2",3,"click"],["azt-track-service","editor-layout-DOA7O4mmZV",1,"btn","btn-primary","w-20",3,"click"],["type","text",1,"form-control",3,"formControl","placeholder"],[1,"mr-2","ml-auto"],["azt-track-service","editor-layout-IQLlBSOOur",1,"btn","btn-secondary","mr-2",3,"click"],["azt-track-service","editor-layout-_3e-MqRK1i",1,"btn","btn-primary",3,"click"]],template:function(s,o){1&s&&(t.F$t(),t.YNc(0,g,31,9,"div",0)),2&s&&t.Q6J("ngIf",o.isLogin)},dependencies:[O.yS,U.O5,e.Fj,e.JJ,e.oH,S.x,R.H,_.y,d.mp,d.bT,d.Jc],encapsulation:2}),a})()},1643:(H,k,f)=>{f.d(k,{p:()=>s});var t=f(55330),e=f(5e3),b=f(63382),D=f(50690),A=f(69808),B=f(1033);function O(o,c){if(1&o&&(e.TgZ(0,"h3",6),e._uU(1),e.qZA()),2&o){const i=e.oxw(3);e.xp6(1),e.Oqu(i.title)}}const U=function(o){return{"rotated-img":o}},S=function(o,c,i,r){return{"width.px":o,"height.px":c,"aspect-ratio":i,transform:r}};function R(o,c){if(1&o&&(e._UZ(0,"img",10),e.ALo(1,"mycdn")),2&o){const i=e.oxw(2).$implicit,r=e.oxw(2);e.s9C("src",e.lcZ(1,4,i.backgroundImage),e.LSH),e.Q6J("ngClass",e.VKq(6,U,r.isRightRotation(i.rotation||0)))("ngStyle",e.l5B(8,S,(i.width||0)<(i.height||0)?"auto":r.isRightRotation(i.rotation||0)?i.height:i.width,(i.width||0)>(i.height||0)?"auto":r.isRightRotation(i.rotation||0)?i.width:i.height,(i.width||0)/(i.height||1),"rotate("+i.rotation+"deg)")),e.uIk("data-ratio",(i.width||0)/(i.height||1))}}function _(o,c){1&o&&(e.TgZ(0,"div",11),e._uU(1),e.ALo(2,"mytranslate"),e.qZA()),2&o&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"lang_auto_dinh_dang_file_khong_ho_tro_xuat_ra_pdf_he_thong_chi_xuat_duoc_file_pdf_doi_voi_file_tai_len_dang_anh_va_pdf")))}function d(o,c){if(1&o&&(e._UZ(0,"img",12),e.ALo(1,"mycdn")),2&o){const i=e.oxw(2).$implicit;e.s9C("src",e.lcZ(1,1,i.draw),e.LSH)}}function m(o,c){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const i=e.oxw(6);e.xp6(1),e.hij(" ",null==i.result.staticTextConfigParse?null:i.result.staticTextConfigParse.textCorrect," ")}}function v(o,c){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const i=e.oxw(6);e.xp6(1),e.hij(" ",null==i.result.staticTextConfigParse?null:i.result.staticTextConfigParse.textWrong," ")}}function C(o,c){if(1&o&&e._UZ(0,"img",15),2&o){const i=e.oxw(6);e.s9C("src","assets/images/classlive/"+(null==i.result.staticTextConfigParse?null:i.result.staticTextConfigParse.urlImgCorrect),e.LSH)}}function T(o,c){if(1&o&&e._UZ(0,"img",15),2&o){const i=e.oxw(6);e.s9C("src","assets/images/classlive/"+(null==i.result.staticTextConfigParse?null:i.result.staticTextConfigParse.urlImgWrong),e.LSH)}}const y=function(o,c,i,r,E){return{"font-family":o,color:c,"font-size":i,position:"absolute","z-index":2,"top.px":r,"left.px":E}};function x(o,c){if(1&o&&(e.ynx(0),e.TgZ(1,"span",13),e.YNc(2,m,2,1,"ng-container",0),e.YNc(3,v,2,1,"ng-container",0),e.YNc(4,C,1,1,"img",14),e.YNc(5,T,1,1,"img",14),e.qZA(),e.BQk()),2&o){const i=c.$implicit,r=e.oxw(5);e.xp6(1),e.Q6J("ngStyle",e.qbA(5,y,null==r.result.staticTextConfigParse?null:r.result.staticTextConfigParse.fontText,null==r.result.staticTextConfigParse?null:r.result.staticTextConfigParse.fontColor,(null==r.result.staticTextConfigParse?null:r.result.staticTextConfigParse.fontSize)+"px",i.y,i.x)),e.xp6(1),e.Q6J("ngIf",(null==r.result.staticTextConfigParse?null:r.result.staticTextConfigParse.useCorrectText)&&"correct"==i.value),e.xp6(1),e.Q6J("ngIf",(null==r.result.staticTextConfigParse?null:r.result.staticTextConfigParse.useCorrectText)&&"wrong"==i.value),e.xp6(1),e.Q6J("ngIf",!(null!=r.result.staticTextConfigParse&&r.result.staticTextConfigParse.useCorrectText)&&"correct"==i.value),e.xp6(1),e.Q6J("ngIf",!(null!=r.result.staticTextConfigParse&&r.result.staticTextConfigParse.useWrongText)&&"wrong"==i.value)}}function P(o,c){if(1&o&&e.YNc(0,x,6,11,"ng-container",1),2&o){const i=e.oxw(2).$implicit;e.Q6J("ngForOf",i.staticText)}}const n=function(o,c,i,r,E,w){return{"font-family":o,color:c,"font-size":i,display:"block","line-height":1.5,position:"absolute",letterSpacing:"3px",fontWeight:"bold","z-index":3,"text-align":r,"top.px":E,"left.px":w}};function l(o,c){if(1&o&&(e.ynx(0),e._UZ(1,"span",16),e.ALo(2,"formatNoteBreak"),e.BQk()),2&o){const i=c.$implicit;e.xp6(1),e.Q6J("ngStyle",e.HTZ(4,n,i.textStyle.font,i.textStyle.color,i.textStyle.size+"px",i.textStyle.align,i.y,i.x))("innerHtml",e.lcZ(2,2,i.value),e.oJD)}}function g(o,c){if(1&o&&e.YNc(0,l,3,11,"ng-container",1),2&o){const i=e.oxw(2).$implicit;e.Q6J("ngForOf",i.objText)}}function u(o,c){if(1&o&&(e.YNc(0,R,2,13,"img",7),e.ALo(1,"isImageExtension"),e.YNc(2,_,3,3,"ng-template",null,8,e.W1O),e.YNc(4,d,2,3,"img",9),e.YNc(5,P,1,1,"ng-template",5),e.YNc(6,g,1,1,"ng-template",5)),2&o){const i=e.MAs(3),r=e.oxw().$implicit;e.Q6J("ngIf",e.lcZ(1,5,(null==r?null:r.backgroundImage)||""))("ngIfElse",i),e.xp6(4),e.Q6J("ngIf",r.draw),e.xp6(1),e.Q6J("ngIf",r.staticText&&r.staticText.length>0),e.xp6(1),e.Q6J("ngIf",r.objText&&r.objText.length>0)}}const h=function(o,c){return{position:"relative","width.px":o,"height.px":c,display:"flex","justify-content":"center","align-items":"center"}};function a(o,c){if(1&o&&(e.ynx(0),e.TgZ(1,"div",2),e.YNc(2,O,2,1,"h3",3),e.TgZ(3,"div",4),e.YNc(4,u,7,7,"ng-template",5),e.qZA()(),e.BQk()),2&o){const i=c.$implicit,r=c.first,E=e.oxw(2);e.xp6(1),e.Tol("mb-2 essayPdfImage "+E.blockItemCropClass+" "+E.blockItemEssayCropClass),e.xp6(1),e.Q6J("ngIf",r),e.xp6(1),e.Q6J("ngStyle",e.WLB(6,h,i.width,i.height)),e.xp6(1),e.Q6J("ngIf",null==i?null:i.backgroundImage)}}function p(o,c){if(1&o&&(e.ynx(0),e.YNc(1,a,5,9,"ng-container",1),e.BQk()),2&o){const i=e.oxw();e.xp6(1),e.Q6J("ngForOf",i.result.pages)}}let s=(()=>{class o extends t.Q{constructor(i,r){super(r),this.iframeService=i,this.commonService=r,this.title="",this.result={}}isRightRotation(i){return 1==Math.abs(i/90%2)}ngOnInit(){var i;this.title=null!==(i=this.commonService.myTranslateInstant("lang_auto_anh_bai_lam_tu_luan"))&&void 0!==i?i:"",this.result.staticTextConfig&&(this.result.staticTextConfigParse=this.commonService.myParseJson(this.result.staticTextConfig)),super.ngOnInit()}ngOnChanges(){this.result.staticTextConfig&&(this.result.staticTextConfigParse=this.commonService.myParseJson(this.result.staticTextConfig))}}return o.\u0275fac=function(i){return new(i||o)(e.Y36(b.X),e.Y36(D.v))},o.\u0275cmp=e.Xpm({type:o,selectors:[["azt-export-essay-template"]],inputs:{title:"title",blockItemEssayCropClass:"blockItemEssayCropClass",blockItemCropClass:"blockItemCropClass",result:"result"},features:[e.qOj,e.TTD],decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"display","flex","justify-content","center","align-items","center","flex-direction","column"],["id","essayPdfTitle","class","text-center",4,"ngIf"],[3,"ngStyle"],[3,"ngIf"],["id","essayPdfTitle",1,"text-center"],["class","user-img img_respon","alt","",3,"ngClass","ngStyle","src",4,"ngIf","ngIfElse"],["noSupportExtension",""],["style","position: absolute; z-index: 1; top: 0; left: 0","class","user-img img_respon","alt","",3,"src",4,"ngIf"],["alt","",1,"user-img","img_respon",3,"ngClass","ngStyle","src"],[1,"p-2","text-center",2,"border","2px solid red"],["alt","",1,"user-img","img_respon",2,"position","absolute","z-index","1","top","0","left","0",3,"src"],[2,"min-height","50px","min-width","50px","font-weight","bold","display","flex","line-height","1.5","font-weight","bold","align-items","center","justify-content","center","text-shadow","rgb(130 126 126) 1px 1px 1px",3,"ngStyle"],["width","30","height","30","class","","alt","",3,"src",4,"ngIf"],["width","30","height","30","alt","",1,"",3,"src"],[3,"ngStyle","innerHtml"]],template:function(i,r){1&i&&e.YNc(0,p,2,1,"ng-container",0),2&i&&e.Q6J("ngIf",r.result)},dependencies:[A.mk,A.sg,A.O5,A.PC,B.bT,B.GT,B.AL,B.kJ],encapsulation:2}),o})()},16031:(H,k,f)=>{f.d(k,{I:()=>y});var t=f(70655),e=f(4159),D=f(53583),A=f(17489),O=f(5e3),U=f(296),S=f(20814),R=f(88161),_=f(72491);const T={top:60,left:60,right:60,bottom:60};let y=(()=>{class x{constructor(n,l,g,u){this.exportPdfConvertDataService=n,this.exportPdfUtilsService=l,this.answerTypeService=g,this.timeService=u,this.totalDraw=1,this.countDraw=0,this.currentPos=T,this.pdfDoc=new D.jsPDF}get loadPercent(){return Math.floor(this.countDraw/this.totalDraw*100)}getSourceCanvas(n){return(0,t.mG)(this,void 0,void 0,function*(){var l=document.getElementById(n);return yield e(l,{scale:2})})}resetPosition(n){n&&(this.currentPos={left:60,top:60,right:60,bottom:60})}drawHomeworkNoteBoxOfTeacher(n){return(0,t.mG)(this,void 0,void 0,function*(){let l=document.querySelector(".box-point.display .text-mark");if(n){n.font="25px font_chu_dep",n.fillStyle="#000",l&&n.fillText("\u0110i\u1ec3m",90,this.currentPos.top+20),n.fillText("L\u1eddi ph\xea c\u1ee7a gi\xe1o vi\xean",420,this.currentPos.top+20),this.currentPos.top+=30;let g=document.querySelector(".box-msg .note p");if(g){n.lineWidth=2,n.fillStyle="#000",n.fillRect(this.currentPos.left,this.currentPos.top,n.canvas.width-this.currentPos.left-this.currentPos.right,1);const u=this.currentPos.top;let h=window.getComputedStyle(g,null).getPropertyValue("font"),a=window.getComputedStyle(g,null).getPropertyValue("color"),p=parseInt(h.split(" ")[0].split("p")[0],10);n.font=h;let o=this.exportPdfUtilsService.essayText2LinesArr(g.innerHTML,n,n.canvas.width-60-30-(l?200:0),16,h);this.currentPos.top+=35;const c=Math.round(1.5*p),i=this.currentPos.left+(l?200:0)+15;let r=0,E=200;for(let M=0;M<o.length;M++)for(let L=0;L<o[M].length;L++){const Z=o[M][L];n.font=h,n.fillStyle=a,n.fillText(Z,i,this.currentPos.top),this.currentPos.top+=c,r+=c}let w=document.querySelectorAll(".box-emoji> img"),I=this.currentPos.left+(l?100:0)+15,W=this.currentPos.top,N=78,z=78,F=15;w.forEach(M=>{var L;let Z=new Image;Z.src=null!==(L=M.getAttribute("src"))&&void 0!==L?L:"",Z.onload=()=>{I=I+N+F,n.drawImage(Z,I,W,N,z)}});let J=30+z;if(r>E-J&&(E=r+J),n.lineWidth=2,n.fillStyle="#000",n.fillRect(this.currentPos.left,u,1,E),l&&n.fillRect(this.currentPos.left+200,u,1,E),n.fillRect(n.canvas.width-this.currentPos.right,u,1,E),n.fillRect(this.currentPos.left,u+E,n.canvas.width-this.currentPos.right-this.currentPos.left,1),l){let M=l.getBoundingClientRect().width,L=l.getBoundingClientRect().height,Z=window.getComputedStyle(l,null).getPropertyValue("font"),Q=window.getComputedStyle(l,null).getPropertyValue("color");n.font=Z,n.fillStyle=Q,n.fillText(l.textContent?l.textContent:"",this.currentPos.left+100-M/2,u+E/2+L/4)}this.currentPos.top=u+E+20}else{if(n.lineWidth=2,n.rect(this.currentPos.left,this.currentPos.top,n.canvas.width-this.currentPos.left-this.currentPos.right,200),n.stroke(),l&&n.fillRect(this.currentPos.left+200,this.currentPos.top,1,200),l){let u=l.getBoundingClientRect().width,h=l.getBoundingClientRect().height,a=window.getComputedStyle(l,null).getPropertyValue("font"),p=window.getComputedStyle(l,null).getPropertyValue("color");n.font=a,n.fillStyle=p,n.fillText(l.textContent?l.textContent:"",this.currentPos.left+100-u/2,this.currentPos.top+150-h/2)}this.currentPos.top+=220}}})}drawExamTitle(n){if(n){let r=document.querySelector("#mainTitle span"),E=r?window.getComputedStyle(r,null).getPropertyValue("font"):"",w=null==r?void 0:r.getBoundingClientRect().width,I=null==r?void 0:r.getBoundingClientRect().height;var l=null==r?void 0:r.querySelector("img"),g=null==l?void 0:l.getBoundingClientRect().width,u=null==l?void 0:l.getBoundingClientRect().height,h=0;if(r&&r.textContent&&w&&I&&!(l&&g&&u)){var a=(n.canvas.width-w)/2,p=this.currentPos.top+15;n.font=E,n.fillStyle="#000",n.fillText(r.textContent,a,p),h=I+20}else r&&r.textContent&&w&&I&&l&&g&&u&&(a=(n.canvas.width-w)/2,p=this.currentPos.top+20,n.font=E,n.fillStyle="#000",n.fillText(r.textContent,a,p),h=I+40,n.drawImage(l,0,0,g,u,a+(w-g)+5,this.currentPos.top-10,g,u));h>0&&(this.currentPos.top+=h,this.countDraw++)}}drawColLeftRightInHeaderOfExam(n){var l;let g=document.getElementById("colLeftInfo"),u=document.getElementById("colRightInfo"),h=g?g.querySelectorAll("h3"):void 0,a=u?u.querySelectorAll("h3"):void 0,p={top:0,left:0,right:0,bottom:0};if(n){if(n.font="16px Arial",h)for(let s=0;s<h.length;s++){0==s&&(p=A.cloneDeep(this.currentPos));const o=h[s];o.textContent&&(n.fillText(null!==(l=o.textContent)&&void 0!==l?l:"",this.currentPos.left,this.currentPos.top),this.currentPos.top+=o.getBoundingClientRect().height+5)}if(a)for(let s=0;s<a.length;s++){const o=a[s];o.textContent&&(n.fillText(o.textContent,n.canvas.width-this.currentPos.right-o.getBoundingClientRect().width,p.top),p.top+=o.getBoundingClientRect().height+5)}}}drawBlockItemToPageForExam(n,l){return(0,t.mG)(this,void 0,void 0,function*(){if(n){let u=document.querySelectorAll(`.${this.exportPdfUtilsService.blockCropItemClass}`);if(u.length>0){let h=[];for(let a=0;a<u.length;a++)h.push(a);var g=yield this.getSourceCanvas("multipleChoiceWrap");for(const a of h){const p=u[a];let s=p.classList.contains(this.exportPdfUtilsService.blockEssayCropItemClass),o=p.classList.contains("__TXT_ESSAY_PARA");console.log("nvanh 1",o,s);let c=2*p.offsetLeft,i=2*p.offsetTop,r=2*p.getBoundingClientRect().width,E=2*p.getBoundingClientRect().height;const w=n.canvas.width-this.currentPos.left-this.currentPos.right,I=w*E/r;if(I<=n.canvas.height-this.currentPos.bottom-this.currentPos.top&&!s)this.drawSingleBlockItemToCanvas(n,g,w,I,{left:c,top:i,width:r,height:E},o);else if(this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,n.canvas.toDataURL("image/jpeg",1)),this.pdfDoc.addPage(),this.exportPdfUtilsService.eraseCanvas(n),this.resetPosition(l),"h"==this.exportPdfConvertDataService.findScaleDirection(r,E)){const W=n.canvas.height-T.top-T.bottom,N=W*r/E;this.drawSingleBlockItemToCanvas(n,g,w,I,{left:c,top:i,width:r,height:E},o,(n.canvas.width-N)/2,T.top,N,W)}else this.drawSingleBlockItemToCanvas(n,g,w,I,{left:c,top:i,width:r,height:E},o)}this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,n.canvas.toDataURL("image/jpeg",1))}else this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,n.canvas.toDataURL("image/jpeg",1))}})}convertEssayBoxes2Canvas(n,l,g,u){return(0,t.mG)(this,void 0,void 0,function*(){let h=[];for(let a=0;a<n.length;a++)h.push(a);for(const a of h){const p=yield e(n[a]);if(0==a&&l){const c=(l.canvas.width-50-50)*p.height/p.width;u&&c>l.canvas.height-50-this.currentPos.top&&(this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,l.canvas.toDataURL("image/jpeg",1)),this.exportPdfUtilsService.eraseCanvas(l),this.resetPosition(g),this.pdfDoc.addPage()),this.addEssayImage(l,n,p,a)}else this.exportPdfUtilsService.eraseCanvas(l),this.resetPosition(g),this.addEssayImage(l,n,p,a)}})}drawEssayIframeContent(n,l,g){return(0,t.mG)(this,void 0,void 0,function*(){let u=document.querySelectorAll(".essayPdfImage");if(u.length>0&&n){g||(this.exportPdfUtilsService.eraseCanvas(n),this.resetPosition(l),this.pdfDoc.addPage());let h=document.querySelector("#essayPdfTitle span");n&&h&&h.textContent&&(n.font="18px Georgia",n.fillStyle="#333",n.fillText(h.textContent,(n.canvas.width-h.getBoundingClientRect().width)/2,this.currentPos.top+20),this.currentPos.top+=h.getBoundingClientRect().height+20),yield this.convertEssayBoxes2Canvas(u,n,l,g)}})}addEssayImage(n,l,g,u){if(n){if("w"==this.exportPdfConvertDataService.findScaleDirection(g.width,g.height))n.drawImage(g,0,0,g.width,g.height,50,this.currentPos.top+50,n.canvas.width-100,(n.canvas.width-100)*g.height/g.width);else{let h=n.canvas.height-this.currentPos.top-this.currentPos.bottom,a=h*g.width/g.height;n.drawImage(g,0,0,g.width,g.height,(n.canvas.width-a)/2,this.currentPos.top,a,h)}console.log(`[_Essay_image_] V\u1ebd \u1ea3nh t\u1ef1 lu\u1eadn s\u1ed1 ${u+1}`),this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,n.canvas.toDataURL("image/jpeg",1)),this.countDraw++,u!=l.length-1&&this.pdfDoc.addPage()}}drawSingleBlockItemToCanvas(n,l,g,u,h,a,p,s,o,c){a&&this.currentPos.top!=T.top&&(this.currentPos.top-=60),n.drawImage(l,h.left,h.top,h.width,h.height,p||this.currentPos.left,s||this.currentPos.top,o||g,c||u),this.currentPos.top+=u+80,this.countDraw++}examToPdf(n,l){return(0,t.mG)(this,void 0,void 0,function*(){this.countDraw=0,this.totalDraw=document.querySelectorAll(`.${this.exportPdfUtilsService.blockCropItemClass}`).length,this.pdfDoc=new D.jsPDF;let g=document.createElement("canvas"),u=document.getElementById("multipleChoiceWrap");if(console.log("nvanh",u),u){let p=u.getBoundingClientRect().width;g.width=2*p,g.height=297*p/210*2}let h=g.getContext("2d");return this.exportPdfUtilsService.eraseCanvas(h),u&&this.resetPosition(u),u&&(yield this.drawBlockItemToPageForExam(h,u)),this.countDraw=this.totalDraw,yield this.exportPdfUtilsService.asyncTimeout(1e3),"class"==n?this.pdfDoc.output("blob"):(this.pdfDoc.save(l||"test_result.pdf"),!0)})}homeworkToPdf(){return(0,t.mG)(this,void 0,void 0,function*(){this.pdfDoc=new D.jsPDF;let n=document.createElement("canvas"),l=document.getElementById("multipleChoiceWrap");if(l){let h=l.getBoundingClientRect().width;n.width=h,n.height=297*h/210}let g=n.getContext("2d");return this.exportPdfUtilsService.eraseCanvas(g),l&&this.resetPosition(l),this.drawExamTitle(g),this.drawColLeftRightInHeaderOfExam(g),yield this.drawHomeworkNoteBoxOfTeacher(g),l&&(yield this.drawEssayIframeContent(g,l,!0)),this.pdfDoc.output("blob")})}}return x.\u0275fac=function(n){return new(n||x)(O.LFG(U.S),O.LFG(S.V),O.LFG(R.T),O.LFG(_.O))},x.\u0275prov=O.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})()},50136:(H,k,f)=>{f.d(k,{J:()=>U});var t=f(40520),e=f(34202),b=f(51442),D=f(5e3),A=f(50690),B=f(12813),O=f(58326);let U=(()=>{class S{constructor(_,d,m){this.commonService=_,this.apiUploadService=d,this.myPdfService=m}replaceImageInContent(_){return new e.y(d=>{if(_.includes("<img ")){var m=this.findAllSubString(_,"<img"),v=[],C=[];m.forEach(T=>{var y=_.indexOf("src=",T),x=_.indexOf('"',Number(y)+5),P=_.substring(Number(y)+5,Number(x)+1);P.includes(";base64")?v.push({oldUrl:P}):P.includes("blob:")&&C.push({oldUrl:P})}),v.length>0?this.reUploadBase64File(v,(T,y)=>{null!=y?this.reUploadBlobFile(C,(x,P)=>{null!=P?(_=this.replaceHomeworkContent(_,T),_=this.replaceHomeworkContent(_,x),d.next({errorMessage:void 0,content:_}),d.complete()):(d.next({errorMessage:P,content:_}),d.complete())}):(d.next({errorMessage:y,content:_}),d.complete())}):C.length>0?this.reUploadBlobFile(C,(T,y)=>{null!=y?(_=this.replaceHomeworkContent(_,T),d.next({errorMessage:void 0,content:_}),d.complete()):(d.next({errorMessage:y,content:_}),d.complete())}):(_=this.replaceHomeworkContent(_,[]),d.next({errorMessage:void 0,content:_}),d.complete())}else d.next({errorMessage:void 0,content:_}),d.complete()})}replaceHomeworkContent(_,d){return d.length>0&&d.forEach(m=>{var v,C=_.replace(null!==(v=m.oldUrl)&&void 0!==v?v:"  ",m.newUrl+'" class="w-100 img-fluid"');_=C}),_}findAllSubString(_,d){for(var m=0,v=0,C=[];_.indexOf(d,m)>-1;)v=_.indexOf(d,m),C.push(v),m=v+d.length;return C}getTypeFile(_){var d=_.indexOf(";");return _.substring(5,d)}getFileName(_){var d=_.split("").reverse().join(""),m=d.indexOf(";"),v=d.indexOf("/",m);return d.substring(m,v).split("").reverse().join("")}convertBlobToBase64(_){return new Promise(d=>{var m=new Image;m.crossOrigin="Anonymous",m.addEventListener("load",function(){var v=document.createElement("canvas"),C=v.getContext("2d");v.width=m.width,v.height=m.height,null==C||C.drawImage(m,0,0);var T=v.toDataURL("image/png");d(T)},!1),m.src=_})}reUploadBase64File(_,d){var m;if(_&&_.length>0){let y,T=_.length;for(var v=[],C=0;C<_.length;C++){const x=_[C],P=null===(m=x.oldUrl)||void 0===m?void 0:m.substring(0,x.oldUrl.length-1);this.startUploadBlobFile(x,null!=P?P:"",[],(n,l)=>{null==l?v=v.concat(n):y=l,T-=1,0==T&&d(v,y)})}}else d([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}reUploadBlobFile(_,d){var m;if(_&&_.length>0){let y,T=_.length;for(var v=[],C=0;C<_.length;C++){const x=_[C],P=null===(m=null==x?void 0:x.oldUrl)||void 0===m?void 0:m.substring(0,x.oldUrl.length-1);this.convertBlobToBase64(null!=P?P:"").then(n=>{this.startUploadBlobFile(x,n,[],(l,g)=>{null==g?v=v.concat(l):y=g,T-=1,0==T&&d(v,y)})})}}else d([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}startUploadBlobFile(_,d,m,v){if(d&&""!=d){var C=this.getTypeFile(d),T=this.myPdfService.b64toFile(d,this.getFileName(C),C);(0,b.hv)(T).then(y=>{this.apiUploadService.uploadToCdnForHomework(y).subscribe(x=>{var P,n;if(x.type!=t.dt.UploadProgress)if(1==x.success){var l=Object.assign(Object.assign({},_),{newUrl:null!==(n=null===(P=x.data)||void 0===P?void 0:P.url)&&void 0!==n?n:""});m.push(l),v(m,void 0)}else v(m,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi[SPLIT_LANG] [SPLIT_LANG]"+x.message)})})}else v(m,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}}return S.\u0275fac=function(_){return new(_||S)(D.LFG(A.v),D.LFG(B.$),D.LFG(O.t))},S.\u0275prov=D.Yz7({token:S,factory:S.\u0275fac,providedIn:"root"}),S})()}}]);