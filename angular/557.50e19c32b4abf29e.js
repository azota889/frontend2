"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[557],{70513:(ht,F,m)=>{m.d(F,{S:()=>q});var k=m(49671),g=m(65879),S=m(87384),P=m(8415),R=m(50871),M=m(77051);let q=(()=>{class x{processEssayResultToBase64(h){var f=this;return(0,k.Z)(function*(){for(const _ of h.pages??[]){if(_.draw){const w=yield f.exportPdfUtilsService.convertAndRetryToBase64(_.draw);_.draw=w}if(_.backgroundImage){const w=yield f.exportPdfUtilsService.convertAndRetryToBase64(_.backgroundImage);_.backgroundImage=w}}if(h.commentEmoji&&h.commentEmoji.length){let _="https://azota889.github.io/storage_public/mnote/",w=h.commentEmoji.length;for(let v=0;v<w;v++){let O=_+h.commentEmoji[v];const T=yield f.exportPdfUtilsService.convertAndRetryToBase64(O);h.commentEmoji[v]=T}}return h})()}processGroupImagesToBase64(h,f){var _=this;return(0,k.Z)(function*(){if(h&&h?.[0].name?.startsWith("[PDFv2]"))for(const w of h)if(w.questionContentParse&&w.questionContentParse[0].groupUrl&&f.includes(w.indexLabel??-1)){const v=yield _.exportPdfUtilsService.convertAndRetryToBase64(w.questionContentParse[0].groupUrl);w.questionContentParse[0].groupUrl=v}})()}processQuestionImagesToBase64(h){var f=this;return(0,k.Z)(function*(){if(1==h[0].isImage)for(const _ of h){const w=yield f.exportPdfUtilsService.convertAndRetryToBase64(_.questionContentParse?.[0].url??"");_.questionContentParse&&(_.questionContentParse[0].url=w)}})()}processQuestionDocxContentToBase64(h){var f=this;return(0,k.Z)(function*(){if(0==h[0].isImage)for(const w of h){var _=f.exportPdfUtilsService.findImageSrcInContent(w.questionContentParse?.[0].content??"");if(_&&!_.includes(";base64")){const v=yield f.exportPdfUtilsService.convertAndRetryToBase64(_);w.questionContentParse?.[0].content?.includes("img")&&v&&(w.questionContentParse[0].content=w.questionContentParse[0].content.replace(_,v))}}})()}convertAnswersArr(h,f){0!=h.length&&h.forEach(_=>{_.QuestionId&&_.AnswerContent&&_.AnswerContent[0]&&_.AnswerContent[0].Content&&(f[`id_${_.QuestionId}`]=_.AnswerContent[0].Content)})}findScaleDirection(h,f){return h/f>=.7070707070707071?"w":"h"}constructor(h,f,_,w){this.commonService=h,this.cdnService=f,this.customQuestionAnswerConfig=_,this.exportPdfUtilsService=w}}return x.\u0275fac=function(h){return new(h||x)(g.LFG(S.v),g.LFG(P.U),g.LFG(R.U),g.LFG(M.V))},x.\u0275prov=g.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})()},77051:(ht,F,m)=>{m.d(F,{V:()=>q});var k=m(49671),g=m(65879),S=m(87384),P=m(8415),R=m(46825),M=function(x){return x[x.Cdn=0]="Cdn",x[x.CdnTimestamp=1]="CdnTimestamp",x[x.Rawlink=2]="Rawlink",x[x.RawlinkTimestamp=3]="RawlinkTimestamp",x}(M||{});let q=(()=>{class x{get blockCropItemClass(){return"__CANVAS_CROP_ITEM"}get blockEssayCropItemClass(){return"_ESSAY"}isSupportedBrowser(){let h=this.commonService.getBrowserType().toString();return!(!["chrome"].includes(h.split(" ")[0].toLowerCase())||parseInt(h.split(" ")[1],10)<80)}getExtensionFile(h){if(!h)return"";var f=h.split(".");return f.length<=1?"":f[f.length-1].toLocaleLowerCase().split("_")[0]}translateMetaTitle(h){let f="Export PDF: ";this.commonService.translateMetaData({title:f+h.data?.examObj?.name,description:f+h.data?.examObj?.name,image:"lang_cms_test_image"})}findImageSrcInContent(h){var f="";if(h.includes("img")){var _=h.indexOf("img"),w=h.indexOf("src=",_),v=h.indexOf('"',Number(w)+5);f=h.substring(Number(w)+5,Number(v))}return f}asyncTimeout(h){return(0,k.Z)(function*(){return`Waited ${yield new Promise(_=>{setTimeout(()=>_(h),h)})} miliseconds`})()}parseEssayMarkResult(h,f){let _=h.filter(O=>this.answerTypeService.isEssayAnswer(O.answerType));if(0!=_.length&&f&&f.essayResult){var w=this.commonService.willDeleteParseJson(f.essayResult);if(w){var v=Object.entries(w);for(let O=0;O<_.length;O++)_[O].essayMarkParsed=v[O][1]}}}convertToBase64(h,f){var _=this;return(0,k.Z)(function*(){let w=h;switch(f){case M.Cdn:w=_.cdnService.getMyCdn(h);break;case M.CdnTimestamp:w=_.cdnService.getMyCdn(h)+"?t="+Date.now();break;case M.RawlinkTimestamp:w=h+"?t="+Date.now()}const O=yield(yield fetch(w)).blob(),T=yield new Promise(A=>{const Z=new FileReader;Z.readAsDataURL(O),Z.onloadend=()=>{A(Z.result)}});return T&&"string"==typeof T?T:h})()}convertAndRetryToBase64(h){var f=this;return(0,k.Z)(function*(){let _=f.getExtensionFile(h);if(["pdf","jpg","jpeg","png","gif"].includes(_)){let w;const v=[M.Cdn,M.CdnTimestamp,M.Rawlink,M.RawlinkTimestamp];try{w=yield f.convertToBase64(h,v[0])}catch{try{w=yield f.convertToBase64(h,v[1])}catch{try{w=yield f.convertToBase64(h,v[2])}catch{try{w=yield f.convertToBase64(h,v[3])}catch{console.log("Kh\xf4ng th\u1ec3 convert url n\xe0y th\xe0nh base64 sau v\xe0i l\u1ea7n retry: "+h),w=h}}}}return w}return h})()}eraseCanvas(h){h&&(h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.fillStyle="white",h.fill())}addContentToPdf(h,f){h.addImage(f,"JPEG",0,0,h.internal.pageSize.getWidth(),h.internal.pageSize.getHeight())}drawTextWrap(h,f,_,w,v){let O=h.split(" "),T=[],A=O[0];if(f){f.font=v||`${w}px Arial`;for(let Z=1;Z<O.length;Z++){let D=O[Z];f.measureText(A+" "+D).width<_?A+=" "+D:(T.push(A),A=D)}T.push(A)}return T}essayText2LinesArr(h,f,_,w,v){let O=new RegExp("(<br>|<br/>)+","igm"),A=(this.commonService.replaceAllByRegExp(h,O,"<br>")??"").split("<br>"),Z=[];for(let D=0;D<A.length;D++)Z.push(this.drawTextWrap(A[D],f,_,w,v));return Z}constructor(h,f,_){this.commonService=h,this.cdnService=f,this.answerTypeService=_}}return x.\u0275fac=function(h){return new(h||x)(g.LFG(S.v),g.LFG(P.U),g.LFG(R.T))},x.\u0275prov=g.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})()},43557:(ht,F,m)=>{m.r(F),m.d(F,{HomeworkModule:()=>Fo});var k=m(96814),g=m(56223),S=m(19347),P=m(75187),R=m(42753),M=m(37722),q=m(21494),x=m(90654),Q=m(84906),h=m(49962),f=m(23348),_=m(11222),w=m(69814),v=m(82481),O=m(29921),T=m(29023),A=m(69862),Z=m(73445),D=m(23680),Y=m(52572),it=m(10548),Zt=m(12889),It=m(16019),Dt=m(88620),ut=m(35187),K=m(35318),E=m(39621),Et=m(217),Nt=m(5961),t=m(65879),J=m(90467),st=m(50503),G=m(58222),Lt=m(63934),gt=m(31518),Ut=m(79107),Ht=m(71069),Jt=m(2032),at=m(64170),pt=m(92596),X=m(5647),tt=m(775),zt=m(10463),Bt=m(74438),_t=m(33066),j=m(11964);function Rt(i,r){1&i&&t._UZ(0,"azt-loading-effect")}function Ft(i,r){1&i&&(t.TgZ(0,"div",95),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"lang_auto_vui_long_nhap_ten_bai_tap")," "))}function qt(i,r){1&i&&(t.TgZ(0,"span"),t._uU(1,"OK"),t.qZA())}function Qt(i,r){1&i&&(t.TgZ(0,"span"),t._uU(1,"OK"),t.qZA())}function Yt(i,r){1&i&&(t.TgZ(0,"div",96),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"lang_testbank_test_config_end_time_bigger_time_star"),". "))}function Gt(i,r){1&i&&(t.TgZ(0,"div",97),t.O4$(),t.TgZ(1,"svg",98)(2,"g",99)(3,"g",100),t._UZ(4,"circle",101),t.TgZ(5,"path",102),t._UZ(6,"animateTransform",103),t.qZA()()()()())}function Wt(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",104)(1,"button",105),t.NdJ("click",function(){const s=t.CHM(e).index,a=t.oxw(2);return t.KtG(!!a.formHomework.files&&a.formHomework.files.splice(s,1))}),t.O4$(),t.TgZ(2,"svg",27),t._UZ(3,"line",106)(4,"line",107),t.qZA()(),t.kcU(),t.TgZ(5,"a",108),t.NdJ("click",function(){const s=t.CHM(e).$implicit,a=t.oxw(2);return t.KtG(a.onShowFile(s,-1))}),t.TgZ(6,"span",109),t._uU(7),t.qZA()()()}if(2&i){const e=r.$implicit;t.xp6(6),t.Q6J("title",e.name),t.xp6(1),t.Oqu(e.name)}}function Vt(i,r){1&i&&(t.TgZ(0,"div",112),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"lang_testbank_test_config_you_not_yet_class")," "))}function $t(i,r){if(1&i&&(t.TgZ(0,"div",110),t.YNc(1,Vt,3,3,"div",111),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.form.controls.classroomIds.errors.classroomCheckBoxValidatorWithoutWhoAllow)}}const Kt=function(){return{standalone:!0}},Xt=function(i){return{"h-56-important":i}};function te(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",3)(1,"form",4)(2,"div",5)(3,"div",6)(4,"h3",7),t._uU(5),t.ALo(6,"mytranslate"),t.qZA(),t.TgZ(7,"div",8)(8,"div",9)(9,"div",10)(10,"label",11),t._uU(11),t.ALo(12,"mytranslate"),t.qZA()(),t.TgZ(13,"div",10)(14,"div",12),t._UZ(15,"input",13),t.ALo(16,"mytranslate"),t.qZA(),t.YNc(17,Ft,3,3,"div",14),t.qZA()(),t.TgZ(18,"div",15)(19,"div",16)(20,"label",17),t._uU(21),t.ALo(22,"mytranslate"),t.O4$(),t.TgZ(23,"svg",18),t.ALo(24,"mytranslate"),t._UZ(25,"circle",19)(26,"line",20)(27,"line",21),t.qZA()()(),t.kcU(),t.TgZ(28,"div",16)(29,"div",22)(30,"div",23)(31,"mat-form-field",24)(32,"input",25),t.NdJ("click",function(){t.CHM(e);const n=t.MAs(43);return t.KtG(n.open())}),t.ALo(33,"mytranslate"),t.qZA(),t.TgZ(34,"button",26),t.NdJ("click",function(n){return t.CHM(e),t.MAs(43).open(),t.KtG(n.stopPropagation())}),t.O4$(),t.TgZ(35,"svg",27),t._UZ(36,"path",28)(37,"path",29)(38,"path",30)(39,"path",31)(40,"path",32)(41,"path",33),t.qZA()(),t.kcU(),t.TgZ(42,"ngx-mat-datetime-picker",null,34),t.YNc(44,qt,2,0,"ng-template"),t.qZA()()(),t.TgZ(45,"div",23)(46,"mat-form-field",24)(47,"input",35),t.NdJ("click",function(){t.CHM(e);const n=t.MAs(58);return t.KtG(n.open())}),t.ALo(48,"mytranslate"),t.qZA(),t.TgZ(49,"button",36),t.NdJ("click",function(n){return t.CHM(e),t.MAs(58).open(),t.KtG(n.stopPropagation())}),t.O4$(),t.TgZ(50,"svg",27),t._UZ(51,"path",28)(52,"path",29)(53,"path",30)(54,"path",31)(55,"path",32)(56,"path",33),t.qZA()(),t.kcU(),t.TgZ(57,"ngx-mat-datetime-picker",null,37),t.YNc(59,Qt,2,0,"ng-template"),t.qZA()()(),t.TgZ(60,"div",38)(61,"button",39),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.clearTime())}),t.O4$(),t.TgZ(62,"svg",40),t._UZ(63,"path",41)(64,"path",42)(65,"path",43)(66,"path",44),t.qZA(),t._uU(67),t.ALo(68,"mytranslate"),t.qZA()()(),t.kcU(),t.TgZ(69,"div",45)(70,"div",46),t._uU(71),t.ALo(72,"mytranslate"),t.qZA(),t.YNc(73,Yt,3,3,"div",47),t.qZA()()(),t.TgZ(74,"div",48)(75,"div",10)(76,"h3",49),t._uU(77),t.ALo(78,"mytranslate"),t.qZA()(),t.TgZ(79,"div",50)(80,"div",51)(81,"input",52,53),t.NdJ("change",function(n){t.CHM(e);const s=t.oxw();return t.KtG(s.onFileSelected(n))}),t.qZA(),t.TgZ(83,"a",54),t.NdJ("click",function(){t.CHM(e);const n=t.MAs(82);return t.KtG(n.click())}),t.O4$(),t.TgZ(84,"svg",55),t._UZ(85,"line",56)(86,"line",57),t.qZA(),t.kcU(),t.TgZ(87,"span"),t._uU(88),t.ALo(89,"mytranslate"),t.qZA()(),t.YNc(90,Gt,7,0,"div",58),t.TgZ(91,"div",59),t._uU(92),t.ALo(93,"mytranslate"),t.qZA(),t.YNc(94,Wt,8,2,"div",60),t.qZA(),t.TgZ(95,"editor",61),t.NdJ("ngModelChange",function(n){t.CHM(e);const s=t.oxw();return t.KtG(s.formHomework.content=n)}),t.qZA()()(),t.TgZ(96,"div",62)(97,"div",63)(98,"label",64),t._uU(99),t.ALo(100,"mytranslate"),t.qZA()(),t.TgZ(101,"div",65)(102,"div",66)(103,"div",67),t._UZ(104,"input",68),t.TgZ(105,"label",69),t._uU(106),t.ALo(107,"mytranslate"),t.qZA()(),t.TgZ(108,"div",70),t._UZ(109,"input",71),t.TgZ(110,"label",72),t._uU(111),t.ALo(112,"mytranslate"),t.qZA()()()()(),t.TgZ(113,"div",73)(114,"div",63)(115,"label",64),t._uU(116),t.ALo(117,"mytranslate"),t.qZA()(),t.TgZ(118,"div",65)(119,"div",66)(120,"div",67),t._UZ(121,"input",74),t.TgZ(122,"label",75),t._uU(123),t.ALo(124,"mytranslate"),t.qZA()(),t.TgZ(125,"div",70),t._UZ(126,"input",76),t.TgZ(127,"label",77),t._uU(128),t.ALo(129,"mytranslate"),t.qZA()()()()(),t.TgZ(130,"div",78)(131,"div",79)(132,"div",80),t._uU(133),t.ALo(134,"mytranslate"),t.qZA()(),t.TgZ(135,"div",81)(136,"div",82)(137,"div",83)(138,"h3",84),t._uU(139),t.ALo(140,"mytranslate"),t.qZA(),t.TgZ(141,"div",85),t._UZ(142,"azt-list-classroom-checkall",86),t.qZA()(),t.TgZ(143,"div",87)(144,"ng-scrollbar",88),t._UZ(145,"azt-list-classroom-checkbox",89),t.qZA()()()(),t.YNc(146,$t,2,1,"div",90),t.qZA()(),t.TgZ(147,"div",91)(148,"div",92)(149,"button",93),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.saveHomework(0))}),t._uU(150),t.ALo(151,"mytranslate"),t.qZA(),t.TgZ(152,"button",94),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.saveHomework(1))}),t._uU(153),t.ALo(154,"mytranslate"),t.qZA()()()()()()()}if(2&i){const e=t.MAs(43),o=t.MAs(58),n=t.oxw();t.xp6(1),t.Q6J("formGroup",n.form),t.xp6(4),t.hij(" ",t.lcZ(6,45,"lang_auto_tao_bai_tap_moi")," "),t.xp6(6),t.hij(" ",t.lcZ(12,47,"lang_auto_ten")," "),t.xp6(4),t.s9C("placeholder",t.lcZ(16,49,"lang_auto_nhap_ten")+" ..."),t.xp6(2),t.Q6J("ngIf",n.form.controls.homeworkName.errors),t.xp6(4),t.hij(" ",t.lcZ(22,51,"lang_testbank_test_config_time_assigne_homework")," "),t.xp6(2),t.s9C("matTooltip",t.lcZ(24,53,"lang_homework_add_home_work_startDate_introduce")),t.xp6(9),t.s9C("placeholder",t.lcZ(33,55,"lang_auto_tu")),t.Q6J("ngxMatDatetimePicker",e),t.xp6(15),t.s9C("placeholder",t.lcZ(48,57,"lang_auto_den")),t.Q6J("ngxMatDatetimePicker",o),t.xp6(20),t.hij(" ",t.lcZ(68,59,"lang_auto_dat_lai")," "),t.xp6(4),t.hij(" ",t.lcZ(72,61,"lang_auto_bo_trong_neu_khong_muon_gioi_han_thoi_gian"),". "),t.xp6(2),t.Q6J("ngIf",n.calculatorTimeValidate(n.form.controls.homeworkDeadline.value,n.form.controls.homeworkStartDate.value)<=0),t.xp6(4),t.hij(" ",t.lcZ(78,63,"lang_auto_noi_dung")," "),t.xp6(11),t.Oqu(t.lcZ(89,65,"lang_homework_add_home_work_add_file_homework")),t.xp6(2),t.Q6J("ngIf",n.loadingUpload),t.xp6(2),t.Oqu(t.lcZ(93,67,"lang_cms_add_homework_input_file")),t.xp6(2),t.Q6J("ngForOf",n.formHomework.files),t.xp6(1),t.Q6J("ngModel",n.formHomework.content)("ngModelOptions",t.DdM(89,Kt))("init",n.initDataEditor),t.xp6(4),t.hij(" ",t.lcZ(100,69,"lang_auto_cho_xem_ket_qua")," "),t.xp6(7),t.hij(" ",t.lcZ(107,71,"lang_auto_khong")," "),t.xp6(5),t.hij(" ",t.lcZ(112,73,"lang_auto_co")," "),t.xp6(5),t.hij(" ",t.lcZ(117,75,"lang_auto_dang_nhap_de_nop_bai")," "),t.xp6(7),t.hij(" ",t.lcZ(124,77,"lang_auto_khong")," "),t.xp6(5),t.hij(" ",t.lcZ(129,79,"lang_auto_co")," "),t.xp6(5),t.hij(" ",t.lcZ(134,81,"lang_auto_giao_cho_lop")," "),t.xp6(6),t.hij(" ",t.lcZ(140,83,"lang_auto_danh_sach_cac_lop")," "),t.xp6(3),t.Q6J("form",n.form)("objs",n.classroomObjs)("permissionName",n.permissionTypes.homework),t.xp6(2),t.Q6J("visibility","hover")("autoHeightDisabled",!1)("ngClass",t.VKq(90,Xt,n.isMobileWebView)),t.xp6(1),t.Q6J("form",n.form)("objs",n.classroomObjs)("homeworkObj",void 0)("permissionName",n.permissionTypes.homework),t.xp6(1),t.Q6J("ngIf",n.form.controls.classroomIds.errors),t.xp6(3),t.Q6J("disabled",n.form.invalid||n.checkDeadLineValid(n.form.controls.homeworkStartDate.value,n.form.controls.homeworkDeadline.value)<=0),t.xp6(1),t.hij(" ",t.lcZ(151,85,"lang_auto_luu_nhap")," "),t.xp6(2),t.Q6J("disabled",n.form.invalid||n.checkDeadLineValid(n.form.controls.homeworkStartDate.value,n.form.controls.homeworkDeadline.value)<=0),t.xp6(1),t.hij(" ",t.lcZ(154,87,"lang_auto_xuat_ban")," ")}}let ee=(()=>{class i extends E.Q{clearTime(){this.form.controls.homeworkDeadline.setValue(""),this.form.controls.homeworkStartDate.setValue("")}checkDeadLineValid(e,o){return""!=e&&""!=o?this.timeService.getDiffFromTwoDateWithZeroSecond(o,e):1}onFileSelected(e){let n=e.target,s=n.files,a=!!s&&s[0];0!=a&&((0,it.C0)(a.type)?(0,it.ml)(a.type)?this.showErrorSnack("lang_auto_file_gap_loi: "+a.name+"lang_auto__kieu: "+a.type+"lang_auto__chua_ho_tro_dinh_dang_video_wmv_vui_long_thu_lai"):(this.loadingUpload=!0,this.uploadProgress=0,(0,it.hv)(a).then(c=>{this.apiUploadService.uploadToCdnForHomework(c).subscribe(d=>{d.type!=A.dt.UploadProgress&&(1==d.success?(this.formHomework.files&&!Array.isArray(this.formHomework.files)&&(this.formHomework.files=[]),this.formHomework.files?.push({...d.data}),this.loadingUpload=!1,this.uploadProgress=-1):(this.loadingUpload=!1,this.showErrorSnack(this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi",d.message??"none"))))})})):this.showErrorSnack("lang_cms_add_homework_not_support_file_upload")),n.files=null}onShowFile(e,o){let n={...e,index:o};this.dialog.open(Zt.F,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:n},restoreFocus:!1})}saveHomework(e){this.initStatusObj(),this.homeWorkContent=this.formHomework.content??"",this.uploadImageOfHomeworkService.replaceImageInContent(this.homeWorkContent).subscribe(o=>{null==o.errorMessage?(this.homeWorkContent=o.content,this.callApiToSaveHomework(e)):(this.showErrorSnack(o.errorMessage),this.stopStatusObj())})}callApiToSaveHomework(e){let o=this.commonService.getFormObj(this.form);o.homeworkStartDate=""===o.homeworkStartDate||null===o.homeworkStartDate?null:this.timeService.formatDateTimeToPostToServer(o.homeworkStartDate),o.homeworkDeadline=""===o.homeworkDeadline||null===o.homeworkDeadline?null:this.timeService.formatDateTimeToPostToServer(o.homeworkDeadline),o.mustVerified=1!=o.mustVerified?0:1,o.whenShowAnswer=1!=o.whenShowAnswer?0:1,this.homeWorkContent=this.zipDataService.convertContentGzip(this.homeWorkContent);let n=this.userService.getUserObj(),s=JSON.stringify({type:"homework",id:0,user:n.id}),a=this.sEAztClassroomCheckboxService.findClassroomWithNoPermission(this.classroomObjs,ut.y.homework);const c=this.sEAztClassroomCheckboxService.getClassroomIdsChecked(this.classroomObjs,a,o.classroomIds);let d={name:o.homeworkName,content:this.homeWorkContent,startDate:o.homeworkStartDate,deadline:o.homeworkDeadline,files:JSON.stringify(this.formHomework.files),mustVerified:o.mustVerified,whenShowAnswer:o.whenShowAnswer,isPublished:e,categoryId:this.cateId?Number(this.cateId):void 0,classroomIds:c};this.subscriptions.add(this.homeworkService.apiHomeworkSaveObjPost(s,d).subscribe(l=>{if(1==l.success){if(e){this.successStatusObj("lang_auto_xuat_ban_thanh_cong",!0);let u=[];if(l.data?.objs)for(let b=0;b<l.data.objs.length;b++)u.push(l.data?.objs[b].hashId);this.listIds=JSON.stringify(u),this.commonService.myNavigationWithQueryString("/admin/testbank/publish-document/1/"+(this.cateId??0)+"/"+this.listIds,"?backto="+encodeURIComponent(`/admin/homework/add-new-homework/${this.cateId??0}?backto=`+this.backToLink))}else this.commonService.myNavigation(this.backToLink?this.backToLink:"/admin/testbank/document-management/1/0/1"),this.successStatusObj("lang_auto_luu_thanh_cong_chua_xuat_ban",!0);this.successStatusObj()}else this.errorStatusObj(l.message??"",!0)}))}getHomework(){this.subscriptions.add(this.homeworkService.apiHomeworkGetObjGet("add_new").subscribe(e=>{1==e.success?(this.classroomObjs=e?.data?.classroomObjs??new Array,this.successStatusObj()):this.errorStatusObj(e.message??"",!0)}))}checkModeUiEditor(e){this.initDataEditor="dark"==e?{height:250,menubar:!1,plugins:[],skin:"oxide-dark",content_css:"dark",toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify"}:{height:250,menubar:!1,plugins:[],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify"}}calculatorTimeValidate(e,o){return""!=e&&""!=o?(this.timeService.calculationHomeworkTimeWithZeroSecond(e,o),this.timeService.calculationHomeworkTimeWithZeroSecond(e,o)):1}ngOnChanges(){let e=""==this.browserStorageService.getStorage("mode_ui")?"light":this.browserStorageService.getStorage("mode_ui")??"light";this.checkModeUiEditor(e)}ngOnInit(){this.initStatusObj();let e=""==this.browserStorageService.getStorage("mode_ui")?"light":this.browserStorageService.getStorage("mode_ui")??"light";this.checkModeUiEditor(e),(0,Y.a)([this.activeRoute.params,this.activeRoute.queryParams]).subscribe(([])=>{this.backToLink=this.commonService.getMyQueryParam("backto")??"",this.cateId=this.commonService.getMyParam(this.activeRoute,"cat_id")??"",this.getHomework()}),this.form=this.fb.group({homeworkName:new g.p4("",[g.kI.required,g.kI.maxLength(180),Nt._.noWhiteSpace]),homeworkStartDate:new g.p4(""),homeworkDeadline:new g.p4(""),mustVerified:new g.p4("0"),whenShowAnswer:new g.p4("0"),classroomIds:this.fb.array([]),whoAllow:new g.p4("2")},{validators:[Et.h.classroomCheckBoxValidatorWithoutWhoAllow]}),this.form.valueChanges.subscribe(o=>{let n=JSON.stringify(o);n!=this.prevData&&(this.prevData=n,this.form.patchValue(o))}),this.commonService.translateMetaData({title:"lang_cms_homework_add_exercise_title",description:"lang_cms_homework_add_exercise_description",image:"lang_cms_test_image"})}constructor(e,o,n,s,a,c,d,l,u,p,b,y){super(),this.dialog=e,this.activeRoute=o,this.fb=n,this.homeworkService=s,this.classroomService=a,this.apiUploadService=c,this.zipDataService=d,this.timeService=l,this.userService=u,this.browserStorageService=p,this.sEAztClassroomCheckboxService=b,this.uploadImageOfHomeworkService=y,this.form=new g.nJ({}),this.permissionTypes=ut.y,this.formHomework={files:[],content:""},this.classroomObjs=[],this.prevData="",this.cateId="",this.listIds="",this.backToLink="",this.uploadProgress=-1,this.loadingUpload=!1,this.homeWorkContent="",this.initDataEditor={}}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(S.uw),t.Y36(P.gz),t.Y36(g.QS),t.Y36(J.Lk),t.Y36(J.um),t.Y36(st.$),t.Y36(G.D),t.Y36(K.O),t.Y36(Lt.K),t.Y36(gt.z),t.Y36(Ut.L),t.Y36(Ht.J))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-add-home-work"]],features:[t._Bn([{provide:T.fM,useClass:It.WG,deps:[D.Ad,Z.o8]},{provide:T.ab,useFactory:Dt.hx,deps:[K.O]}]),t.qOj,t.TTD],decls:4,vars:3,consts:[[3,"headerBackToLink"],[4,"ngIf","ngIfElse"],["doneLoading",""],[1,"intro-y","mt-5"],[3,"formGroup"],[1,"azt-config-document","mx-auto",2,"max-width","1000px"],[1,"setting-basic"],[1,"text-md","uppercase","font-medium"],[1,"box","mt-2","p-5"],["id","azt-config-name",1,"grid","grid-cols-12"],[1,"col-span-12","lg:col-span-12"],["for","homework-name",1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["id","homework-name","formControlName","homeworkName","type","text",1,"form-control",3,"placeholder"],["class","text-xs text-danger mt-2",4,"ngIf"],["id","azt-config-time-assignment",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12"],["for","regular-form-1",1,"form-label","mb-0","font-medium","flex","items-center"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"lucide","w-4","h-4","ml-2",3,"matTooltip"],["cx","12","cy","12","r","10"],["x1","12","y1","16","x2","12","y2","12"],["x1","12","y1","8","x2","12.01","y2","8"],[1,"grid","grid-cols-12","gap-3"],[1,"col-span-12","md:col-span-5"],["appearance","outline"],["azt-track-service","add-home-work-2lcHTxnwVmR","matInput","","formControlName","homeworkStartDate","readonly","",3,"placeholder","ngxMatDatetimePicker","click"],["azt-track-service","add-home-work-6MNUM1lV8t1","matSuffix","",2,"font-size","18px",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-4","h-4","lucide"],["d","M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5"],["d","M16 2v4"],["d","M8 2v4"],["d","M3 10h5"],["d","M17.5 17.5 16 16.25V14"],["d","M22 16a6 6 0 1 1-12 0 6 6 0 0 1 12 0Z"],["startTime",""],["azt-track-service","add-home-work-ShSJ8gIBpK8","matInput","","formControlName","homeworkDeadline","readonly","",3,"placeholder","ngxMatDatetimePicker","click"],["azt-track-service","add-home-work--BjU84v-g28","matSuffix","",2,"font-size","18px",3,"click"],["endTime",""],[1,"col-span-6","md:col-span-2"],["azt-track-service","add-home-work-NEdqGTKJIVb",1,"btn","btn-outline-secondary","w-full",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"lucide","w-4","h-4","mr-2"],["d","M10 2h4"],["d","M12 14v-4"],["d","M4 13a8 8 0 0 1 8-7 8 8 0 1 1-5.3 14L4 17.6"],["d","M9 17H4v5"],[1,"text-xs","mt-2"],[1,"text-slate-500","mt-1"],["class","text-danger mt-1",4,"ngIf"],[1,"grid","grid-cols-12","mt-4"],[1,"text-md","font-medium"],[1,"col-span-12","lg:col-span-12","mt-3"],[1,"col-md-12"],["type","file","name","fileHomework",2,"display","none",3,"change"],["formChoseFile",""],["azt-track-service","add-home-work-4ML9tUkucGY",1,"btn","btn-sm","btn-primary-soft",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-4","h-4","mr-2"],["x1","12","y1","5","x2","12","y2","19"],["x1","5","y1","12","x2","19","y2","12"],["class","flex justify-center my-2",4,"ngIf"],[1,"text-slate-600","text-xs","mt-2","mb-2"],["class","flex items-center mt-3 mb-3",4,"ngFor","ngForOf"],["apiKey","ldij13v1886vlrnk42g9bvngyqdc6gxpe8l0n9mo8gdjpg9d",3,"ngModel","ngModelOptions","init","ngModelChange"],["id","azt-config-when-result",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12","lg:col-span-5"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"col-span-12","lg:col-span-7"],[1,"flex","flex-col","sm:flex-row"],[1,"form-check","mr-8"],["id","whenShowAnswer-off","type","radio","formControlName","whenShowAnswer","value","1",1,"form-check-input"],["for","whenShowAnswer-off",1,"form-check-label"],[1,"form-check","mr-8","mt-2","sm:mt-0"],["id","whenShowAnswer-tested","type","radio","formControlName","whenShowAnswer","value","0",1,"form-check-input"],["for","whenShowAnswer-tested",1,"form-check-label","flex","items-center"],["id","azt-config-login-require",1,"grid","grid-cols-12","mt-4"],["id","mustVerified-off","type","radio","formControlName","mustVerified","value","0",1,"form-check-input"],["for","mustVerified-off",1,"form-check-label"],["id","mustVerified-tested","type","radio","formControlName","mustVerified","value","1",1,"form-check-input"],["for","mustVerified-tested",1,"form-check-label","flex","items-center"],["id","azt-config-who-allow",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12","lg:col-span-5","pr-5"],[1,"mb-0","font-medium","flex","items-center"],[1,"col-span-12","mt-4","intro-y"],[1,"border","border-slate-200/60","dark:border-darkmode-400","rounded-md","pb-1"],[1,"p-3","bg-slate-100","dark:bg-darkmode-400","flex","items-center"],[1,"mr-auto"],[1,"flex"],["formArrayName","classroomIds",3,"form","objs","permissionName"],[1,"classroom_list"],["pointerEventsMethod","scrollbar",1,"w-full",3,"visibility","autoHeightDisabled","ngClass"],["formArrayName","classroomIds",3,"form","objs","homeworkObj","permissionName"],["class","col-span-12 mt-2 intro-y",4,"ngIf"],[1,"my-5"],[1,"text-right"],["azt-track-service","add-home-work-ZxDqD0KF4NR",1,"btn","btn-pending","w-24","mr-2",3,"disabled","click"],["azt-track-service","add-home-work-JgG_cpuccgD",1,"btn","w-24","btn-primary",3,"disabled","click"],[1,"text-xs","text-danger","mt-2"],[1,"text-danger","mt-1"],[1,"flex","justify-center","my-2"],["width","25","viewBox","-2 -2 42 42","xmlns","http://www.w3.org/2000/svg","stroke","rgb(30, 41, 59)",1,"w-6","h-6"],["fill","none","fill-rule","evenodd"],["transform","translate(1 1)","stroke-width","4"],["stroke-opacity",".5","cx","18","cy","18","r","18"],["d","M36 18c0-9.94-8.06-18-18-18"],["attributeName","transform","type","rotate","from","0 18 18","to","360 18 18","dur","1s","repeatCount","indefinite"],[1,"flex","items-center","mt-3","mb-3"],["azt-track-service","add-home-work-HeEXhrbob3P",1,"text-slate-600","mr-2",3,"click"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],["azt-track-service","add-home-work-QFtSJlUphLG",3,"click"],[1,"text-slate-600",3,"title"],[1,"col-span-12","mt-2","intro-y"],["class","text-xs text-danger",4,"ngIf"],[1,"text-xs","text-danger"]],template:function(e,o){if(1&e&&(t.TgZ(0,"teacher-layout",0),t.YNc(1,Rt,1,0,"azt-loading-effect",1),t.YNc(2,te,155,92,"ng-template",null,2,t.W1O),t.qZA()),2&e){const n=t.MAs(3);t.Q6J("headerBackToLink","/admin/testbank/document-management/1/0/1"),t.xp6(1),t.Q6J("ngIf",1==o.statusObj.loading)("ngIfElse",n)}},dependencies:[x.KC,k.mk,k.sg,k.O5,Jt.Nt,at.KE,at.R9,pt.gM,T.rZ,T.T$,R.PG,g._Y,g.Fj,g._,g.JJ,g.JL,g.On,g.sg,g.u,g.CE,X.Q,tt.M,zt.o,Bt.g,_t._,j.bT],encapsulation:2}),i})();var et=m(47394),ft=m(20054),W=m(30617),oe=m(98525),ne=m(62347);function ie(i,r){if(1&i&&(t.TgZ(0,"mat-option",15),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function se(i,r){1&i&&t._UZ(0,"azt-loading-effect")}function ae(i,r){1&i&&(t.TgZ(0,"div",18)(1,"span",19),t._uU(2),t.ALo(3,"mytranslate"),t.qZA()()),2&i&&(t.xp6(2),t.hij("",t.lcZ(3,1,"lang_homework_content_store_not_found_search"),"!"))}function re(i,r){1&i&&(t.TgZ(0,"div",33),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"lang_homework_content_store_free")))}function le(i,r){if(1&i&&(t.TgZ(0,"div",34),t._uU(1),t.ALo(2,"number"),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij("",t.lcZ(2,1,e.amount)," Azo")}}function ce(i,r){1&i&&(t.TgZ(0,"div",35),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"lang_homework_content_store_bought")))}function de(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"a",36),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,s=t.oxw(3);return t.KtG(s.downloadFrontFileContent(n.id?n.id:0))}),t.TgZ(1,"mat-icon",37),t._uU(2,"save_alt"),t.qZA(),t._uU(3),t.ALo(4,"mytranslate"),t.qZA()}2&i&&(t.xp6(3),t.hij(" ",t.lcZ(4,1,"lang_homework_content_store_download")," "))}function me(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"a",38),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,s=t.oxw(3);return t.KtG(s.openBuyContentDialog(n,s.userObj&&s.userObj.amount?s.userObj.amount:0))}),t.TgZ(1,"mat-icon",37),t._uU(2,"shopping_cart"),t.qZA(),t._uU(3),t.ALo(4,"mytranslate"),t.qZA()}2&i&&(t.xp6(3),t.hij(" ",t.lcZ(4,1,"lang_buttom_buy")," "))}function he(i,r){if(1&i&&(t.TgZ(0,"div",22)(1,"div",23),t._UZ(2,"img",24),t.ALo(3,"mycdn"),t.TgZ(4,"div",25)(5,"p",26),t._uU(6),t.qZA(),t.TgZ(7,"div",27),t.YNc(8,re,3,3,"div",28),t.YNc(9,le,3,3,"div",29),t.YNc(10,ce,3,3,"div",30),t.YNc(11,de,5,3,"a",31),t.YNc(12,me,5,3,"a",32),t.qZA()()()()),2&i){const e=r.$implicit;t.xp6(2),t.s9C("src",t.lcZ(3,7,e.thumb),t.LSH),t.xp6(4),t.Oqu(e.name),t.xp6(2),t.Q6J("ngIf",0==e.amount),t.xp6(1),t.Q6J("ngIf",0!=e.amount&&-1!=e.amount),t.xp6(1),t.Q6J("ngIf",-1==e.amount),t.xp6(1),t.Q6J("ngIf",0==e.amount||-1==e.amount),t.xp6(1),t.Q6J("ngIf",(e&&e.amount?e.amount:0)>0)}}function ue(i,r){if(1&i&&(t.TgZ(0,"div",20),t.YNc(1,he,13,9,"div",21),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.objs)}}function ge(i,r){if(1&i&&(t.YNc(0,ae,4,3,"div",16),t.YNc(1,ue,2,1,"ng-template",null,17,t.W1O)),2&i){const e=t.MAs(2),o=t.oxw();t.Q6J("ngIf",o.isNullData)("ngIfElse",e)}}function pe(i,r){if(1&i&&(t.TgZ(0,"div",14)(1,"p",15),t._uU(2),t.ALo(3,"mytranslate"),t.qZA(),t.TgZ(4,"p")(5,"span",6),t._uU(6),t.qZA()(),t.TgZ(7,"span",16),t._uU(8),t.ALo(9,"mytranslate"),t.TgZ(10,"span",17),t._uU(11),t.ALo(12,"number"),t.qZA(),t._uU(13),t.ALo(14,"mytranslate"),t.qZA()()),2&i){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,5,"lang_homework_content_store_definitely_want_to_buy")),t.xp6(4),t.hij(" ",null==e.content?null:e.content.name,""),t.xp6(2),t.hij(" ",t.lcZ(9,7,"lang_homework_content_store_with_price")," "),t.xp6(3),t.hij("",t.lcZ(12,9,null==e.content?null:e.content.amount)," Azo"),t.xp6(2),t.hij(" ",t.lcZ(14,11,"lang_homework_content_store_not"),"?")}}function _e(i,r){if(1&i&&(t.TgZ(0,"div",14)(1,"p",15),t._uU(2),t.ALo(3,"mytranslate"),t.qZA(),t.TgZ(4,"p")(5,"span",6),t._uU(6),t.qZA()(),t.TgZ(7,"span",16),t._uU(8),t.ALo(9,"mytranslate"),t.TgZ(10,"span",17),t._uU(11),t.ALo(12,"number"),t.qZA()()()),2&i){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,4,"lang_homework_content_store_not_enough_azo")),t.xp6(4),t.hij(" ",null==e.content?null:e.content.name,""),t.xp6(2),t.hij(" ",t.lcZ(9,6,"lang_homework_content_store_with_price")," "),t.xp6(3),t.hij("",t.lcZ(12,8,null==e.content?null:e.content.amount)," Azo")}}function fe(i,r){1&i&&(t.TgZ(0,"div",5)(1,"span",18),t._uU(2),t.ALo(3,"mytranslate"),t.qZA()()),2&i&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"lang_homework_content_store_please"),"!"))}function we(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"button",19),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.buyContent())}),t.TgZ(1,"mat-icon",20),t._uU(2,"shopping_cart"),t.qZA(),t._uU(3),t.ALo(4,"mytranslate"),t.qZA()}2&i&&(t.xp6(3),t.hij(" ",t.lcZ(4,1,"lang_buttom_buy")," "))}function be(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"button",21),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.gotoPack())}),t.TgZ(1,"mat-icon",20),t._uU(2,"account_balance_wallet"),t.qZA(),t._uU(3),t.ALo(4,"mytranslate"),t.qZA()}2&i&&(t.xp6(3),t.hij(" ",t.lcZ(4,1,"lang_homework_content_store_recharge")," "))}let ke=(()=>{class i extends E.Q{getData(){this.initStatusObj(),this.subscriptions.add(this.frontFileContentService.apiFrontFileContentGetObjsGet(0).subscribe(e=>{1==e.success?(this.objs=e.data?.objs??new Array,this.successStatusObj()):this.errorStatusObj(e.message??"")}))}getInfo(){this.initStatusObj(),this.subscriptions.add(this.userInfoService.apiUserInfoInfoGet().subscribe(e=>{1==e.success?(this.userObj=e.data,this.successStatusObj()):this.errorStatusObj(e.message??"")}))}getCategories(){this.initStatusObj(),this.subscriptions.add(this.frontFileContentService.apiFrontFileContentGetCategoriesObjsGet().subscribe(e=>{1==e.success?(this.categories=e.data?.objs??new Array,this.successStatusObj()):this.errorStatusObj(e.message??"")}))}openBuyContentDialog(e,o){this.openDialog(!(e.amount&&e.amount>o),e,o)}openDialog(e,o,n){this.dialog.open(xe,{width:"380px",panelClass:"buyContentDialogBox",data:{status:e,content:o,userAmount:n},restoreFocus:!1}).afterClosed().subscribe(a=>{})}selectValue(e){this.initStatusObj(),this.subscriptions.add(this.frontFileContentService.apiFrontFileContentGetObjsGet(e,void 0).subscribe(o=>{1==o.success?o.data?.objs&&o.data?.objs.length>0?(this.isNullData=!1,this.objs=o.data?.objs??new Array,this.successStatusObj()):(this.isNullData=!0,this.stopStatusObj()):this.errorStatusObj(o.message??"")}))}onSearch(){var e=this.commonService.getFormObj(this.form);this.initStatusObj(),""==e.searchContent?(this.isNullData=!1,this.subscriptions.add(this.frontFileContentService.apiFrontFileContentGetObjsGet(0).subscribe(o=>{1==o.success?(this.objs=o.data?.objs??new Array,this.successStatusObj()):this.errorStatusObj(o.message??"")}))):this.subscriptions.add(this.frontFileContentService.apiFrontFileContentGetObjsGet(0,e.searchContent).subscribe(o=>{1==o.success?(o.data?.objs&&0==o.data?.objs.length?this.isNullData=!0:this.objs=o.data?.objs??new Array,this.successStatusObj()):this.errorStatusObj(o.message??"")}))}downloadFrontFileContent(e){this.frontFileContentService.apiFrontFileContentGetFileLinkGet(e).subscribe(o=>{if(1==o.success){var n=document.createElement("a");document.body.appendChild(n),n.href=o.data?.link??"",n.click()}else this.showErrorSnack("lang_cms_content_store_download_fail")})}ngOnInit(){(0,Y.a)([this.activeRoute.params,this.activeRoute.queryParams]).subscribe(([e,o])=>{this.getData(),this.getInfo(),this.getCategories()}),this.form=this.formBuilder.group({searchContent:new g.p4("",g.kI.required)}),this.commonService.translateMetaData({title:"lang_cms_homework_content_store_title",description:"lang_cms_homework_content_store_description",image:"lang_cms_test_image"}),super.ngOnInit()}constructor(e,o,n,s,a){super(),this.activeRoute=e,this.userInfoService=o,this.frontFileContentService=n,this.formBuilder=s,this.dialog=a,this.isNullData=!1,this.form=new g.nJ({}),this.subscriptions=new et.w0,this.objs=[],this.categories=[]}ngOnDestroy(){this.subscriptions.unsubscribe(),super.ngOnDestroy()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(P.gz),t.Y36(ft.$C),t.Y36(ft.cd),t.Y36(g.QS),t.Y36(S.uw))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-content-store"]],features:[t.qOj],decls:21,vars:14,consts:[[3,"headerTitle","headerBackToLink"],["id","content-store",1,"container-fluid","component-wrap","W1200","m-auto","mt-3","pb-mb-80","pb-4"],[3,"formGroup"],[1,"flex",2,"justify-content","space-between"],[2,"width","60%","margin-top","5px"],[1,"search-bar","form-group"],[1,"input-group-append"],["type","text","formControlName","searchContent",1,"form-control",3,"placeholder","keyup.enter"],["azt-track-service","content-store-Z-NOMKYiG5Z","id","basic-addon2",1,"btn","btn-primary","ml-2",3,"click"],[1,"content-store-select",2,"width","38%"],["appearance","outline"],["name","category",3,"placeholder","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["doneLoading",""],[3,"value"],["class","text-center mt-3 mb-3",4,"ngIf","ngIfElse"],["HasData",""],[1,"text-center","mt-3","mb-3"],[1,"h3"],[1,"grid","grid-cols-12","gap-5","mt-2"],["class","box col-span-12 md:col-span-4 sm:col-span-6 mb-2","style","margin: auto",4,"ngFor","ngForOf"],[1,"box","col-span-12","md:col-span-4","sm:col-span-6","mb-2",2,"margin","auto"],[1,"card"],["alt","thumbnail",1,"card-img-top",2,"width","80vw",3,"src"],[1,"card-body"],[1,"truncate","p-2","card-text"],[1,"actionZone","p-2"],["class","azo-price text-warning",4,"ngIf"],["class","azo-price text-danger",4,"ngIf"],["class","azo-price",4,"ngIf"],["azt-track-service","content-store-NDNy2GWJJPR","class","actionBtn clickable",3,"click",4,"ngIf"],["azt-track-service","content-store-7VbNrXJRnEV","class","actionBtn","style","cursor: pointer",3,"click",4,"ngIf"],[1,"azo-price","text-warning"],[1,"azo-price","text-danger"],[1,"azo-price"],["azt-track-service","content-store-NDNy2GWJJPR",1,"actionBtn","clickable",3,"click"],[2,"vertical-align","sub"],["azt-track-service","content-store-7VbNrXJRnEV",1,"actionBtn",2,"cursor","pointer",3,"click"]],template:function(e,o){if(1&e&&(t.TgZ(0,"teacher-layout",0),t.ALo(1,"mytranslate"),t.TgZ(2,"div",1)(3,"form",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"input",7),t.NdJ("keyup.enter",function(){return o.onSearch()}),t.ALo(9,"mytranslate"),t.qZA(),t.TgZ(10,"button",8),t.NdJ("click",function(){return o.onSearch()}),t.TgZ(11,"mat-icon"),t._uU(12,"search"),t.qZA()()()()(),t.TgZ(13,"div",9)(14,"mat-form-field",10)(15,"mat-select",11),t.NdJ("selectionChange",function(s){return o.selectValue(s.value)}),t.ALo(16,"mytranslate"),t.YNc(17,ie,2,2,"mat-option",12),t.qZA()()()()(),t.YNc(18,se,1,0,"azt-loading-effect",13),t.YNc(19,ge,3,2,"ng-template",null,14,t.W1O),t.qZA()()),2&e){const n=t.MAs(20);t.Q6J("headerTitle",t.lcZ(1,8,"lang_homework_content_store_content_bank"))("headerBackToLink","/admin/dashboard"),t.xp6(3),t.Q6J("formGroup",o.form),t.xp6(5),t.s9C("placeholder",t.lcZ(9,10,"lang_homework_content_store_search")),t.xp6(7),t.s9C("placeholder",t.lcZ(16,12,"lang_homework_content_store_all")),t.xp6(2),t.Q6J("ngForOf",o.categories),t.xp6(1),t.Q6J("ngIf",o.statusObj.loading)("ngIfElse",n)}},dependencies:[k.sg,k.O5,D.ey,W.Hw,at.KE,oe.gD,g._Y,g.Fj,g.JJ,g.JL,g.sg,g.u,X.Q,tt.M,_t._,k.JJ,j.bT,j.GT],styles:[".dashboard__header[_ngcontent-%COMP%]{background-color:#0089a7;border-radius:5px}.input-group-append[_ngcontent-%COMP%]{display:flex}.border-test[_ngcontent-%COMP%]{border:1px solid red;min-height:50px}.azo-price[_ngcontent-%COMP%]{padding-top:5px;font-weight:500;font-size:1.2rem}.content-store-select[_ngcontent-%COMP%]{margin-top:5px}.card-text[_ngcontent-%COMP%]{display:block!important;max-width:245px!important}.content-header[_ngcontent-%COMP%]{background:inherit;background-color:#0089a7;padding:20px 0}.user_amount[_ngcontent-%COMP%]{background:inherit;background-color:#009cbe;border:none;border-radius:5px;padding:10px;box-shadow:none}.user_amount[_ngcontent-%COMP%]:hover{text-decoration:none}.mat-card-avatar[_ngcontent-%COMP%]{height:50px;width:50px;border-radius:50%;flex-shrink:0;object-fit:cover}@media (max-width: 992px){.dashboard__header[_ngcontent-%COMP%]{background-color:#0089a7;margin-top:-15px;margin-left:-15px;margin-right:-15px;border-radius:0}}.actionZone[_ngcontent-%COMP%]{display:flex;justify-content:space-between}  .mat-form-field-underline{position:initial!important}@media (max-width: 768px){.card-text[_ngcontent-%COMP%]{display:block!important;max-width:120px}.header-col-center[_ngcontent-%COMP%]{text-align:center!important;display:block!important}.header-col-center[_ngcontent-%COMP%]   .nav[_ngcontent-%COMP%]{margin-left:auto!important;margin-right:auto!important;margin-bottom:10px!important;text-align:center!important;display:inline-flex!important}.user_amount[_ngcontent-%COMP%]{margin-left:0!important;margin-bottom:10px!important}.content-header[_ngcontent-%COMP%]{padding:20px 0 0}}"]}),i})(),xe=(()=>{class i extends E.Q{getData(){this.initStatusObj(),this.data.content?(this.content=this.data.content,this.successStatusObj()):this.errorStatusObj("lang_auto_khong_tai_duoc_du_lieu")}buyContent(){this.initStatusObj(),this.subscriptions.add(this.paymentService.apiPaymentBuyFileContentByAzoPost(this.content?.id??0).subscribe(e=>{1==e.success?(this.successStatusObj(),this.showSuccessSnack("lang_auto_ban_da_mua_thanh_cong"),this.onNoClick(),setTimeout(()=>{document.location.reload()},3e3)):(this.errorStatusObj(e.message??"",!0),this.showErrorSnack("lang_auto_thanh_toan_khong_thanh_cong"),this.onNoClick(),setTimeout(()=>{document.location.reload()},3e3))}))}gotoPack(){this.onNoClick(),this.commonService.myNavigation("/payment/azo-pack")}onNoClick(){this.dialogRef.close()}ngOnInit(){this.getData(),super.ngOnInit()}constructor(e,o,n){super(),this.dialogRef=e,this.paymentService=o,this.data=n,this.subscriptions=new et.w0}ngOnDestroy(){this.subscriptions.unsubscribe(),super.ngOnDestroy()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(S.so),t.Y36(ne.te),t.Y36(S.WI))},i.\u0275cmp=t.Xpm({type:i,selectors:[["buy-content-dialog"]],features:[t.qOj],decls:22,vars:16,consts:[[1,"box","p-3"],[3,"hidden"],[1,"d-flex","justify-content-center"],["role","status",1,"spinner-border"],[1,"sr-only"],[1,"text-center"],[1,"h5"],["class","text-left","style","border: 1px dashed red; padding: 10px 5px; border-radius: 5px;",4,"ngIf"],["class","text-center",4,"ngIf"],[1,"flex","justify-end","mt-3"],[1,"azt-block-button"],["azt-track-service","content-store-wkv517MZvQQ","class","btn btn-primary",3,"click",4,"ngIf"],["azt-track-service","content-store-pGRw2qZB3VD","class","btn btn-primary",3,"click",4,"ngIf"],["azt-track-service","content-store-g17bdA2D8GW",1,"btn","btn-secondary",2,"margin-left","15px",3,"click"],[1,"text-left",2,"border","1px dashed red","padding","10px 5px","border-radius","5px"],[1,"h5","text-danger"],[1,"h5","mt-1"],[1,"text-danger"],[1,"h6","mt-2","mb-1"],["azt-track-service","content-store-wkv517MZvQQ",1,"btn","btn-primary",3,"click"],[2,"font-size","23px","vertical-align","sub"],["azt-track-service","content-store-pGRw2qZB3VD",1,"btn","btn-primary",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),t._uU(5,"..."),t.qZA()()()(),t.TgZ(6,"div",1)(7,"div",5)(8,"p",6),t._uU(9),t.ALo(10,"mytranslate"),t.ALo(11,"number"),t.qZA()(),t.YNc(12,pe,15,13,"div",7),t.YNc(13,_e,13,10,"div",7),t.YNc(14,fe,4,3,"div",8),t.qZA(),t.TgZ(15,"div",9)(16,"div",10),t.YNc(17,we,5,3,"button",11),t.YNc(18,be,5,3,"button",12),t.qZA(),t.TgZ(19,"button",13),t.NdJ("click",function(){return o.onNoClick()}),t._uU(20),t.ALo(21,"mytranslate"),t.qZA()()()),2&e&&(t.xp6(1),t.Q6J("hidden",!o.statusObj.loading),t.xp6(5),t.Q6J("hidden",o.statusObj.loading),t.xp6(3),t.AsE("",t.lcZ(10,10,"lang_homework_content_store_having")," ",t.lcZ(11,12,o.data.userAmount)," Azo"),t.xp6(3),t.Q6J("ngIf",o.data.status),t.xp6(1),t.Q6J("ngIf",!o.data.status),t.xp6(1),t.Q6J("ngIf",!o.data.status),t.xp6(3),t.Q6J("ngIf",o.data.status),t.xp6(1),t.Q6J("ngIf",!o.data.status),t.xp6(2),t.Oqu(t.lcZ(21,14,"lang_buttom_cancel")))},dependencies:[k.O5,W.Hw,k.JJ,j.bT],encapsulation:2}),i})();var L=m(49671),wt=m(85965),ve=m(32839),bt=m(70513),kt=m(74456),rt=m(74825),ye=m(6990),xt=m(77051),Ce=m(46825);const V={top:60,left:60,right:60,bottom:60};let Oe=(()=>{class i{get loadPercent(){return Math.floor(this.countDraw/this.totalDraw*100)}getSourceCanvas(e){return(0,L.Z)(function*(){var o=document.getElementById(e);return yield kt(o,{scale:2})})()}resetPosition(e){e&&(this.currentPos={left:60,top:60,right:60,bottom:60})}drawHomeworkNoteBoxOfTeacher(e){var o=this;return(0,L.Z)(function*(){let n=document.querySelector(".box-point.display .text-mark");if(e){e.font="25px font_chu_dep",e.fillStyle="#000",n&&e.fillText("\u0110i\u1ec3m",90,o.currentPos.top+20),e.fillText("L\u1eddi ph\xea c\u1ee7a gi\xe1o vi\xean",420,o.currentPos.top+20),o.currentPos.top+=30;let s=document.querySelector(".box-msg .note p");if(s){e.lineWidth=2,e.fillStyle="#000",e.fillRect(o.currentPos.left,o.currentPos.top,e.canvas.width-o.currentPos.left-o.currentPos.right,1);const a=o.currentPos.top;let c=window.getComputedStyle(s,null).getPropertyValue("font"),d=window.getComputedStyle(s,null).getPropertyValue("color"),l=parseInt(c.split(" ")[0].split("p")[0],10);e.font=c;let p=o.exportPdfUtilsService.essayText2LinesArr(s.innerHTML,e,e.canvas.width-60-30-(n?200:0),16,c);o.currentPos.top+=35;const b=Math.round(1.5*l),y=o.currentPos.left+(n?200:0)+15;let I=0,C=200;for(let B=0;B<p.length;B++)for(let H=0;H<p[B].length;H++){const mt=p[B][H];e.font=c,e.fillStyle=d,e.fillText(mt,y,o.currentPos.top),o.currentPos.top+=b,I+=b}let N=document.querySelectorAll(".box-emoji> img"),z=o.currentPos.left+(n?100:0)+15,ot=o.currentPos.top,$=78,nt=78,dt=15;N.forEach(B=>{let H=new Image;H.src=B.getAttribute("src")??"",H.onload=()=>{z=z+$+dt,e.drawImage(H,z,ot,$,nt)}});let Mt=30+nt;if(I>C-Mt&&(C=I+Mt),e.lineWidth=2,e.fillStyle="#000",e.fillRect(o.currentPos.left,a,1,C),n&&e.fillRect(o.currentPos.left+200,a,1,C),e.fillRect(e.canvas.width-o.currentPos.right,a,1,C),e.fillRect(o.currentPos.left,a+C,e.canvas.width-o.currentPos.right-o.currentPos.left,1),n){let B=n.getBoundingClientRect().width,H=n.getBoundingClientRect().height,mt=window.getComputedStyle(n,null).getPropertyValue("font"),qo=window.getComputedStyle(n,null).getPropertyValue("color");e.font=mt,e.fillStyle=qo,e.fillText(n.textContent?n.textContent:"",o.currentPos.left+100-B/2,a+C/2+H/4)}o.currentPos.top=a+C+20}else{if(e.lineWidth=2,e.rect(o.currentPos.left,o.currentPos.top,e.canvas.width-o.currentPos.left-o.currentPos.right,200),e.stroke(),n&&e.fillRect(o.currentPos.left+200,o.currentPos.top,1,200),n){let a=n.getBoundingClientRect().width,c=n.getBoundingClientRect().height,d=window.getComputedStyle(n,null).getPropertyValue("font"),l=window.getComputedStyle(n,null).getPropertyValue("color");e.font=d,e.fillStyle=l,e.fillText(n.textContent?n.textContent:"",o.currentPos.left+100-a/2,o.currentPos.top+150-c/2)}o.currentPos.top+=220}}})()}drawExamTitle(e){if(e){let y=document.querySelector("#mainTitle span"),I=y?window.getComputedStyle(y,null).getPropertyValue("font"):"",C=y?.getBoundingClientRect().width,N=y?.getBoundingClientRect().height;var o=y?.querySelector("img"),n=o?.getBoundingClientRect().width,s=o?.getBoundingClientRect().height,a=0;if(y&&y.textContent&&C&&N&&!(o&&n&&s)){var c=(e.canvas.width-C)/2,d=this.currentPos.top+15;e.font=I,e.fillStyle="#000",e.fillText(y.textContent,c,d),a=N+20}else y&&y.textContent&&C&&N&&o&&n&&s&&(c=(e.canvas.width-C)/2,d=this.currentPos.top+20,e.font=I,e.fillStyle="#000",e.fillText(y.textContent,c,d),a=N+40,e.drawImage(o,0,0,n,s,c+(C-n)+5,this.currentPos.top-10,n,s));a>0&&(this.currentPos.top+=a,this.countDraw++)}}drawColLeftRightInHeaderOfExam(e){let o=document.getElementById("colLeftInfo"),n=document.getElementById("colRightInfo"),s=o?o.querySelectorAll("h3"):void 0,a=n?n.querySelectorAll("h3"):void 0,c={top:0,left:0,right:0,bottom:0};if(e){if(e.font="16px Arial",s)for(let d=0;d<s.length;d++){0==d&&(c=ye.cloneDeep(this.currentPos));const l=s[d];l.textContent&&(e.fillText(l.textContent??"",this.currentPos.left,this.currentPos.top),this.currentPos.top+=l.getBoundingClientRect().height+5)}if(a)for(let d=0;d<a.length;d++){const l=a[d];l.textContent&&(e.fillText(l.textContent,e.canvas.width-this.currentPos.right-l.getBoundingClientRect().width,c.top),c.top+=l.getBoundingClientRect().height+5)}}}drawBlockItemToPageForExam(e,o){var n=this;return(0,L.Z)(function*(){if(e){let a=document.querySelectorAll(`.${n.exportPdfUtilsService.blockCropItemClass}`);if(a.length>0){let c=[];for(let d=0;d<a.length;d++)c.push(d);var s=yield n.getSourceCanvas("multipleChoiceWrap");for(const d of c){const l=a[d];let u=l.classList.contains(n.exportPdfUtilsService.blockEssayCropItemClass),p=l.classList.contains("__TXT_ESSAY_PARA");console.log("nvanh 1",p,u);let b=2*l.offsetLeft,y=2*l.offsetTop,I=2*l.getBoundingClientRect().width,C=2*l.getBoundingClientRect().height;const N=e.canvas.width-n.currentPos.left-n.currentPos.right,z=N*C/I;if(z<=e.canvas.height-n.currentPos.bottom-n.currentPos.top&&!u)n.drawSingleBlockItemToCanvas(e,s,N,z,{left:b,top:y,width:I,height:C},p);else if(n.exportPdfUtilsService.addContentToPdf(n.pdfDoc,e.canvas.toDataURL("image/jpeg",1)),n.pdfDoc.addPage(),n.exportPdfUtilsService.eraseCanvas(e),n.resetPosition(o),"h"==n.exportPdfConvertDataService.findScaleDirection(I,C)){const ot=e.canvas.height-V.top-V.bottom,$=ot*I/C;n.drawSingleBlockItemToCanvas(e,s,N,z,{left:b,top:y,width:I,height:C},p,(e.canvas.width-$)/2,V.top,$,ot)}else n.drawSingleBlockItemToCanvas(e,s,N,z,{left:b,top:y,width:I,height:C},p)}n.exportPdfUtilsService.addContentToPdf(n.pdfDoc,e.canvas.toDataURL("image/jpeg",1))}else n.exportPdfUtilsService.addContentToPdf(n.pdfDoc,e.canvas.toDataURL("image/jpeg",1))}})()}convertEssayBoxes2Canvas(e,o,n,s){var a=this;return(0,L.Z)(function*(){let c=[];for(let d=0;d<e.length;d++)c.push(d);for(const d of c){const l=yield kt(e[d]);0==d&&o?(s&&(o.canvas.width-50-50)*l.height/l.width>o.canvas.height-50-a.currentPos.top&&(a.exportPdfUtilsService.addContentToPdf(a.pdfDoc,o.canvas.toDataURL("image/jpeg",1)),a.exportPdfUtilsService.eraseCanvas(o),a.resetPosition(n),a.pdfDoc.addPage()),a.addEssayImage(o,e,l,d)):(a.exportPdfUtilsService.eraseCanvas(o),a.resetPosition(n),a.addEssayImage(o,e,l,d))}})()}drawEssayIframeContent(e,o,n){var s=this;return(0,L.Z)(function*(){let a=document.querySelectorAll(".essayPdfImage");if(a.length>0&&e){n||(s.exportPdfUtilsService.eraseCanvas(e),s.resetPosition(o),s.pdfDoc.addPage());let c=document.querySelector("#essayPdfTitle span");e&&c&&c.textContent&&(e.font="18px Georgia",e.fillStyle="#333",e.fillText(c.textContent,(e.canvas.width-c.getBoundingClientRect().width)/2,s.currentPos.top+20),s.currentPos.top+=c.getBoundingClientRect().height+20),yield s.convertEssayBoxes2Canvas(a,e,o,n)}})()}addEssayImage(e,o,n,s){if(e){if("w"==this.exportPdfConvertDataService.findScaleDirection(n.width,n.height))e.drawImage(n,0,0,n.width,n.height,50,this.currentPos.top+50,e.canvas.width-100,(e.canvas.width-100)*n.height/n.width);else{let a=e.canvas.height-this.currentPos.top-this.currentPos.bottom,c=a*n.width/n.height;e.drawImage(n,0,0,n.width,n.height,(e.canvas.width-c)/2,this.currentPos.top,c,a)}console.log(`[_Essay_image_] V\u1ebd \u1ea3nh t\u1ef1 lu\u1eadn s\u1ed1 ${s+1}`),this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,e.canvas.toDataURL("image/jpeg",1)),this.countDraw++,s!=o.length-1&&this.pdfDoc.addPage()}}drawSingleBlockItemToCanvas(e,o,n,s,a,c,d,l,u,p){c&&this.currentPos.top!=V.top&&(this.currentPos.top-=60),e.drawImage(o,a.left,a.top,a.width,a.height,d||this.currentPos.left,l||this.currentPos.top,u||n,p||s),this.currentPos.top+=s+80,this.countDraw++}examToPdf(e,o){var n=this;return(0,L.Z)(function*(){n.countDraw=0,n.totalDraw=document.querySelectorAll(`.${n.exportPdfUtilsService.blockCropItemClass}`).length,n.pdfDoc=new rt.jsPDF;let s=document.createElement("canvas"),a=document.getElementById("multipleChoiceWrap");if(console.log("nvanh",a),a){let l=a.getBoundingClientRect().width;s.width=2*l,s.height=297*l/210*2}let c=s.getContext("2d");return n.exportPdfUtilsService.eraseCanvas(c),a&&n.resetPosition(a),a&&(yield n.drawBlockItemToPageForExam(c,a)),n.countDraw=n.totalDraw,yield n.exportPdfUtilsService.asyncTimeout(1e3),"class"==e?n.pdfDoc.output("blob"):(n.pdfDoc.save(o||"test_result.pdf"),!0)})()}homeworkToPdf(){var e=this;return(0,L.Z)(function*(){e.pdfDoc=new rt.jsPDF;let o=document.createElement("canvas"),n=document.getElementById("multipleChoiceWrap");if(n){let c=n.getBoundingClientRect().width;o.width=c,o.height=297*c/210}let s=o.getContext("2d");return e.exportPdfUtilsService.eraseCanvas(s),n&&e.resetPosition(n),e.drawExamTitle(s),e.drawColLeftRightInHeaderOfExam(s),yield e.drawHomeworkNoteBoxOfTeacher(s),n&&(yield e.drawEssayIframeContent(s,n,!0)),e.pdfDoc.output("blob")})()}constructor(e,o,n,s){this.exportPdfConvertDataService=e,this.exportPdfUtilsService=o,this.answerTypeService=n,this.timeService=s,this.totalDraw=1,this.countDraw=0,this.currentPos=V,this.pdfDoc=new rt.jsPDF}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(bt.S),t.LFG(xt.V),t.LFG(Ce.T),t.LFG(K.O))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var ct=m(8415),Te=m(67854),je=m(8150);function Ae(i,r){if(1&i&&(t.TgZ(0,"h3",6),t._uU(1),t.qZA()),2&i){const e=t.oxw(3);t.xp6(1),t.Oqu(e.title)}}const Pe=function(i){return{"rotated-img":i}},Me=function(i,r,e,o){return{"width.px":i,"height.px":r,"aspect-ratio":e,transform:o}};function Ze(i,r){if(1&i&&(t._UZ(0,"img",10),t.ALo(1,"mycdn")),2&i){const e=t.oxw(2).$implicit,o=t.oxw(2);t.s9C("src",t.lcZ(1,4,e.backgroundImage),t.LSH),t.Q6J("ngClass",t.VKq(6,Pe,o.isRightRotation(e.rotation||0)))("ngStyle",t.l5B(8,Me,(e.width||0)<(e.height||0)?"auto":o.isRightRotation(e.rotation||0)?e.height:e.width,(e.width||0)>(e.height||0)?"auto":o.isRightRotation(e.rotation||0)?e.width:e.height,(e.width||0)/(e.height||1),"rotate("+e.rotation+"deg)")),t.uIk("data-ratio",(e.width||0)/(e.height||1))}}function Ie(i,r){1&i&&(t.TgZ(0,"div",11),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"lang_auto_dinh_dang_file_khong_ho_tro_xuat_ra_pdf_he_thong_chi_xuat_duoc_file_pdf_doi_voi_file_tai_len_dang_anh_va_pdf")))}function De(i,r){if(1&i&&(t._UZ(0,"img",12),t.ALo(1,"mycdn")),2&i){const e=t.oxw(2).$implicit;t.s9C("src",t.lcZ(1,1,e.draw),t.LSH)}}function Ee(i,r){if(1&i&&(t.ynx(0),t._uU(1),t.BQk()),2&i){const e=t.oxw(6);t.xp6(1),t.hij(" ",null==e.result.staticTextConfigParse?null:e.result.staticTextConfigParse.textCorrect," ")}}function Ne(i,r){if(1&i&&(t.ynx(0),t._uU(1),t.BQk()),2&i){const e=t.oxw(6);t.xp6(1),t.hij(" ",null==e.result.staticTextConfigParse?null:e.result.staticTextConfigParse.textWrong," ")}}function Le(i,r){if(1&i&&t._UZ(0,"img",15),2&i){const e=t.oxw(6);t.s9C("src","assets/images/classlive/"+(null==e.result.staticTextConfigParse?null:e.result.staticTextConfigParse.urlImgCorrect),t.LSH)}}function Ue(i,r){if(1&i&&t._UZ(0,"img",15),2&i){const e=t.oxw(6);t.s9C("src","assets/images/classlive/"+(null==e.result.staticTextConfigParse?null:e.result.staticTextConfigParse.urlImgWrong),t.LSH)}}const He=function(i,r,e,o,n){return{"font-family":i,color:r,"font-size":e,position:"absolute","z-index":2,"top.px":o,"left.px":n}};function Je(i,r){if(1&i&&(t.ynx(0),t.TgZ(1,"span",13),t.YNc(2,Ee,2,1,"ng-container",0),t.YNc(3,Ne,2,1,"ng-container",0),t.YNc(4,Le,1,1,"img",14),t.YNc(5,Ue,1,1,"img",14),t.qZA(),t.BQk()),2&i){const e=r.$implicit,o=t.oxw(5);t.xp6(1),t.Q6J("ngStyle",t.qbA(5,He,null==o.result.staticTextConfigParse?null:o.result.staticTextConfigParse.fontText,null==o.result.staticTextConfigParse?null:o.result.staticTextConfigParse.fontColor,(null==o.result.staticTextConfigParse?null:o.result.staticTextConfigParse.fontSize)+"px",e.y,e.x)),t.xp6(1),t.Q6J("ngIf",(null==o.result.staticTextConfigParse?null:o.result.staticTextConfigParse.useCorrectText)&&"correct"==e.value),t.xp6(1),t.Q6J("ngIf",(null==o.result.staticTextConfigParse?null:o.result.staticTextConfigParse.useCorrectText)&&"wrong"==e.value),t.xp6(1),t.Q6J("ngIf",!(null!=o.result.staticTextConfigParse&&o.result.staticTextConfigParse.useCorrectText)&&"correct"==e.value),t.xp6(1),t.Q6J("ngIf",!(null!=o.result.staticTextConfigParse&&o.result.staticTextConfigParse.useWrongText)&&"wrong"==e.value)}}function ze(i,r){if(1&i&&t.YNc(0,Je,6,11,"ng-container",1),2&i){const e=t.oxw(2).$implicit;t.Q6J("ngForOf",e.staticText)}}const Be=function(i,r,e,o,n,s){return{"font-family":i,color:r,"font-size":e,display:"block","line-height":1.5,position:"absolute",letterSpacing:"3px",fontWeight:"bold","z-index":3,"text-align":o,"top.px":n,"left.px":s}};function Re(i,r){if(1&i&&(t.ynx(0),t._UZ(1,"span",16),t.ALo(2,"formatNoteBreak"),t.BQk()),2&i){const e=r.$implicit;t.xp6(1),t.Q6J("ngStyle",t.HTZ(4,Be,e.textStyle.font,e.textStyle.color,e.textStyle.size+"px",e.textStyle.align,e.y,e.x))("innerHtml",t.lcZ(2,2,e.value),t.oJD)}}function Fe(i,r){if(1&i&&t.YNc(0,Re,3,11,"ng-container",1),2&i){const e=t.oxw(2).$implicit;t.Q6J("ngForOf",e.objText)}}function qe(i,r){if(1&i&&(t.YNc(0,Ze,2,13,"img",7),t.ALo(1,"isImageExtension"),t.YNc(2,Ie,3,3,"ng-template",null,8,t.W1O),t.YNc(4,De,2,3,"img",9),t.YNc(5,ze,1,1,"ng-template",5),t.YNc(6,Fe,1,1,"ng-template",5)),2&i){const e=t.MAs(3),o=t.oxw().$implicit;t.Q6J("ngIf",t.lcZ(1,5,(null==o?null:o.backgroundImage)||""))("ngIfElse",e),t.xp6(4),t.Q6J("ngIf",o.draw),t.xp6(1),t.Q6J("ngIf",o.staticText&&o.staticText.length>0),t.xp6(1),t.Q6J("ngIf",o.objText&&o.objText.length>0)}}const Qe=function(i,r){return{position:"relative","width.px":i,"height.px":r,display:"flex","justify-content":"center","align-items":"center"}};function Ye(i,r){if(1&i&&(t.ynx(0),t.TgZ(1,"div",2),t.YNc(2,Ae,2,1,"h3",3),t.TgZ(3,"div",4),t.YNc(4,qe,7,7,"ng-template",5),t.qZA()(),t.BQk()),2&i){const e=r.$implicit,o=r.first,n=t.oxw(2);t.xp6(1),t.Tol("mb-2 essayPdfImage "+n.blockItemCropClass+" "+n.blockItemEssayCropClass),t.xp6(1),t.Q6J("ngIf",o),t.xp6(1),t.Q6J("ngStyle",t.WLB(6,Qe,e.width,e.height)),t.xp6(1),t.Q6J("ngIf",null==e?null:e.backgroundImage)}}function Ge(i,r){if(1&i&&(t.ynx(0),t.YNc(1,Ye,5,9,"ng-container",1),t.BQk()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.result.pages)}}let We=(()=>{class i extends E.Q{isRightRotation(e){return 1==Math.abs(e/90%2)}ngOnInit(){this.title=this.commonService.myTranslateInstant("lang_auto_anh_bai_lam_tu_luan")??"",this.result.staticTextConfig&&(this.result.staticTextConfigParse=this.commonService.myParseJson(this.result.staticTextConfig)),super.ngOnInit()}ngOnChanges(){this.result.staticTextConfig&&(this.result.staticTextConfigParse=this.commonService.myParseJson(this.result.staticTextConfig))}constructor(e){super(),this.iframeService=e,this.title="",this.result={}}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(je.X))},i.\u0275cmp=t.Xpm({type:i,selectors:[["azt-export-essay-template"]],inputs:{title:"title",blockItemEssayCropClass:"blockItemEssayCropClass",blockItemCropClass:"blockItemCropClass",result:"result"},features:[t.qOj,t.TTD],decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"display","flex","justify-content","center","align-items","center","flex-direction","column"],["id","essayPdfTitle","class","text-center",4,"ngIf"],[3,"ngStyle"],[3,"ngIf"],["id","essayPdfTitle",1,"text-center"],["class","user-img img_respon","alt","",3,"ngClass","ngStyle","src",4,"ngIf","ngIfElse"],["noSupportExtension",""],["style","position: absolute; z-index: 1; top: 0; left: 0","class","user-img img_respon","alt","",3,"src",4,"ngIf"],["alt","",1,"user-img","img_respon",3,"ngClass","ngStyle","src"],[1,"p-2","text-center",2,"border","2px solid red"],["alt","",1,"user-img","img_respon",2,"position","absolute","z-index","1","top","0","left","0",3,"src"],[2,"min-height","50px","min-width","50px","font-weight","bold","display","flex","line-height","1.5","font-weight","bold","align-items","center","justify-content","center","text-shadow","rgb(130 126 126) 1px 1px 1px",3,"ngStyle"],["width","30","height","30","class","","alt","",3,"src",4,"ngIf"],["width","30","height","30","alt","",1,"",3,"src"],[3,"ngStyle","innerHtml"]],template:function(e,o){1&e&&t.YNc(0,Ge,2,1,"ng-container",0),2&e&&t.Q6J("ngIf",o.result)},dependencies:[k.mk,k.sg,k.O5,k.PC,j.bT,j.GT,j.AL,j.kJ],encapsulation:2}),i})();var yt=m(61725),Ve=m(75986);function $e(i,r){1&i&&t._UZ(0,"azt-loading-effect")}function Ke(i,r){1&i&&t._UZ(0,"span",31)}function Xe(i,r){if(1&i&&(t.TgZ(0,"div",11),t.YNc(1,Ke,1,0,"span",30),t._uU(2),t.ALo(3,"mytranslate"),t.qZA()),2&i){const e=t.oxw(4);t.xp6(1),t.Q6J("ngIf",e.countDonePdf<((null==e.curExportArr?null:e.curExportArr.length)||-1)),t.xp6(1),t.lnq(" ",t.lcZ(3,4,"lang_homework_export_homework_request"),"",e.countDonePdf," / ",null==e.curExportArr?null:e.curExportArr.length," ")}}function to(i,r){if(1&i&&(t.TgZ(0,"div",11)(1,"mat-icon",32),t._uU(2," check_circle "),t.qZA(),t._uU(3),t.ALo(4,"mytranslate"),t.qZA()),2&i){const e=t.oxw(4);let o;t.xp6(3),t.lnq(" ",t.lcZ(4,3,"lang_homework_export_homework_complete")," ",e.countDonePdf," / ",null!==(o=null==e.curExportArr?null:e.curExportArr.length)&&void 0!==o?o:0," ")}}const eo=function(){return{fontFamily:"font_chu_dam"}};function oo(i,r){if(1&i&&(t.TgZ(0,"div",33)(1,"span",34),t._UZ(2,"azt-check-mark",35),t.qZA(),t.TgZ(3,"span",28),t._uU(4),t.ALo(5,"mytranslate"),t.qZA()()),2&i){const e=t.oxw(4);t.Q6J("ngClass",null!=e.curAnswer&&null!=e.curAnswer.resultParse&&e.curAnswer.resultParse.hideMark?"":"display")("hidden",null==e.curAnswer||null==e.curAnswer.resultParse?null:e.curAnswer.resultParse.hideMark),t.xp6(1),t.Q6J("ngStyle",t.DdM(7,eo)),t.xp6(1),t.Q6J("mark",null==e.curAnswer||null==e.curAnswer.resultParse?null:e.curAnswer.resultParse.point),t.xp6(2),t.Oqu(t.lcZ(5,5,"lang_point"))}}const no=function(i){return{"font-family":i}};function io(i,r){if(1&i&&t._UZ(0,"p",36),2&i){const e=t.oxw(4);t.Q6J("ngStyle",t.VKq(2,no,null!=e.curAnswer&&null!=e.curAnswer.resultParse&&null!=e.curAnswer.resultParse.staticTextConfigParse&&e.curAnswer.resultParse.staticTextConfigParse.txtCommentFont?null==e.curAnswer||null==e.curAnswer.resultParse||null==e.curAnswer.resultParse.staticTextConfigParse?null:e.curAnswer.resultParse.staticTextConfigParse.txtCommentFont:"font_chu_dep"))("innerHtml",null==e.curAnswer||null==e.curAnswer.resultParse?null:e.curAnswer.resultParse.comment,t.oJD)}}function so(i,r){if(1&i&&(t.ynx(0),t._UZ(1,"img",39),t.BQk()),2&i){const e=r.$implicit,o=r.index,n=t.oxw(5);t.xp6(1),t.s9C("id","imgEmoji_"+o),t.s9C("src",n.isBase64ImageToExport?e:n.linkCdnGitHub+e,t.LSH)}}function ao(i,r){if(1&i&&(t.TgZ(0,"div",37),t.YNc(1,so,2,2,"ng-container",38),t.qZA()),2&i){const e=t.oxw(4);t.xp6(1),t.Q6J("ngForOf",null==e.curAnswer||null==e.curAnswer.resultParse?null:e.curAnswer.resultParse.commentEmoji)}}const ro=function(){return{}};function lo(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8)(4,"div",9)(5,"h1",10),t._uU(6),t.ALo(7,"mytranslate"),t.qZA(),t.TgZ(8,"div",11),t._uU(9),t.ALo(10,"mytranslate"),t.qZA(),t.TgZ(11,"div",11)(12,"button",12),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(3);return t.KtG(n.openDialog(n.submittedStudents))}),t._uU(13),t.ALo(14,"mytranslate"),t.qZA()(),t.YNc(15,Xe,4,6,"div",13),t.YNc(16,to,5,5,"div",13),t.TgZ(17,"div",14)(18,"div",15)(19,"h2",16)(20,"span"),t._uU(21),t.ALo(22,"mytranslate"),t.qZA()(),t.TgZ(23,"div",17)(24,"div",18)(25,"h3",19),t._uU(26),t.ALo(27,"mytranslate"),t.qZA(),t.TgZ(28,"h3",19),t._uU(29),t.ALo(30,"mytranslate"),t.qZA()(),t.TgZ(31,"div",20)(32,"h3",19),t._uU(33),t.ALo(34,"mytranslate"),t.qZA()()(),t.TgZ(35,"div",21)(36,"div",22),t.YNc(37,oo,6,8,"div",23),t.TgZ(38,"div",24)(39,"div",25),t.YNc(40,io,1,4,"p",26),t.YNc(41,ao,2,1,"div",27),t.qZA(),t.TgZ(42,"span",28),t._uU(43),t.ALo(44,"mytranslate"),t.qZA()()()()(),t._UZ(45,"br")(46,"azt-export-essay-template",29),t.ALo(47,"mytranslate"),t.qZA()()()()()()}if(2&i){const e=t.oxw(3);let o;t.xp6(6),t.Oqu(t.lcZ(7,21,"lang_homework_export_homework_export_pdf")),t.xp6(3),t.AsE(" ",t.lcZ(10,23,"lang_homework_export_homework_number_student_dotted"),": ",e.submittedStudents.length," "),t.xp6(3),t.Q6J("disabled",e.loadingExportBtn),t.xp6(1),t.hij(" ",t.lcZ(14,25,"lang_homework_export_homework_continue")," "),t.xp6(2),t.Q6J("ngIf",e.isProcessingPdf),t.xp6(1),t.Q6J("ngIf",((null==e.curExportArr?null:e.curExportArr.length)||-1)>0&&e.countDonePdf===(null!==(o=null==e.curExportArr?null:e.curExportArr.length)&&void 0!==o?o:0)),t.xp6(5),t.AsE("",t.lcZ(22,27,"lang_first_and_last_name"),": ",null==e.curAnswer?null:e.curAnswer.fullName,""),t.xp6(5),t.AsE("",t.lcZ(27,29,"lang_homework_export_homework_class"),": ",e.data.classroomObj.name,""),t.xp6(3),t.AsE("",t.lcZ(30,31,"lang_homework_export_homework_home_work"),": ",e.data.homeworkObj.name,""),t.xp6(4),t.AsE("",t.lcZ(34,33,"lang_homework_export_homework_code"),": ",null==e.curAnswer?null:e.curAnswer.id,""),t.xp6(4),t.Q6J("ngIf",null==e.curAnswer?null:e.curAnswer.resultParse),t.xp6(3),t.Q6J("ngIf",null==e.curAnswer||null==e.curAnswer.resultParse?null:e.curAnswer.resultParse.comment),t.xp6(1),t.Q6J("ngIf",null==e.curAnswer||null==e.curAnswer.resultParse?null:e.curAnswer.resultParse.commentEmoji),t.xp6(2),t.Oqu(t.lcZ(44,35,"lang_homework_export_homework_comment_of_teacher")),t.xp6(3),t.Q6J("title",t.lcZ(47,37,"lang_homework_export_homework_assignment"))("result",(null==e.curAnswer?null:e.curAnswer.resultParse)||t.DdM(39,ro))}}function co(i,r){1&i&&(t.TgZ(0,"div",40)(1,"div",41),t._uU(2),t.ALo(3,"mytranslate"),t.qZA()()),2&i&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"lang_homework_export_homework_request_marking")))}function mo(i,r){if(1&i&&(t.YNc(0,lo,48,40,"div",3),t.YNc(1,co,4,3,"ng-template",null,4,t.W1O)),2&i){const e=t.MAs(2),o=t.oxw(2);t.Q6J("ngIf",o.submittedStudents.length>0)("ngIfElse",e)}}function ho(i,r){if(1&i&&(t.ynx(0),t.YNc(1,$e,1,0,"azt-loading-effect",0),t.YNc(2,mo,3,2,"ng-template",null,2,t.W1O),t.BQk()),2&i){const e=t.MAs(3),o=t.oxw();t.xp6(1),t.Q6J("ngIf",o.statusObj.loading)("ngIfElse",e)}}function uo(i,r){1&i&&(t.TgZ(0,"div",42),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"lang_homework_export_homework_request_browser")))}function go(i,r){if(1&i&&(t.TgZ(0,"mat-checkbox",12),t._uU(1),t.qZA()),2&i){const e=r.index,o=t.oxw();t.Q6J("checked",o.form.value.exports[e])("formControlName",e),t.xp6(1),t.AsE(" ",e+1,". ",o.data.resultsArr[e].fullName," ")}}const po=function(i){return{selects:i}};let _o=(()=>{class i extends E.Q{askBeforeCloseWindow(e){return!this.isProcessingPdf||(e.returnValue=!1)}openDialog(e){this.dialog.open(fo,{width:"1100px",data:{resultsArr:e},restoreFocus:!1}).afterClosed().subscribe(n=>{if(n){const s=[];for(let a=0;a<n.selects.length;a++)n.selects[a]&&s.push(e[a]);this.zipAll(s)}})}finalSaveAll(){this.myZip.generateAsync({type:"blob"}).then(e=>{this.countDonePdf++;let o=this.commonService.createFileNameExportFile([this.data.classroomObj?.name??"",this.data.homeworkObj?.name??""])+"_homework_result.zip";this.shareFileFlutterService.shareFileWithBlob(e,o),this.isProcessingPdf=!1,this.cdr.detectChanges()},e=>{console.log(e)})}zipAll(e){var o=this;return(0,L.Z)(function*(){o.isProcessingPdf=!0,o.loadingExportBtn=!0,document.body.style.overflow="hidden",o.countDonePdf=0,o.curExportArr=e,o.myZip=new wt;for(const s of e)if(null!=s.answer?.id){const a=yield o.answerService.apiAnswerGetObjGet(o.homeworkHashId,s.answer?.id).toPromise();if(1==a?.success){if(o.zipDataService.convertSubmittedAnswersObj(a.data?.answerObj),o.curAnswer=o.homeworkExamService.parserHomeworkIframeResult(a.data?.answerObj),o.curAnswer){o.curAnswer.fullName=o.commonService.convertVietnameseToEnglish(s.fullName??"")??"",o.curAnswer.resultParse=o.curAnswer.resultParse?yield o.exportPdfConvertDataService.processEssayResultToBase64(o.curAnswer.resultParse):o.curAnswer.resultParse,o.isBase64ImageToExport=!0;try{yield o.exportPdfUtilsService.asyncTimeout(3e3);var n=o.timeService.getCurrentSecond();console.log("Start export for "+o.curAnswer.fullName+": 0 seconds");const c=yield o.newPdfExportService.homeworkToPdf();console.log("End export: "+(o.timeService.getCurrentSecond()-n)+" seconds"),o.myZip.file(`${o.folderName}/${o.commonService.convertVietnameseToEnglish(o.curAnswer.fullName)}_${o.curAnswer.id}.pdf`,c)}catch(c){console.log(c)}}o.countDonePdf<e.length-1&&o.countDonePdf++}else o.errorStatusObj(a?.message??"",!0)}o.finalSaveAll(),document.body.style.overflow="auto",setTimeout(()=>{o.loadingExportBtn=!1},2e3)})()}getData(){this.homeworkHashId?this.answerService.apiAnswerGetStudentsHomeworkGet(this.homeworkHashId).subscribe(e=>{1==e.success?(e.data&&(this.zipDataService.convertStudentsHomeworkObj(e.data?.studentObjs),this.data=e.data,this.submittedStudents=e.data&&Array.isArray(e.data?.studentObjs)?e.data?.studentObjs.filter(o=>o.confirmedAt):new Array,this.submittedStudents.length>0?this.answerService.apiAnswerGetObjGet(this.homeworkHashId,this.submittedStudents[0]?.answer?.id??0).subscribe(o=>{if(1==o.success){this.zipDataService.convertSubmittedAnswersObj(o.data?.answerObj);var n=this.homeworkExamService.parserHomeworkIframeResult(o.data?.answerObj);this.curAnswer=n,this.curAnswer&&(this.curAnswer.fullName=this.submittedStudents[0].fullName),this.successStatusObj()}else this.errorStatusObj(e.message??"",!0)}):this.stopStatusObj()),this.stopStatusObj()):this.errorStatusObj(e.message??"",!0)}):(this.stopStatusObj(),this.showErrorSnack("lang_cms_export_homework_cannot_get_data"))}ngOnInit(){if(this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"",this.isSupportedBrowser=this.exportPdfUtilsService.isSupportedBrowser(),this.isSupportedBrowser){this.initStatusObj();var e=[{source:this.cdnService.convertCdnLinkOfGitHub("azota_assets/js/html2pdf.bundle.js?v=28092021"),name:"html2pdf.bundle.js"}];this.commonService.loadScriptPromises(e).then(()=>{this.commonService.translateMetaData({title:"lang_cms_export_homework_title",description:"lang_cms_export_homework_description",image:"lang_cms_test_image"}),this.getData()}).catch(o=>{this.errorStatusObj(this.commonService.myTranslateInstant(o.message)??"",!0)})}super.ngOnInit()}constructor(e,o,n,s,a,c,d,l,u,p,b,y){super(),this.cdr=e,this.answerService=o,this.dialog=n,this.shareFileFlutterService=s,this.activeRoute=a,this.exportPdfConvertDataService=c,this.newPdfExportService=d,this.exportPdfUtilsService=l,this.zipDataService=u,this.cdnService=p,this.timeService=b,this.homeworkExamService=y,this.folderName="results",this.homeworkHashId="",this.countDonePdf=0,this.isProcessingPdf=!1,this.submittedStudents=[],this.myZip=new wt,this.linkCdnGitHub="https://azota889.github.io/storage_public/mnote/",this.isBase64ImageToExport=!1,this.loadingExportBtn=!1}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(t.sBO),t.Y36(J.P6),t.Y36(S.uw),t.Y36(ve.g),t.Y36(P.gz),t.Y36(bt.S),t.Y36(Oe),t.Y36(xt.V),t.Y36(G.D),t.Y36(ct.U),t.Y36(K.O),t.Y36(Te.j))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-export-homework"]],hostBindings:function(e,o){1&e&&t.NdJ("beforeunload",function(s){return o.askBeforeCloseWindow(s)},!1,t.Jf7)},features:[t.qOj],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["notBrowserSupport",""],["doneLoading",""],["id","test_review_container","class","container-fluid mt-2",4,"ngIf","ngIfElse"],["noSubmit",""],["id","test_review_container",1,"container-fluid","mt-2"],["id","tabRowExam",1,"row",2,"margin-bottom","10px"],["id","test_review_area",1,"col"],["id","col_examContent_wrap",2,"width","1100px!important","margin","0 auto"],["id","mbTestContent"],[1,"text-center","font-bold","mb-2",2,"font-size","18px"],[1,"buttons-area","mb-3","text-center"],["azt-track-service","export-homework-PKHoUw4ISM_",1,"btn","btn-primary",3,"disabled","click"],["class","buttons-area mb-3 text-center",4,"ngIf"],["id","multipleChoiceWrap",1,"exportPdfModeIndex",2,"padding","30px"],["id","multipleChoiceWrapHeader"],["id","mainTitle",1,"mb-1","text-center","font-bold",2,"font-size","18px"],["id","detailInfo",1,"flex",2,"justify-content","space-between","font-size","16px"],["id","colLeftInfo"],[1,"mb-0"],["id","colRightInfo"],["id","teacherMessage",2,"padding-top","3rem"],[1,"contentNote"],["class","box-point",3,"ngClass","hidden",4,"ngIf"],[1,"box-msg"],[1,"note"],[3,"ngStyle","innerHtml",4,"ngIf"],["class","box-emoji",4,"ngIf"],[1,"cap"],[3,"title","result"],["style","color: darkgrey;","class","spinner-border spinner-border-sm","role","status",4,"ngIf"],["role","status",1,"spinner-border","spinner-border-sm",2,"color","darkgrey"],[2,"color","green","vertical-align","bottom"],[1,"box-point",3,"ngClass","hidden"],[1,"point",3,"ngStyle"],[3,"mark"],[3,"ngStyle","innerHtml"],[1,"box-emoji"],[4,"ngFor","ngForOf"],["alt","icon-emoji",1,"comment-emoji","img-fluid","mr-2",3,"id","src"],[2,"padding","50px"],[1,"alert","alert-info"],[1,"p-5","text-center","alert","alert-danger"]],template:function(e,o){if(1&e&&(t.YNc(0,ho,4,2,"ng-container",0),t.YNc(1,uo,3,3,"ng-template",null,1,t.W1O)),2&e){const n=t.MAs(2);t.Q6J("ngIf",o.isSupportedBrowser)("ngIfElse",n)}},dependencies:[k.mk,k.sg,k.O5,k.PC,W.Hw,X.Q,We,yt.B,j.bT],styles:["#test_review_container[_ngcontent-%COMP%]{background:#ecf0f5;flex:auto;padding-top:15px}#tester-info[_ngcontent-%COMP%]{width:300px;padding:15px;background-color:#fff;margin:0 auto;position:sticky;top:10px;max-height:calc(100vh - 10px);display:flex;flex-direction:column;max-width:100%;border-radius:3px;border:1px solid #f1f1f1}#short_cut_mobile[_ngcontent-%COMP%]{display:none}#fullPoint[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:1px solid #f1f1f1;background-color:#fafafa;padding:10px;margin-top:15px;align-items:center}#fullPoint[_ngcontent-%COMP%]   .point[_ngcontent-%COMP%]{font-weight:500;font-size:130%}.tested-times[_ngcontent-%COMP%]{margin-top:15px}.tested-times[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{border:1px solid #f1f1f1;background-color:#fafafa;padding:10px}.tested-times[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;border:1px solid #f1f1f1;border-top:none;margin-bottom:0;background-color:#fff;padding:10px}.tested-times[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:10px}.tested-times[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{margin-bottom:0}.tested-times[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.select[_ngcontent-%COMP%]{font-weight:500}.tested-times[_ngcontent-%COMP%]:last-child{flex:auto;overflow:auto}#multipleChoiceWrapHeader[_ngcontent-%COMP%]{padding-left:30px;padding-right:30px}#unsupportFallback[_ngcontent-%COMP%]{width:750px;height:350px;border:1px solid grey;border-radius:3px;display:flex;align-items:center;justify-content:center}#teacherMessage[_ngcontent-%COMP%]   .contentNote[_ngcontent-%COMP%]{display:flex}#teacherMessage[_ngcontent-%COMP%]   .contentNote[_ngcontent-%COMP%]   .cap[_ngcontent-%COMP%]{position:absolute;top:-30px;font-family:font_chu_dep;font-weight:700;font-size:25px}#teacherMessage[_ngcontent-%COMP%]   .contentNote[_ngcontent-%COMP%]   .box-point[_ngcontent-%COMP%]{width:200px;min-width:200px;min-height:200px;border:2px solid #333;border-right:none;position:relative;display:flex;align-items:center;justify-content:center;padding:15px}#teacherMessage[_ngcontent-%COMP%]   .contentNote[_ngcontent-%COMP%]   .box-point[_ngcontent-%COMP%]   span.point[_ngcontent-%COMP%]{color:red;font-size:60px}#teacherMessage[_ngcontent-%COMP%]   .contentNote[_ngcontent-%COMP%]   .box-msg[_ngcontent-%COMP%]{border:2px solid #333;padding:15px;position:relative;flex:auto;min-height:200px}#teacherMessage[_ngcontent-%COMP%]   .contentNote[_ngcontent-%COMP%]   .box-msg[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{width:100%;height:100%;border:none;color:red;font-size:24px;line-height:1.5}#teacherMessage[_ngcontent-%COMP%]   .contentNote[_ngcontent-%COMP%]   .box-msg[_ngcontent-%COMP%]   .cap[_ngcontent-%COMP%]{left:300px}.fading_layer[_ngcontent-%COMP%]{position:absolute;z-index:9;background-color:#ffffffe3;width:100%;height:100%;top:0;left:0;padding-top:200px;text-align:center;color:#a9a9a9;font-size:16px}#filterWrap[_ngcontent-%COMP%]{position:absolute;right:0;top:-4px;z-index:2}.viewWrong[_ngcontent-%COMP%]   .correct[_ngcontent-%COMP%], .viewRight[_ngcontent-%COMP%]   .incorrect[_ngcontent-%COMP%]{display:none}#col_examContent_wrap[_ngcontent-%COMP%]{width:1100px;margin:0 auto}#col_examContent_wrap[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{position:fixed;right:5px;top:50%;z-index:3;font-size:35px;width:40px;height:40px;display:flex;align-items:center;justify-content:center;background-color:#c9c9c97a;border-radius:50%;color:#fff;margin-top:-20px}#col_examContent_wrap[_ngcontent-%COMP%] > mat-icon.prev_icon[_ngcontent-%COMP%]{left:5px}#mbTestContent[_ngcontent-%COMP%]{position:relative}#mbTestContent[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{display:none;position:absolute;top:12px;color:#646464;z-index:100}#test_review_container.toggleNavInfo[_ngcontent-%COMP%]   #col_std_info[_ngcontent-%COMP%]{left:0}#close_button[_ngcontent-%COMP%]{color:red;position:absolute;right:5px;top:5px}@media screen and (max-width: 320px){#tester-info[_ngcontent-%COMP%]{width:100%}}@media screen and (max-width: 480px){#mbTestContent[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{display:inline-block}#test_review_container[_ngcontent-%COMP%]{padding-top:0}#col_std_info[_ngcontent-%COMP%]{position:fixed;top:0;left:-100%;z-index:99999;background:rgba(0,0,0,.6117647059);bottom:0;padding:0;transition:all .5s}#short_cut_mobile[_ngcontent-%COMP%]{display:flex;font-weight:500;font-size:18px;justify-content:space-between;color:#4a4a4a}#header-app-component[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:last-child{padding-left:0!important}#tester-info[_ngcontent-%COMP%]{margin:0;position:relative;height:100%;max-height:unset;top:0}#multipleChoiceWrap[_ngcontent-%COMP%]{padding-right:5px;padding-left:5px;padding-top:5px}}.buttons-area[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{text-transform:none!important}.box-emoji[_ngcontent-%COMP%]{margin-top:5px;padding:5px;width:88px;display:flex}@media screen and (max-width: 1600px){#col_examContent_wrap[_ngcontent-%COMP%]{width:100%}}"]}),i})(),fo=(()=>{class i extends E.Q{get exportsFormArray(){return this.form.controls.exports}get countSelected(){return this.exportsFormArray.value.filter(e=>!0===e).length}selectAll(){const e=[];this.data.resultsArr.forEach(()=>{e.push(this.isSelectAll.value)}),this.form.controls.exports.setValue(e)}ngOnInit(){this.form=this.fb.group({exports:new g.vC([],wo(1))}),this.data.resultsArr.forEach(()=>{this.exportsFormArray.push(new g.p4(!1))}),super.ngOnInit()}constructor(e,o,n){super(),this.dialogRef=e,this.fb=o,this.data=n,this.form=new g.nJ({}),this.isSelectAll=new g.p4(!1)}onNoClick(){this.dialogRef.close()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(S.so),t.Y36(g.QS),t.Y36(S.WI))},i.\u0275cmp=t.Xpm({type:i,selectors:[["what-export-dialog"]],features:[t.qOj],decls:28,vars:28,consts:[[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"intro-y"],[1,"text-base","font-medium","mr-auto","text-center"],[1,"clickable","d-flex","align-items-center",2,"font-weight","500"],["color","primary",1,"example-margin",3,"formControl","change"],[3,"formGroup"],["formArrayName","exports","ngFor","",3,"ngForOf"],[1,"text-right","mt-3"],["azt-track-service","export-homework-1pFKkr5k6sd",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","export-homework-sOTjM3oTR8F",1,"btn","w-24","btn-primary",3,"disabled","mat-dialog-close"],["color","primary",1,"mr-2","mb-2",3,"checked","formControlName"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),t._uU(5),t.ALo(6,"mytranslate"),t.qZA()(),t._UZ(7,"br"),t.TgZ(8,"div",3)(9,"p")(10,"i"),t._uU(11),t.ALo(12,"mytranslate"),t.ALo(13,"mytranslate"),t.qZA()(),t.TgZ(14,"span",5)(15,"mat-checkbox",6),t.NdJ("change",function(){return o.selectAll()}),t._uU(16),t.ALo(17,"mytranslate"),t.ALo(18,"mytranslate"),t.qZA()(),t.TgZ(19,"form",7),t.YNc(20,go,2,4,"ng-template",8),t.qZA()(),t.TgZ(21,"div",9)(22,"button",10),t.NdJ("click",function(){return o.onNoClick()}),t._uU(23),t.ALo(24,"mytranslate"),t.qZA(),t.TgZ(25,"button",11),t._uU(26),t.ALo(27,"mytranslate"),t.qZA()()()()()),2&e&&(t.xp6(5),t.hij("",t.lcZ(6,12,"lang_homework_export_homework_select_students_export_pdf"),"!"),t.xp6(6),t.lnq("*** ",t.lcZ(12,14,"lang_homework_export_homework_tutorial")," (",t.lcZ(13,16,"lang_homework_export_homework_choose"),": ",o.countSelected,")"),t.xp6(4),t.Q6J("formControl",o.isSelectAll),t.xp6(1),t.Oqu(o.isSelectAll.value?t.lcZ(17,18,"lang_homework_export_homework_clear_select_all"):t.lcZ(18,20,"lang_homework_export_homework_select_all")),t.xp6(3),t.Q6J("formGroup",o.form),t.xp6(1),t.Q6J("ngForOf",o.exportsFormArray.controls),t.xp6(3),t.hij("",t.lcZ(24,22,"lang_buttom_cancel_clear")," "),t.xp6(2),t.Q6J("disabled",!o.form.valid)("mat-dialog-close",t.VKq(26,po,o.exportsFormArray.value)),t.xp6(1),t.hij("",t.lcZ(27,24,"lang_buttom_agree")," "))},dependencies:[k.sg,Ve.oG,S.ZT,g._Y,g.JJ,g.JL,g.oH,g.sg,g.u,g.CE,tt.M,j.bT],encapsulation:2}),i})();function wo(i=1){return e=>e.controls.map(n=>n.value).reduce((n,s)=>s?n+s:n,0)>=i?null:{required:!0}}let Ct=(()=>{class i extends E.Q{getData(){this.initStatusObj(),this.data.status?this.successStatusObj():this.stopStatusObj()}cleanResult(){var e=this.commonService.getFormObj(this.form),o={homeworkHashId:this.data.itemHomework.hashId??"",id:this.data.ans_id,resendNote:e.reason};this.initStatusObj(),this.subscriptions.add(this.answerService.apiAnswerResendAnswerPost(o).subscribe(n=>{1==n.success?(this.showSuccessSnack("lang_cms_send_request_success"),this.result=!0,this.onSubmit({result:this.result,id:this.data.ans_id,itemHomework:this.data.itemHomework,isRedirect:this.data.redirect}),this.successStatusObj()):(this.showErrorSnack("lang_cms_send_request_error"),this.result=!1,this.onSubmit({result:this.result,id:this.data.ans_id,itemHomework:this.data.itemHomework,isRedirect:this.data.redirect}),this.errorStatusObj(n.message??""))}))}ngOnInit(){this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"",this.getData(),this.form=this.fb.group({reason:new g.p4("",g.kI.required)}),super.ngOnInit()}constructor(e,o,n,s,a){super(),this.dialogRef=e,this.answerService=o,this.activeRoute=n,this.fb=s,this.data=a,this.subscriptions=new et.w0,this.form=new g.nJ({}),this.result=!1,this.homeworkHashId=""}onNoClick(){this.dialogRef.close()}onSubmit(e){this.dialogRef.close(e)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(S.so),t.Y36(J.P6),t.Y36(P.gz),t.Y36(g.QS),t.Y36(S.WI))},i.\u0275cmp=t.Xpm({type:i,selectors:[["clean-result-dialog"]],features:[t.qOj],decls:43,vars:31,consts:[[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"intro"],[1,"text-base","font-medium","mr-auto","text-center"],[3,"hidden"],[1,"d-flex","justify-content-center"],["role","status",1,"spinner-border"],[1,"sr-only"],[1,"intro",3,"hidden"],["enctype","multipart/form-data",1,"form-horizontal","text-center",3,"formGroup"],[1,"text-left",2,"border","1px dashed red","padding","10px 5px","border-radius","5px"],[1,"h5","text-danger","text-center"],[1,"h5","mb-1"],[1,"text-danger"],[1,"h5","text-danger","mt-1","mb-1"],["type","text","id","reason","formControlName","reason",1,"form-control","mt-2"],[1,"text-right","mt-3"],["azt-track-service","clean-result-dialog-_f7PVI4E-S_",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","clean-result-dialog-xDCHUvnl-fJ",1,"btn","w-24","btn-primary",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),t._uU(5),t.ALo(6,"mytranslate"),t.qZA()(),t._UZ(7,"br"),t.TgZ(8,"div",5)(9,"div",6)(10,"div",7)(11,"span",8),t._uU(12,"..."),t.qZA()()()(),t.TgZ(13,"div",9)(14,"form",10)(15,"div",11)(16,"p",12),t._uU(17),t.ALo(18,"mytranslate"),t.qZA(),t.TgZ(19,"p",13),t._uU(20),t.ALo(21,"mytranslate"),t.TgZ(22,"span",14),t._uU(23),t.qZA(),t._uU(24),t.ALo(25,"mytranslate"),t.TgZ(26,"span",14),t._uU(27),t.ALo(28,"formatOnlyDateByUserUnitPipe"),t.qZA(),t._uU(29),t.ALo(30,"mytranslate"),t.qZA(),t._UZ(31,"hr"),t.TgZ(32,"p",15),t._uU(33),t.ALo(34,"mytranslate"),t.qZA(),t._UZ(35,"input",16),t.qZA()()(),t.TgZ(36,"div",17)(37,"button",18),t.NdJ("click",function(){return o.onNoClick()}),t._uU(38),t.ALo(39,"mytranslate"),t.qZA(),t.TgZ(40,"button",19),t.NdJ("click",function(){return o.cleanResult()}),t._uU(41),t.ALo(42,"mytranslate"),t.qZA()()()()()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,13,"lang_homework_mark_exercise_utils_request_resubmit")),t.xp6(3),t.Q6J("hidden",!o.statusObj.loading),t.xp6(5),t.Q6J("hidden",o.statusObj.loading),t.xp6(1),t.Q6J("formGroup",o.form),t.xp6(3),t.hij("(*) ",t.lcZ(18,15,"lang_homework_mark_exercise_utils_note"),":"),t.xp6(3),t.hij(" ",t.lcZ(21,17,"lang_homework_mark_exercise_utils_request")," "),t.xp6(3),t.hij(" ",o.data.name," "),t.xp6(1),t.hij(" ",t.lcZ(25,19,"lang_homework_mark_exercise_utils_in_homework"),"\xa0"),t.xp6(3),t.Oqu(t.lcZ(28,21,o.data.deadline?o.data.deadline:o.data.itemHomework.createdAt)),t.xp6(2),t.hij("\xa0",t.lcZ(30,23,"lang_homework_mark_exercise_utils_will_be_deleted"),"! "),t.xp6(4),t.Oqu(t.lcZ(34,25,"lang_homework_mark_exercise_utils_coment_request_resubmit")),t.xp6(5),t.hij(" ",t.lcZ(39,27,"lang_buttom_cancel")," "),t.xp6(3),t.hij(" ",t.lcZ(42,29,"lang_buttom_confirm")," "))},dependencies:[g._Y,g.Fj,g.JJ,g.JL,g.sg,g.u,tt.M,j.bT,j._I],encapsulation:2}),i})(),St=(()=>{class i extends E.Q{ngOnInit(){this.success=this.data.status}constructor(e,o,n){super(),this.dialogRef=e,this.answerService=o,this.data=n,this.success=!1}checkNextAns(){this.dialogRef.close(),this.answerService.apiAnswerGetNextObjByHomeworkGet(this.data.homeworkHashId).subscribe(e=>{if(1==e.success)return this.commonService.myNavigationWithQueryString("/admin/homework/switch-mark-exercise/"+e.data?.obj?.id+"/"+this.data.homeworkHashId,"?backto="+encodeURIComponent(this.data.backToLink)),void(window.location=this.commonService.getLocalRouter("/admin/homework/switch-mark-exercise/"+e.data?.obj?.id+"/"+this.data.homeworkHashId+"?backto="+encodeURIComponent(this.data.backToLink)));window.location=this.commonService.getLocalRouter("/admin/testbank/homework-results-list/"+this.data.classID+"/"+this.data.homeWorkID+"/"+this.data.homeworkHashId)})}onNoClick(){this.dialogRef.close()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(S.so),t.Y36(J.P6),t.Y36(S.WI))},i.\u0275cmp=t.Xpm({type:i,selectors:[["notice-dialog"]],features:[t.qOj],decls:22,vars:10,consts:[[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"intro"],[1,"text-base","font-medium","mr-auto"],[1,"mr-1",2,"color","green"],[2,"color","red","font-size","120%","font-weight","500"],[3,"mark"],[1,"text-right","mt-3"],["azt-track-service","notice-dialog-YnLBVlTjw",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","notice-dialog-D6RUmpOZKX",1,"btn","w-24","btn-primary",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4)(5,"mat-icon",5),t._uU(6,"check_circle"),t.qZA(),t._uU(7),t.ALo(8,"mytranslate"),t.qZA()(),t._UZ(9,"br"),t.TgZ(10,"div",3),t._uU(11),t.ALo(12,"mytranslate"),t.TgZ(13,"span",6),t._UZ(14,"azt-check-mark",7),t.qZA()(),t._UZ(15,"br"),t.TgZ(16,"div",8)(17,"button",9),t.NdJ("click",function(){return o.onNoClick()}),t._uU(18,"Ok"),t.qZA(),t.TgZ(19,"button",10),t.NdJ("click",function(){return o.checkNextAns()}),t._uU(20),t.ALo(21,"mytranslate"),t.qZA()()()()()),2&e&&(t.xp6(7),t.hij(" ",t.lcZ(8,4,"lang_homework_mark_exercise_utils_mark_success"),""),t.xp6(4),t.hij(" ",t.lcZ(12,6,"lang_homework_mark_exercise_utils_assignment_marking")," "),t.xp6(3),t.Q6J("mark",o.data.score),t.xp6(6),t.Oqu(t.lcZ(21,8,"lang_homework_mark_exercise_utils_mark_continue")))},dependencies:[W.Hw,yt.B,j.bT],styles:["#ok[_ngcontent-%COMP%]:hover{background-color:#e7e7e7}#next[_ngcontent-%COMP%]:hover{background-color:#1e579d!important}"]}),i})();var Ot=m(14845),Tt=m(94281),jt=m(12893),bo=m(81373),ko=m(10134),xo=m(87303);const vo=["aztMarkNote"];function yo(i,r){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"azt-mark-note",37,38),t.NdJ("handleBackLink",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.goBack())})("doneLoadData",function(n){t.CHM(e);const s=t.oxw();return t.KtG(s.doneLoadData(n))})("markData",function(n){t.CHM(e);const s=t.oxw();return t.KtG(s.getMarkData(n))})("sizeMarkEditor",function(n){t.CHM(e);const s=t.oxw();return t.KtG(s.getSizeMarkEditor(n))})("getIdHistory",function(n){t.CHM(e);const s=t.oxw();return t.KtG(s.getDataHistory(n))}),t.qZA(),t.BQk()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("dataMarkNote",e.dataMarkNote)("showBackLink",!0)("markedByObj",e.markedByObj)("historyAnswerObjs",e.historyAnswerObjs)}}function Co(i,r){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"mytranslate"),t.ALo(3,"mytranslate"),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.HOy(" ",t.lcZ(2,4,"lang_testbank_testted_list_number_success")+" "," ",e.markData.totalRight+", "," ",t.lcZ(3,6,"lang_testbank_testted_list_error")+" "," ",e.markData.totalWrong," ")}}function So(i,r){1&i&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"lang_core_chua_co_so_cau_dung_cau_sai")))}function Oo(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",39)(1,"button",40),t.NdJ("click",function(){const s=t.CHM(e).$implicit,a=t.oxw();return t.KtG(a.setPoint(s))}),t._uU(2),t.qZA()()}if(2&i){const e=r.$implicit;t.xp6(2),t.hij(" ",e.name," ")}}function To(i,r){1&i&&(t.TgZ(0,"span",41),t._UZ(1,"azt-loading-ui",42),t.qZA()),2&i&&(t.xp6(1),t.Q6J("type","oval"))}const jo=function(i){return{height:i}};let Ao=(()=>{class i extends E.Q{onResize(e){this.changeSizeMarkGeneral()}doneLoadData(e){this.loadingDataCdn=!1}uploadDrawBase64ToCDN(e,o,n){let s=this.baseApiService.dataURItoBlob(e),a=Date.now();this.apiUploadService.commonUploadForMarkResult(s,`essay_note_${o}_${this.answerId}_${a}.png`,"image/png",1e4).subscribe(c=>{c.type!=A.dt.UploadProgress&&(1==c.success?(this.mnoteJsonData.pages?.[o]&&(this.mnoteJsonData.pages[o].draw=c.data?.url),this.pagesCount--,0==this.pagesCount&&this.remark(this.answerId,n,this.mnoteJsonData)):(this.showErrorSnack("lang_cms_cannot_save_data_marked"),this.stopStatusObj()))})}uploadAll(e,o){this.pagesCount=0;for(let n=0;n<e.length;n++)e[n].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(this.answerId,o,this.mnoteJsonData);else for(let n=0;n<e.length;n++)e[n].draw&&this.uploadDrawBase64ToCDN(e[n].draw,n,o)}sendDataToMarkNote(){let e=this.castObj(this.result.answerObj);if(e){let c=this.commonService.willDeleteParseJson(e.result??"");if(null!=c){let l=c.pages?.length??0;for(let u=0;u<l;u++)c?.pages?.[u].backgroundImage&&(c.pages[u].backgroundImage=this.cdnService.getMyCdn(c.pages[u].backgroundImage??"")),c.pages?.[u].draw&&(c.pages[u].draw=this.cdnService.getMyCdn(c.pages[u].draw));c=JSON.stringify(c),e.result=JSON.stringify(c)}let d=this.commonService.willDeleteParseJson(e.files??"");if(null!=d){for(let l=0;l<d.length;l++)d[l].url&&(d[l].url=this.cdnService.getMyCdn(d[l].url)),d[l].thumb&&(d[l].thumb=this.cdnService.getMyCdn(d[l].thumb));d=JSON.stringify(d),e.files=d}}let o=this.result.studentObj,n=this.result.classroomObj,s=this.result.homeworkObj,a=this.commonService.myParseJson(e?.result??"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let c=0;c<(this.jsonData.pages?.length??0);c++)this.jsonData.pages?.[c].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[c].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[c].backgroundImage??"")),this.jsonData.pages?.[c].hasOwnProperty("draw")&&(this.jsonData.pages[c].draw=this.cdnService.getMyCdn(this.jsonData.pages[c].draw??""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="edit",this.jsonData.answer_obj=e,this.jsonData.student_obj=o,this.jsonData.classroom_obj=n,this.jsonData.homework_obj=s,a&&a.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=a.hideMark),this.dataMarkNote=this.jsonData;else{let c=[];this.files.forEach(l=>{c.push({backgroundImage:l.url})});let d={cmd:"initMNote",mode:"edit",pages:c,answer_obj:e,student_obj:o,classroom_obj:n,homework_obj:s};a&&a.hasOwnProperty("hideMark")&&(d.hideMark=a.hideMark),this.dataMarkNote=d}}getHistoryObjs(e){this.initStatusObj(),this.answerService.apiAnswerGetHistoryObjsGet(this.homeworkHashId,e).subscribe(o=>{1==o.success?this.historyAnswerObjs=o.data?.objs??new Array:this.errorMessage=o.message??"",this.stopStatusObj()})}getDataHistory(e){this.historyId=e,this.errorMessage="",this.countLoad=1,this.answerService.apiAnswerGetHistoryObjGet(this.homeworkHashId,this.answerId,parseInt(e,10)).subscribe(o=>{if(1==o.success){if(this.zipDataService.convertSubmittedAnswersObj(o.data?.answerObj),o.data){this.result=o.data,this.markedByObj=o.data.markedByObj,this.score=o.data?.answerObj?.point??0,this.pointExercise.value=o.data?.answerObj?.point??"",Number(this.pointExercise.value)<1e3?this.pointExercise.name=this.pointExercise.value.toString():this.listPointAzt.forEach(s=>{s.value==this.pointExercise.value&&(this.pointExercise=this.commonService.myClone(s))}),"0"==this.pointExercise.name&&(this.pointExercise.name="");let n=this.castJsonToObj(o.data.answerObj?.resultNote??"");if(this.commentExercise=n?.Note??"",this.showPoint=!n?.IsHideMark,this.files=this.commonService.myParseJson(o.data.answerObj?.files??"")??[],null!=this.files)for(let s=0;s<this.files.length;s++)this.files[s].url=this.cdnService.getMyCdn(this.files?.[s].url??""),this.files[s].thumb=this.cdnService.getMyCdn(this.files?.[s].thumb??"");this.handleJsonData(),this.hasLoadedData=!0,this.sendDataToMarkNote(),this.successStatusObj()}}else this.errorMessage=o.message??"",this.stopStatusObj()})}handleJsonData(){if(this.jsonData={},!this.result?.answerObj?.confirmedAt&&!this.result?.answerObj?.result&&(this.isMarked=!1),this.result.answerObj?.confirmedAt){this.isMarked=!0;var e=this.commonService.myParseJson(this.result.answerObj?.result??"");e&&(this.jsonData=e,null==this.jsonData&&(this.isMarked=!1))}}getData(e){this.initStatusObj(),this.errorMessage="",this.answerId=e,this.answerService.apiAnswerGetObjGet(this.homeworkHashId,e).subscribe(o=>{if(1==o.success)if(this.zipDataService.convertSubmittedAnswersObj(o.data?.answerObj),o.data?.hasOwnProperty("studentObj")&&null!=o.data?.studentObj){this.result=o.data,this.markedByObj=o.data.markedByObj,this.score=o.data?.answerObj?.point??0,this.pointExercise.value=o.data?.answerObj?.point??0,this.checkInputActive=!0,this.pointExercise.value<1e3?this.pointExercise.name=this.pointExercise.value.toString():this.listPointAzt.forEach(s=>{s.value==this.pointExercise.value&&(this.pointExercise=this.commonService.myClone(s))}),"0"==this.pointExercise.name&&(this.pointExercise.name="",this.checkInputActive=!1);let n=this.castJsonToObj(o.data.answerObj?.resultNote??"");if(this.commentExercise=n?.Note??"",this.showPoint=!n?.IsHideMark,this.homeworkID=o.data.homeworkObj?.id??0,this.classID=o.data.classroomObj?.id??0,this.files=this.commonService.myParseJson(o.data.answerObj?.files??"")??[],this.studentObj=o.data.studentObj,this.classroomObj=o.data.classroomObj??{},null!=this.files)for(let s=0;s<this.files.length;s++)this.files[s].url=this.cdnService.getMyCdn(this.files?.[s].url??""),this.files[s].thumb=this.cdnService.getMyCdn(this.files?.[s].thumb??"");this.homeworkObj=o.data.homeworkObj??{},this.studentName=o.data.studentObj.fullName??"",this.handleJsonData(),this.hasLoadedData=!0,0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToMarkNote()),this.successStatusObj()}else this.errorMessage="lang_core_not_found_student",this.stopStatusObj();else this.errorMessage=o.message??"",this.stopStatusObj()})}openDialog(e,o){this.dialog.open(St,{width:"280px",autoFocus:!1,data:{score:o,status:e,homeWorkID:this.homeworkID,homeworkHashId:this.homeworkHashId,classID:this.classID,backToLink:this.backToLink},restoreFocus:!1}).afterClosed().subscribe(s=>{})}handleOpenReSubmit(){this.homeworkObj&&this.openDialogReSubmit(!0,this.homeworkObj.deadline??void 0,this.homeworkObj,this.answerId,this.studentName)}openDialogReSubmit(e,o,n,s,a){let c={status:e,deadline:o,itemHomework:n,ans_id:s,name:a,redirect:!0,classID:this.useNewDashboard?this.homeworkObj?.categoryId:this.classID};this.dialog.open(Ct,{width:"380px",panelClass:"cleanResultDialogBox",data:c,restoreFocus:!1}).afterClosed().subscribe(l=>{if(l&&l.result&&l.isRedirect){let u="?backto="+encodeURIComponent("/admin/testbank/document-management/1/"+c.classID+"/1");this.commonService.myNavigationWithQueryString("/admin/testbank/homework-results-list/"+c.classID+"/"+c.itemHomework.id+"/"+this.homeworkHashId,u)}})}remark(e,o,n){let s=JSON.stringify({type:"homework",id:this.homeworkObj?.id,user:this.homeworkObj?.tenantId});if(""==this.historyId)if(1==this.permissionService.hasMarkPointPermission("homework",this.homeworkObj?.permissionObj)){let a={id:e,comment:n.comment,hideMark:n.hideMark?1:0,point:o?parseFloat(o.replace(",",".")):0,result:this.zipDataService.convertContentGzip(JSON.stringify(n)),homeworkHashId:this.homeworkHashId};this.answerService.apiAnswerSaveResultPost(s,a).subscribe(c=>{1==c.success?(this.openDialog(!0,c.data?.obj?.point),this.successStatusObj()):(this.stopStatusObj(),this.showErrorSnack("lang_cms_mark_fail"))})}else this.showErrorSnack("lang_cms_no_permission_on_homework"),this.stopStatusObj();else this.stopStatusObj(),this.showErrorSnack("lang_cms_cannot_remark_student_history_result")}goBack(){this.backToLink?this.backToLink.includes("shareType")?this.commonService.myNavigationBySpecialQueryString(this.backToLink):this.commonService.myNavigation(this.backToLink):this.commonService.myNavigation(this.useNewDashboard?"/admin/testbank/homework-results-list/"+(this.homeworkObj?.categoryId??"0")+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId:"/admin/testbank/homework-results-list/"+this.classID+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId)}checkModeUiEditor(e){let n=(document.getElementById("mark-general-box")?.offsetHeight??0)-80-40-140-40-30;this.initDataEditor="dark"==e?{min_height:n,menubar:!1,resize:!1,skin:"oxide-dark",content_css:"dark",plugins:["advlist","anchor","autolink","charmap","code","fullscreen","lists","media","preview","textcolor","emoticons","fontselect","autoresize"],toolbar:"| fontfamily | fontsize |bold italic underline | forecolor backcolor | alignleft aligncenter alignright | emoticons",emoticons_database:"emojis",font_family_formats:"Arial=arial,helvetica,sans-serif; Comic Sans MS=comic sans ms,sans-serif; Courier New=courier new,courier; Georgia=georgia,palatino; Helvetica=helvetica; Times New Roman=times new roman,times; Trebuchet MS=trebuchet ms,geneva; Verdana=verdana,geneva; Font ch\u1eef \u0111\u1eb9p=font_chu_dep",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",content_style:"@font-face { font-family: font_chu_dep; src: url('https://cdn.jsdelivr.net/gh/azota889/storage_public/azota_assets/fonts/HP0015HB.ttf');} body { font-family: font_chu_dep; color: red; font-size: 18pt; line-height: initial;};"}:{min_height:n,menubar:!1,resize:!1,plugins:["advlist","anchor","autolink","charmap","code","fullscreen","lists","media","preview","textcolor","emoticons","fontselect","autoresize"],toolbar:"| fontfamily | fontsize |bold italic underline | forecolor backcolor | alignleft aligncenter alignright | emoticons",emoticons_database:"emojis",font_family_formats:"Arial=arial,helvetica,sans-serif; Comic Sans MS=comic sans ms,sans-serif; Courier New=courier new,courier; Georgia=georgia,palatino; Helvetica=helvetica; Times New Roman=times new roman,times; Trebuchet MS=trebuchet ms,geneva; Verdana=verdana,geneva; Font ch\u1eef \u0111\u1eb9p=font_chu_dep",font_size_formats:"8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 22pt 24pt 30pt 36pt 48pt 60pt 72pt 96pt",content_style:"@font-face { font-family: font_chu_dep; src: url('https://cdn.jsdelivr.net/gh/azota889/storage_public/azota_assets/fonts/HP0015HB.ttf');} body { font-family: font_chu_dep; color: red; font-size: 18pt; line-height: initial;};"}}setPoint(e){this.pointExercise=this.commonService.myClone(e),this.checkInputActive=!0}setPointInput(e){if(e.target){this.checkInputActive=!0;let o=e.target.value;this.pointExercise.value=o,this.pointExercise.name=o}}getListPointDefault(){this.listPointAzt=[{value:1e3,name:"\u0110"},{value:1001,name:"C\u0110"},{value:2e3,name:"HT"},{value:2001,name:"CHT"},{value:3e3,name:"HTT"}]}getMarkData(e){e.checkChangeMark&&(this.markData=e,this.checkInputActive||(this.pointExercise.value=isNaN(this.markData.pointRaw??0)?"":this.markData.pointRaw,this.pointExercise.name=this.pointExercise.value?.toString()))}ngOnInit(){this.isMobileDevice||(document.body.style.overflowY="hidden"),this.getListPointDefault();const e=this.commonService.getMyParam(this.activeRoute,"id")?Number(this.commonService.getMyParam(this.activeRoute,"id")):0,o=this.commonService.getMyParam(this.activeRoute,"historyId")??"";this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"";let n=this.commonService.getMyQueryParam("backto");this.backToLink=n?n.includes("shareType")?decodeURIComponent(n):n:"",this.getData(e),this.getHistoryObjs(e),o&&this.getDataHistory(o);let s=""==this.browserStorageService.getStorage("mode_ui")?"light":this.browserStorageService.getStorage("mode_ui")??"light";this.checkModeUiEditor(s),this.commonService.translateMetaData({title:"lang_cms_homework_mark_exercise_title",description:"lang_cms_homework_mark_exercise_description",image:"lang_cms_test_image"}),super.ngOnInit()}getSizeMarkEditor(e){this.sizeMarkEditor=e}changeSizeMarkGeneral(){let e=document.getElementById("mark-general"),o=document.getElementById("mark-general-box");o&&e&&(o.style.width=e.offsetWidth.toString()+"px")}uploadDrawBase64ToCdn(){return new Promise(e=>{let o=[];if(this.objectResult.pages){this.objectResult.pages.forEach(n=>{o.push(!1)});for(let n=0;n<this.objectResult.pages.length;n++)if(this.objectResult.pages[n]&&this.objectResult.pages[n].draws?.length)for(let s=0;s<(this.objectResult.pages[n].draws?.length??0);s++){let a=this.objectResult.pages[n].draws?.[s]??{};if(a.src&&a.src.includes("base64")){o[n]=!0;let c=this.baseApiService.dataURItoBlob(a.src);this.apiUploadService.commonUploadForMarkResult(c,`essay_note_${n}_${s}_${this.answerId}.png`,"image/png",1e4).subscribe(d=>{d.type!=A.dt.UploadProgress&&(a.src=d.data?.url,o[n]=!1),o.includes(!0)||e()})}}}})}saveDataMarkExercise(){var e=this;return(0,L.Z)(function*(){if(e.loadingSaveData=!0,""==e.historyId)if(1==e.permissionService.hasMarkPointPermission("homework",e.homeworkObj?.permissionObj)){if(!e.MarkNote)return;e.objectResult=e.MarkNote?.exportDataMarkNote();let o=!1;if(e.objectResult.pages?.length===e.files.length){for(let d=0;d<e.objectResult.pages.length;d++)if(e.objectResult.pages[d]&&e.objectResult.pages[d].draws?.length)for(let l=0;l<(e.objectResult.pages[d].draws?.length??0);l++){let u=e.objectResult.pages[d].draws?.[l]??{};u.src&&u.src.includes("base64")&&(o=!0)}o&&(yield e.uploadDrawBase64ToCdn());const n=e.serializeJson(e.objectResult),s=e.zipDataService.convertContentGzip(n),a=new Blob([s],{type:"text/plain"}),c=new File([a],"txt",{type:"text/plain"});e.apiUploadService.uploadToCdnForHomework(c).subscribe(d=>{if(1==d.success){let l=d.data?.url??"",u={point:e.pointExercise.value?.toString(),urlDataMark:l,version:"0.1",comment:e.commentExercise,hideMark:!e.showPoint};e.remark(e.answerId,u.point??"0",u)}else e.showErrorSnack("lang_core_co_loi_trong_qua_trinh_luu_du_lieu_len_cdn_vui_long_thu_lai");e.loadingSaveData=!1})}else e.loadingSaveData=!1,e.showErrorSnack("lang_core_co_loi_trong_qua_trinh_luu_du_lieu_vui_long_thu_lai")}else e.showErrorSnack("lang_cms_no_permission_on_homework"),e.stopStatusObj();else e.stopStatusObj(),e.showErrorSnack("lang_cms_cannot_remark_student_history_result")})()}ngAfterViewInit(){this.changeSizeMarkGeneral()}constructor(e,o,n,s,a,c,d,l,u,p){super(),this.activeRoute=e,this.answerService=o,this.baseApiService=n,this.permissionService=s,this.dialog=a,this.cdnService=c,this.zipDataService=d,this.apiUploadService=l,this.browserStorageService=u,this.vcRef=p,this.answerId=0,this.homeworkID="",this.historyId="",this.isMarked=!1,this.jsonData={},this.errorMessage="",this.files=[],this.classID="",this.studentName="",this.score=0,this.mnoteJsonData={},this.pagesCount=0,this.backToLink="",this.hasSendDataToIframe=!1,this.hasLoadedData=!1,this.historyAnswerObjs=[],this.countLoad=1,this.homeworkHashId="",this.useNewDashboard=!1,this.initDataEditor={},this.color="#000",this.dataMarkNote={},this.loadingSaveData=!1,this.loadingDataCdn=!0,this.listPointAzt=[],this.pointExercise={value:0,name:""},this.markData={},this.commentExercise="",this.showPoint=!0,this.sizeMarkEditor={width:200,height:800},this.checkInputActive=!1,this.objectResult={},this.handleIframe=b=>{"MNoteJson"==b.data.cmd&&(this.initStatusObj(),this.mnoteJsonData=b.data.data,this.uploadAll(this.mnoteJsonData.pages??[],b.data.data.point)),"MNoteReSubmit"==b.data.cmd&&(console.log("Listen res submit"),this.handleOpenReSubmit()),"MNoteLoadComplete"==b.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,""==this.historyId&&this.sendDataToMarkNote()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){document.body.style.overflowY="auto",window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(P.gz),t.Y36(J.P6),t.Y36(Ot._),t.Y36(Tt.$),t.Y36(S.uw),t.Y36(ct.U),t.Y36(G.D),t.Y36(st.$),t.Y36(gt.z),t.Y36(t.s_b))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-mark-exercise-new"]],viewQuery:function(e,o){if(1&e&&t.Gf(vo,5),2&e){let n;t.iGM(n=t.CRH())&&(o.MarkNote=n.first)}},hostBindings:function(e,o){1&e&&t.NdJ("resize",function(s){return o.onResize(s)},!1,t.Jf7)},features:[t.qOj],decls:52,vars:39,consts:[[1,"content",2,"padding","0 12px"],[1,"grid","grid-cols-12","gap-3","mt-3"],[1,"col-span-12","md:col-span-8","mark-editor",3,"ngStyle"],[4,"ngIf"],["id","mark-general",1,"col-span-12","md:col-span-4","mark-general"],["id","mark-general-box",1,"box"],[1,"p-2"],[1,"box-head"],[1,"font-medium"],[1,"flex","items-center","mt-2"],[1,"info-student","flex","items-center"],[3,"nameCreateAvatar","size"],[1,"info","ml-2"],[1,"text-md"],[1,"text-xs"],[1,"score","ml-auto","flex","items-center"],["appOnlyNumber","","type","text","id","azt-score",1,"form-control","text-danger","font-medium",3,"decimal","max","value","placeholder","input"],[1,"bg-slate-200","dark:bg-darkmode-400","p-2","text-center","rounded","mt-3"],[4,"ngIf","ngIfElse"],["notMark",""],[1,"choose-score","mt-3"],[1,"score-list-one","grid","grid-cols-10","gap-3"],["class","score-item col-span-2",4,"ngFor","ngForOf"],[1,"comment","mt-3"],[1,"font-medium","text-md"],[1,"comment-editor","mt-2"],["apiKey","ldij13v1886vlrnk42g9bvngyqdc6gxpe8l0n9mo8gdjpg9d",3,"ngModel","init","ngModelChange"],[1,"flex","items-center","mt-3"],[1,"form-check","form-switch"],["id","show-score","type","checkbox",1,"form-check-input","mr-2",3,"ngModel","ngModelChange"],["for","show-score",1,"form-check-label","ml-0"],[1,"ml-auto"],["azt-track-service","mark-exercise-new-yWLPF_cK9E",1,"btn","btn-pending",3,"disabled","click"],[1,"grid","grid-cols-2","gap-3","mt-3"],["azt-track-service","mark-exercise-new-xgpK5bMM5y",1,"btn","btn-secondary",3,"click"],["azt-track-service","mark-exercise-new-lNij5J4UCD",1,"btn","btn-primary",3,"disabled","click"],["class","w-4 h-4 inline-block mr-2",4,"ngIf"],[3,"dataMarkNote","showBackLink","markedByObj","historyAnswerObjs","handleBackLink","doneLoadData","markData","sizeMarkEditor","getIdHistory"],["aztMarkNote",""],[1,"score-item","col-span-2"],["azt-track-service","mark-exercise-new-YBVZ7xc_A",1,"border","border-slate-200","dark:border-darkmode-400","btn-score","btn",3,"click"],[1,"w-4","h-4","inline-block","mr-2"],[3,"type"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t.YNc(3,yo,3,4,"ng-container",3),t.qZA(),t.TgZ(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7)(8,"h3",8),t._uU(9),t.qZA(),t.TgZ(10,"div",9)(11,"div",10),t._UZ(12,"azt-create-avatar",11),t.TgZ(13,"div",12)(14,"p",13),t._uU(15),t.qZA(),t.TgZ(16,"p",14),t._uU(17),t.qZA()()(),t.TgZ(18,"div",15)(19,"input",16),t.NdJ("input",function(s){return o.setPointInput(s)}),t.ALo(20,"mytranslate"),t.qZA()()()(),t.TgZ(21,"div",17),t.YNc(22,Co,4,8,"span",18),t.YNc(23,So,3,3,"ng-template",null,19,t.W1O),t.qZA(),t.TgZ(25,"div",20)(26,"div",21),t.YNc(27,Oo,3,1,"div",22),t.qZA()(),t.TgZ(28,"div",23)(29,"p",24),t._uU(30),t.ALo(31,"mytranslate"),t.qZA(),t.TgZ(32,"div",25)(33,"editor",26),t.NdJ("ngModelChange",function(s){return o.commentExercise=s}),t.qZA()()(),t.TgZ(34,"div",27)(35,"div",28)(36,"input",29),t.NdJ("ngModelChange",function(s){return o.showPoint=s}),t.qZA(),t.TgZ(37,"label",30),t._uU(38),t.ALo(39,"mytranslate"),t.qZA()(),t.TgZ(40,"div",31)(41,"button",32),t.NdJ("click",function(){return o.handleOpenReSubmit()}),t._uU(42),t.ALo(43,"mytranslate"),t.qZA()()(),t.TgZ(44,"div",33)(45,"button",34),t.NdJ("click",function(){return o.goBack()}),t._uU(46),t.ALo(47,"mytranslate"),t.qZA(),t.TgZ(48,"button",35),t.NdJ("click",function(){return o.saveDataMarkExercise()}),t.YNc(49,To,2,1,"span",36),t._uU(50),t.ALo(51,"mytranslate"),t.qZA()()()()()()()),2&e){const n=t.MAs(24);t.xp6(2),t.Q6J("ngStyle",t.VKq(37,jo,o.sizeMarkEditor.height+"px")),t.xp6(1),t.Q6J("ngIf",o.dataMarkNote.answer_obj),t.xp6(6),t.hij(" ",null==o.homeworkObj?null:o.homeworkObj.name," "),t.xp6(3),t.Q6J("nameCreateAvatar",null==o.studentObj?null:o.studentObj.fullName)("size",35),t.xp6(3),t.hij(" ",null==o.studentObj?null:o.studentObj.fullName," "),t.xp6(2),t.hij(" ",null==o.classroomObj?null:o.classroomObj.name," "),t.xp6(2),t.s9C("placeholder",t.lcZ(20,25,"lang_auto_nhap_diem")),t.Q6J("decimal",!0)("max",999)("value",o.pointExercise.name),t.xp6(3),t.Q6J("ngIf",o.markData.totalRight||o.markData.totalWrong)("ngIfElse",n),t.xp6(5),t.Q6J("ngForOf",o.listPointAzt),t.xp6(3),t.hij(" ",t.lcZ(31,27,"lang_auto_nhan_xet")," "),t.xp6(3),t.Q6J("ngModel",o.commentExercise)("init",o.initDataEditor),t.xp6(3),t.Q6J("ngModel",o.showPoint),t.xp6(2),t.hij(" ",t.lcZ(39,29,"lang_auto_hien_thi_diem")," "),t.xp6(3),t.Q6J("disabled",""!==o.historyId),t.xp6(1),t.hij(" ",t.lcZ(43,31,"lang_auto_yeu_cau_nop_lai")," "),t.xp6(4),t.hij(" ",t.lcZ(47,33,"lang_auto_quay_lai")," "),t.xp6(2),t.Q6J("disabled",o.loadingSaveData||""!==o.historyId||""==o.pointExercise.name||o.loadingDataCdn),t.xp6(1),t.Q6J("ngIf",o.loadingSaveData),t.xp6(1),t.hij(" ",t.lcZ(51,35,"lang_auto_luu_du_lieu")," ")}},dependencies:[k.sg,k.O5,k.PC,R.PG,g.Wl,g.JJ,g.On,jt.g,bo.Y,ko.J,xo.a,j.bT],styles:[".btn-score[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center}.btn-score[_ngcontent-%COMP%]:hover{background:rgb(var(--color-slate-200)/var(--tw-bg-opacity))}.choose-score[_ngcontent-%COMP%]{max-width:80%;margin-left:auto;margin-right:auto}.toolbar-list[_ngcontent-%COMP%]{width:100%;padding:5px;position:absolute;top:0;left:0;display:flex;align-items:center;border-bottom-left-radius:0;border-bottom-right-radius:0}.btn-icon[_ngcontent-%COMP%]{padding:10px;min-width:auto;line-height:initial}.toolbar-item[_ngcontent-%COMP%]{margin:0 3px}.toolbar-item[_ngcontent-%COMP%]:first-child{margin-left:0}.btn-icon-child[_ngcontent-%COMP%]{padding:5px}.azt-toolbar-active[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(var(--color-slate-200)/var(--tw-bg-opacity))}  .dark .azt-toolbar-active{--tw-bg-opacity: 1;background-color:rgb(var(--color-darkmode-200)/var(--tw-bg-opacity))}.mark-general[_ngcontent-%COMP%]{order:2}.mark-editor[_ngcontent-%COMP%]{order:1}@media screen and (max-width: 768px){.choose-score[_ngcontent-%COMP%]{max-width:80%}.mark-general[_ngcontent-%COMP%]{order:2}.mark-editor[_ngcontent-%COMP%]{order:1}.content[_ngcontent-%COMP%]{margin-bottom:100px}}#mark-general-box[_ngcontent-%COMP%]{height:calc(100vh - 24px);overflow:auto}@media screen and (max-width: 768px){#mark-general-box[_ngcontent-%COMP%]{position:relative;min-height:100vh;height:auto;overflow:hidden}}"]}),i})();var At=m(52846),Po=m(32296),Pt=m(77988);function Mo(i,r){if(1&i&&(t.TgZ(0,"button",15),t.ALo(1,"mytranslate"),t.TgZ(2,"mat-icon"),t._uU(3,"history"),t.qZA()()),2&i){t.oxw();const e=t.MAs(8);t.s9C("matTooltip",t.lcZ(1,2,"lang_homework_mark_exercise_history_submit")),t.Q6J("matMenuTriggerFor",e)}}function Zo(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"li")(1,"button",16),t.NdJ("click",function(){const s=t.CHM(e).$implicit,a=t.oxw();return t.KtG(a.getDataHistory(s.id?s.id.toString():""))}),t.TgZ(2,"span"),t._uU(3),t.ALo(4,"mytranslate"),t.ALo(5,"formatFullDateTimeWithoutSecondByUserUnitPipe"),t.qZA()()()}if(2&i){const e=r.$implicit,o=r.index;t.xp6(3),t.lnq("",t.lcZ(4,3,"lang_homework_mark_exercise_times")," ",o+1," - ",t.lcZ(5,5,e.createdAt),"")}}function Io(i,r){if(1&i&&(t.TgZ(0,"span"),t._UZ(1,"azt-create-avatar",18),t.ALo(2,"mytranslate"),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.hYB("matTooltip","",t.lcZ(2,5,"lang_homework_mark_exercise_teacher_mark")," ",": "+(null==e.markedByObj?null:e.markedByObj.fullName),""),t.Q6J("nameCreateAvatar",null==e.markedByObj?null:e.markedByObj.fullName)("size",25)("linkAvatar",null==e.markedByObj?null:e.markedByObj.avatar)}}function Do(i,r){if(1&i&&(t.TgZ(0,"h4",17),t.YNc(1,Io,3,7,"span",13),t._uU(2),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.isMarked),t.xp6(1),t.AsE(" ",null==e.studentObj?null:e.studentObj.fullName,", ",e.classroomObj.name," ")}}function Eo(i,r){1&i&&(t._UZ(0,"azt-loading-effect",19),t.ALo(1,"mytranslate")),2&i&&t.Q6J("customText",t.lcZ(1,1,"lang_homework_mark_exercise_loading_data_mark"))}function No(i,r){if(1&i&&(t.TgZ(0,"div")(1,"div",20)(2,"div",21)(3,"div",22),t._uU(4),t.ALo(5,"mytranslate"),t.qZA()()()()),2&i){const e=t.oxw();t.xp6(4),t.Oqu(t.lcZ(5,1,e.errorMessage))}}function Lo(i,r){if(1&i&&(t.TgZ(0,"div",23),t._UZ(1,"iframe",24),t.ALo(2,"safe"),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("src",t.lcZ(2,1,e.iframeSrc),t.uOi)}}let Uo=(()=>{class i extends E.Q{onPopState(e){this.goBack()}uploadDrawBase64ToCDN(e,o,n){let s=this.baseApiService.dataURItoBlob(e);this.apiUploadService.commonUploadForMarkResult(s,`essay_note_${o}_${this.answerId}.png`,"image/png",1e4).subscribe(a=>{a.type!=A.dt.UploadProgress&&(1==a.success?(this.mnoteJsonData.pages?.[o]&&(this.mnoteJsonData.pages[o].draw=a.data?.url),this.pagesCount--,0==this.pagesCount&&this.remark(this.answerId,n,this.mnoteJsonData)):(this.showErrorSnack("lang_cms_cannot_save_data_marked"),this.stopStatusObj()))})}uploadAll(e,o){this.pagesCount=0;for(let n=0;n<e.length;n++)e[n].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(this.answerId,o,this.mnoteJsonData);else for(let n=0;n<e.length;n++)e[n].draw&&this.uploadDrawBase64ToCDN(e[n].draw,n,o)}reloadPage(){location.reload()}sendDataToIframe(){const e=document.getElementById("mNote"),o=e?e.contentWindow:null;if(null!==o){let n=this.castObj(this.result.answerObj);if(null!=n){let l=this.commonService.willDeleteParseJson(n.result??"");if(null!=l){let p=l.pages?.length??0;for(let b=0;b<p;b++)l?.pages?.[b].backgroundImage&&(l.pages[b].backgroundImage=this.cdnService.getMyCdn(l.pages[b].backgroundImage??"")),l.pages?.[b].draw&&(l.pages[b].draw=this.cdnService.getMyCdn(l.pages[b].draw));l=JSON.stringify(l),n.result=l}let u=this.commonService.willDeleteParseJson(n.files??"");if(null!=u){for(let p=0;p<u.length;p++)u[p].url&&(u[p].url=this.cdnService.getMyCdn(u[p].url)),u[p].thumb&&(u[p].thumb=this.cdnService.getMyCdn(u[p].thumb));u=JSON.stringify(u),n.files=u}}let s=this.result.studentObj,a=this.result.classroomObj,c=this.result.homeworkObj,d=this.commonService.myParseJson(n?.result??"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let l=0;l<(this.jsonData.pages?.length??0);l++)this.jsonData.pages?.[l].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[l].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[l].backgroundImage??"")),this.jsonData.pages?.[l].hasOwnProperty("draw")&&(this.jsonData.pages[l].draw=this.cdnService.getMyCdn(this.jsonData.pages[l].draw??""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="edit",this.jsonData.answer_obj=n,this.jsonData.student_obj=s,this.jsonData.classroom_obj=a,this.jsonData.homework_obj=c,d&&d.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=d.hideMark),o.postMessage(this.jsonData,"*");else{let l=[];this.files.forEach(p=>{l.push({backgroundImage:p.url})});let u={cmd:"initMNote",mode:"edit",pages:l,answer_obj:n,student_obj:s,classroom_obj:a,homework_obj:c};d&&d.hasOwnProperty("hideMark")&&(u.hideMark=d.hideMark),o.postMessage(u,"*")}}}sendDataToIframeHistory(){const e=document.getElementById("mNote");e&&1==this.countLoad&&(e.src+="");const o=e?e.contentWindow:null;if(null!==o){let n=this.castObj(this.result.answerObj);if(null!=n){let l=this.commonService.willDeleteParseJson(n?.result??"");if(null!=l){for(let p=0;p<l.pages.length;p++)l.pages[p].backgroundImage&&(l.pages[p].backgroundImage=this.cdnService.getMyCdn(l.pages[p].backgroundImage)),l.pages[p].draw&&(l.pages[p].draw=this.cdnService.getMyCdn(l.pages[p].draw));l=JSON.stringify(l),n.result=l}let u=this.commonService.willDeleteParseJson(n.files??"");if(null!=u){for(let p=0;p<u.length;p++)u[p].url&&(u[p].url=this.cdnService.getMyCdn(u[p].url)),u[p].thumb&&(u[p].thumb=this.cdnService.getMyCdn(u[p].thumb));u=JSON.stringify(u),n.files=u}}let s=this.studentObj,a=this.classroomObj,c=this.homeworkObj,d=this.commonService.willDeleteParseJson(n?.result??"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let l=0;l<(this.jsonData.pages?.length??0);l++)this.jsonData.pages?.[l].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[l].backgroundImage=this.cdnService.getMyCdn(this.jsonData.pages[l].backgroundImage??"")),this.jsonData.pages?.[l].hasOwnProperty("draw")&&(this.jsonData.pages[l].draw=this.cdnService.getMyCdn(this.jsonData.pages[l].draw??""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="view",this.jsonData.answer_obj=n,this.jsonData.student_obj=s,this.jsonData.classroom_obj=a,this.jsonData.homework_obj=c,d&&d.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=d.hideMark),o.postMessage(this.jsonData,"*");else{let l=[];this.files.forEach(p=>{l.push({backgroundImage:p.url})});let u={cmd:"initMNote",mode:"view",pages:l,answer_obj:n,student_obj:s,classroom_obj:a,homework_obj:c};d&&d.hasOwnProperty("hideMark")&&(u.hideMark=d.hideMark),o.postMessage(u,"*")}}}getHistoryObjs(e){this.initStatusObj(),this.answerService.apiAnswerGetHistoryObjsGet(this.homeworkHashId,e).subscribe(o=>{1==o.success?this.historyAnswerObjs=o.data?.objs??new Array:this.errorMessage=o.message??"",this.stopStatusObj()})}getDataHistory(e){this.historyId=e,this.errorMessage="",this.countLoad=1,this.answerService.apiAnswerGetHistoryObjGet(this.homeworkHashId,this.answerId,parseInt(e,10)).subscribe(o=>{if(1==o.success){if(o.data){if(this.zipDataService.convertSubmittedAnswersHistoryObj(o.data?.answerObj),this.result=o.data,this.markedByObj=o.data?.markedByObj,this.score=o.data?.answerObj?.point??0,this.files=this.commonService.myParseJson(o.data?.answerObj?.files??"")??[],null!=this.files)for(let n=0;n<this.files.length;n++)this.files[n].url=this.cdnService.getMyCdn(this.files?.[n].url??""),this.files[n].thumb=this.cdnService.getMyCdn(this.files?.[n].thumb??"");this.handleJsonData(),this.hasLoadedData=!0,1==this.countLoad&&(this.hasSendDataToIframe=!1),0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToIframeHistory())}this.successStatusObj(),this.countLoad++}else this.errorMessage=o.message??"",this.stopStatusObj()})}handleJsonData(){if(this.jsonData={},!this.result?.answerObj?.confirmedAt&&!this.result?.answerObj?.result&&(this.isMarked=!1),this.result.answerObj?.confirmedAt){this.isMarked=!0;var e=this.commonService.myParseJson(this.result.answerObj?.result??"");e&&(this.jsonData=e,null==this.jsonData&&(this.isMarked=!1))}}getData(e){this.initStatusObj(),this.errorMessage="",this.answerId=e,this.answerService.apiAnswerGetObjGet(this.homeworkHashId,e).subscribe(o=>{if(1==o.success)if(this.zipDataService.convertSubmittedAnswersObj(o.data?.answerObj),o.data?.hasOwnProperty("studentObj")&&null!=o.data?.studentObj){if(this.result=o.data,this.markedByObj=o.data.markedByObj,this.score=o.data?.answerObj?.point??0,this.homeworkID=o.data.homeworkObj?.id??0,this.classID=o.data.classroomObj?.id??0,this.files=this.commonService.myParseJson(o.data.answerObj?.files??"")??[],this.studentObj=o.data.studentObj,this.classroomObj=o.data.classroomObj??{},null!=this.files)for(let n=0;n<this.files.length;n++)this.files[n].url=this.cdnService.getMyCdn(this.files?.[n].url??""),this.files[n].thumb=this.cdnService.getMyCdn(this.files?.[n].thumb??"");this.homeworkObj=o.data.homeworkObj??{},this.studentName=o.data.studentObj.fullName??"",this.handleJsonData(),this.hasLoadedData=!0,0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToIframe()),this.successStatusObj()}else this.errorMessage="lang_core_not_found_student",this.stopStatusObj();else this.errorMessage=o.message??"",this.stopStatusObj()})}openDialog(e,o){this.dialog.open(St,{width:"280px",autoFocus:!1,data:{score:o,status:e,homeWorkID:this.homeworkID,homeworkHashId:this.homeworkHashId,classID:this.classID,backToLink:this.backToLink},restoreFocus:!1}).afterClosed().subscribe(s=>{})}handleOpenReSubmit(){null!=this.homeworkObj&&this.openDialogReSubmit(!0,this.homeworkObj.deadline,this.homeworkObj,this.answerId,this.studentName)}openDialogReSubmit(e,o,n,s,a){let c={status:e,deadline:o,itemHomework:n,ans_id:s,name:a,redirect:!0,classID:this.useNewDashboard?this.homeworkObj?.categoryId:this.classID};this.dialog.open(Ct,{width:"380px",panelClass:"cleanResultDialogBox",data:c,restoreFocus:!1}).afterClosed().subscribe(l=>{if(l&&l.result&&l.isRedirect){let u="?backto="+encodeURIComponent("/admin/testbank/document-management/1/"+c.classID+"/1");this.commonService.myNavigationWithQueryString("/admin/testbank/homework-results-list/"+c.classID+"/"+c.itemHomework.id+"/"+this.homeworkHashId,u)}})}remark(e,o,n){let s=JSON.stringify({type:"homework",id:this.homeworkObj?.id,user:this.homeworkObj?.tenantId});if(""==this.historyId)if(1==this.permissionService.hasMarkPointPermission("homework",this.homeworkObj?.permissionObj)){let a={id:e,comment:n.comment,hideMark:n.hideMark?1:0,point:o?parseFloat(o.replace(",",".")):0,result:this.zipDataService.convertContentGzip(JSON.stringify(n)),homeworkHashId:this.homeworkHashId};this.answerService.apiAnswerSaveResultPost(s,a).subscribe(c=>{1==c.success?(this.openDialog(!0,c.data?.obj?.point),this.successStatusObj()):(this.stopStatusObj(),this.showErrorSnack("lang_cms_mark_fail"))})}else this.showErrorSnack("lang_cms_no_permission_on_homework"),this.stopStatusObj();else this.stopStatusObj(),this.showErrorSnack("lang_cms_cannot_remark_student_history_result")}goBack(){this.backToLink?this.backToLink.includes("shareType")?this.commonService.myNavigationBySpecialQueryString(this.backToLink):this.commonService.myNavigation(this.backToLink):this.commonService.myNavigation(this.useNewDashboard?"/admin/testbank/homework-results-list/"+(this.homeworkObj?.categoryId??"0")+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId:"/admin/testbank/homework-results-list/"+this.classID+"/"+this.homeworkID+"/"+this.homeworkObj?.hashId);let e=document.body,o=document.getElementById("azota-app-html");o?.classList.remove("overflow-hidden"),o?.classList.remove("height-100"),e.classList.remove("overflow-hidden"),e.classList.remove("height-100")}ngOnInit(){let e=document.body,o=document.getElementById("azota-app-html");o?.classList.add("overflow-hidden"),o?.classList.add("height-100"),e.classList.add("overflow-hidden"),e.classList.add("height-100"),this.iframeSrc=this.envService.getEnvValue("classliveUrl")??"";const n=this.commonService.getMyParam(this.activeRoute,"id")?Number(this.commonService.getMyParam(this.activeRoute,"id")):0,s=this.commonService.getMyParam(this.activeRoute,"historyId")??"";this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"";let a=this.commonService.getMyQueryParam("backto");this.backToLink=a?a.includes("shareType")?decodeURIComponent(a):a:"",this.getData(n),this.getHistoryObjs(n),s&&this.getDataHistory(s),this.commonService.translateMetaData({title:"lang_cms_homework_mark_exercise_title",description:"lang_cms_homework_mark_exercise_description",image:"lang_cms_test_image"}),super.ngOnInit()}ngAfterViewInit(){window.addEventListener("message",this.handleIframe)}constructor(e,o,n,s,a,c,d,l,u){super(),this.activeRoute=e,this.answerService=o,this.baseApiService=n,this.permissionService=s,this.dialog=a,this.cdnService=c,this.zipDataService=d,this.envService=l,this.apiUploadService=u,this.subscriptions=new et.w0,this.answerId=0,this.homeworkID="",this.historyId="",this.iframeSrc="",this.isMarked=!1,this.jsonData={},this.errorMessage="",this.files=[],this.classID="",this.studentName="",this.score=0,this.mnoteJsonData={},this.pagesCount=0,this.backToLink="",this.hasSendDataToIframe=!1,this.hasLoadedData=!1,this.historyAnswerObjs=[],this.countLoad=1,this.homeworkHashId="",this.useNewDashboard=!1,this.handleIframe=p=>{"MNoteJson"==p.data.cmd&&(this.initStatusObj(),this.mnoteJsonData=p.data.data,this.uploadAll(this.mnoteJsonData.pages??[],p.data.data.point)),"MNoteReSubmit"==p.data.cmd&&(console.log("Listen res submit"),this.handleOpenReSubmit()),"MNoteLoadComplete"==p.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,""==this.historyId?this.sendDataToIframe():this.sendDataToIframeHistory()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(P.gz),t.Y36(J.P6),t.Y36(Ot._),t.Y36(Tt.$),t.Y36(S.uw),t.Y36(ct.U),t.Y36(G.D),t.Y36(At.D),t.Y36(st.$))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-mark-exericse"]],hostBindings:function(e,o){1&e&&t.NdJ("popstate",function(s){return o.onPopState(s)},!1,t.Jf7)},features:[t.qOj],decls:22,vars:13,consts:[["id","markContainer",1,"maxW1000"],["id","titleRow"],[1,"block-left"],["azt-track-service","mark-exercise-bqS4xx4zrp","mat-button","",3,"title","click"],["mat-icon-button","",3,"matTooltip","matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],[1,"dropdown-menu","w-56","show","relative"],[1,"dropdown-content"],["azt-track-service","mark-exercise-7krhNQm3da",1,"dropdown-item","w-full",3,"click"],[4,"ngFor","ngForOf"],["class","studentInfo","style","padding-right: 10px; color: #fff",4,"ngIf"],[3,"customText",4,"ngIf"],[3,"hidden"],[4,"ngIf"],["class","card-box listPhotos",4,"ngIf"],["mat-icon-button","",3,"matTooltip","matMenuTriggerFor"],["azt-track-service","mark-exercise-5mJpoIUV_A",1,"dropdown-item","w-full",3,"click"],[1,"studentInfo",2,"padding-right","10px","color","#fff"],[2,"cursor","pointer",3,"matTooltip","nameCreateAvatar","size","linkAvatar"],[3,"customText"],[1,"row","justify-content-center","py-5"],[1,"col-12","text-center"],[1,"alert","alert-danger"],[1,"card-box","listPhotos"],["id","mNote","frameborder","0",2,"width","100%","height","100%",3,"src"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-icon",3),t.NdJ("click",function(){return o.goBack()}),t.ALo(4,"mytranslate"),t._uU(5,"keyboard_arrow_left"),t.qZA(),t.YNc(6,Mo,4,4,"button",4),t.TgZ(7,"mat-menu",null,5)(9,"div",6)(10,"ul",7)(11,"li")(12,"button",8),t.NdJ("click",function(){return o.reloadPage()}),t.TgZ(13,"span"),t._uU(14),t.ALo(15,"mytranslate"),t.qZA()()(),t.YNc(16,Zo,6,7,"li",9),t.qZA()()()(),t.YNc(17,Do,3,3,"h4",10),t.qZA(),t.YNc(18,Eo,2,3,"azt-loading-effect",11),t.TgZ(19,"div",12),t.YNc(20,No,6,3,"div",13),t.YNc(21,Lo,3,3,"div",14),t.qZA()()),2&e&&(t.xp6(3),t.s9C("title",t.lcZ(4,9,"lang_buttom_back")),t.xp6(3),t.Q6J("ngIf",null!=o.historyAnswerObjs&&o.historyAnswerObjs.length>0),t.xp6(8),t.Oqu(t.lcZ(15,11,"lang_homework_mark_exercise_last")),t.xp6(2),t.Q6J("ngForOf",o.historyAnswerObjs),t.xp6(1),t.Q6J("ngIf",o.classroomObj),t.xp6(1),t.Q6J("ngIf",o.statusObj.loading),t.xp6(1),t.Q6J("hidden",o.statusObj.loading),t.xp6(1),t.Q6J("ngIf",""!=o.errorMessage),t.xp6(1),t.Q6J("ngIf",""==o.errorMessage))},dependencies:[k.sg,k.O5,Po.RK,W.Hw,Pt.VK,Pt.p6,pt.gM,X.Q,jt.g,j.bT,j.yl,j.tO],styles:["#markContainer[_ngcontent-%COMP%]{position:relative}  .studentInfo img{display:inline-flex!important}#titleRow[_ngcontent-%COMP%]{background-color:#00a7d0;height:40px;position:relative;align-items:center;display:flex;justify-content:space-between;color:#fff}#titleRow[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}#titleRow[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-bottom:0;font-weight:500;font-size:16px;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;display:-webkit-box}#titleRow[_ngcontent-%COMP%]   .score[_ngcontent-%COMP%]{margin-right:5px}.block-left[_ngcontent-%COMP%]{display:flex;align-items:center}button[_ngcontent-%COMP%]{border:none}.listPhotos[_ngcontent-%COMP%]{width:100%;position:fixed;top:40px;bottom:0}.file[_ngcontent-%COMP%]{border-width:0px;background:inherit;background-color:#f2f2f2;box-sizing:border-box;border-width:1px;border-style:solid;border-color:#e5e5e5;border-left:0px;border-right:0px;border-radius:0;box-shadow:none}.file[_ngcontent-%COMP%]:first-child{margin-top:52px}.file[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.back[_ngcontent-%COMP%]{padding:15px 10px}.back-to[_ngcontent-%COMP%]{color:#fff;display:flex}.back-to[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-bottom:10px}.block[_ngcontent-%COMP%]{padding-top:2px}.mat-expansion-indicator[_ngcontent-%COMP%]:after{color:#fff!important}.add-click[_ngcontent-%COMP%]{display:flex}.add-icon[_ngcontent-%COMP%]{margin-top:5px}.file-custom[_ngcontent-%COMP%]{margin-top:6px}.description__share[_ngcontent-%COMP%]{margin-top:10px}.description__share[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#fff;color:#666;margin-right:15px;padding:5px 10px 0}.row-check[_ngcontent-%COMP%]{border-bottom:1px solid #eee;padding:10px 0}.col-check[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:5px}.exercise[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:25px 0 15px;border-bottom:1px solid #eee}.btn-custom[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff;border-radius:5px;padding:10px 25px}.files-custom[_ngcontent-%COMP%]{margin:0}.btn-share[_ngcontent-%COMP%]{border:1px solid #eee}.score-exercise[_ngcontent-%COMP%]{background-color:#ea3d19;border-radius:50%;padding:3px 5px 3px 7px;color:#fff;font-weight:600;margin:0 10px}#listNumber[_ngcontent-%COMP%]{display:contents}#markNumber[_ngcontent-%COMP%]{position:absolute;top:40px;right:50%;z-index:9;margin-right:-60px;color:#fff;text-transform:uppercase;width:120px}@media (min-width: 1000px){.mark-edit[_ngcontent-%COMP%]{width:250px}.file[_ngcontent-%COMP%]:first-child{margin-top:0}.listPhotos[_ngcontent-%COMP%]{width:1000px}}"]}),i})();var Ho=m(87384);const Bo=[{path:"",component:(()=>{class i extends E.Q{ngOnInit(){super.ngOnInit()}constructor(e){super(),this.commonService=e}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(Ho.v))},i.\u0275cmp=t.Xpm({type:i,selectors:[["homework-master-page"]],features:[t.qOj],decls:2,vars:0,consts:[["id","homework-layout"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"router-outlet"),t.qZA())},dependencies:[P.lC],encapsulation:2}),i})(),canActivate:[O.v],children:[{path:"add-new-homework/:cat_id",component:ee},{path:"mark-exercise/:id/:hash_id",component:Uo},{path:"switch-mark-exercise/:id/:hash_id",component:(()=>{class i extends E.Q{getData(e){this.initStatusObj(),this.answerService.apiAnswerGetObjGet(this.homeworkHashId,e).subscribe(o=>{if(1==o.success)if(this.zipDataService.convertSubmittedAnswersObj(o.data?.answerObj),null!=o.data?.studentObj){const n=o.data,s=parseInt(this.classliveUrl.split("?")[1].split("=")[1]),a=1e6;n.answerObj?.result?(n.answerObj?.result??"").includes("urlDataMark")?this.commonService.myNavigationWithQueryString(`/admin/homework/mark-exercise-new/${n.answerObj?.id}/${this.homeworkHashId}`,`?backto=${encodeURIComponent(this.backToLink)}`):this.commonService.myNavigationWithQueryString(`/admin/homework/mark-exercise/${n.answerObj?.id}/${this.homeworkHashId}`,`?backto=${encodeURIComponent(this.backToLink)}`):this.commonService.myNavigationWithQueryString(s>a?`/admin/homework/mark-exercise-new/${n.answerObj?.id}/${this.homeworkHashId}`:`/admin/homework/mark-exercise/${n.answerObj?.id}/${this.homeworkHashId}`,`?backto=${encodeURIComponent(this.backToLink)}`),this.successStatusObj()}else this.stopStatusObj();else this.stopStatusObj()})}ngOnInit(){this.classliveUrl=this.envService.getEnvValue("classliveUrl")??"",this.homeworkHashId=this.commonService.getMyParam(this.activeRoute,"hash_id")??"";const e=this.commonService.getMyParam(this.activeRoute,"id")?Number(this.commonService.getMyParam(this.activeRoute,"id")):0;let o=this.commonService.getMyQueryParam("backto");this.backToLink=o?o.includes("shareType")?decodeURIComponent(o):o:"",this.getData(e),super.ngOnInit()}constructor(e,o,n,s,a,c){super(),this.activeRoute=e,this.answerService=o,this.dialog=n,this.zipDataService=s,this.vcRef=a,this.envService=c,this.homeworkHashId="",this.backToLink="",this.classliveUrl=""}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(P.gz),t.Y36(J.P6),t.Y36(S.uw),t.Y36(G.D),t.Y36(t.s_b),t.Y36(At.D))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-mark-exercise-new"]],features:[t.qOj],decls:0,vars:0,template:function(e,o){},encapsulation:2}),i})()},{path:"mark-exercise-new/:id/:hash_id",component:Ao},{path:"export-homework/:class_id/:id/:hash_id",component:_o},{path:"content-store",component:ke}]}];let Ro=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[P.Bz.forChild(Bo),P.Bz,v.fQ]}),i})(),Fo=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[x.kb,P.Bz,k.ez,f.j,R.Z_,Ro,g.u5,g.UX,S.Is,h.Z,q.xC,Q.W,_.d,w.k,M.qyJ.pick(M.ciZ)]}),i})()}}]);