"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[510],{91350:(ot,G,c)=>{c.d(G,{Q:()=>p});var Z=c(55330),r=c(94650),L=c(36895),R=c(1256),d=c(1033);function _(g,b){if(1&g&&(r.O4$(),r.kcU(),r._UZ(0,"mat-progress-bar",10)),2&g){const w=r.oxw();r.Q6J("value",w.progress_value)}}function D(g,b){if(1&g&&(r.O4$(),r.kcU(),r.TgZ(0,"div",11),r._uU(1),r.qZA()),2&g){const w=r.oxw();r.xp6(1),r.Oqu(w.getMsg())}}function A(g,b){if(1&g){const w=r.EpF();r.O4$(),r.kcU(),r.TgZ(0,"div",12),r._uU(1),r.ALo(2,"mytranslate"),r.TgZ(3,"a",13),r.NdJ("click",function(){r.CHM(w);const j=r.oxw();return r.KtG(j.isShowErrorsBox=!j.isShowErrorsBox)}),r._uU(4),r.ALo(5,"mytranslate"),r.ALo(6,"mytranslate"),r.qZA()()}if(2&g){const w=r.oxw();r.xp6(1),r.hij(" ",r.lcZ(2,2,"lang_auto_da_xay_ra_loi_trong_qua_trinh_trao_doi_du_lieu_")," "),r.xp6(3),r.hij(" ",w.isShowErrorsBox?r.lcZ(5,4,"lang_auto_an_chi_tiet"):r.lcZ(6,6,"lang_auto_xem_chi_tiet")," ")}}function q(g,b){if(1&g&&(r.O4$(),r.kcU(),r.TgZ(0,"div",12),r._uU(1),r.qZA()),2&g){const w=r.oxw();r.xp6(1),r.hij(" ",w.LogErrorsRequest," ")}}function v(g,b){if(1&g&&(r.O4$(),r.kcU(),r.TgZ(0,"div",14),r._uU(1),r.ALo(2,"mytranslate"),r.qZA()),2&g){const w=r.oxw();r.xp6(1),r.Oqu(w.customText?w.customText:r.lcZ(2,1,"lang_auto_dang_tai_du_lieu")+"...")}}let p=(()=>{class g extends Z.Q{constructor(){super(...arguments),this.progress_value=-1,this.LogErrorsRequest=!1,this.customText="",this.isShowErrorsBox=!1}getMsg(){var w,S;let j="";return 100==this.progress_value||0==this.progress_value?(j=null!==(w=this.commonService.myTranslateInstant("lang_auto_dang_xu_ly"))&&void 0!==w?w:"",`${j} ...`):(j=null!==(S=this.commonService.myTranslateInstant("lang_auto_dang_tai_tep_tin_len_he_thong"))&&void 0!==S?S:"",`${j}... ${this.progress_value} %`)}}return g.\u0275fac=function(){let b;return function(S){return(b||(b=r.n5z(g)))(S||g)}}(),g.\u0275cmp=r.Xpm({type:g,selectors:[["azt-loading-effect"]],inputs:{progress_value:"progress_value",LogErrorsRequest:"LogErrorsRequest",customText:"customText"},features:[r.qOj],decls:12,vars:5,consts:[[1,"box-loading","h-full"],[1,"text-center","py-4"],["version","1.1","id","jobing-j-drawit","id","Layer_1","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","x","0px","y","0px","viewBox","0 0 109 92.9",0,"xml","space","preserve",1,"w-12","mx-auto",2,"enable-background","new 0 0 109 92.9"],["d","M90.8,52c3.5,6.2,7.1,11.7,9.8,17.7c4.4,9.7-2.9,20.7-13.8,20.9c-11.8,0.2-23.7,0.2-35.5,0 c-11-0.1-17.6-12.2-12-21.7c0.4-0.8,1.8-1.4,2.7-1.4c9.9-0.1,19.7-0.1,29.6-0.1c9.8,0,15.9-4.6,18.7-14C90.4,53.2,90.5,52.9,90.8,52 z",1,"azt-svg-loading","jobing-j"],["d","M39.6,90.3c-6.8,0-13.8,0.8-20.5-0.2c-9.7-1.4-15-12.8-10.3-21.3c5.9-10.9,12.1-21.6,18.5-32.2 c5.5-9,18.6-8.7,24.2,0.2c0.7,1.1,0.8,1.9,0.1,3.1C46.7,48.3,42,57,36.8,65.3c-5.3,8.4-3.8,18.8,2.5,24.6 C39.5,89.9,39.5,90.2,39.6,90.3z",1,"azt-svg-loading","jobing-j"],["d","M32.5,27.3c3.3-5.7,6.1-11,9.4-16c5.9-9.1,19.4-9.2,25.1,0c6.5,10.4,12.6,21,18.3,31.7 c4.8,9-1.5,19.9-11.5,20.7c-1.6,0.1-2.6-0.2-3.5-1.8c-4.8-8.6-9.8-17.1-14.7-25.6c-4.7-8.3-12.5-11.6-21.7-9.2 C33.6,27.1,33.3,27.1,32.5,27.3z",1,"azt-svg-loading","jobing-j"],["style","margin-bottom: 30px; border-radius: 5px","mode","buffer",3,"value",4,"ngIf"],["class","note text-center font-weight-bold",4,"ngIf","ngIfElse"],["class","alert alert-danger mt-3","role","alert",4,"ngIf"],["notLoading",""],["mode","buffer",2,"margin-bottom","30px","border-radius","5px",3,"value"],[1,"note","text-center","font-weight-bold"],["role","alert",1,"alert","alert-danger","mt-3"],["azt-track-service","loading-effect-5TYv52U-wgq","href","javscript:void(0)",3,"click"],[1,"note","text-center","font-medium"]],template:function(w,S){if(1&w&&(r.TgZ(0,"div",0)(1,"div",1),r.O4$(),r.TgZ(2,"svg",2),r._UZ(3,"path",3)(4,"path",4)(5,"path",5),r.qZA()(),r.YNc(6,_,1,1,"mat-progress-bar",6),r.YNc(7,D,2,1,"div",7),r.YNc(8,A,7,8,"div",8),r.YNc(9,q,2,1,"div",8),r.YNc(10,v,3,3,"ng-template",null,9,r.W1O),r.qZA()),2&w){const j=r.MAs(11);r.xp6(6),r.Q6J("ngIf",-1!=S.progress_value),r.xp6(1),r.Q6J("ngIf",-1!=S.progress_value)("ngIfElse",j),r.xp6(1),r.Q6J("ngIf",!1!==S.LogErrorsRequest),r.xp6(1),r.Q6J("ngIf",S.isShowErrorsBox)}},dependencies:[L.O5,R.eI,d.bT],encapsulation:2}),g})()},44944:(ot,G,c)=>{c.d(G,{Y:()=>r});var Z=c(94650);let r=(()=>{class L{constructor(d){this.el=d,this.hasDecimalPoint=!1,this.hasNegativeSign=!1,this.navigationKeys=["Backspace","Delete","Tab","Escape","Enter","Home","End","ArrowLeft","ArrowRight","Clear","Copy","Paste"],this.decimal=!1,this.decimalSeparator1=".",this.decimalSeparator2=",",this.allowNegatives=!1,this.allowPaste=!0,this.negativeSign="-",this.min=-1/0,this.max=1/0,this.regex=null,this.inputElement=d.nativeElement}ngOnChanges(d){if(d.pattern&&(this.regex=this.pattern?RegExp(this.pattern):null),d.min){const _=Number(this.min);this.min=isNaN(_)?-1/0:_}if(d.max){const _=Number(this.max);this.max=isNaN(_)?1/0:_}}onBeforeInput(d){if(isNaN(Number(d.data))){if(d.data===this.decimalSeparator1||d.data===this.decimalSeparator2||d.data===this.negativeSign&&this.allowNegatives)return;d.preventDefault(),d.stopPropagation()}}onKeyDown(d){if(this.navigationKeys.indexOf(d.key)>-1||("a"===d.key||"KeyA"===d.code)&&!0===d.ctrlKey||("c"===d.key||"KeyC"===d.code)&&!0===d.ctrlKey||("v"===d.key||"KeyV"===d.code)&&!0===d.ctrlKey||("x"===d.key||"KeyX"===d.code)&&!0===d.ctrlKey||("a"===d.key||"KeyA"===d.code)&&!0===d.metaKey||("c"===d.key||"KeyC"===d.code)&&!0===d.metaKey||("v"===d.key||"KeyV"===d.code)&&!0===d.metaKey||("x"===d.key||"KeyX"===d.code)&&!0===d.metaKey)return;let _="";var D=d.key;if(d.key===this.decimalSeparator2&&(D=this.decimalSeparator1),this.decimal&&D===this.decimalSeparator1)return _=this.forecastValue(D),_.split(this.decimalSeparator1).length>2||(this.hasDecimalPoint=_.indexOf(this.decimalSeparator1)>-1,this.setNewValue(D)),void d.preventDefault();if(D===this.negativeSign&&this.allowNegatives)return _=this.forecastValue(D),_.charAt(0)!==this.negativeSign||_.split(this.negativeSign).length>2?void d.preventDefault():void(this.hasNegativeSign=_.split(this.negativeSign).length>-1);if(" "===D||isNaN(Number(D)))return void d.preventDefault();if(_=_||this.forecastValue(D),this.regex&&!this.regex.test(_))return void d.preventDefault();const A=Number(_);(A>this.max||A<this.min)&&d.preventDefault()}onPaste(d){if(!0===this.allowPaste){let _="";window.clipboardData?_=window.clipboardData.getData("text"):d.clipboardData&&d.clipboardData.getData&&(_=d.clipboardData.getData("text/plain")),this.pasteData(_),d.preventDefault()}else d.preventDefault(),d.stopPropagation()}onDrop(d){var _,D;const A=null!==(D=null===(_=d.dataTransfer)||void 0===_?void 0:_.getData("text"))&&void 0!==D?D:"";this.inputElement.focus(),this.pasteData(A),d.preventDefault()}pasteData(d){d=d.replace(",",".");const _=this.sanitizeInput(d);if(!_.includes(this.negativeSign)||!this.hasNegativeSign||this.getSelection().includes(this.negativeSign)){if(!document.execCommand("insertText",!1,_))if(this.inputElement.setRangeText){const{selectionStart:A,selectionEnd:q}=this.inputElement;this.inputElement.setRangeText(_,A??0,q??0,"end"),typeof window.InstallTrigger<"u"&&this.inputElement.dispatchEvent(new Event("input",{cancelable:!0}))}else this.insertAtCursor(this.inputElement,_);this.decimal&&(this.hasDecimalPoint=this.inputElement.value.indexOf(this.decimalSeparator1)>-1),this.hasNegativeSign=this.inputElement.value.indexOf(this.negativeSign)>-1}}setNewValue(d){d=d.replace(",","."),this.insertAtCursor(this.inputElement,d),this.decimal&&(this.hasDecimalPoint=this.inputElement.value.indexOf(this.decimalSeparator1)>-1),this.hasNegativeSign=this.inputElement.value.indexOf(this.negativeSign)>-1}insertAtCursor(d,_){var D,A;const q=null!==(D=d.selectionStart)&&void 0!==D?D:0,v=null!==(A=d.selectionEnd)&&void 0!==A?A:0;d.value=d.value.substring(0,q)+_+d.value.substring(v,d.value.length);const p=q+_.length;d.focus(),d.setSelectionRange(p,p),this.triggerEvent(d,"input")}triggerEvent(d,_){if("createEvent"in document){const D=document.createEvent("HTMLEvents");D.initEvent(_,!1,!0),d.dispatchEvent(D)}}sanitizeInput(d){let D,_="";D=this.decimal&&this.isValidDecimal(d)?new RegExp(`${this.getNegativeSignRegExp()}[^0-9${this.decimalSeparator1}]`,"g"):new RegExp(`${this.getNegativeSignRegExp()}[^0-9]`,"g"),_=d.replace(D,"");const A=this.inputElement.maxLength;if(A>0){const q=A-this.inputElement.value.length+(_.includes(`${this.negativeSign}`)?1:0);_=q>0?_.substring(0,q):""}return _}getNegativeSignRegExp(){return!this.allowNegatives||this.hasNegativeSign&&!this.getSelection().includes(this.negativeSign)?"":`(?!^${this.negativeSign})`}isValidDecimal(d){if(this.hasDecimalPoint){const _=this.getSelection();return _&&_.indexOf(this.decimalSeparator1)>-1?d.split(this.decimalSeparator1).length<=2:d.indexOf(this.decimalSeparator1)<0}return d.split(this.decimalSeparator1).length<=2}getSelection(){var d,_;return this.inputElement.value.substring(null!==(d=this.inputElement.selectionStart)&&void 0!==d?d:0,null!==(_=this.inputElement.selectionEnd)&&void 0!==_?_:0)}forecastValue(d){var _,D;const A=null!==(_=this.inputElement.selectionStart)&&void 0!==_?_:0,q=null!==(D=this.inputElement.selectionEnd)&&void 0!==D?D:0,v=this.inputElement.value;return v.substring(0,A)+d+v.substring(q)}}return L.\u0275fac=function(d){return new(d||L)(Z.Y36(Z.SBq))},L.\u0275dir=Z.lG2({type:L,selectors:[["","appOnlyNumber",""]],hostBindings:function(d,_){1&d&&Z.NdJ("beforeinput",function(A){return _.onBeforeInput(A)})("keydown",function(A){return _.onKeyDown(A)})("paste",function(A){return _.onPaste(A)})("drop",function(A){return _.onDrop(A)})},inputs:{decimal:"decimal",decimalSeparator1:"decimalSeparator1",decimalSeparator2:"decimalSeparator2",allowNegatives:"allowNegatives",allowPaste:"allowPaste",negativeSign:"negativeSign",min:"min",max:"max",pattern:"pattern"},features:[Z.TTD]}),L})()},10731:(ot,G,c)=>{c.d(G,{x:()=>Z});class Z{constructor(){this.answerConfigParse=[],this.questionContentParse=[],this.answerLabelsMockup={}}}},296:(ot,G,c)=>{c.d(G,{S:()=>A});var Z=c(70655),r=c(10731),L=c(94650),R=c(51009),d=c(15043),_=c(90893),D=c(20814);let A=(()=>{class q{processEssayResultToBase64(p){var g,b,w,S,j;return(0,Z.mG)(this,void 0,void 0,function*(){for(const T of null!==(g=p.pages)&&void 0!==g?g:[]){if(T.draw){this.cdnService.isViettelCDN(null!==(w=null===(b=p.pages)||void 0===b?void 0:b[0].backgroundImage)&&void 0!==w?w:"")&&(yield this.exportPdfUtilsService.asyncTimeout(500));const Y=yield this.exportPdfUtilsService.convertAndRetryToBase64(T.draw);T.draw=Y}if(this.cdnService.isViettelCDN(null!==(j=null===(S=p.pages)||void 0===S?void 0:S[0].backgroundImage)&&void 0!==j?j:"")&&(yield this.exportPdfUtilsService.asyncTimeout(500)),T.backgroundImage){const Y=yield this.exportPdfUtilsService.convertAndRetryToBase64(T.backgroundImage);T.backgroundImage=Y}}if(p.commentEmoji&&p.commentEmoji.length){let T="https://azota889.github.io/storage_public/mnote/",Y=p.commentEmoji.length;for(let Q=0;Q<Y;Q++){let K=T+p.commentEmoji[Q];const et=yield this.exportPdfUtilsService.convertAndRetryToBase64(K);p.commentEmoji[Q]=et}}return p})}processGroupImagesToBase64(p,g){var b,w,S;return(0,Z.mG)(this,void 0,void 0,function*(){if(p&&null!==(b=p?.[0].name)&&void 0!==b&&b.startsWith("[PDFv2]"))for(const j of p)if(p[0].questionContentParse&&this.cdnService.isViettelCDN(null!==(w=p[0].questionContentParse[0].groupUrl)&&void 0!==w?w:"")&&(yield this.exportPdfUtilsService.asyncTimeout(500)),j.questionContentParse&&j.questionContentParse[0].groupUrl&&g.includes(null!==(S=j.indexLabel)&&void 0!==S?S:-1)){const T=yield this.exportPdfUtilsService.convertAndRetryToBase64(j.questionContentParse[0].groupUrl);j.questionContentParse[0].groupUrl=T}})}processQuestionImagesToBase64(p){var g,b,w,S;return(0,Z.mG)(this,void 0,void 0,function*(){if(1==p[0].isImage)for(const j of p){this.cdnService.isViettelCDN(null!==(b=null===(g=p[0].questionContentParse)||void 0===g?void 0:g[0].url)&&void 0!==b?b:"")&&(yield this.exportPdfUtilsService.asyncTimeout(500));const T=yield this.exportPdfUtilsService.convertAndRetryToBase64(null!==(S=null===(w=j.questionContentParse)||void 0===w?void 0:w[0].url)&&void 0!==S?S:"");j.questionContentParse&&(j.questionContentParse[0].url=T)}})}processQuestionDocxContentToBase64(p){var g,b,w,S;return(0,Z.mG)(this,void 0,void 0,function*(){if(0==p[0].isImage)for(const T of p){var j=this.exportPdfUtilsService.findImageSrcInContent(null!==(b=null===(g=T.questionContentParse)||void 0===g?void 0:g[0].content)&&void 0!==b?b:"");if(this.cdnService.isViettelCDN(j)&&(yield this.exportPdfUtilsService.asyncTimeout(500)),j&&!j.includes(";base64")){const Y=yield this.exportPdfUtilsService.convertAndRetryToBase64(j);null!==(S=null===(w=T.questionContentParse)||void 0===w?void 0:w[0].content)&&void 0!==S&&S.includes("img")&&Y&&(T.questionContentParse[0].content=T.questionContentParse[0].content.replace(j,Y))}}})}convertAnswersArr(p,g){0!=p.length&&p.forEach(b=>{b.QuestionId&&b.AnswerContent&&b.AnswerContent[0]&&b.AnswerContent[0].Content&&(g[`id_${b.QuestionId}`]=b.AnswerContent[0].Content)})}parseQuestionsFor_PDFv2(p,g){var b,w;let S=this.commonService.castJsonToClassObjs(r.x,JSON.stringify(null===(b=g.data)||void 0===b?void 0:b.questionObjs));p=this.customQuestionAnswerConfig.changeQuestionContent(S??[],!0);for(let j=0;j<p.length;j++)p[j].indexLabel=j,p[j].correctAnswer=this.commonService.filterArray(null===(w=g.data)||void 0===w?void 0:w.correctQuestionIds,p[j].id);return p}findScaleDirection(p,g){return p/g>=.7070707070707071?"w":"h"}constructor(p,g,b,w){this.commonService=p,this.cdnService=g,this.customQuestionAnswerConfig=b,this.exportPdfUtilsService=w}}return q.\u0275fac=function(p){return new(p||q)(L.LFG(R.v),L.LFG(d.U),L.LFG(_.U),L.LFG(D.V))},q.\u0275prov=L.Yz7({token:q,factory:q.\u0275fac,providedIn:"root"}),q})()},20814:(ot,G,c)=>{c.d(G,{V:()=>D});var Z=c(70655),r=c(94650),L=c(51009),R=c(15043),d=c(88161),_=(()=>{return(A=_||(_={}))[A.Cdn=0]="Cdn",A[A.CdnTimestamp=1]="CdnTimestamp",A[A.Rawlink=2]="Rawlink",A[A.RawlinkTimestamp=3]="RawlinkTimestamp",_;var A})();let D=(()=>{class A{get blockCropItemClass(){return"__CANVAS_CROP_ITEM"}get blockEssayCropItemClass(){return"_ESSAY"}isSupportedBrowser(){let v=this.commonService.getBrowserType().toString();return!(!["chrome"].includes(v.split(" ")[0].toLowerCase())||parseInt(v.split(" ")[1],10)<80)}getExtensionFile(v){if(!v)return"";var p=v.split(".");return p.length<=1?"":p[p.length-1].toLocaleLowerCase().split("_")[0]}translateMetaTitle(v){var p,g,b,w;let S="Export PDF: ";this.commonService.translateMetaData({title:S+(null===(g=null===(p=v.data)||void 0===p?void 0:p.examObj)||void 0===g?void 0:g.name),description:S+(null===(w=null===(b=v.data)||void 0===b?void 0:b.examObj)||void 0===w?void 0:w.name),image:"lang_cms_test_image"})}findImageSrcInContent(v){var p="";if(v.includes("img")){var g=v.indexOf("img"),b=v.indexOf("src=",g),w=v.indexOf('"',Number(b)+5);p=v.substring(Number(b)+5,Number(w))}return p}asyncTimeout(v){return(0,Z.mG)(this,void 0,void 0,function*(){return`Waited ${yield new Promise(g=>{setTimeout(()=>g(v),v)})} miliseconds`})}parseEssayMarkResult(v,p,g){var b;let w=v.filter(T=>this.answerTypeService.isEssayAnswer(T.answerType));if(0!=w.length){if(p&&p.essayResult){var S=this.commonService.willDeleteParseJson(p.essayResult);if(S){var j=Object.entries(S);for(let T=0;T<w.length;T++)w[T].essayMarkParsed=j[T][1]}}for(let T=0;T<w.length;T++){let Y=w[T].id,Q=g.filter(et=>et.questionId==Y)[0],K=this.commonService.willDeleteParseJson(null!==(b=Q.config)&&void 0!==b?b:"");w[T].scorePerQuestion=K?Number(K.ScorePerQuestion):0}}}convertToBase64(v,p){return(0,Z.mG)(this,void 0,void 0,function*(){let g=v;switch(p){case _.Cdn:g=this.cdnService.getMyCdn(v);break;case _.CdnTimestamp:g=this.cdnService.getMyCdn(v)+"?t="+Date.now();break;case _.RawlinkTimestamp:g=v+"?t="+Date.now()}const w=yield(yield fetch(g)).blob(),S=yield new Promise(j=>{const T=new FileReader;T.readAsDataURL(w),T.onloadend=()=>{j(T.result)}});return S&&"string"==typeof S?S:v})}convertAndRetryToBase64(v){return(0,Z.mG)(this,void 0,void 0,function*(){let p=this.getExtensionFile(v);if(["pdf","jpg","jpeg","png","gif"].includes(p)){let g;const b=[_.Cdn,_.CdnTimestamp,_.Rawlink,_.RawlinkTimestamp];if(this.cdnService.isViettelCDN(v))try{g=yield this.convertToBase64(v,b[0])}catch{try{yield this.asyncTimeout(500),g=yield this.convertToBase64(v,b[1])}catch{g=v}}else try{g=yield this.convertToBase64(v,b[0])}catch{try{g=yield this.convertToBase64(v,b[1])}catch{try{g=yield this.convertToBase64(v,b[2])}catch{try{g=yield this.convertToBase64(v,b[3])}catch{console.log("Kh\xf4ng th\u1ec3 convert url n\xe0y th\xe0nh base64 sau v\xe0i l\u1ea7n retry: "+v),g=v}}}}return g}return v})}eraseCanvas(v){v&&(v.beginPath(),v.rect(0,0,v.canvas.width,v.canvas.height),v.fillStyle="white",v.fill())}addContentToPdf(v,p){v.addImage(p,"JPEG",0,0,v.internal.pageSize.getWidth(),v.internal.pageSize.getHeight())}drawTextWrap(v,p,g,b,w){let S=v.split(" "),j=[],T=S[0];if(p){p.font=w||`${b}px Arial`;for(let Y=1;Y<S.length;Y++){let Q=S[Y];p.measureText(T+" "+Q).width<g?T+=" "+Q:(j.push(T),T=Q)}j.push(T)}return j}essayText2LinesArr(v,p,g,b,w){var S;let j=new RegExp("(<br>|<br/>)+","igm"),Y=(null!==(S=this.commonService.replaceAllByRegExp(v,j,"<br>"))&&void 0!==S?S:"").split("<br>"),Q=[];for(let K=0;K<Y.length;K++)Q.push(this.drawTextWrap(Y[K],p,g,b,w));return Q}constructor(v,p,g){this.commonService=v,this.cdnService=p,this.answerTypeService=g}}return A.\u0275fac=function(v){return new(v||A)(r.LFG(L.v),r.LFG(R.U),r.LFG(d.T))},A.\u0275prov=r.Yz7({token:A,factory:A.\u0275fac,providedIn:"root"}),A})()},63382:(ot,G,c)=>{c.d(G,{X:()=>L});var Z=c(94650),r=c(51009);let L=(()=>{class R{isInIframe(){try{return window.self!==window.top}catch{return!0}}sendMessageToParentIframe(_){try{window.parent.postMessage(_,"*")}catch{}}sendMessageToIFrame(_,D){const A=document.getElementById(_);(A?A.contentWindow:null)?.postMessage(D,"*")}constructor(_){this.commonService=_}}return R.\u0275fac=function(_){return new(_||R)(Z.LFG(r.v))},R.\u0275prov=Z.Yz7({token:R,factory:R.\u0275fac,providedIn:"root"}),R})()},71956:(ot,G,c)=>{c.r(G),c.d(G,{HomeworkModule:()=>Co});var Z=c(36895),r=c(24006),L=c(35559),R=c(34793),d=c(39102),_=c(93194),D=c(1737),A=c(59650),q=c(47470),v=c(75658),p=c(76310),g=c(8785),b=c(34641),w=c(51178),S=c(6834),j=c(7100),T=c(80529),Y=c(8277),Q=c(3238),K=c(39841),et=c(30502),Pt=c(24149),It=c(96551),wt=c(85053),dt=c(72491),$=c(55330),Nt=c(1574),Et=c(41303),mt=c(51442),t=c(94650),X=c(51009),Lt=c(1192),at=c(15194),ht=c(45511),it=c(1218),Ut=c(88386),kt=c(34782),Ht=c(79001),Jt=c(50136),ut=c(18455),zt=c(29203),xt=c(42542),st=c(91350),rt=c(49692),Bt=c(16883),Rt=c(73727),yt=c(20371),W=c(1033);function qt(n,h){1&n&&t._UZ(0,"azt-loading-effect")}function Yt(n,h){1&n&&(t.TgZ(0,"div",95),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"lang_auto_vui_long_nhap_ten_bai_tap")," "))}function Ft(n,h){1&n&&(t.TgZ(0,"span"),t._uU(1,"OK"),t.qZA())}function Qt(n,h){1&n&&(t.TgZ(0,"span"),t._uU(1,"OK"),t.qZA())}function Gt(n,h){1&n&&(t.TgZ(0,"div",96),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"lang_testbank_test_config_end_time_bigger_time_star"),". "))}function Wt(n,h){1&n&&(t.TgZ(0,"div",97),t.O4$(),t.TgZ(1,"svg",98)(2,"g",99)(3,"g",100),t._UZ(4,"circle",101),t.TgZ(5,"path",102),t._UZ(6,"animateTransform",103),t.qZA()()()()())}function Kt(n,h){if(1&n){const e=t.EpF();t.TgZ(0,"div",104)(1,"button",105),t.NdJ("click",function(){const a=t.CHM(e).index,s=t.oxw(2);return t.KtG(!!s.formHomework.files&&s.formHomework.files.splice(a,1))}),t.O4$(),t.TgZ(2,"svg",27),t._UZ(3,"line",106)(4,"line",107),t.qZA()(),t.kcU(),t.TgZ(5,"a",108),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.onShowFile(a,-1))}),t.TgZ(6,"span",109),t._uU(7),t.qZA()()()}if(2&n){const e=h.$implicit;t.xp6(6),t.Q6J("title",e.name),t.xp6(1),t.Oqu(e.name)}}function Vt(n,h){1&n&&(t.TgZ(0,"div",112),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"lang_testbank_test_config_you_not_yet_class")," "))}function $t(n,h){if(1&n&&(t.TgZ(0,"div",110),t.YNc(1,Vt,3,3,"div",111),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.form.controls.classroomIds.errors.classroomCheckBoxValidatorWithoutWhoAllow)}}const Xt=function(){return{standalone:!0}},te=function(n){return{"h-56-important":n}};function ee(n,h){if(1&n){const e=t.EpF();t.TgZ(0,"div",3)(1,"form",4)(2,"div",5)(3,"div",6)(4,"h3",7),t._uU(5),t.ALo(6,"mytranslate"),t.qZA(),t.TgZ(7,"div",8)(8,"div",9)(9,"div",10)(10,"label",11),t._uU(11),t.ALo(12,"mytranslate"),t.qZA()(),t.TgZ(13,"div",10)(14,"div",12),t._UZ(15,"input",13),t.ALo(16,"mytranslate"),t.qZA(),t.YNc(17,Yt,3,3,"div",14),t.qZA()(),t.TgZ(18,"div",15)(19,"div",16)(20,"label",17),t._uU(21),t.ALo(22,"mytranslate"),t.O4$(),t.TgZ(23,"svg",18),t.ALo(24,"mytranslate"),t._UZ(25,"circle",19)(26,"line",20)(27,"line",21),t.qZA()()(),t.kcU(),t.TgZ(28,"div",16)(29,"div",22)(30,"div",23)(31,"mat-form-field",24)(32,"input",25),t.NdJ("click",function(){t.CHM(e);const i=t.MAs(43);return t.KtG(i.open())}),t.ALo(33,"mytranslate"),t.qZA(),t.TgZ(34,"button",26),t.NdJ("click",function(i){return t.CHM(e),t.MAs(43).open(),t.KtG(i.stopPropagation())}),t.O4$(),t.TgZ(35,"svg",27),t._UZ(36,"path",28)(37,"path",29)(38,"path",30)(39,"path",31)(40,"path",32)(41,"path",33),t.qZA()(),t.kcU(),t.TgZ(42,"ngx-mat-datetime-picker",null,34),t.YNc(44,Ft,2,0,"ng-template"),t.qZA()()(),t.TgZ(45,"div",23)(46,"mat-form-field",24)(47,"input",35),t.NdJ("click",function(){t.CHM(e);const i=t.MAs(58);return t.KtG(i.open())}),t.ALo(48,"mytranslate"),t.qZA(),t.TgZ(49,"button",36),t.NdJ("click",function(i){return t.CHM(e),t.MAs(58).open(),t.KtG(i.stopPropagation())}),t.O4$(),t.TgZ(50,"svg",27),t._UZ(51,"path",28)(52,"path",29)(53,"path",30)(54,"path",31)(55,"path",32)(56,"path",33),t.qZA()(),t.kcU(),t.TgZ(57,"ngx-mat-datetime-picker",null,37),t.YNc(59,Qt,2,0,"ng-template"),t.qZA()()(),t.TgZ(60,"div",38)(61,"button",39),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.clearTime())}),t.O4$(),t.TgZ(62,"svg",40),t._UZ(63,"path",41)(64,"path",42)(65,"path",43)(66,"path",44),t.qZA(),t._uU(67),t.ALo(68,"mytranslate"),t.qZA()()(),t.kcU(),t.TgZ(69,"div",45)(70,"div",46),t._uU(71),t.ALo(72,"mytranslate"),t.qZA(),t.YNc(73,Gt,3,3,"div",47),t.qZA()()(),t.TgZ(74,"div",48)(75,"div",10)(76,"h3",49),t._uU(77),t.ALo(78,"mytranslate"),t.qZA()(),t.TgZ(79,"div",50)(80,"div",51)(81,"input",52,53),t.NdJ("change",function(i){t.CHM(e);const a=t.oxw();return t.KtG(a.onFileSelected(i))}),t.qZA(),t.TgZ(83,"a",54),t.NdJ("click",function(){t.CHM(e);const i=t.MAs(82);return t.KtG(i.click())}),t.O4$(),t.TgZ(84,"svg",55),t._UZ(85,"line",56)(86,"line",57),t.qZA(),t.kcU(),t.TgZ(87,"span"),t._uU(88),t.ALo(89,"mytranslate"),t.qZA()(),t.YNc(90,Wt,7,0,"div",58),t.TgZ(91,"div",59),t._uU(92),t.ALo(93,"mytranslate"),t.qZA(),t.YNc(94,Kt,8,2,"div",60),t.qZA(),t.TgZ(95,"editor",61),t.NdJ("ngModelChange",function(i){t.CHM(e);const a=t.oxw();return t.KtG(a.formHomework.content=i)}),t.qZA()()(),t.TgZ(96,"div",62)(97,"div",63)(98,"label",64),t._uU(99),t.ALo(100,"mytranslate"),t.qZA()(),t.TgZ(101,"div",65)(102,"div",66)(103,"div",67),t._UZ(104,"input",68),t.TgZ(105,"label",69),t._uU(106),t.ALo(107,"mytranslate"),t.qZA()(),t.TgZ(108,"div",70),t._UZ(109,"input",71),t.TgZ(110,"label",72),t._uU(111),t.ALo(112,"mytranslate"),t.qZA()()()()(),t.TgZ(113,"div",73)(114,"div",63)(115,"label",64),t._uU(116),t.ALo(117,"mytranslate"),t.qZA()(),t.TgZ(118,"div",65)(119,"div",66)(120,"div",67),t._UZ(121,"input",74),t.TgZ(122,"label",75),t._uU(123),t.ALo(124,"mytranslate"),t.qZA()(),t.TgZ(125,"div",70),t._UZ(126,"input",76),t.TgZ(127,"label",77),t._uU(128),t.ALo(129,"mytranslate"),t.qZA()()()()(),t.TgZ(130,"div",78)(131,"div",79)(132,"div",80),t._uU(133),t.ALo(134,"mytranslate"),t.qZA()(),t.TgZ(135,"div",81)(136,"div",82)(137,"div",83)(138,"h3",84),t._uU(139),t.ALo(140,"mytranslate"),t.qZA(),t.TgZ(141,"div",85),t._UZ(142,"azt-list-classroom-checkall",86),t.qZA()(),t.TgZ(143,"div",87)(144,"ng-scrollbar",88),t._UZ(145,"azt-list-classroom-checkbox",89),t.qZA()()()(),t.YNc(146,$t,2,1,"div",90),t.qZA()(),t.TgZ(147,"div",91)(148,"div",92)(149,"button",93),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.saveHomework(0))}),t._uU(150),t.ALo(151,"mytranslate"),t.qZA(),t.TgZ(152,"button",94),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.saveHomework(1))}),t._uU(153),t.ALo(154,"mytranslate"),t.qZA()()()()()()()}if(2&n){const e=t.MAs(43),o=t.MAs(58),i=t.oxw();t.xp6(1),t.Q6J("formGroup",i.form),t.xp6(4),t.hij(" ",t.lcZ(6,45,"lang_auto_tao_bai_tap_moi")," "),t.xp6(6),t.hij(" ",t.lcZ(12,47,"lang_auto_ten")," "),t.xp6(4),t.s9C("placeholder",t.lcZ(16,49,"lang_auto_nhap_ten")+" ..."),t.xp6(2),t.Q6J("ngIf",i.form.controls.homeworkName.errors),t.xp6(4),t.hij(" ",t.lcZ(22,51,"lang_testbank_test_config_time_assigne_homework")," "),t.xp6(2),t.s9C("matTooltip",t.lcZ(24,53,"lang_homework_add_home_work_startDate_introduce")),t.xp6(9),t.s9C("placeholder",t.lcZ(33,55,"lang_auto_tu")),t.Q6J("ngxMatDatetimePicker",e),t.xp6(15),t.s9C("placeholder",t.lcZ(48,57,"lang_auto_den")),t.Q6J("ngxMatDatetimePicker",o),t.xp6(20),t.hij(" ",t.lcZ(68,59,"lang_auto_dat_lai")," "),t.xp6(4),t.hij(" ",t.lcZ(72,61,"lang_auto_bo_trong_neu_khong_muon_gioi_han_thoi_gian"),". "),t.xp6(2),t.Q6J("ngIf",i.calculatorTimeValidate(i.form.controls.homeworkDeadline.value,i.form.controls.homeworkStartDate.value)<0),t.xp6(4),t.hij(" ",t.lcZ(78,63,"lang_auto_noi_dung")," "),t.xp6(11),t.Oqu(t.lcZ(89,65,"lang_homework_add_home_work_add_file_homework")),t.xp6(2),t.Q6J("ngIf",i.loadingUpload),t.xp6(2),t.Oqu(t.lcZ(93,67,"lang_cms_add_homework_input_file")),t.xp6(2),t.Q6J("ngForOf",i.formHomework.files),t.xp6(1),t.Q6J("ngModel",i.formHomework.content)("ngModelOptions",t.DdM(89,Xt))("init",i.initDataEditor),t.xp6(4),t.hij(" ",t.lcZ(100,69,"lang_auto_cho_xem_ket_qua")," "),t.xp6(7),t.hij(" ",t.lcZ(107,71,"lang_auto_khong")," "),t.xp6(5),t.hij(" ",t.lcZ(112,73,"lang_auto_co")," "),t.xp6(5),t.hij(" ",t.lcZ(117,75,"lang_auto_dang_nhap_de_nop_bai")," "),t.xp6(7),t.hij(" ",t.lcZ(124,77,"lang_auto_khong")," "),t.xp6(5),t.hij(" ",t.lcZ(129,79,"lang_auto_co")," "),t.xp6(5),t.hij(" ",t.lcZ(134,81,"lang_auto_giao_cho_lop")," "),t.xp6(6),t.hij(" ",t.lcZ(140,83,"lang_auto_danh_sach_cac_lop")," "),t.xp6(3),t.Q6J("form",i.form)("objs",i.classroomObjs)("permissionName",i.permissionTypes.homework),t.xp6(2),t.Q6J("visibility","hover")("autoHeightDisabled",!1)("ngClass",t.VKq(90,te,i.isMobileWebView)),t.xp6(1),t.Q6J("form",i.form)("objs",i.classroomObjs)("homeworkObj",void 0)("permissionName",i.permissionTypes.homework),t.xp6(1),t.Q6J("ngIf",i.form.controls.classroomIds.errors),t.xp6(3),t.Q6J("disabled",i.form.invalid||i.checkDeadLineValid(i.form.controls.homeworkStartDate.value,i.form.controls.homeworkDeadline.value)<0),t.xp6(1),t.hij(" ",t.lcZ(151,85,"lang_auto_luu_nhap")," "),t.xp6(2),t.Q6J("disabled",i.form.invalid||i.checkDeadLineValid(i.form.controls.homeworkStartDate.value,i.form.controls.homeworkDeadline.value)<0),t.xp6(1),t.hij(" ",t.lcZ(154,87,"lang_auto_xuat_ban")," ")}}let oe=(()=>{class n extends $.Q{clearTime(){this.form.controls.homeworkDeadline.setValue(""),this.form.controls.homeworkStartDate.setValue("")}checkDeadLineValid(e,o){return""!=e&&""!=o?this.timeService.getDiffFromTwoDate(o,e):0}onFileSelected(e){let i=e.target,a=i.files,s=!!a&&a[0];0!=s&&((0,mt.C0)(s.type)?(0,mt.ml)(s.type)?this.showErrorSnack("lang_auto_file_gap_loi: "+s.name+"lang_auto__kieu: "+s.type+"lang_auto__chua_ho_tro_dinh_dang_video_wmv_vui_long_thu_lai"):(this.loadingUpload=!0,this.uploadProgress=0,(0,mt.hv)(s).then(l=>{this.apiUploadService.uploadToCdnForHomework(l).subscribe(m=>{var u;m.type!=T.dt.UploadProgress&&(1==m.success?(this.formHomework.files&&!Array.isArray(this.formHomework.files)&&(this.formHomework.files=[]),null===(u=this.formHomework.files)||void 0===u||u.push(Object.assign({},m.data)),this.loadingUpload=!1,this.uploadProgress=-1):(this.loadingUpload=!1,this.showErrorSnack("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi[SPLIT_LANG] [SPLIT_LANG]"+m.message)))})})):this.showErrorSnack("lang_cms_add_homework_not_support_file_upload")),i.files=null}onShowFile(e,o){let i=Object.assign(Object.assign({},e),{index:o});this.dialog.open(et.F,{maxWidth:"100vw",maxHeight:"100vh",height:"100%",width:"100%",data:{fileOption:i},restoreFocus:!1})}saveHomework(e){var o;this.initStatusObj(),this.homeWorkContent=null!==(o=this.formHomework.content)&&void 0!==o?o:"",this.uploadImageOfHomeworkService.replaceImageInContent(this.homeWorkContent).subscribe(i=>{null==i.errorMessage?(this.homeWorkContent=i.content,this.callApiToSaveHomework(e)):(this.showErrorSnack(i.errorMessage),this.stopStatusObj())})}callApiToSaveHomework(e){let o=this.commonService.getFormObj(this.form);o.homeworkStartDate=""===o.homeworkStartDate||null===o.homeworkStartDate?null:this.timeService.formatDateTimeToPostToServer(o.homeworkStartDate),o.homeworkDeadline=""===o.homeworkDeadline||null===o.homeworkDeadline?null:this.timeService.formatDateTimeToPostToServer(o.homeworkDeadline),o.mustVerified=1!=o.mustVerified?0:1,o.whenShowAnswer=1!=o.whenShowAnswer?0:1,this.homeWorkContent=this.zipDataService.convertContentGzip(this.homeWorkContent);let i=this.userService.getUserObj(),a=JSON.stringify({type:"homework",id:0,user:i.id}),s=this.sEAztClassroomCheckboxService.findClassroomWithNoPermission(this.classroomObjs,wt.$.homework);const l=this.sEAztClassroomCheckboxService.getClassroomIdsChecked(this.classroomObjs,s,o.classroomIds);let m={name:o.homeworkName,content:this.homeWorkContent,startDate:o.homeworkStartDate,deadline:o.homeworkDeadline,testbankExams:"",files:JSON.stringify(this.formHomework.files),mustVerified:o.mustVerified,whenShowAnswer:o.whenShowAnswer,isPublished:e,categoryId:this.cateId?Number(this.cateId):void 0,classroomIds:l};this.subscriptions.add(this.homeworkService.apiHomeworkSaveObjPost(m,a).subscribe(u=>{var k,y,f,x,O;if(1==u.success){if(e){this.successStatusObj("lang_auto_xuat_ban_thanh_cong",!0);let N=[];if(null!==(k=u.data)&&void 0!==k&&k.objs)for(let U=0;U<u.data.objs.length;U++)N.push(null===(y=u.data)||void 0===y?void 0:y.objs[U].hashId);this.listIds=JSON.stringify(N);let H=`/admin/homework/add-new-homework/${null!==(f=this.cateId)&&void 0!==f?f:0}?backto=`+this.backToLink;this.commonService.myNavigationWithQueryString("/admin/testbank/publish-document/1/"+(null!==(x=this.cateId)&&void 0!==x?x:0)+"/"+this.listIds,"?backto="+encodeURIComponent(H))}else this.commonService.myNavigation(this.backToLink?this.backToLink:"/admin/testbank/document-management/1/0/1"),this.successStatusObj("lang_auto_luu_thanh_cong_chua_xuat_ban",!0);this.successStatusObj()}else this.errorStatusObj(null!==(O=u.message)&&void 0!==O?O:"",!0)}))}getHomework(){this.subscriptions.add(this.homeworkService.apiHomeworkGetObjGet("add_new").subscribe(e=>{var o,i,a;1==e.success?(this.classroomObjs=null!==(i=null===(o=e?.data)||void 0===o?void 0:o.classroomObjs)&&void 0!==i?i:new Array,this.successStatusObj()):this.errorStatusObj(null!==(a=e.message)&&void 0!==a?a:"",!0)}))}checkModeUiEditor(e){this.initDataEditor="dark"==e?{height:250,menubar:!1,plugins:[],skin:"oxide-dark",content_css:"dark",toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify"}:{height:250,menubar:!1,plugins:[],toolbar:"bold italic backcolor | alignleft aligncenter alignright alignjustify"}}calculatorTimeValidate(e,o){return""!=e&&""!=o?this.timeService.calculationHomeworkTime(e,o):0}ngOnChanges(){var e;let o=""==this.browserStorageService.getStorage("mode_ui")?"light":null!==(e=this.browserStorageService.getStorage("mode_ui"))&&void 0!==e?e:"light";this.checkModeUiEditor(o)}ngOnInit(){var e;this.initStatusObj();let o=""==this.browserStorageService.getStorage("mode_ui")?"light":null!==(e=this.browserStorageService.getStorage("mode_ui"))&&void 0!==e?e:"light";this.checkModeUiEditor(o),(0,K.a)([this.activeRoute.params,this.activeRoute.queryParams]).subscribe(([])=>{var i,a;this.backToLink=null!==(i=this.commonService.getMyQueryParam("backto"))&&void 0!==i?i:"",this.cateId=null!==(a=this.commonService.getMyParam(this.activeRoute,"cat_id"))&&void 0!==a?a:"",this.getHomework()}),this.form=this.fb.group({homeworkName:new r.p4("",[r.kI.required,r.kI.maxLength(180),Et._.noWhiteSpace]),homeworkStartDate:new r.p4(""),homeworkDeadline:new r.p4(""),mustVerified:new r.p4("0"),whenShowAnswer:new r.p4("0"),classroomIds:this.fb.array([]),whoAllow:new r.p4("2")},{validators:[Nt.h.classroomCheckBoxValidatorWithoutWhoAllow]}),this.form.valueChanges.subscribe(i=>{let a=JSON.stringify(i);a!=this.prevData&&(this.prevData=a,this.form.patchValue(i))}),this.commonService.translateMetaData({title:"lang_cms_homework_add_exercise_title",description:"lang_cms_homework_add_exercise_description",image:"lang_cms_test_image"})}constructor(e,o,i,a,s,l,m,u,k,y,f,x,O){super(i),this.dialog=e,this.activeRoute=o,this.commonService=i,this.fb=a,this.homeworkService=s,this.classroomService=l,this.apiUploadService=m,this.zipDataService=u,this.timeService=k,this.userService=y,this.browserStorageService=f,this.sEAztClassroomCheckboxService=x,this.uploadImageOfHomeworkService=O,this.form=new r.nJ({}),this.permissionTypes=wt.$,this.formHomework={files:[],content:""},this.classroomObjs=[],this.prevData="",this.cateId="",this.listIds="",this.backToLink="",this.uploadProgress=-1,this.loadingUpload=!1,this.homeWorkContent="",this.initDataEditor={}}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(L.on),t.Y36(R.gz),t.Y36(X.v),t.Y36(r.QS),t.Y36(Lt.L),t.Y36(at.um),t.Y36(ht.$),t.Y36(it.D),t.Y36(dt.O),t.Y36(Ut.K),t.Y36(kt.z),t.Y36(Ht.L),t.Y36(Jt.J))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-add-home-work"]],features:[t._Bn([{provide:j.fM,useClass:Pt.HF,deps:[Q.Ad,Y.o8]},{provide:j.ab,useFactory:It.hx,deps:[dt.O]}]),t.qOj,t.TTD],decls:4,vars:3,consts:[[3,"headerBackTolink"],[4,"ngIf","ngIfElse"],["doneLoading",""],[1,"intro-y","mt-5"],[3,"formGroup"],[1,"azt-config-document","mx-auto",2,"max-width","1000px"],[1,"setting-basic"],[1,"text-md","uppercase","font-medium"],[1,"box","mt-2","p-5"],["id","azt-config-name",1,"grid","grid-cols-12"],[1,"col-span-12","lg:col-span-12"],["for","homework-name",1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["id","homework-name","formControlName","homeworkName","type","text",1,"form-control",3,"placeholder"],["class","text-xs text-danger mt-2",4,"ngIf"],["id","azt-config-time-assignment",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12"],["for","regular-form-1",1,"form-label","mb-0","font-medium","flex","items-center"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"lucide","w-4","h-4","ml-2",3,"matTooltip"],["cx","12","cy","12","r","10"],["x1","12","y1","16","x2","12","y2","12"],["x1","12","y1","8","x2","12.01","y2","8"],[1,"grid","grid-cols-12","gap-3"],[1,"col-span-12","md:col-span-5"],["appearance","outline"],["azt-track-service","add-home-work-2lcHTxnwVmR","matInput","","formControlName","homeworkStartDate","readonly","",3,"placeholder","ngxMatDatetimePicker","click"],["azt-track-service","add-home-work-6MNUM1lV8t1","matSuffix","",2,"font-size","18px",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-4","h-4","lucide"],["d","M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5"],["d","M16 2v4"],["d","M8 2v4"],["d","M3 10h5"],["d","M17.5 17.5 16 16.25V14"],["d","M22 16a6 6 0 1 1-12 0 6 6 0 0 1 12 0Z"],["startTime",""],["azt-track-service","add-home-work-ShSJ8gIBpK8","matInput","","formControlName","homeworkDeadline","readonly","",3,"placeholder","ngxMatDatetimePicker","click"],["azt-track-service","add-home-work--BjU84v-g28","matSuffix","",2,"font-size","18px",3,"click"],["endTime",""],[1,"col-span-6","md:col-span-2"],["azt-track-service","add-home-work-NEdqGTKJIVb",1,"btn","btn-outline-secondary","w-full",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"lucide","w-4","h-4","mr-2"],["d","M10 2h4"],["d","M12 14v-4"],["d","M4 13a8 8 0 0 1 8-7 8 8 0 1 1-5.3 14L4 17.6"],["d","M9 17H4v5"],[1,"text-xs","mt-2"],[1,"text-slate-500","mt-1"],["class","text-danger mt-1",4,"ngIf"],[1,"grid","grid-cols-12","mt-4"],[1,"text-md","font-medium"],[1,"col-span-12","lg:col-span-12","mt-3"],[1,"col-md-12"],["type","file","name","fileHomework",2,"display","none",3,"change"],["formChoseFile",""],["azt-track-service","add-home-work-4ML9tUkucGY",1,"btn","btn-sm","btn-primary-soft",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-4","h-4","mr-2"],["x1","12","y1","5","x2","12","y2","19"],["x1","5","y1","12","x2","19","y2","12"],["class","flex justify-center my-2",4,"ngIf"],[1,"text-slate-600","text-xs","mt-2","mb-2"],["class","flex items-center mt-3 mb-3",4,"ngFor","ngForOf"],["apiKey","ldij13v1886vlrnk42g9bvngyqdc6gxpe8l0n9mo8gdjpg9d",3,"ngModel","ngModelOptions","init","ngModelChange"],["id","azt-config-when-result",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12","lg:col-span-5"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"col-span-12","lg:col-span-7"],[1,"flex","flex-col","sm:flex-row"],[1,"form-check","mr-8"],["id","whenShowAnswer-off","type","radio","formControlName","whenShowAnswer","value","1",1,"form-check-input"],["for","whenShowAnswer-off",1,"form-check-label"],[1,"form-check","mr-8","mt-2","sm:mt-0"],["id","whenShowAnswer-tested","type","radio","formControlName","whenShowAnswer","value","0",1,"form-check-input"],["for","whenShowAnswer-tested",1,"form-check-label","flex","items-center"],["id","azt-config-login-require",1,"grid","grid-cols-12","mt-4"],["id","mustVerified-off","type","radio","formControlName","mustVerified","value","0",1,"form-check-input"],["for","mustVerified-off",1,"form-check-label"],["id","mustVerified-tested","type","radio","formControlName","mustVerified","value","1",1,"form-check-input"],["for","mustVerified-tested",1,"form-check-label","flex","items-center"],["id","azt-config-who-allow",1,"grid","grid-cols-12","mt-4"],[1,"col-span-12","lg:col-span-5","pr-5"],[1,"mb-0","font-medium","flex","items-center"],[1,"col-span-12","mt-4","intro-y"],[1,"border","border-slate-200/60","dark:border-darkmode-400","rounded-md","pb-1"],[1,"p-3","bg-slate-100","dark:bg-darkmode-400","flex","items-center"],[1,"mr-auto"],[1,"flex"],["formArrayName","classroomIds",3,"form","objs","permissionName"],[1,"classroom_list"],["pointerEventsMethod","scrollbar",1,"w-full",3,"visibility","autoHeightDisabled","ngClass"],["formArrayName","classroomIds",3,"form","objs","homeworkObj","permissionName"],["class","col-span-12 mt-2 intro-y",4,"ngIf"],[1,"my-5"],[1,"text-right"],["azt-track-service","add-home-work-ZxDqD0KF4NR",1,"btn","btn-pending","w-24","mr-2",3,"disabled","click"],["azt-track-service","add-home-work-JgG_cpuccgD",1,"btn","w-24","btn-primary",3,"disabled","click"],[1,"text-xs","text-danger","mt-2"],[1,"text-danger","mt-1"],[1,"flex","justify-center","my-2"],["width","25","viewBox","-2 -2 42 42","xmlns","http://www.w3.org/2000/svg","stroke","rgb(30, 41, 59)",1,"w-6","h-6"],["fill","none","fill-rule","evenodd"],["transform","translate(1 1)","stroke-width","4"],["stroke-opacity",".5","cx","18","cy","18","r","18"],["d","M36 18c0-9.94-8.06-18-18-18"],["attributeName","transform","type","rotate","from","0 18 18","to","360 18 18","dur","1s","repeatCount","indefinite"],[1,"flex","items-center","mt-3","mb-3"],["azt-track-service","add-home-work-HeEXhrbob3P",1,"text-slate-600","mr-2",3,"click"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],["azt-track-service","add-home-work-QFtSJlUphLG",3,"click"],[1,"text-slate-600",3,"title"],[1,"col-span-12","mt-2","intro-y"],["class","text-xs text-danger",4,"ngIf"],[1,"text-xs","text-danger"]],template:function(e,o){if(1&e&&(t.TgZ(0,"teacher-layout",0),t.YNc(1,qt,1,0,"azt-loading-effect",1),t.YNc(2,ee,155,92,"ng-template",null,2,t.W1O),t.qZA()),2&e){const i=t.MAs(3);t.Q6J("headerBackTolink","/admin/testbank/document-management/1/0/1"),t.xp6(1),t.Q6J("ngIf",1==o.statusObj.loading)("ngIfElse",i)}},dependencies:[A.KC,Z.mk,Z.sg,Z.O5,ut.v_,ut.nX,zt.k0,xt.Kd,j.AB,j.g2,d.PG,r._Y,r.Fj,r._,r.JJ,r.JL,r.On,r.sg,r.u,r.CE,st.Q,rt.M,Bt.o,Rt.g,yt._,W.bT],encapsulation:2}),n})();var lt=c(50727),ie=c(98209),ne=c(24363),nt=c(97392),ae=c(46289),se=c(53573);function re(n,h){if(1&n&&(t.TgZ(0,"mat-option",15),t._uU(1),t.qZA()),2&n){const e=h.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function le(n,h){1&n&&t._UZ(0,"azt-loading-effect")}function ce(n,h){1&n&&(t.TgZ(0,"div",18)(1,"span",19),t._uU(2),t.ALo(3,"mytranslate"),t.qZA()()),2&n&&(t.xp6(2),t.hij("",t.lcZ(3,1,"lang_homework_content_store_not_found_search"),"!"))}function de(n,h){1&n&&(t.TgZ(0,"div",33),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"lang_homework_content_store_free")))}function me(n,h){if(1&n&&(t.TgZ(0,"div",34),t._uU(1),t.ALo(2,"number"),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij("",t.lcZ(2,1,e.amount)," Azo")}}function he(n,h){1&n&&(t.TgZ(0,"div",35),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"lang_homework_content_store_bought")))}function ue(n,h){if(1&n){const e=t.EpF();t.TgZ(0,"a",36),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,a=t.oxw(3);return t.KtG(a.downloadFrontFileContent(i.id?i.id:0))}),t.TgZ(1,"mat-icon",37),t._uU(2,"save_alt"),t.qZA(),t._uU(3),t.ALo(4,"mytranslate"),t.qZA()}2&n&&(t.xp6(3),t.hij(" ",t.lcZ(4,1,"lang_homework_content_store_download")," "))}function _e(n,h){if(1&n){const e=t.EpF();t.TgZ(0,"a",38),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,a=t.oxw(3);return t.KtG(a.openBuyContentDialog(i,a.userObj&&a.userObj.amount?a.userObj.amount:0))}),t.TgZ(1,"mat-icon",37),t._uU(2,"shopping_cart"),t.qZA(),t._uU(3),t.ALo(4,"mytranslate"),t.qZA()}2&n&&(t.xp6(3),t.hij(" ",t.lcZ(4,1,"lang_buttom_buy")," "))}function ge(n,h){if(1&n&&(t.TgZ(0,"div",22)(1,"div",23),t._UZ(2,"img",24),t.ALo(3,"mycdn"),t.TgZ(4,"div",25)(5,"p",26),t._uU(6),t.qZA(),t.TgZ(7,"div",27),t.YNc(8,de,3,3,"div",28),t.YNc(9,me,3,3,"div",29),t.YNc(10,he,3,3,"div",30),t.YNc(11,ue,5,3,"a",31),t.YNc(12,_e,5,3,"a",32),t.qZA()()()()),2&n){const e=h.$implicit;t.xp6(2),t.s9C("src",t.lcZ(3,7,e.thumb),t.LSH),t.xp6(4),t.Oqu(e.name),t.xp6(2),t.Q6J("ngIf",0==e.amount),t.xp6(1),t.Q6J("ngIf",0!=e.amount&&-1!=e.amount),t.xp6(1),t.Q6J("ngIf",-1==e.amount),t.xp6(1),t.Q6J("ngIf",0==e.amount||-1==e.amount),t.xp6(1),t.Q6J("ngIf",(e&&e.amount?e.amount:0)>0)}}function pe(n,h){if(1&n&&(t.TgZ(0,"div",20),t.YNc(1,ge,13,9,"div",21),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.objs)}}function ve(n,h){if(1&n&&(t.YNc(0,ce,4,3,"div",16),t.YNc(1,pe,2,1,"ng-template",null,17,t.W1O)),2&n){const e=t.MAs(2),o=t.oxw();t.Q6J("ngIf",o.isNullData)("ngIfElse",e)}}function fe(n,h){if(1&n&&(t.TgZ(0,"div",13)(1,"p",14),t._uU(2),t.ALo(3,"mytranslate"),t.qZA(),t.TgZ(4,"p")(5,"span",5),t._uU(6),t.qZA()(),t.TgZ(7,"span",15),t._uU(8),t.ALo(9,"mytranslate"),t.TgZ(10,"span",16),t._uU(11),t.ALo(12,"number"),t.qZA(),t._uU(13),t.ALo(14,"mytranslate"),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,5,"lang_homework_content_store_definitely_want_to_buy")),t.xp6(4),t.hij(" ",e.content.name,""),t.xp6(2),t.hij(" ",t.lcZ(9,7,"lang_homework_content_store_with_price")," "),t.xp6(3),t.hij("",t.lcZ(12,9,e.content.amount)," Azo"),t.xp6(2),t.hij(" ",t.lcZ(14,11,"lang_homework_content_store_not"),"?")}}function be(n,h){if(1&n&&(t.TgZ(0,"div",13)(1,"p",14),t._uU(2),t.ALo(3,"mytranslate"),t.qZA(),t.TgZ(4,"p")(5,"span",5),t._uU(6),t.qZA()(),t.TgZ(7,"span",15),t._uU(8),t.ALo(9,"mytranslate"),t.TgZ(10,"span",16),t._uU(11),t.ALo(12,"number"),t.qZA()()()),2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,4,"lang_homework_content_store_not_enough_azo")),t.xp6(4),t.hij(" ",e.content.name,""),t.xp6(2),t.hij(" ",t.lcZ(9,6,"lang_homework_content_store_with_price")," "),t.xp6(3),t.hij("",t.lcZ(12,8,e.content.amount)," Azo")}}function we(n,h){1&n&&(t.TgZ(0,"div",4)(1,"span",17),t._uU(2),t.ALo(3,"mytranslate"),t.qZA()()),2&n&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"lang_homework_content_store_please"),"!"))}function ke(n,h){if(1&n){const e=t.EpF();t.TgZ(0,"button",18),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.buyContent())}),t.TgZ(1,"mat-icon",19),t._uU(2,"shopping_cart"),t.qZA(),t._uU(3),t.ALo(4,"mytranslate"),t.qZA()}2&n&&(t.xp6(3),t.hij(" ",t.lcZ(4,1,"lang_buttom_buy")," "))}function xe(n,h){if(1&n){const e=t.EpF();t.TgZ(0,"button",20),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.gotoPack())}),t.TgZ(1,"mat-icon",19),t._uU(2,"account_balance_wallet"),t.qZA(),t._uU(3),t.ALo(4,"mytranslate"),t.qZA()}2&n&&(t.xp6(3),t.hij(" ",t.lcZ(4,1,"lang_homework_content_store_recharge")," "))}let ye=(()=>{class n extends $.Q{getData(){this.initStatusObj(),this.subscriptions.add(this.frontFileContentService.apiFrontFileContentGetObjsGet().subscribe(e=>{var o,i,a;1==e.success?(this.objs=null!==(i=null===(o=e.data)||void 0===o?void 0:o.objs)&&void 0!==i?i:new Array,this.successStatusObj()):this.errorStatusObj(null!==(a=e.message)&&void 0!==a?a:"")}))}getInfo(){this.initStatusObj(),this.subscriptions.add(this.userInfoService.apiUserInfoInfoGet().subscribe(e=>{var o,i;1==e.success?(this.userObj=null!==(o=e.data)&&void 0!==o?o:{},this.successStatusObj()):this.errorStatusObj(null!==(i=e.message)&&void 0!==i?i:"")}))}getCategories(){this.initStatusObj(),this.subscriptions.add(this.frontFileContentService.apiFrontFileContentGetCategoriesObjsGet().subscribe(e=>{var o,i,a;1==e.success?(this.categories=null!==(i=null===(o=e.data)||void 0===o?void 0:o.objs)&&void 0!==i?i:new Array,this.successStatusObj()):this.errorStatusObj(null!==(a=e.message)&&void 0!==a?a:"")}))}openBuyContentDialog(e,o){this.openDialog(!(e.amount&&e.amount>o),e,o)}openDialog(e,o,i){this.dialog.open(Oe,{width:"380px",panelClass:"buyContentDialogBox",data:{status:e,content:o,userAmount:i},restoreFocus:!1}).afterClosed().subscribe(s=>{})}selectValue(e){this.initStatusObj(),this.subscriptions.add(this.frontFileContentService.apiFrontFileContentGetObjsGet(void 0,e).subscribe(o=>{var i,a,s,l,m;1==o.success?null!==(i=o.data)&&void 0!==i&&i.objs&&(null===(a=o.data)||void 0===a?void 0:a.objs.length)>0?(this.isNullData=!1,this.objs=null!==(l=null===(s=o.data)||void 0===s?void 0:s.objs)&&void 0!==l?l:new Array,this.successStatusObj()):(this.isNullData=!0,this.stopStatusObj()):this.errorStatusObj(null!==(m=o.message)&&void 0!==m?m:"")}))}onSearch(){var e=this.commonService.getFormObj(this.form);this.initStatusObj(),""==e.searchContent?(this.isNullData=!1,this.subscriptions.add(this.frontFileContentService.apiFrontFileContentGetObjsGet().subscribe(o=>{var i,a,s;1==o.success?(this.objs=null!==(a=null===(i=o.data)||void 0===i?void 0:i.objs)&&void 0!==a?a:new Array,this.successStatusObj()):this.errorStatusObj(null!==(s=o.message)&&void 0!==s?s:"")}))):this.subscriptions.add(this.frontFileContentService.apiFrontFileContentGetObjsGet(e.searchContent).subscribe(o=>{var i,a,s,l,m;1==o.success?(null!==(i=o.data)&&void 0!==i&&i.objs&&0==(null===(a=o.data)||void 0===a?void 0:a.objs.length)?this.isNullData=!0:this.objs=null!==(l=null===(s=o.data)||void 0===s?void 0:s.objs)&&void 0!==l?l:new Array,this.successStatusObj()):this.errorStatusObj(null!==(m=o.message)&&void 0!==m?m:"")}))}downloadFrontFileContent(e){this.frontFileContentService.apiFrontFileContentGetFileLinkGet(e).subscribe(o=>{var i,a;if(1==o.success){var s=document.createElement("a");document.body.appendChild(s),s.href=null!==(a=null===(i=o.data)||void 0===i?void 0:i.link)&&void 0!==a?a:"",s.click()}else this.showErrorSnack("lang_cms_content_store_download_fail")})}ngOnInit(){(0,K.a)([this.activeRoute.params,this.activeRoute.queryParams]).subscribe(([e,o])=>{this.getData(),this.getInfo(),this.getCategories()}),this.form=this.formBuilder.group({searchContent:new r.p4("",r.kI.required)}),this.commonService.translateMetaData({title:"lang_cms_homework_content_store_title",description:"lang_cms_homework_content_store_description",image:"lang_cms_test_image"}),super.ngOnInit()}constructor(e,o,i,a,s,l){super(o),this.activeRoute=e,this.commonService=o,this.userInfoService=i,this.frontFileContentService=a,this.formBuilder=s,this.dialog=l,this.isNullData=!1,this.form=new r.nJ({}),this.subscriptions=new lt.w0,this.objs=[],this.categories=[],this.userObj={}}ngOnDestroy(){this.subscriptions.unsubscribe(),super.ngOnDestroy()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(R.gz),t.Y36(X.v),t.Y36(at.$C),t.Y36(ie.c),t.Y36(r.QS),t.Y36(L.on))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-content-store"]],features:[t.qOj],decls:21,vars:14,consts:[[3,"headerTitle","headerBackTolink"],[1,"container-fluid","component-wrap","W1200","m-auto","mt-3","pb-mb-80","pb-4"],[3,"formGroup"],[1,"flex",2,"justify-content","space-between"],[2,"width","60%","margin-top","5px"],[1,"search-bar","form-group"],[1,"input-group-append"],["type","text","formControlName","searchContent",1,"form-control",3,"placeholder","keyup.enter"],["azt-track-service","content-store-Z-NOMKYiG5Z","id","basic-addon2",1,"btn","btn-primary","ml-2",3,"click"],[1,"content-store-select",2,"width","38%"],["appearance","fill"],["name","category",3,"placeholder","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["doneLoading",""],[3,"value"],["class","text-center mt-3 mb-3",4,"ngIf","ngIfElse"],["HasData",""],[1,"text-center","mt-3","mb-3"],[1,"h3"],[1,"grid","grid-cols-12","gap-5","mt-2"],["class","box col-span-12 md:col-span-4 sm:col-span-6 mb-2","style","margin: auto",4,"ngFor","ngForOf"],[1,"box","col-span-12","md:col-span-4","sm:col-span-6","mb-2",2,"margin","auto"],[1,"card"],["alt","thumbnail",1,"card-img-top",2,"width","80vw",3,"src"],[1,"card-body"],[1,"truncate","p-2","card-text"],[1,"actionZone","p-2"],["class","azo-price text-warning",4,"ngIf"],["class","azo-price text-danger",4,"ngIf"],["class","azo-price",4,"ngIf"],["azt-track-service","content-store-NDNy2GWJJPR","class","actionBtn clickable",3,"click",4,"ngIf"],["azt-track-service","content-store-7VbNrXJRnEV","class","actionBtn","style","cursor: pointer",3,"click",4,"ngIf"],[1,"azo-price","text-warning"],[1,"azo-price","text-danger"],[1,"azo-price"],["azt-track-service","content-store-NDNy2GWJJPR",1,"actionBtn","clickable",3,"click"],[2,"vertical-align","sub"],["azt-track-service","content-store-7VbNrXJRnEV",1,"actionBtn",2,"cursor","pointer",3,"click"]],template:function(e,o){if(1&e&&(t.TgZ(0,"teacher-layout",0),t.ALo(1,"mytranslate"),t.TgZ(2,"div",1)(3,"form",2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"input",7),t.NdJ("keyup.enter",function(){return o.onSearch()}),t.ALo(9,"mytranslate"),t.qZA(),t.TgZ(10,"button",8),t.NdJ("click",function(){return o.onSearch()}),t.TgZ(11,"mat-icon"),t._uU(12,"search"),t.qZA()()()()(),t.TgZ(13,"div",9)(14,"mat-form-field",10)(15,"mat-select",11),t.NdJ("selectionChange",function(a){return o.selectValue(a.value)}),t.ALo(16,"mytranslate"),t.YNc(17,re,2,2,"mat-option",12),t.qZA()()()()(),t.YNc(18,le,1,0,"azt-loading-effect",13),t.YNc(19,ve,3,2,"ng-template",null,14,t.W1O),t.qZA()()),2&e){const i=t.MAs(20);t.Q6J("headerTitle",t.lcZ(1,8,"lang_homework_content_store_content_bank"))("headerBackTolink","/admin/dashboard"),t.xp6(3),t.Q6J("formGroup",o.form),t.xp6(5),t.s9C("placeholder",t.lcZ(9,10,"lang_homework_content_store_search")),t.xp6(7),t.s9C("placeholder",t.lcZ(16,12,"lang_homework_content_store_all")),t.xp6(2),t.Q6J("ngForOf",o.categories),t.xp6(1),t.Q6J("ngIf",o.statusObj.loading)("ngIfElse",i)}},dependencies:[Z.sg,Z.O5,ne.CK,nt.Hw,ut.v_,ae.x8,r._Y,r.Fj,r.JJ,r.JL,r.sg,r.u,st.Q,rt.M,yt._,Z.JJ,W.bT,W.GT],styles:[".dashboard__header[_ngcontent-%COMP%]{background-color:#0089a7;border-radius:5px}.input-group-append[_ngcontent-%COMP%]{display:flex}.border-test[_ngcontent-%COMP%]{border:1px solid red;min-height:50px}.azo-price[_ngcontent-%COMP%]{padding-top:5px;font-weight:500;font-size:1.2rem}.content-store-select[_ngcontent-%COMP%]{margin-top:5px}.card-text[_ngcontent-%COMP%]{display:block!important;max-width:245px!important}.content-header[_ngcontent-%COMP%]{background:inherit;background-color:#0089a7;padding:20px 0}.user_amount[_ngcontent-%COMP%]{background:inherit;background-color:#009cbe;border:none;border-radius:5px;padding:10px;box-shadow:none}.user_amount[_ngcontent-%COMP%]:hover{text-decoration:none}.mat-card-avatar[_ngcontent-%COMP%]{height:50px;width:50px;border-radius:50%;flex-shrink:0;object-fit:cover}@media (max-width: 992px){.dashboard__header[_ngcontent-%COMP%]{background-color:#0089a7;margin-top:-15px;margin-left:-15px;margin-right:-15px;border-radius:0}}.actionZone[_ngcontent-%COMP%]{display:flex;justify-content:space-between}  .mat-form-field-underline{position:initial!important}@media (max-width: 768px){.card-text[_ngcontent-%COMP%]{display:block!important;max-width:120px}.header-col-center[_ngcontent-%COMP%]{text-align:center!important;display:block!important}.header-col-center[_ngcontent-%COMP%]   .nav[_ngcontent-%COMP%]{margin-left:auto!important;margin-right:auto!important;margin-bottom:10px!important;text-align:center!important;display:inline-flex!important}.user_amount[_ngcontent-%COMP%]{margin-left:0!important;margin-bottom:10px!important}.content-header[_ngcontent-%COMP%]{padding:20px 0 0}}"]}),n})(),Oe=(()=>{class n extends $.Q{getData(){this.initStatusObj(),this.data.content?(this.content=this.data.content,this.successStatusObj()):this.errorStatusObj("lang_auto_khong_tai_duoc_du_lieu")}buyContent(){this.initStatusObj(),this.subscriptions.add(this.paymentService.apiPaymentBuyFileContentByAzoPost(this.content.id).subscribe(e=>{var o;1==e.success?(this.successStatusObj(),this.showSuccessSnack("lang_auto_ban_da_mua_thanh_cong"),this.onNoClick(),setTimeout(()=>{document.location.reload()},3e3)):(this.errorStatusObj(null!==(o=e.message)&&void 0!==o?o:"",!0),this.showErrorSnack("lang_auto_thanh_toan_khong_thanh_cong"),this.onNoClick(),setTimeout(()=>{document.location.reload()},3e3))}))}gotoPack(){this.onNoClick(),this.commonService.myNavigation("/payment/azo-pack")}ngOnInit(){this.getData(),super.ngOnInit()}constructor(e,o,i,a){super(i),this.dialogRef=e,this.paymentService=o,this.commonService=i,this.data=a,this.subscriptions=new lt.w0,this.content={}}onNoClick(){this.dialogRef.close()}ngOnDestroy(){this.subscriptions.unsubscribe(),super.ngOnDestroy()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(L.hV),t.Y36(se.t),t.Y36(X.v),t.Y36(L.eJ))},n.\u0275cmp=t.Xpm({type:n,selectors:[["buy-content-dialog"]],features:[t.qOj],decls:21,vars:16,consts:[[3,"hidden"],[1,"d-flex","justify-content-center"],["role","status",1,"spinner-border"],[1,"sr-only"],[1,"text-center"],[1,"h5"],["class","text-left","style","border: 1px dashed red; padding: 10px 5px; border-radius: 5px;",4,"ngIf"],["class","text-center",4,"ngIf"],["mat-dialog-actions","",1,"float-right"],[1,"azt-block-button"],["azt-track-service","content-store-wkv517MZvQQ","class","btn btn-primary",3,"click",4,"ngIf"],["azt-track-service","content-store-pGRw2qZB3VD","class","btn btn-primary",3,"click",4,"ngIf"],["azt-track-service","content-store-g17bdA2D8GW",1,"btn","btn-secondary",2,"margin-left","15px",3,"click"],[1,"text-left",2,"border","1px dashed red","padding","10px 5px","border-radius","5px"],[1,"h5","text-danger"],[1,"h5","mt-1"],[1,"text-danger"],[1,"h6","mt-2","mb-1"],["azt-track-service","content-store-wkv517MZvQQ",1,"btn","btn-primary",3,"click"],[2,"font-size","23px","vertical-align","sub"],["azt-track-service","content-store-pGRw2qZB3VD",1,"btn","btn-primary",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),t._uU(4,"..."),t.qZA()()()(),t.TgZ(5,"div",0)(6,"div",4)(7,"p",5),t._uU(8),t.ALo(9,"mytranslate"),t.ALo(10,"number"),t.qZA()(),t.YNc(11,fe,15,13,"div",6),t.YNc(12,be,13,10,"div",6),t.YNc(13,we,4,3,"div",7),t.qZA(),t.TgZ(14,"div",8)(15,"div",9),t.YNc(16,ke,5,3,"button",10),t.YNc(17,xe,5,3,"button",11),t.qZA(),t.TgZ(18,"button",12),t.NdJ("click",function(){return o.onNoClick()}),t._uU(19),t.ALo(20,"mytranslate"),t.qZA()()),2&e&&(t.Q6J("hidden",!o.statusObj.loading),t.xp6(5),t.Q6J("hidden",o.statusObj.loading),t.xp6(3),t.AsE("",t.lcZ(9,10,"lang_homework_content_store_having")," ",t.lcZ(10,12,o.data.userAmount)," Azo"),t.xp6(3),t.Q6J("ngIf",o.data.status),t.xp6(1),t.Q6J("ngIf",!o.data.status),t.xp6(1),t.Q6J("ngIf",!o.data.status),t.xp6(3),t.Q6J("ngIf",o.data.status),t.xp6(1),t.Q6J("ngIf",!o.data.status),t.xp6(2),t.Oqu(t.lcZ(20,14,"lang_buttom_cancel")))},dependencies:[Z.O5,L.ev,nt.Hw,Z.JJ,W.bT],encapsulation:2}),n})();var Ce=c(70655),Se=c(94327),Ot=c(25650),ct=c(52106),je=c(296),Ae=c(16031),Me=c(20814),_t=c(15043),Te=c(35191),De=c(1643),Ct=c(37104),Ze=c(20074);function Pe(n,h){1&n&&t._UZ(0,"azt-loading-effect")}function Ie(n,h){1&n&&t._UZ(0,"span",31)}function Ne(n,h){if(1&n&&(t.TgZ(0,"div",11),t.YNc(1,Ie,1,0,"span",30),t._uU(2),t.ALo(3,"mytranslate"),t.qZA()),2&n){const e=t.oxw(4);t.xp6(1),t.Q6J("ngIf",e.countDonePdf<((null==e.curExportArr?null:e.curExportArr.length)||-1)),t.xp6(1),t.lnq(" ",t.lcZ(3,4,"lang_homework_export_homework_request"),"",e.countDonePdf," / ",null==e.curExportArr?null:e.curExportArr.length," ")}}function Ee(n,h){if(1&n&&(t.TgZ(0,"div",11)(1,"mat-icon",32),t._uU(2," check_circle "),t.qZA(),t._uU(3),t.ALo(4,"mytranslate"),t.qZA()),2&n){const e=t.oxw(4);let o;t.xp6(3),t.lnq(" ",t.lcZ(4,3,"lang_homework_export_homework_complete")," ",e.countDonePdf," / ",null!==(o=null==e.curExportArr?null:e.curExportArr.length)&&void 0!==o?o:0," ")}}const Le=function(){return{fontFamily:"font_chu_dam"}};function Ue(n,h){if(1&n&&(t.TgZ(0,"div",33)(1,"span",34),t._UZ(2,"azt-check-mark",35),t.qZA(),t.TgZ(3,"span",28),t._uU(4),t.ALo(5,"mytranslate"),t.qZA()()),2&n){const e=t.oxw(4);t.Q6J("ngClass",e.curAnswer.resultParse.hideMark?"":"display")("hidden",e.curAnswer.resultParse.hideMark),t.xp6(1),t.Q6J("ngStyle",t.DdM(7,Le)),t.xp6(1),t.Q6J("mark",e.curAnswer.resultParse.point),t.xp6(2),t.Oqu(t.lcZ(5,5,"lang_point"))}}const He=function(n){return{"font-family":n}};function Je(n,h){if(1&n&&t._UZ(0,"p",36),2&n){const e=t.oxw(4);t.Q6J("ngStyle",t.VKq(2,He,null!=e.curAnswer.resultParse&&null!=e.curAnswer.resultParse.staticTextConfigParse&&e.curAnswer.resultParse.staticTextConfigParse.txtCommentFont?null==e.curAnswer.resultParse||null==e.curAnswer.resultParse.staticTextConfigParse?null:e.curAnswer.resultParse.staticTextConfigParse.txtCommentFont:"font_chu_dep"))("innerHtml",null==e.curAnswer.resultParse?null:e.curAnswer.resultParse.comment,t.oJD)}}function ze(n,h){if(1&n&&(t.ynx(0),t._UZ(1,"img",39),t.BQk()),2&n){const e=h.$implicit,o=h.index,i=t.oxw(5);t.xp6(1),t.s9C("id","imgEmoji_"+o),t.s9C("src",i.isBase64ImageToExport?e:i.linkCdnGitHub+e,t.LSH)}}function Be(n,h){if(1&n&&(t.TgZ(0,"div",37),t.YNc(1,ze,2,2,"ng-container",38),t.qZA()),2&n){const e=t.oxw(4);t.xp6(1),t.Q6J("ngForOf",null==e.curAnswer.resultParse?null:e.curAnswer.resultParse.commentEmoji)}}const Re=function(){return{}};function qe(n,h){if(1&n){const e=t.EpF();t.TgZ(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8)(4,"div",9)(5,"h1",10),t._uU(6),t.ALo(7,"mytranslate"),t.qZA(),t.TgZ(8,"div",11),t._uU(9),t.ALo(10,"mytranslate"),t.qZA(),t.TgZ(11,"div",11)(12,"button",12),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(3);return t.KtG(i.openDialog(i.submitedStudents))}),t._uU(13),t.ALo(14,"mytranslate"),t.qZA()(),t.YNc(15,Ne,4,6,"div",13),t.YNc(16,Ee,5,5,"div",13),t.TgZ(17,"div",14)(18,"div",15)(19,"h2",16)(20,"span"),t._uU(21),t.ALo(22,"mytranslate"),t.qZA()(),t.TgZ(23,"div",17)(24,"div",18)(25,"h3",19),t._uU(26),t.ALo(27,"mytranslate"),t.qZA(),t.TgZ(28,"h3",19),t._uU(29),t.ALo(30,"mytranslate"),t.qZA()(),t.TgZ(31,"div",20)(32,"h3",19),t._uU(33),t.ALo(34,"mytranslate"),t.qZA()()(),t.TgZ(35,"div",21)(36,"div",22),t.YNc(37,Ue,6,8,"div",23),t.TgZ(38,"div",24)(39,"div",25),t.YNc(40,Je,1,4,"p",26),t.YNc(41,Be,2,1,"div",27),t.qZA(),t.TgZ(42,"span",28),t._uU(43),t.ALo(44,"mytranslate"),t.qZA()()()()(),t._UZ(45,"br")(46,"azt-export-essay-template",29),t.ALo(47,"mytranslate"),t.qZA()()()()()()}if(2&n){const e=t.oxw(3);let o;t.xp6(6),t.Oqu(t.lcZ(7,21,"lang_homework_export_homework_export_pdf")),t.xp6(3),t.AsE(" ",t.lcZ(10,23,"lang_homework_export_homework_number_student_dotted"),": ",e.submitedStudents.length," "),t.xp6(3),t.Q6J("disabled",e.loadingExportBtn),t.xp6(1),t.hij(" ",t.lcZ(14,25,"lang_homework_export_homework_continue")," "),t.xp6(2),t.Q6J("ngIf",e.isProcessingPdf),t.xp6(1),t.Q6J("ngIf",((null==e.curExportArr?null:e.curExportArr.length)||-1)>0&&e.countDonePdf===(null!==(o=null==e.curExportArr?null:e.curExportArr.length)&&void 0!==o?o:0)),t.xp6(5),t.AsE("",t.lcZ(22,27,"lang_first_and_last_name"),": ",e.curAnswer.fullName,""),t.xp6(5),t.AsE("",t.lcZ(27,29,"lang_homework_export_homework_class"),": ",null==e.data.classroomObj?null:e.data.classroomObj.name,""),t.xp6(3),t.AsE("",t.lcZ(30,31,"lang_homework_export_homework_home_work"),": ",null==e.data.homeworkObj?null:e.data.homeworkObj.name,""),t.xp6(4),t.AsE("",t.lcZ(34,33,"lang_homework_export_homework_code"),": ",e.curAnswer.id,""),t.xp6(4),t.Q6J("ngIf",e.curAnswer.resultParse),t.xp6(3),t.Q6J("ngIf",null==e.curAnswer.resultParse?null:e.curAnswer.resultParse.comment),t.xp6(1),t.Q6J("ngIf",null==e.curAnswer.resultParse?null:e.curAnswer.resultParse.commentEmoji),t.xp6(2),t.Oqu(t.lcZ(44,35,"lang_homework_export_homework_comment_of_teacher")),t.xp6(3),t.Q6J("title",t.lcZ(47,37,"lang_homework_export_homework_assignment"))("result",e.curAnswer.resultParse||t.DdM(39,Re))}}function Ye(n,h){1&n&&(t.TgZ(0,"div",40)(1,"div",41),t._uU(2),t.ALo(3,"mytranslate"),t.qZA()()),2&n&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"lang_homework_export_homework_request_marking")))}function Fe(n,h){if(1&n&&(t.YNc(0,qe,48,40,"div",3),t.YNc(1,Ye,4,3,"ng-template",null,4,t.W1O)),2&n){const e=t.MAs(2),o=t.oxw(2);t.Q6J("ngIf",o.submitedStudents.length>0)("ngIfElse",e)}}function Qe(n,h){if(1&n&&(t.ynx(0),t.YNc(1,Pe,1,0,"azt-loading-effect",0),t.YNc(2,Fe,3,2,"ng-template",null,2,t.W1O),t.BQk()),2&n){const e=t.MAs(3),o=t.oxw();t.xp6(1),t.Q6J("ngIf",o.statusObj.loading)("ngIfElse",e)}}function Ge(n,h){1&n&&(t.TgZ(0,"div",42),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"lang_homework_export_homework_request_browser")))}function We(n,h){if(1&n&&(t.TgZ(0,"mat-checkbox",12),t._uU(1),t.qZA()),2&n){const e=h.index,o=t.oxw();t.Q6J("checked",o.form.value.exports[e])("formControlName",e),t.xp6(1),t.AsE(" ",e+1,". ",o.data.resultsArr[e].fullName," ")}}const Ke=function(n){return{selects:n}};let Ve=(()=>{class n extends $.Q{askBeforeCloseWindow(e){return!this.isProcessingPdf||(e.returnValue=!1)}openDialog(e){this.dialog.open($e,{width:"1100px",data:{resultsArr:e},restoreFocus:!1}).afterClosed().subscribe(i=>{if(i){const a=[];for(let s=0;s<i.selects.length;s++)i.selects[s]&&a.push(e[s]);this.zipAll(a)}})}finalSaveAll(){this.myZip.generateAsync({type:"blob"}).then(e=>{var o,i,a,s;this.countDonePdf++;let l=this.commonService.createFileNameExportFile([null!==(i=null===(o=this.data.classroomObj)||void 0===o?void 0:o.name)&&void 0!==i?i:"",null!==(s=null===(a=this.data.homeworkObj)||void 0===a?void 0:a.name)&&void 0!==s?s:""])+"_homework_result.zip";(0,Se.saveAs)(e,l),console.log("after save"),this.isProcessingPdf=!1,this.cdr.detectChanges()},e=>{console.log(e)})}zipAll(e){var o,i,a,s,l,m;return(0,Ce.mG)(this,void 0,void 0,function*(){this.isProcessingPdf=!0,this.loadingExportBtn=!0,document.body.style.overflow="hidden",this.countDonePdf=0,this.curExportArr=e,this.myZip=new Ot;for(const y of e){const f=yield this.answerService.apiAnswerGetObjGet(this.homeworkHashId,null===(o=y.answer)||void 0===o?void 0:o.id).toPromise();if(1==f?.success){this.zipDataService.convertSubmittedAnswersObj(null===(i=f.data)||void 0===i?void 0:i.answerObj);var u=this.homeworkExamService.parserHomeworkIframeResult(null===(a=f.data)||void 0===a?void 0:a.answerObj);this.curAnswer=u||{},this.curAnswer.fullName=null!==(l=this.commonService.convertVietnameseToEnglish(null!==(s=y.fullName)&&void 0!==s?s:""))&&void 0!==l?l:"",this.curAnswer.resultParse=this.curAnswer.resultParse?yield this.exportPdfConvertDataService.processEssayResultToBase64(this.curAnswer.resultParse):this.curAnswer.resultParse,this.isBase64ImageToExport=!0;try{yield this.exportPdfUtilsService.asyncTimeout(3e3);var k=this.timeService.getCurrentSecond();console.log("Start export for "+this.curAnswer.fullName+": 0 seconds");const x=yield this.newPdfExportService.homeworkToPdf();console.log("End export: "+(this.timeService.getCurrentSecond()-k)+" seconds"),this.myZip.file(`${this.folderName}/${this.commonService.convertVietnameseToEnglish(this.curAnswer.fullName)}_${this.curAnswer.id}.pdf`,x)}catch(x){console.log(x)}this.countDonePdf<e.length-1&&this.countDonePdf++}else this.errorStatusObj(null!==(m=f?.message)&&void 0!==m?m:"",!0)}this.finalSaveAll(),document.body.style.overflow="auto",setTimeout(()=>{this.loadingExportBtn=!1},2e3)})}getData(){this.homeworkId?this.answerService.apiAnswerGetStudentsHomeworkGet(parseInt(this.homeworkId,10),this.homeworkHashId).subscribe(e=>{var o,i,a,s,l,m,u,k;1==e.success?(this.zipDataService.convertStudentsHomeworkObj(null===(o=e.data)||void 0===o?void 0:o.studentObjs),this.data=null!==(i=e.data)&&void 0!==i?i:{},this.submitedStudents=e.data&&Array.isArray(null===(a=e.data)||void 0===a?void 0:a.studentObjs)?null===(s=e.data)||void 0===s?void 0:s.studentObjs.filter(y=>y.confirmedAt):new Array,this.submitedStudents.length>0?this.answerService.apiAnswerGetObjGet(this.homeworkHashId,null!==(u=null===(m=null===(l=this.submitedStudents[0])||void 0===l?void 0:l.answer)||void 0===m?void 0:m.id)&&void 0!==u?u:0).subscribe(y=>{var f,x,O;if(1==y.success){this.zipDataService.convertSubmittedAnswersObj(null===(f=y.data)||void 0===f?void 0:f.answerObj);var N=this.homeworkExamService.parserHomeworkIframeResult(null===(x=y.data)||void 0===x?void 0:x.answerObj),H=this.commonService.myClone(N);console.log(H),this.curAnswer=N||{},this.curAnswer.fullName=this.submitedStudents[0].fullName,this.successStatusObj()}else this.errorStatusObj(null!==(O=e.message)&&void 0!==O?O:"",!0)}):this.stopStatusObj()):this.errorStatusObj(null!==(k=e.message)&&void 0!==k?k:"",!0)}):(this.stopStatusObj(),this.showErrorSnack("lang_cms_export_homework_cannot_get_data"))}ngOnInit(){var e,o;if(this.homeworkHashId=null!==(e=this.commonService.getMyParam(this.activeRoute,"hash_id"))&&void 0!==e?e:"",this.isSupportedBrowser=this.exportPdfUtilsService.isSupportedBrowser(),this.homeworkId=null!==(o=this.activeRoute.snapshot.paramMap.get("id"))&&void 0!==o?o:"",this.isSupportedBrowser){this.initStatusObj();var i=[{source:this.cdnService.convertCdnLinkOfGitHub("azota_assets/js/html2pdf.bundle.js?v=28092021"),name:"html2pdf.bundle.js"}];this.commonService.loadScriptPromises(i).then(()=>{this.commonService.translateMetaData({title:"lang_cms_export_homework_title",description:"lang_cms_export_homework_description",image:"lang_cms_test_image"}),this.getData()})}super.ngOnInit()}constructor(e,o,i,a,s,l,m,u,k,y,f,x){super(a),this.cdr=e,this.answerService=o,this.dialog=i,this.commonService=a,this.activeRoute=s,this.exportPdfConvertDataService=l,this.newPdfExportService=m,this.exportPdfUtilsService=u,this.zipDataService=k,this.cdnService=y,this.timeService=f,this.homeworkExamService=x,this.folderName="results",this.homeworkHashId="",this.homeworkId="",this.countDonePdf=0,this.isProcessingPdf=!1,this.data={},this.curAnswer={},this.submitedStudents=[],this.myZip=new Ot,this.linkCdnGitHub="https://azota889.github.io/storage_public/mnote/",this.isBase64ImageToExport=!1,this.loadingExportBtn=!1}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.sBO),t.Y36(ct.P),t.Y36(L.on),t.Y36(X.v),t.Y36(R.gz),t.Y36(je.S),t.Y36(Ae.I),t.Y36(Me.V),t.Y36(it.D),t.Y36(_t.U),t.Y36(dt.O),t.Y36(Te.j))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-export-homework"]],hostBindings:function(e,o){1&e&&t.NdJ("beforeunload",function(a){return o.askBeforeCloseWindow(a)},!1,t.Jf7)},features:[t.qOj],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["notBrowserSupport",""],["doneLoading",""],["id","test_review_container","class","container-fluid mt-2",4,"ngIf","ngIfElse"],["noSubmit",""],["id","test_review_container",1,"container-fluid","mt-2"],["id","tabRowExam",1,"row",2,"margin-bottom","10px"],["id","test_review_area",1,"col"],["id","col_examContent_wrap",2,"width","1100px!important","margin","0 auto"],["id","mbTestContent"],[1,"text-center","font-bold","mb-2",2,"font-size","18px"],[1,"buttons-area","mb-3","text-center"],["azt-track-service","export-homework-PKHoUw4ISM_",1,"btn","btn-primary",3,"disabled","click"],["class","buttons-area mb-3 text-center",4,"ngIf"],["id","multipleChoiceWrap",1,"exportPdfModeIndex",2,"padding","30px"],["id","multipleChoiceWrapHeader"],["id","mainTitle",1,"mb-1","text-center","font-bold",2,"font-size","18px"],["id","detailInfo",1,"flex",2,"justify-content","space-between","font-size","16px"],["id","colLeftInfo"],[1,"mb-0"],["id","colRightInfo"],["id","teacherMessage",2,"padding-top","3rem"],[1,"contentNote"],["class","box-point",3,"ngClass","hidden",4,"ngIf"],[1,"box-msg"],[1,"note"],[3,"ngStyle","innerHtml",4,"ngIf"],["class","box-emoji",4,"ngIf"],[1,"cap"],[3,"title","result"],["style","color: darkgrey;","class","spinner-border spinner-border-sm","role","status",4,"ngIf"],["role","status",1,"spinner-border","spinner-border-sm",2,"color","darkgrey"],[2,"color","green","vertical-align","bottom"],[1,"box-point",3,"ngClass","hidden"],[1,"point",3,"ngStyle"],[3,"mark"],[3,"ngStyle","innerHtml"],[1,"box-emoji"],[4,"ngFor","ngForOf"],["alt","icon-emoji",1,"comment-emoji","img-fluid","mr-2",3,"id","src"],[2,"padding","50px"],[1,"alert","alert-info"],[1,"p-5","text-center","alert","alert-danger"]],template:function(e,o){if(1&e&&(t.YNc(0,Qe,4,2,"ng-container",0),t.YNc(1,Ge,3,3,"ng-template",null,1,t.W1O)),2&e){const i=t.MAs(2);t.Q6J("ngIf",o.isSupportedBrowser)("ngIfElse",i)}},dependencies:[Z.mk,Z.sg,Z.O5,Z.PC,nt.Hw,st.Q,De.p,Ct.B,W.bT],styles:["#test_review_container[_ngcontent-%COMP%]{background:#ecf0f5;flex:auto;padding-top:15px}#tester-info[_ngcontent-%COMP%]{width:300px;padding:15px;background-color:#fff;margin:0 auto;position:sticky;top:10px;max-height:calc(100vh - 10px);display:flex;flex-direction:column;max-width:100%;border-radius:3px;border:1px solid #f1f1f1}#short_cut_mobile[_ngcontent-%COMP%]{display:none}#fullPoint[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:1px solid #f1f1f1;background-color:#fafafa;padding:10px;margin-top:15px;align-items:center}#fullPoint[_ngcontent-%COMP%]   .point[_ngcontent-%COMP%]{font-weight:500;font-size:130%}.tested-times[_ngcontent-%COMP%]{margin-top:15px}.tested-times[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{border:1px solid #f1f1f1;background-color:#fafafa;padding:10px}.tested-times[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;border:1px solid #f1f1f1;border-top:none;margin-bottom:0;background-color:#fff;padding:10px}.tested-times[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:10px}.tested-times[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{margin-bottom:0}.tested-times[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.select[_ngcontent-%COMP%]{font-weight:500}.tested-times[_ngcontent-%COMP%]:last-child{flex:auto;overflow:auto}#multipleChoiceWrapHeader[_ngcontent-%COMP%]{padding-left:30px;padding-right:30px}#unsupportFallback[_ngcontent-%COMP%]{width:750px;height:350px;border:1px solid grey;border-radius:3px;display:flex;align-items:center;justify-content:center}#teacherMessage[_ngcontent-%COMP%]   .contentNote[_ngcontent-%COMP%]{display:flex}#teacherMessage[_ngcontent-%COMP%]   .contentNote[_ngcontent-%COMP%]   .cap[_ngcontent-%COMP%]{position:absolute;top:-30px;font-family:font_chu_dep;font-weight:700;font-size:25px}#teacherMessage[_ngcontent-%COMP%]   .contentNote[_ngcontent-%COMP%]   .box-point[_ngcontent-%COMP%]{width:200px;min-width:200px;min-height:200px;border:2px solid #333;border-right:none;position:relative;display:flex;align-items:center;justify-content:center;padding:15px}#teacherMessage[_ngcontent-%COMP%]   .contentNote[_ngcontent-%COMP%]   .box-point[_ngcontent-%COMP%]   span.point[_ngcontent-%COMP%]{color:red;font-size:60px}#teacherMessage[_ngcontent-%COMP%]   .contentNote[_ngcontent-%COMP%]   .box-msg[_ngcontent-%COMP%]{border:2px solid #333;padding:15px;position:relative;flex:auto;min-height:200px}#teacherMessage[_ngcontent-%COMP%]   .contentNote[_ngcontent-%COMP%]   .box-msg[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{width:100%;height:100%;border:none;color:red;font-size:24px;line-height:1.5}#teacherMessage[_ngcontent-%COMP%]   .contentNote[_ngcontent-%COMP%]   .box-msg[_ngcontent-%COMP%]   .cap[_ngcontent-%COMP%]{left:300px}.fading_layer[_ngcontent-%COMP%]{position:absolute;z-index:9;background-color:#ffffffe3;width:100%;height:100%;top:0;left:0;padding-top:200px;text-align:center;color:#a9a9a9;font-size:16px}#filterWrap[_ngcontent-%COMP%]{position:absolute;right:0;top:-4px;z-index:2}.viewWrong[_ngcontent-%COMP%]   .correct[_ngcontent-%COMP%], .viewRight[_ngcontent-%COMP%]   .incorrect[_ngcontent-%COMP%]{display:none}#col_examContent_wrap[_ngcontent-%COMP%]{width:1100px;margin:0 auto}#col_examContent_wrap[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{position:fixed;right:5px;top:50%;z-index:3;font-size:35px;width:40px;height:40px;display:flex;align-items:center;justify-content:center;background-color:#c9c9c97a;border-radius:50%;color:#fff;margin-top:-20px}#col_examContent_wrap[_ngcontent-%COMP%] > mat-icon.prev_icon[_ngcontent-%COMP%]{left:5px}#mbTestContent[_ngcontent-%COMP%]{position:relative}#mbTestContent[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{display:none;position:absolute;top:12px;color:#646464;z-index:100}#test_review_container.toggleNavInfo[_ngcontent-%COMP%]   #col_std_info[_ngcontent-%COMP%]{left:0}#close_button[_ngcontent-%COMP%]{color:red;position:absolute;right:5px;top:5px}@media screen and (max-width: 320px){#tester-info[_ngcontent-%COMP%]{width:100%}}@media screen and (max-width: 480px){#mbTestContent[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{display:inline-block}#test_review_container[_ngcontent-%COMP%]{padding-top:0}#col_std_info[_ngcontent-%COMP%]{position:fixed;top:0;left:-100%;z-index:99999;background:rgba(0,0,0,.6117647059);bottom:0;padding:0;transition:all .5s}#short_cut_mobile[_ngcontent-%COMP%]{display:flex;font-weight:500;font-size:18px;justify-content:space-between;color:#4a4a4a}#header-app-component[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:last-child{padding-left:0!important}#tester-info[_ngcontent-%COMP%]{margin:0;position:relative;height:100%;max-height:unset;top:0}#multipleChoiceWrap[_ngcontent-%COMP%]{padding-right:5px;padding-left:5px;padding-top:5px}}.buttons-area[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{text-transform:none!important}.box-emoji[_ngcontent-%COMP%]{margin-top:5px;padding:5px;width:88px;display:flex}@media screen and (max-width: 1600px){#col_examContent_wrap[_ngcontent-%COMP%]{width:100%}}"]}),n})(),$e=(()=>{class n extends $.Q{get exportsFormArray(){return this.form.controls.exports}get countSelected(){return this.exportsFormArray.value.filter(e=>!0===e).length}selectAll(){const e=[];this.data.resultsArr.forEach(()=>{e.push(this.isSelectAll.value)}),this.form.controls.exports.setValue(e)}ngOnInit(){this.form=this.fb.group({exports:new r.vC([],Xe(1))}),this.data.resultsArr.forEach(()=>{this.exportsFormArray.push(new r.p4(!1))}),super.ngOnInit()}constructor(e,o,i,a){super(o),this.dialogRef=e,this.commonService=o,this.fb=i,this.data=a,this.form=new r.nJ({}),this.isSelectAll=new r.p4(!1)}onNoClick(){this.dialogRef.close()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(L.hV),t.Y36(X.v),t.Y36(r.QS),t.Y36(L.eJ))},n.\u0275cmp=t.Xpm({type:n,selectors:[["what-export-dialog"]],features:[t.qOj],decls:28,vars:28,consts:[[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"intro-y"],[1,"text-base","font-medium","mr-auto","text-center"],[1,"clickable","d-flex","align-items-center",2,"font-weight","500"],["color","primary",1,"example-margin",3,"formControl","change"],[3,"formGroup"],["formArrayName","exports","ngFor","",3,"ngForOf"],[1,"text-right","mt-3"],["azt-track-service","export-homework-1pFKkr5k6sd",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","export-homework-sOTjM3oTR8F",1,"btn","w-24","btn-primary",3,"disabled","mat-dialog-close"],["color","primary",1,"mr-2","mb-2",3,"checked","formControlName"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),t._uU(5),t.ALo(6,"mytranslate"),t.qZA()(),t._UZ(7,"br"),t.TgZ(8,"div",3)(9,"p")(10,"i"),t._uU(11),t.ALo(12,"mytranslate"),t.ALo(13,"mytranslate"),t.qZA()(),t.TgZ(14,"span",5)(15,"mat-checkbox",6),t.NdJ("change",function(){return o.selectAll()}),t._uU(16),t.ALo(17,"mytranslate"),t.ALo(18,"mytranslate"),t.qZA()(),t.TgZ(19,"form",7),t.YNc(20,We,2,4,"ng-template",8),t.qZA()(),t.TgZ(21,"div",9)(22,"button",10),t.NdJ("click",function(){return o.onNoClick()}),t._uU(23),t.ALo(24,"mytranslate"),t.qZA(),t.TgZ(25,"button",11),t._uU(26),t.ALo(27,"mytranslate"),t.qZA()()()()()),2&e&&(t.xp6(5),t.hij("",t.lcZ(6,12,"lang_homework_export_homework_select_students_export_pdf"),"!"),t.xp6(6),t.lnq("*** ",t.lcZ(12,14,"lang_homework_export_homework_tutorial")," (",t.lcZ(13,16,"lang_homework_export_homework_choose"),": ",o.countSelected,")"),t.xp6(4),t.Q6J("formControl",o.isSelectAll),t.xp6(1),t.Oqu(o.isSelectAll.value?t.lcZ(17,18,"lang_homework_export_homework_clear_select_all"):t.lcZ(18,20,"lang_homework_export_homework_select_all")),t.xp6(3),t.Q6J("formGroup",o.form),t.xp6(1),t.Q6J("ngForOf",o.exportsFormArray.controls),t.xp6(3),t.hij("",t.lcZ(24,22,"lang_buttom_cancel_clear")," "),t.xp6(2),t.Q6J("disabled",!o.form.valid)("mat-dialog-close",t.VKq(26,Ke,o.exportsFormArray.value)),t.xp6(1),t.hij("",t.lcZ(27,24,"lang_buttom_agree")," "))},dependencies:[Z.sg,Ze.FC,L.aO,r._Y,r.JJ,r.JL,r.oH,r.sg,r.u,r.CE,rt.M,W.bT],encapsulation:2}),n})();function Xe(n=1){return e=>e.controls.map(i=>i.value).reduce((i,a)=>a?i+a:i,0)>=n?null:{required:!0}}let St=(()=>{class n extends $.Q{getData(){this.initStatusObj(),this.data.status?this.successStatusObj():this.stopStatusObj()}cleanResult(){var e=this.commonService.getFormObj(this.form),o={homeworkHashId:this.data.itemHomework.hashId,id:this.data.ans_id,resendNote:e.reason};this.initStatusObj(),this.subscriptions.add(this.answerService.apiAnswerResendAnswerPost(o).subscribe(i=>{var a;1==i.success?(this.showSuccessSnack("lang_cms_send_request_success"),this.result=!0,this.onSubmit({result:this.result,id:this.data.ans_id,itemHomework:this.data.itemHomework,isRedirect:this.data.redirect}),this.successStatusObj()):(this.showErrorSnack("lang_cms_send_request_error"),this.result=!1,this.onSubmit({result:this.result,id:this.data.ans_id,itemHomework:this.data.itemHomework,isRedirect:this.data.redirect}),this.errorStatusObj(null!==(a=i.message)&&void 0!==a?a:""))}))}ngOnInit(){var e;this.homeworkHashId=null!==(e=this.commonService.getMyParam(this.activeRoute,"hash_id"))&&void 0!==e?e:"",this.getData(),this.form=this.fb.group({reason:new r.p4("",r.kI.required)}),super.ngOnInit()}constructor(e,o,i,a,s,l){super(s),this.dialogRef=e,this.answerService=o,this.activeRoute=i,this.fb=a,this.commonService=s,this.data=l,this.subscriptions=new lt.w0,this.form=new r.nJ({}),this.result=!1,this.homeworkHashId=""}onNoClick(){this.dialogRef.close()}onSubmit(e){this.dialogRef.close(e)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(L.hV),t.Y36(at.P6),t.Y36(R.gz),t.Y36(r.QS),t.Y36(X.v),t.Y36(L.eJ))},n.\u0275cmp=t.Xpm({type:n,selectors:[["clean-result-dialog"]],features:[t.qOj],decls:43,vars:31,consts:[[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"intro"],[1,"text-base","font-medium","mr-auto","text-center"],[3,"hidden"],[1,"d-flex","justify-content-center"],["role","status",1,"spinner-border"],[1,"sr-only"],[1,"intro",3,"hidden"],["enctype","multipart/form-data",1,"form-horizontal","text-center",3,"formGroup"],[1,"text-left",2,"border","1px dashed red","padding","10px 5px","border-radius","5px"],[1,"h5","text-danger","text-center"],[1,"h5","mb-1"],[1,"text-danger"],[1,"h5","text-danger","mt-1","mb-1"],["type","text","id","reason","formControlName","reason",1,"form-control","mt-2"],[1,"text-right","mt-3"],["azt-track-service","clean-result-dialog-_f7PVI4E-S_",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","clean-result-dialog-xDCHUvnl-fJ",1,"btn","w-24","btn-primary",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),t._uU(5),t.ALo(6,"mytranslate"),t.qZA()(),t._UZ(7,"br"),t.TgZ(8,"div",5)(9,"div",6)(10,"div",7)(11,"span",8),t._uU(12,"..."),t.qZA()()()(),t.TgZ(13,"div",9)(14,"form",10)(15,"div",11)(16,"p",12),t._uU(17),t.ALo(18,"mytranslate"),t.qZA(),t.TgZ(19,"p",13),t._uU(20),t.ALo(21,"mytranslate"),t.TgZ(22,"span",14),t._uU(23),t.qZA(),t._uU(24),t.ALo(25,"mytranslate"),t.TgZ(26,"span",14),t._uU(27),t.ALo(28,"formatOnlyDateByUserUnitPipe"),t.qZA(),t._uU(29),t.ALo(30,"mytranslate"),t.qZA(),t._UZ(31,"hr"),t.TgZ(32,"p",15),t._uU(33),t.ALo(34,"mytranslate"),t.qZA(),t._UZ(35,"input",16),t.qZA()()(),t.TgZ(36,"div",17)(37,"button",18),t.NdJ("click",function(){return o.onNoClick()}),t._uU(38),t.ALo(39,"mytranslate"),t.qZA(),t.TgZ(40,"button",19),t.NdJ("click",function(){return o.cleanResult()}),t._uU(41),t.ALo(42,"mytranslate"),t.qZA()()()()()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,13,"lang_homework_mark_exercise_utils_request_resubmit")),t.xp6(3),t.Q6J("hidden",!o.statusObj.loading),t.xp6(5),t.Q6J("hidden",o.statusObj.loading),t.xp6(1),t.Q6J("formGroup",o.form),t.xp6(3),t.hij("(*) ",t.lcZ(18,15,"lang_homework_mark_exercise_utils_note"),":"),t.xp6(3),t.hij(" ",t.lcZ(21,17,"lang_homework_mark_exercise_utils_request")," "),t.xp6(3),t.hij(" ",o.data.name," "),t.xp6(1),t.hij(" ",t.lcZ(25,19,"lang_homework_mark_exercise_utils_in_homework"),"\xa0"),t.xp6(3),t.Oqu(t.lcZ(28,21,o.data.deadline?o.data.deadline:o.data.itemHomework.createdAt)),t.xp6(2),t.hij("\xa0",t.lcZ(30,23,"lang_homework_mark_exercise_utils_will_be_deleted"),"! "),t.xp6(4),t.Oqu(t.lcZ(34,25,"lang_homework_mark_exercise_utils_coment_request_resubmit")),t.xp6(5),t.hij(" ",t.lcZ(39,27,"lang_buttom_cancel")," "),t.xp6(3),t.hij(" ",t.lcZ(42,29,"lang_buttom_confirm")," "))},dependencies:[r._Y,r.Fj,r.JJ,r.JL,r.sg,r.u,rt.M,W.bT,W._I],encapsulation:2}),n})(),jt=(()=>{class n extends $.Q{ngOnInit(){this.success=this.data.status}constructor(e,o,i,a){super(i),this.dialogRef=e,this.answerService=o,this.commonService=i,this.data=a,this.success=!1}checkNextAns(){this.dialogRef.close(),this.answerService.apiAnswerGetNextObjByHomeworkGet(this.data.homeworkHashId).subscribe(e=>{var o,i;1!=e.success?this.commonService.myNavigation("/admin/testbank/homework-results-list/"+this.data.classID+"/"+this.data.homeWorkID+"/"+this.data.homeworkHashId):this.commonService.myNavigationWithQueryString("/admin/homework/switch-mark-exercise/"+(null===(i=null===(o=e.data)||void 0===o?void 0:o.obj)||void 0===i?void 0:i.id)+"/"+this.data.homeworkHashId,"?backto="+encodeURIComponent(this.data.backToLink))})}onNoClick(){this.dialogRef.close()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(L.hV),t.Y36(ct.P),t.Y36(X.v),t.Y36(L.eJ))},n.\u0275cmp=t.Xpm({type:n,selectors:[["notice-dialog"]],features:[t.qOj],decls:22,vars:10,consts:[[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"intro"],[1,"text-base","font-medium","mr-auto"],[1,"mr-1",2,"color","green"],[2,"color","red","font-size","120%","font-weight","500"],[3,"mark"],[1,"text-right","mt-3"],["azt-track-service","notice-dialog-YnLBVlTjw",1,"btn","w-24","btn-secondary","mr-3",3,"click"],["azt-track-service","notice-dialog-D6RUmpOZKX",1,"btn","w-24","btn-primary",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4)(5,"mat-icon",5),t._uU(6,"check_circle"),t.qZA(),t._uU(7),t.ALo(8,"mytranslate"),t.qZA()(),t._UZ(9,"br"),t.TgZ(10,"div",3),t._uU(11),t.ALo(12,"mytranslate"),t.TgZ(13,"span",6),t._UZ(14,"azt-check-mark",7),t.qZA()(),t._UZ(15,"br"),t.TgZ(16,"div",8)(17,"button",9),t.NdJ("click",function(){return o.onNoClick()}),t._uU(18,"Ok"),t.qZA(),t.TgZ(19,"button",10),t.NdJ("click",function(){return o.checkNextAns()}),t._uU(20),t.ALo(21,"mytranslate"),t.qZA()()()()()),2&e&&(t.xp6(7),t.hij(" ",t.lcZ(8,4,"lang_homework_mark_exercise_utils_mark_success"),""),t.xp6(4),t.hij(" ",t.lcZ(12,6,"lang_homework_mark_exercise_utils_assignment_marking")," "),t.xp6(3),t.Q6J("mark",o.data.score),t.xp6(6),t.Oqu(t.lcZ(21,8,"lang_homework_mark_exercise_utils_mark_continue")))},dependencies:[nt.Hw,Ct.B,W.bT],styles:["#ok[_ngcontent-%COMP%]:hover{background-color:#e7e7e7}#next[_ngcontent-%COMP%]:hover{background-color:#1e579d!important}"]}),n})();var At=c(76056),Mt=c(15431),gt=c(41752),Tt=c(64123),to=c(44944),eo=c(38469),oo=c(66492);const io=["aztMarkNote"];function no(n,h){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"azt-mark-note",37,38),t.NdJ("handleBackLink",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.goBack())})("doneLoadData",function(i){t.CHM(e);const a=t.oxw();return t.KtG(a.doneLoadData(i))})("markData",function(i){t.CHM(e);const a=t.oxw();return t.KtG(a.getMarkData(i))})("sizeMarkEditor",function(i){t.CHM(e);const a=t.oxw();return t.KtG(a.getSizeMarkEditor(i))})("getIdHistory",function(i){t.CHM(e);const a=t.oxw();return t.KtG(a.getDataHistory(i))}),t.qZA(),t.BQk()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("dataMarkNote",e.dataMarkNote)("showBackLink",!0)("markedByObj",e.markedByObj)("historyAnswerObjs",e.historyAnswerObjs)}}function ao(n,h){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"mytranslate"),t.ALo(3,"mytranslate"),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.HOy(" ",t.lcZ(2,4,"lang_testbank_testted_list_number_success")+" "," ",e.markData.totalRight+", "," ",t.lcZ(3,6,"lang_testbank_testted_list_error")+" "," ",e.markData.totalWrong," ")}}function so(n,h){1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"lang_core_chua_co_so_cau_dung_cau_sai")))}function ro(n,h){if(1&n){const e=t.EpF();t.TgZ(0,"div",39)(1,"button",40),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.setPoint(a))}),t._uU(2),t.qZA()()}if(2&n){const e=h.$implicit;t.xp6(2),t.hij(" ",e.name," ")}}function lo(n,h){1&n&&(t.TgZ(0,"span",41),t._UZ(1,"azt-loading-ui",42),t.qZA()),2&n&&(t.xp6(1),t.Q6J("type","oval"))}const co=function(n){return{height:n}};let mo=(()=>{class n extends $.Q{onResize(e){this.changeSizeMarkGeneral()}doneLoadData(e){this.loadingDataCdn=!1}uploadDrawBase64ToCDN(e,o,i){let a=this.baseApiService.dataURItoBlob(e),s=Date.now();this.apiUploadService.commonUploadForMarkResult(a,`essay_note_${o}_${this.answerId}_${s}.png`,"image/png",1e4).subscribe(l=>{var m,u;l.type!=T.dt.UploadProgress&&(1==l.success?(!(null===(m=this.mnoteJsonData.pages)||void 0===m)&&m[o]&&(this.mnoteJsonData.pages[o].draw=null===(u=l.data)||void 0===u?void 0:u.url),this.pagesCount--,0==this.pagesCount&&this.remark(this.answerId,i,this.mnoteJsonData)):(this.showErrorSnack("lang_cms_cannot_save_data_marked"),this.stopStatusObj()))})}uploadAll(e,o){this.pagesCount=0;for(let i=0;i<e.length;i++)e[i].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(this.answerId,o,this.mnoteJsonData);else for(let i=0;i<e.length;i++)e[i].draw&&this.uploadDrawBase64ToCDN(e[i].draw,i,o)}sendDataToMarkNote(){var e,o,i,a,s,l,m,u,k,y,f,x,O,N,H;let U=this.result.hasOwnProperty("answerObj")&&null!==(e=this.castObj(this.result.answerObj))&&void 0!==e?e:{};if(this.result.hasOwnProperty("answerObj")){let I=this.commonService.willDeleteParseJson(null!==(o=U.result)&&void 0!==o?o:"");if(null!=I){let C=null!==(a=null===(i=I.pages)||void 0===i?void 0:i.length)&&void 0!==a?a:0;for(let z=0;z<C;z++)!(null===(s=I?.pages)||void 0===s)&&s[z].backgroundImage&&(I.pages[z].backgroundImage=this.cdnService.getMyCdn(null!==(l=I.pages[z].backgroundImage)&&void 0!==l?l:"")),null!==(m=I.pages)&&void 0!==m&&m[z].draw&&(I.pages[z].draw=this.cdnService.getMyCdn(I.pages[z].draw));I=JSON.stringify(I),U.result=JSON.stringify(I)}let J=this.commonService.willDeleteParseJson(null!==(u=U.files)&&void 0!==u?u:"");if(null!=J){for(let C=0;C<J.length;C++)J[C].url&&(J[C].url=this.cdnService.getMyCdn(J[C].url)),J[C].thumb&&(J[C].thumb=this.cdnService.getMyCdn(J[C].thumb));J=JSON.stringify(J),U.files=J}}let B=this.result.hasOwnProperty("studentObj")?this.result.studentObj:{},M=this.result.hasOwnProperty("classroomObj")?this.result.classroomObj:{},E=this.result.hasOwnProperty("homeworkObj")?this.result.homeworkObj:{},P=this.commonService.myParseJson(null!==(k=U.result)&&void 0!==k?k:"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let I=0;I<(null!==(f=null===(y=this.jsonData.pages)||void 0===y?void 0:y.length)&&void 0!==f?f:0);I++)!(null===(x=this.jsonData.pages)||void 0===x)&&x[I].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[I].backgroundImage=this.cdnService.getMyCdn(null!==(O=this.jsonData.pages[I].backgroundImage)&&void 0!==O?O:"")),null!==(N=this.jsonData.pages)&&void 0!==N&&N[I].hasOwnProperty("draw")&&(this.jsonData.pages[I].draw=this.cdnService.getMyCdn(null!==(H=this.jsonData.pages[I].draw)&&void 0!==H?H:""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="edit",this.jsonData.answer_obj=U,this.jsonData.student_obj=B,this.jsonData.classroom_obj=M,this.jsonData.homework_obj=E,P&&P.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=P.hideMark),this.dataMarkNote=this.jsonData;else{let I=[];this.files.forEach(C=>{I.push({backgroundImage:C.url})});let J={cmd:"initMNote",mode:"edit",pages:I,answer_obj:U,student_obj:B,classroom_obj:M,homework_obj:E};P&&P.hasOwnProperty("hideMark")&&(J.hideMark=P.hideMark),this.dataMarkNote=J}}getHistoryObjs(e){this.initStatusObj(),this.answerService.apiAnswerGetHistoryObjsGet(this.homeworkHashId,e).subscribe(o=>{var i,a,s;1==o.success?this.historyAnswerObjs=null!==(a=null===(i=o.data)||void 0===i?void 0:i.objs)&&void 0!==a?a:new Array:this.errorMessage=null!==(s=o.message)&&void 0!==s?s:"",this.stopStatusObj()})}getDataHistory(e){this.historyId=e,this.errorMessage="",this.countLoad=1,this.answerService.apiAnswerGetHistoryObjGet(this.homeworkHashId,this.answerId,parseInt(e,10)).subscribe(o=>{var i,a,s,l,m,u,k,y,f,x,O,N,H,U,B,M,E,P,I;if(1==o.success){if(this.zipDataService.convertSubmittedAnswersObj(null===(i=o.data)||void 0===i?void 0:i.answerObj),o.data){this.result=o.data,this.markedByObj=null!==(a=o.data.markedByObj)&&void 0!==a?a:{},this.score=null!==(m=null===(l=null===(s=o.data)||void 0===s?void 0:s.answerObj)||void 0===l?void 0:l.point)&&void 0!==m?m:0,this.pointExercise.value=null!==(y=null===(k=null===(u=o.data)||void 0===u?void 0:u.answerObj)||void 0===k?void 0:k.point)&&void 0!==y?y:"",this.pointExercise.value<1e3?this.pointExercise.name=this.pointExercise.value.toString():this.listPointAzt.forEach(C=>{C.value==this.pointExercise.value&&(this.pointExercise=this.commonService.myClone(C))}),"0"==this.pointExercise.name&&(this.pointExercise.name="");let J=this.castJsonToObj(null!==(x=null===(f=o.data.answerObj)||void 0===f?void 0:f.resultNote)&&void 0!==x?x:"");if(this.commentExercise=null!==(O=J.Note)&&void 0!==O?O:"",this.showPoint=!J.IsHideMark,this.files=null!==(U=this.commonService.myParseJson(null!==(H=null===(N=o.data.answerObj)||void 0===N?void 0:N.files)&&void 0!==H?H:""))&&void 0!==U?U:[],null!=this.files)for(let C=0;C<this.files.length;C++)this.files[C].url=this.cdnService.getMyCdn(null!==(M=null===(B=this.files)||void 0===B?void 0:B[C].url)&&void 0!==M?M:""),this.files[C].thumb=this.cdnService.getMyCdn(null!==(P=null===(E=this.files)||void 0===E?void 0:E[C].thumb)&&void 0!==P?P:"");this.handleJsonData(),this.hasLoadedData=!0,this.sendDataToMarkNote(),this.successStatusObj()}}else this.errorMessage=null!==(I=o.message)&&void 0!==I?I:"",this.stopStatusObj()})}handleJsonData(){var e,o,i,a,s,l,m;if(this.jsonData={},null!==(o=null===(e=this.result)||void 0===e?void 0:e.answerObj)&&void 0!==o&&o.confirmedAt||null!==(a=null===(i=this.result)||void 0===i?void 0:i.answerObj)&&void 0!==a&&a.result||(this.isMarked=!1),null!==(s=this.result.answerObj)&&void 0!==s&&s.confirmedAt){this.isMarked=!0;var u=this.commonService.myParseJson(null!==(m=null===(l=this.result.answerObj)||void 0===l?void 0:l.result)&&void 0!==m?m:"");u&&(this.jsonData=u,null==this.jsonData&&(this.isMarked=!1))}}getData(e){this.initStatusObj(),this.errorMessage="",this.answerId=e,this.answerService.apiAnswerGetObjGet(this.homeworkHashId,e).subscribe(o=>{var i,a,s,l,m,u,k,y,f,x,O,N,H,U,B,M,E,P,I,J,C,z,F,V,pt,vt,ft,bt;if(1==o.success)if(this.zipDataService.convertSubmittedAnswersObj(null===(i=o.data)||void 0===i?void 0:i.answerObj),null!==(a=o.data)&&void 0!==a&&a.hasOwnProperty("studentObj")&&null!=(null===(s=o.data)||void 0===s?void 0:s.studentObj)){this.result=o.data,this.markedByObj=null!==(l=o.data.markedByObj)&&void 0!==l?l:{},this.score=null!==(k=null===(u=null===(m=o.data)||void 0===m?void 0:m.answerObj)||void 0===u?void 0:u.point)&&void 0!==k?k:0,this.pointExercise.value=null!==(x=null===(f=null===(y=o.data)||void 0===y?void 0:y.answerObj)||void 0===f?void 0:f.point)&&void 0!==x?x:0,this.pointExercise.value<1e3?this.pointExercise.name=this.pointExercise.value.toString():this.listPointAzt.forEach(tt=>{tt.value==this.pointExercise.value&&(this.pointExercise=this.commonService.myClone(tt))}),"0"==this.pointExercise.name&&(this.pointExercise.name="");let Zt=this.castJsonToObj(null!==(N=null===(O=o.data.answerObj)||void 0===O?void 0:O.resultNote)&&void 0!==N?N:"");if(this.commentExercise=null!==(H=Zt.Note)&&void 0!==H?H:"",this.showPoint=!Zt.IsHideMark,this.homeworkID=null!==(B=null===(U=o.data.homeworkObj)||void 0===U?void 0:U.id)&&void 0!==B?B:0,this.classID=null!==(E=null===(M=o.data.classroomObj)||void 0===M?void 0:M.id)&&void 0!==E?E:0,this.files=null!==(J=this.commonService.myParseJson(null!==(I=null===(P=o.data.answerObj)||void 0===P?void 0:P.files)&&void 0!==I?I:""))&&void 0!==J?J:[],this.studentObj=o.data.studentObj,this.classroomObj=null!==(C=o.data.classroomObj)&&void 0!==C?C:{},null!=this.files)for(let tt=0;tt<this.files.length;tt++)this.files[tt].url=this.cdnService.getMyCdn(null!==(F=null===(z=this.files)||void 0===z?void 0:z[tt].url)&&void 0!==F?F:""),this.files[tt].thumb=this.cdnService.getMyCdn(null!==(pt=null===(V=this.files)||void 0===V?void 0:V[tt].thumb)&&void 0!==pt?pt:"");this.homeworkObj=null!==(vt=o.data.homeworkObj)&&void 0!==vt?vt:{},this.studentName=null!==(ft=o.data.studentObj.fullName)&&void 0!==ft?ft:"",this.handleJsonData(),this.hasLoadedData=!0,0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToMarkNote()),this.successStatusObj()}else this.errorMessage="lang_core_not_found_student",this.stopStatusObj();else this.errorMessage=null!==(bt=o.message)&&void 0!==bt?bt:"",this.stopStatusObj()})}openDialog(e,o){this.dialog.open(jt,{width:"280px",autoFocus:!1,data:{score:o,status:e,homeWorkID:this.homeworkID,homeworkHashId:this.homeworkHashId,classID:this.classID,backToLink:this.backToLink},restoreFocus:!1}).afterClosed().subscribe(a=>{})}handleOpenReSubmit(){var e;this.openDialogReSubmit(!0,null!==(e=this.homeworkObj.deadline)&&void 0!==e?e:void 0,this.homeworkObj,this.answerId,this.studentName)}openDialogReSubmit(e,o,i,a,s){let l={status:e,deadline:o,itemHomework:i,ans_id:a,name:s,redirect:!0,classID:this.useNewDashboard?this.homeworkObj.categoryId:this.classID};this.dialog.open(St,{width:"380px",panelClass:"cleanResultDialogBox",data:l,restoreFocus:!1}).afterClosed().subscribe(u=>{if(u.result&&u.isRedirect){let k="?backto="+encodeURIComponent("/admin/testbank/document-management/1/"+l.classID+"/1");this.commonService.myNavigationWithQueryString("/admin/testbank/homework-results-list/"+l.classID+"/"+l.itemHomework.id+"/"+this.homeworkHashId,k),console.log("queryString",k)}})}remark(e,o,i){let a=JSON.stringify({type:"homework",id:this.homeworkObj.id,user:this.homeworkObj.tenantId});if(""==this.historyId)if(1==this.permissionService.hasMarkPointPermission("homework",this.homeworkObj.permissionObj)){let s={id:e,comment:i.comment,hideMark:i.hideMark?1:0,point:o?parseFloat(o.replace(",",".")):0,result:this.zipDataService.convertContentGzip(JSON.stringify(i)),homeworkHashId:this.homeworkHashId};this.answerService.apiAnswerSaveResultPost(s,a).subscribe(l=>{var m,u;1==l.success?(this.openDialog(!0,null===(u=null===(m=l.data)||void 0===m?void 0:m.obj)||void 0===u?void 0:u.point),this.successStatusObj()):(this.stopStatusObj(),this.showErrorSnack("lang_cms_mark_fail"))})}else this.showErrorSnack("lang_cms_no_permission_on_homework"),this.stopStatusObj();else this.stopStatusObj(),this.showErrorSnack("lang_cms_cannot_remark_student_history_result")}goBack(){var e;this.backToLink?this.backToLink.includes("shareType")?this.commonService.myNavigationBySpecialQueryString(this.backToLink):this.commonService.myNavigation(this.backToLink):this.commonService.myNavigation(this.useNewDashboard?"/admin/testbank/homework-results-list/"+(null!==(e=this.homeworkObj.categoryId)&&void 0!==e?e:"0")+"/"+this.homeworkID+"/"+this.homeworkObj.hashId:"/admin/testbank/homework-results-list/"+this.classID+"/"+this.homeworkID+"/"+this.homeworkObj.hashId)}checkModeUiEditor(e){var o;let a=((null===(o=document.getElementById("mark-general-box"))||void 0===o?void 0:o.offsetHeight)??0)-80-80-40-140-40-40-10;this.initDataEditor="dark"==e?{height:a,menubar:!1,resize:!1,skin:"oxide-dark",content_css:"dark",plugins:["advlist","anchor","autolink","charmap","code","fullscreen","lists","media","preview","textcolor","emoticons"],toolbar:"bold italic underline | forecolor backcolor | alignleft aligncenter alignright | emoticons",emoticons_database:"emojis"}:{height:a,menubar:!1,resize:!1,plugins:["advlist","anchor","autolink","charmap","code","fullscreen","lists","media","preview","textcolor","emoticons"],toolbar:"bold italic underline| forecolor backcolor  | alignleft aligncenter alignright | emoticons",emoticons_database:"emojis"}}setPoint(e){this.pointExercise=this.commonService.myClone(e)}setPointInput(e){if(e.target){let o=e.target.value;this.pointExercise.value=o,this.pointExercise.name=o}}getListPointDefault(){this.listPointAzt=[{value:1e3,name:"\u0110"},{value:1001,name:"C\u0110"},{value:2e3,name:"HT"},{value:2001,name:"CHT"},{value:3e3,name:"HTT"},{value:10,name:"10"},{value:9,name:"9"},{value:8,name:"8"},{value:7,name:"7"},{value:6,name:"6"},{value:5,name:"5"},{value:4,name:"4"},{value:3,name:"3"},{value:2,name:"2"},{value:1,name:"1"}]}getMarkData(e){var o,i;e.checkChangeMark&&(this.markData=e,this.pointExercise.value=isNaN(null!==(o=this.markData.pointRaw)&&void 0!==o?o:0)?"":this.markData.pointRaw,this.pointExercise.name=null===(i=this.pointExercise.value)||void 0===i?void 0:i.toString())}ngOnInit(){var e,o,i;this.commonService.isMobileDevice()||(document.body.style.overflowY="hidden"),this.getListPointDefault();const a=this.commonService.getMyParam(this.activeRoute,"id")?Number(this.commonService.getMyParam(this.activeRoute,"id")):0,s=null!==(e=this.commonService.getMyParam(this.activeRoute,"historyId"))&&void 0!==e?e:"";this.homeworkHashId=null!==(o=this.commonService.getMyParam(this.activeRoute,"hash_id"))&&void 0!==o?o:"";let l=this.commonService.getMyQueryParam("backto");this.backToLink=l?l.includes("shareType")?decodeURIComponent(l):l:"",this.getData(a),this.getHistoryObjs(a),s&&this.getDataHistory(s);let m=""==this.browserStorageService.getStorage("mode_ui")?"light":null!==(i=this.browserStorageService.getStorage("mode_ui"))&&void 0!==i?i:"light";this.checkModeUiEditor(m),this.commonService.translateMetaData({title:"lang_cms_homework_mark_exercise_title",description:"lang_cms_homework_mark_exercise_description",image:"lang_cms_test_image"}),super.ngOnInit()}getSizeMarkEditor(e){this.sizeMarkEditor=e}changeSizeMarkGeneral(){let e=document.getElementById("mark-general"),o=document.getElementById("mark-general-box");o&&e&&(o.style.width=e.offsetWidth.toString()+"px")}uploadDrawBase64ToCdn(e){var o,i,a,s,l;if(e.pages)for(let m=0;m<e.pages.length;m++)if(e.pages[m]&&null!==(o=e.pages[m].draws)&&void 0!==o&&o.length)for(let u=0;u<(null!==(a=null===(i=e.pages[m].draws)||void 0===i?void 0:i.length)&&void 0!==a?a:0);u++){let k=null!==(l=null===(s=e.pages[m].draws)||void 0===s?void 0:s[u])&&void 0!==l?l:{};if(k.src){let y=this.baseApiService.dataURItoBlob(k.src);this.apiUploadService.commonUploadForMarkResult(y,`essay_note_${m}_${u}_${this.answerId}.png`,"image/png",1e4).subscribe(f=>{var x;f.type!=T.dt.UploadProgress&&(k.src=null===(x=f.data)||void 0===x?void 0:x.url)})}}return e}saveDataMarkExercise(){var e;if(this.loadingSaveData=!0,""==this.historyId)if(1==this.permissionService.hasMarkPointPermission("homework",this.homeworkObj.permissionObj)){const o=null===(e=this.MarkNote)||void 0===e?void 0:e.exportDataMarkNote(),i=this.uploadDrawBase64ToCdn(o),a=this.zipDataService.convertContentGzip(JSON.stringify(i)),s=new Blob([a],{type:"text/plain"}),l=new File([s],"txt");this.apiUploadService.uploadToCdnForHomework(l).subscribe(m=>{var u,k,y,f;if(1==m.success){let x=null!==(k=null===(u=m.data)||void 0===u?void 0:u.url)&&void 0!==k?k:"",O={point:null===(y=this.pointExercise.value)||void 0===y?void 0:y.toString(),urlDataMark:x,version:"0.1",comment:this.commentExercise,hideMark:!this.showPoint};this.remark(this.answerId,null!==(f=O.point)&&void 0!==f?f:"0",O)}else this.showErrorSnack("lang_auto_co_loi_trong_qua_trinh_luu_du_lieu_len_cdn_vui_long_thu_lai");this.loadingSaveData=!1})}else this.showErrorSnack("lang_cms_no_permission_on_homework"),this.stopStatusObj();else this.stopStatusObj(),this.showErrorSnack("lang_cms_cannot_remark_student_history_result")}ngAfterViewInit(){this.changeSizeMarkGeneral()}constructor(e,o,i,a,s,l,m,u,k,y,f,x){super(a),this.activeRoute=e,this.answerService=o,this.baseApiService=i,this.commonService=a,this.permissionService=s,this.dialog=l,this.cdnService=m,this.zipDataService=u,this.envService=k,this.apiUploadService=y,this.browserStorageService=f,this.vcRef=x,this.result={},this.answerId=0,this.homeworkID="",this.historyId="",this.isMarked=!1,this.jsonData={},this.errorMessage="",this.files=[],this.classID="",this.homeworkObj={},this.studentName="",this.markedByObj={},this.studentObj={},this.classroomObj={},this.score=0,this.mnoteJsonData={},this.pagesCount=0,this.backToLink="",this.hasSendDataToIframe=!1,this.hasLoadedData=!1,this.historyAnswerObjs=[],this.countLoad=1,this.homeworkHashId="",this.useNewDashboard=!1,this.initDataEditor={},this.color="#000",this.dataMarkNote={},this.loadingSaveData=!1,this.loadingDataCdn=!0,this.listPointAzt=[],this.pointExercise={value:0,name:""},this.markData={},this.commentExercise="",this.showPoint=!0,this.sizeMarkEditor={width:200,height:800},this.handleIframe=O=>{var N;"MNoteJson"==O.data.cmd&&(this.initStatusObj(),this.mnoteJsonData=O.data.data,this.uploadAll(null!==(N=this.mnoteJsonData.pages)&&void 0!==N?N:[],O.data.data.point)),"MNoteReSubmit"==O.data.cmd&&(console.log("listend res submit"),this.handleOpenReSubmit()),"MNoteLoadComplete"==O.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,""==this.historyId&&this.sendDataToMarkNote()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){document.body.style.overflowY="auto",window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(R.gz),t.Y36(ct.P),t.Y36(At._),t.Y36(X.v),t.Y36(Mt.$),t.Y36(L.on),t.Y36(_t.U),t.Y36(it.D),t.Y36(gt.D),t.Y36(ht.$),t.Y36(kt.z),t.Y36(t.s_b))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-mark-exercise-new"]],viewQuery:function(e,o){if(1&e&&t.Gf(io,5),2&e){let i;t.iGM(i=t.CRH())&&(o.MarkNote=i.first)}},hostBindings:function(e,o){1&e&&t.NdJ("resize",function(a){return o.onResize(a)},!1,t.Jf7)},features:[t.qOj],decls:52,vars:39,consts:[[1,"content",2,"padding","0 12px"],[1,"grid","grid-cols-12","gap-3","mt-3"],[1,"col-span-12","md:col-span-8","mark-editor",3,"ngStyle"],[4,"ngIf"],["id","mark-general",1,"col-span-12","md:col-span-4","mark-general"],["id","mark-general-box",1,"box"],[1,"p-2"],[1,"box-head"],[1,"font-medium"],[1,"flex","items-center","mt-2"],[1,"info-student","flex","items-center"],[3,"nameCreateAvatar","size"],[1,"info","ml-2"],[1,"text-md"],[1,"text-xs"],[1,"score","ml-auto","flex","items-center"],["appOnlyNumber","","type","text","id","azt-score",1,"form-control","text-danger","font-medium",3,"decimal","max","value","placeholder","input"],[1,"bg-slate-200","dark:bg-darkmode-400","p-2","text-center","rounded","mt-3"],[4,"ngIf","ngIfElse"],["notMark",""],[1,"choose-score","mt-3"],[1,"score-list-one","grid","grid-cols-10","gap-3"],["class","score-item col-span-2",4,"ngFor","ngForOf"],[1,"comment","mt-3"],[1,"font-medium","text-md"],[1,"comment-editor","mt-2"],["apiKey","ldij13v1886vlrnk42g9bvngyqdc6gxpe8l0n9mo8gdjpg9d",3,"ngModel","init","ngModelChange"],[1,"flex","items-center","mt-3"],[1,"form-check","form-switch"],["id","show-score","type","checkbox",1,"form-check-input","mr-2",3,"ngModel","ngModelChange"],["for","show-score",1,"form-check-label","ml-0"],[1,"ml-auto"],["azt-track-service","mark-exercise-new-yWLPF_cK9E",1,"btn","btn-pending",3,"disabled","click"],[1,"grid","grid-cols-2","gap-3","mt-3"],["azt-track-service","mark-exercise-new-xgpK5bMM5y",1,"btn","btn-secondary",3,"click"],["azt-track-service","mark-exercise-new-lNij5J4UCD",1,"btn","btn-primary",3,"disabled","click"],["class","w-4 h-4 inline-block mr-2",4,"ngIf"],[3,"dataMarkNote","showBackLink","markedByObj","historyAnswerObjs","handleBackLink","doneLoadData","markData","sizeMarkEditor","getIdHistory"],["aztMarkNote",""],[1,"score-item","col-span-2"],["azt-track-service","mark-exercise-new-YBVZ7xc_A",1,"border","border-slate-200","dark:border-darkmode-400","btn-score","btn",3,"click"],[1,"w-4","h-4","inline-block","mr-2"],[3,"type"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t.YNc(3,no,3,4,"ng-container",3),t.qZA(),t.TgZ(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7)(8,"h3",8),t._uU(9),t.qZA(),t.TgZ(10,"div",9)(11,"div",10),t._UZ(12,"azt-create-avatar",11),t.TgZ(13,"div",12)(14,"p",13),t._uU(15),t.qZA(),t.TgZ(16,"p",14),t._uU(17),t.qZA()()(),t.TgZ(18,"div",15)(19,"input",16),t.NdJ("input",function(a){return o.setPointInput(a)}),t.ALo(20,"mytranslate"),t.qZA()()()(),t.TgZ(21,"div",17),t.YNc(22,ao,4,8,"span",18),t.YNc(23,so,3,3,"ng-template",null,19,t.W1O),t.qZA(),t.TgZ(25,"div",20)(26,"div",21),t.YNc(27,ro,3,1,"div",22),t.qZA()(),t.TgZ(28,"div",23)(29,"p",24),t._uU(30),t.ALo(31,"mytranslate"),t.qZA(),t.TgZ(32,"div",25)(33,"editor",26),t.NdJ("ngModelChange",function(a){return o.commentExercise=a}),t.qZA()()(),t.TgZ(34,"div",27)(35,"div",28)(36,"input",29),t.NdJ("ngModelChange",function(a){return o.showPoint=a}),t.qZA(),t.TgZ(37,"label",30),t._uU(38),t.ALo(39,"mytranslate"),t.qZA()(),t.TgZ(40,"div",31)(41,"button",32),t.NdJ("click",function(){return o.handleOpenReSubmit()}),t._uU(42),t.ALo(43,"mytranslate"),t.qZA()()(),t.TgZ(44,"div",33)(45,"button",34),t.NdJ("click",function(){return o.goBack()}),t._uU(46),t.ALo(47,"mytranslate"),t.qZA(),t.TgZ(48,"button",35),t.NdJ("click",function(){return o.saveDataMarkExercise()}),t.YNc(49,lo,2,1,"span",36),t._uU(50),t.ALo(51,"mytranslate"),t.qZA()()()()()()()),2&e){const i=t.MAs(24);t.xp6(2),t.Q6J("ngStyle",t.VKq(37,co,o.sizeMarkEditor.height+"px")),t.xp6(1),t.Q6J("ngIf",o.dataMarkNote.answer_obj),t.xp6(6),t.hij(" ",o.homeworkObj.name," "),t.xp6(3),t.Q6J("nameCreateAvatar",o.studentObj.fullName)("size",35),t.xp6(3),t.hij(" ",o.studentObj.fullName," "),t.xp6(2),t.hij(" ",o.classroomObj.name," "),t.xp6(2),t.s9C("placeholder",t.lcZ(20,25,"lang_auto_nhap_diem")),t.Q6J("decimal",!0)("max",999)("value",o.pointExercise.name),t.xp6(3),t.Q6J("ngIf",o.markData.totalRight||o.markData.totalWrong)("ngIfElse",i),t.xp6(5),t.Q6J("ngForOf",o.listPointAzt),t.xp6(3),t.hij(" ",t.lcZ(31,27,"lang_auto_nhan_xet")," "),t.xp6(3),t.Q6J("ngModel",o.commentExercise)("init",o.initDataEditor),t.xp6(3),t.Q6J("ngModel",o.showPoint),t.xp6(2),t.hij(" ",t.lcZ(39,29,"lang_auto_hien_thi_diem")," "),t.xp6(3),t.Q6J("disabled",""!==o.historyId),t.xp6(1),t.hij(" ",t.lcZ(43,31,"lang_auto_yeu_cau_nop_lai")," "),t.xp6(4),t.hij(" ",t.lcZ(47,33,"lang_auto_quay_lai")," "),t.xp6(2),t.Q6J("disabled",o.loadingSaveData||""!==o.historyId||""==o.pointExercise.name||o.loadingDataCdn),t.xp6(1),t.Q6J("ngIf",o.loadingSaveData),t.xp6(1),t.hij(" ",t.lcZ(51,35,"lang_auto_luu_du_lieu")," ")}},dependencies:[Z.sg,Z.O5,Z.PC,d.PG,r.Wl,r.JJ,r.On,Tt.g,to.Y,eo.J,oo.a,W.bT],styles:[".btn-score[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center}.btn-score[_ngcontent-%COMP%]:hover{background:rgb(var(--color-slate-200)/var(--tw-bg-opacity))}.choose-score[_ngcontent-%COMP%]{max-width:80%;margin-left:auto;margin-right:auto}.toolbar-list[_ngcontent-%COMP%]{width:100%;padding:5px;position:absolute;top:0;left:0;display:flex;align-items:center;border-bottom-left-radius:0;border-bottom-right-radius:0}.btn-icon[_ngcontent-%COMP%]{padding:10px;min-width:auto;line-height:initial}.toolbar-item[_ngcontent-%COMP%]{margin:0 3px}.toolbar-item[_ngcontent-%COMP%]:first-child{margin-left:0}.btn-icon-child[_ngcontent-%COMP%]{padding:5px}.azt-toolbar-active[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(var(--color-slate-200)/var(--tw-bg-opacity))}  .dark .azt-toolbar-active{--tw-bg-opacity: 1;background-color:rgb(var(--color-darkmode-200)/var(--tw-bg-opacity))}.mark-general[_ngcontent-%COMP%]{order:2}.mark-editor[_ngcontent-%COMP%]{order:1}@media screen and (max-width: 768px){.choose-score[_ngcontent-%COMP%]{max-width:80%}.mark-general[_ngcontent-%COMP%]{order:2}.mark-editor[_ngcontent-%COMP%]{order:1}.content[_ngcontent-%COMP%]{margin-bottom:100px}}#mark-general-box[_ngcontent-%COMP%]{height:calc(100vh - 24px);overflow:auto}@media screen and (max-width: 768px){#mark-general-box[_ngcontent-%COMP%]{position:relative;overflow:hidden}}"]}),n})();var ho=c(99818),Dt=c(86255);function uo(n,h){if(1&n&&(t.TgZ(0,"button",15),t.ALo(1,"mytranslate"),t.TgZ(2,"mat-icon"),t._uU(3,"history"),t.qZA()()),2&n){t.oxw();const e=t.MAs(8);t.s9C("matTooltip",t.lcZ(1,2,"lang_homework_mark_exercise_history_submit")),t.Q6J("matMenuTriggerFor",e)}}function _o(n,h){if(1&n){const e=t.EpF();t.TgZ(0,"li")(1,"button",16),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.getDataHistory(a.id?a.id.toString():""))}),t.TgZ(2,"span"),t._uU(3),t.ALo(4,"mytranslate"),t.ALo(5,"formatFullDateTimeWithoutSecondByUserUnitPipe"),t.qZA()()()}if(2&n){const e=h.$implicit,o=h.index;t.xp6(3),t.lnq("",t.lcZ(4,3,"lang_homework_mark_exercise_times")," ",o+1," - ",t.lcZ(5,5,e.createdAt),"")}}function go(n,h){if(1&n&&(t.TgZ(0,"span"),t._UZ(1,"azt-create-avatar",18),t.ALo(2,"mytranslate"),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.hYB("matTooltip","",t.lcZ(2,5,"lang_homework_mark_exercise_teacher_mark")," ",": "+e.markedByObj.fullName,""),t.Q6J("nameCreateAvatar",e.markedByObj.fullName)("size",25)("linkAvatar",e.markedByObj.avatar)}}function po(n,h){if(1&n&&(t.TgZ(0,"h4",17),t.YNc(1,go,3,7,"span",13),t._uU(2),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.isMarked),t.xp6(1),t.AsE(" ",e.studentObj.fullName,", ",e.classroomObj.name," ")}}function vo(n,h){1&n&&(t._UZ(0,"azt-loading-effect",19),t.ALo(1,"mytranslate")),2&n&&t.Q6J("customText",t.lcZ(1,1,"lang_homework_mark_exercise_loading_data_mark"))}function fo(n,h){if(1&n&&(t.TgZ(0,"div")(1,"div",20)(2,"div",21)(3,"div",22),t._uU(4),t.ALo(5,"mytranslate"),t.qZA()()()()),2&n){const e=t.oxw();t.xp6(4),t.Oqu(t.lcZ(5,1,e.errorMessage))}}function bo(n,h){if(1&n&&(t.TgZ(0,"div",23),t._UZ(1,"iframe",24),t.ALo(2,"safe"),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("src",t.lcZ(2,1,e.iframeSrc),t.uOi)}}let wo=(()=>{class n extends $.Q{onPopState(e){this.goBack()}uploadDrawBase64ToCDN(e,o,i){let a=this.baseApiService.dataURItoBlob(e);this.apiUploadService.commonUploadForMarkResult(a,`essay_note_${o}_${this.answerId}.png`,"image/png",1e4).subscribe(s=>{var l,m;s.type!=T.dt.UploadProgress&&(1==s.success?(!(null===(l=this.mnoteJsonData.pages)||void 0===l)&&l[o]&&(this.mnoteJsonData.pages[o].draw=null===(m=s.data)||void 0===m?void 0:m.url),this.pagesCount--,0==this.pagesCount&&this.remark(this.answerId,i,this.mnoteJsonData)):(this.showErrorSnack("lang_cms_cannot_save_data_marked"),this.stopStatusObj()))})}uploadAll(e,o){this.pagesCount=0;for(let i=0;i<e.length;i++)e[i].draw&&this.pagesCount++;if(0==this.pagesCount)this.remark(this.answerId,o,this.mnoteJsonData);else for(let i=0;i<e.length;i++)e[i].draw&&this.uploadDrawBase64ToCDN(e[i].draw,i,o)}reloadPage(){location.reload()}sendDataToIframe(){var e,o,i,a,s,l,m,u,k,y,f,x,O,N,H;const U=document.getElementById("mNote"),B=U?U.contentWindow:null;if(null!==B){let M=this.result.hasOwnProperty("answerObj")&&null!==(e=this.castObj(this.result.answerObj))&&void 0!==e?e:{};if(this.result.hasOwnProperty("answerObj")){let C=this.commonService.willDeleteParseJson(null!==(o=M.result)&&void 0!==o?o:"");if(null!=C){let F=null!==(a=null===(i=C.pages)||void 0===i?void 0:i.length)&&void 0!==a?a:0;for(let V=0;V<F;V++)!(null===(s=C?.pages)||void 0===s)&&s[V].backgroundImage&&(C.pages[V].backgroundImage=this.cdnService.getMyCdn(null!==(l=C.pages[V].backgroundImage)&&void 0!==l?l:"")),null!==(m=C.pages)&&void 0!==m&&m[V].draw&&(C.pages[V].draw=this.cdnService.getMyCdn(C.pages[V].draw));C=JSON.stringify(C),M.result=C}let z=this.commonService.willDeleteParseJson(null!==(u=M.files)&&void 0!==u?u:"");if(null!=z){for(let F=0;F<z.length;F++)z[F].url&&(z[F].url=this.cdnService.getMyCdn(z[F].url)),z[F].thumb&&(z[F].thumb=this.cdnService.getMyCdn(z[F].thumb));z=JSON.stringify(z),M.files=z}}let E=this.result.hasOwnProperty("studentObj")?this.result.studentObj:{},P=this.result.hasOwnProperty("classroomObj")?this.result.classroomObj:{},I=this.result.hasOwnProperty("homeworkObj")?this.result.homeworkObj:{},J=this.commonService.myParseJson(null!==(k=M.result)&&void 0!==k?k:"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let C=0;C<(null!==(f=null===(y=this.jsonData.pages)||void 0===y?void 0:y.length)&&void 0!==f?f:0);C++)!(null===(x=this.jsonData.pages)||void 0===x)&&x[C].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[C].backgroundImage=this.cdnService.getMyCdn(null!==(O=this.jsonData.pages[C].backgroundImage)&&void 0!==O?O:"")),null!==(N=this.jsonData.pages)&&void 0!==N&&N[C].hasOwnProperty("draw")&&(this.jsonData.pages[C].draw=this.cdnService.getMyCdn(null!==(H=this.jsonData.pages[C].draw)&&void 0!==H?H:""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="edit",this.jsonData.answer_obj=M,this.jsonData.student_obj=E,this.jsonData.classroom_obj=P,this.jsonData.homework_obj=I,J&&J.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=J.hideMark),B.postMessage(this.jsonData,"*");else{let C=[];this.files.forEach(F=>{C.push({backgroundImage:F.url})});let z={cmd:"initMNote",mode:"edit",pages:C,answer_obj:M,student_obj:E,classroom_obj:P,homework_obj:I};J&&J.hasOwnProperty("hideMark")&&(z.hideMark=J.hideMark),B.postMessage(z,"*")}}}sendDataToIframeHistory(){var e,o,i,a,s,l,m,u,k,y;const f=document.getElementById("mNote");f&&1==this.countLoad&&(f.src+="");const x=f?f.contentWindow:null;if(null!==x){let O=this.result.hasOwnProperty("answerObj")&&null!==(e=this.castObj(this.result.answerObj))&&void 0!==e?e:{};if(this.result.hasOwnProperty("answerObj")){let M=this.commonService.willDeleteParseJson(null!==(o=O.result)&&void 0!==o?o:"");if(null!=M){for(let P=0;P<M.pages.length;P++)M.pages[P].backgroundImage&&(M.pages[P].backgroundImage=this.cdnService.getMyCdn(M.pages[P].backgroundImage)),M.pages[P].draw&&(M.pages[P].draw=this.cdnService.getMyCdn(M.pages[P].draw));M=JSON.stringify(M),O.result=M}let E=this.commonService.willDeleteParseJson(null!==(i=O.files)&&void 0!==i?i:"");if(null!=E){for(let P=0;P<E.length;P++)E[P].url&&(E[P].url=this.cdnService.getMyCdn(E[P].url)),E[P].thumb&&(E[P].thumb=this.cdnService.getMyCdn(E[P].thumb));E=JSON.stringify(E),O.files=E}}let N=this.studentObj,H=this.classroomObj,U=this.homeworkObj,B=this.commonService.willDeleteParseJson(null!==(a=O.result)&&void 0!==a?a:"");if(this.jsonData&&this.jsonData.hasOwnProperty("pages"))for(let M=0;M<(null!==(l=null===(s=this.jsonData.pages)||void 0===s?void 0:s.length)&&void 0!==l?l:0);M++)!(null===(m=this.jsonData.pages)||void 0===m)&&m[M].hasOwnProperty("backgroundImage")&&(this.jsonData.pages[M].backgroundImage=this.cdnService.getMyCdn(null!==(u=this.jsonData.pages[M].backgroundImage)&&void 0!==u?u:"")),null!==(k=this.jsonData.pages)&&void 0!==k&&k[M].hasOwnProperty("draw")&&(this.jsonData.pages[M].draw=this.cdnService.getMyCdn(null!==(y=this.jsonData.pages[M].draw)&&void 0!==y?y:""));if(this.isMarked)this.jsonData.cmd="initMNote",this.jsonData.mode="view",this.jsonData.answer_obj=O,this.jsonData.student_obj=N,this.jsonData.classroom_obj=H,this.jsonData.homework_obj=U,B&&B.hasOwnProperty("hideMark")&&(this.jsonData.hideMark=B.hideMark),x.postMessage(this.jsonData,"*");else{let M=[];this.files.forEach(P=>{M.push({backgroundImage:P.url})});let E={cmd:"initMNote",mode:"view",pages:M,answer_obj:O,student_obj:N,classroom_obj:H,homework_obj:U};B&&B.hasOwnProperty("hideMark")&&(E.hideMark=B.hideMark),x.postMessage(E,"*")}}}getHistoryObjs(e){this.initStatusObj(),this.answerService.apiAnswerGetHistoryObjsGet(this.homeworkHashId,e).subscribe(o=>{var i,a,s;1==o.success?this.historyAnswerObjs=null!==(a=null===(i=o.data)||void 0===i?void 0:i.objs)&&void 0!==a?a:new Array:this.errorMessage=null!==(s=o.message)&&void 0!==s?s:"",this.stopStatusObj()})}getDataHistory(e){this.historyId=e,this.errorMessage="",this.countLoad=1,this.answerService.apiAnswerGetHistoryObjGet(this.homeworkHashId,this.answerId,parseInt(e,10)).subscribe(o=>{var i,a,s,l,m,u,k,y,f,x,O,N,H,U,B,M;if(1==o.success){if(this.zipDataService.convertSubmittedAnswersHistoryObj(null===(i=o.data)||void 0===i?void 0:i.answerObj),this.result=null!==(a=o.data)&&void 0!==a?a:{},this.markedByObj=null!==(l=null===(s=o.data)||void 0===s?void 0:s.markedByObj)&&void 0!==l?l:{},this.score=null!==(k=null===(u=null===(m=o.data)||void 0===m?void 0:m.answerObj)||void 0===u?void 0:u.point)&&void 0!==k?k:0,this.files=null!==(O=this.commonService.myParseJson(null!==(x=null===(f=null===(y=o.data)||void 0===y?void 0:y.answerObj)||void 0===f?void 0:f.files)&&void 0!==x?x:""))&&void 0!==O?O:[],null!=this.files)for(let E=0;E<this.files.length;E++)this.files[E].url=this.cdnService.getMyCdn(null!==(H=null===(N=this.files)||void 0===N?void 0:N[E].url)&&void 0!==H?H:""),this.files[E].thumb=this.cdnService.getMyCdn(null!==(B=null===(U=this.files)||void 0===U?void 0:U[E].thumb)&&void 0!==B?B:"");this.handleJsonData(),this.hasLoadedData=!0,1==this.countLoad&&(this.hasSendDataToIframe=!1),0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToIframeHistory()),this.successStatusObj(),this.countLoad++}else this.errorMessage=null!==(M=o.message)&&void 0!==M?M:"",this.stopStatusObj()})}handleJsonData(){var e,o,i,a,s,l,m;if(this.jsonData={},null!==(o=null===(e=this.result)||void 0===e?void 0:e.answerObj)&&void 0!==o&&o.confirmedAt||null!==(a=null===(i=this.result)||void 0===i?void 0:i.answerObj)&&void 0!==a&&a.result||(this.isMarked=!1),null!==(s=this.result.answerObj)&&void 0!==s&&s.confirmedAt){this.isMarked=!0;var u=this.commonService.myParseJson(null!==(m=null===(l=this.result.answerObj)||void 0===l?void 0:l.result)&&void 0!==m?m:"");u&&(this.jsonData=u,null==this.jsonData&&(this.isMarked=!1))}}getData(e){this.initStatusObj(),this.errorMessage="",this.answerId=e,this.answerService.apiAnswerGetObjGet(this.homeworkHashId,e).subscribe(o=>{var i,a,s,l,m,u,k,y,f,x,O,N,H,U,B,M,E,P,I,J,C,z;if(1==o.success)if(this.zipDataService.convertSubmittedAnswersObj(null===(i=o.data)||void 0===i?void 0:i.answerObj),null!==(a=o.data)&&void 0!==a&&a.hasOwnProperty("studentObj")&&null!=(null===(s=o.data)||void 0===s?void 0:s.studentObj)){if(this.result=o.data,this.markedByObj=null!==(l=o.data.markedByObj)&&void 0!==l?l:{},this.score=null!==(k=null===(u=null===(m=o.data)||void 0===m?void 0:m.answerObj)||void 0===u?void 0:u.point)&&void 0!==k?k:0,this.homeworkID=null!==(f=null===(y=o.data.homeworkObj)||void 0===y?void 0:y.id)&&void 0!==f?f:0,this.classID=null!==(O=null===(x=o.data.classroomObj)||void 0===x?void 0:x.id)&&void 0!==O?O:0,this.files=null!==(U=this.commonService.myParseJson(null!==(H=null===(N=o.data.answerObj)||void 0===N?void 0:N.files)&&void 0!==H?H:""))&&void 0!==U?U:[],this.studentObj=o.data.studentObj,this.classroomObj=null!==(B=o.data.classroomObj)&&void 0!==B?B:{},null!=this.files)for(let F=0;F<this.files.length;F++)this.files[F].url=this.cdnService.getMyCdn(null!==(E=null===(M=this.files)||void 0===M?void 0:M[F].url)&&void 0!==E?E:""),this.files[F].thumb=this.cdnService.getMyCdn(null!==(I=null===(P=this.files)||void 0===P?void 0:P[F].thumb)&&void 0!==I?I:"");this.homeworkObj=null!==(J=o.data.homeworkObj)&&void 0!==J?J:{},this.studentName=null!==(C=o.data.studentObj.fullName)&&void 0!==C?C:"",this.handleJsonData(),this.hasLoadedData=!0,0==this.hasSendDataToIframe&&(this.hasSendDataToIframe=!0,this.sendDataToIframe()),this.successStatusObj()}else this.errorMessage="lang_core_not_found_student",this.stopStatusObj();else this.errorMessage=null!==(z=o.message)&&void 0!==z?z:"",this.stopStatusObj()})}openDialog(e,o){this.dialog.open(jt,{width:"280px",autoFocus:!1,data:{score:o,status:e,homeWorkID:this.homeworkID,homeworkHashId:this.homeworkHashId,classID:this.classID,backToLink:this.backToLink},restoreFocus:!1}).afterClosed().subscribe(a=>{})}handleOpenReSubmit(){var e;this.openDialogReSubmit(!0,null!==(e=this.homeworkObj.deadline)&&void 0!==e?e:void 0,this.homeworkObj,this.answerId,this.studentName)}openDialogReSubmit(e,o,i,a,s){let l={status:e,deadline:o,itemHomework:i,ans_id:a,name:s,redirect:!0,classID:this.useNewDashboard?this.homeworkObj.categoryId:this.classID};this.dialog.open(St,{width:"380px",panelClass:"cleanResultDialogBox",data:l,restoreFocus:!1}).afterClosed().subscribe(u=>{if(u.result&&u.isRedirect){let k="?backto="+encodeURIComponent("/admin/testbank/document-management/1/"+l.classID+"/1");this.commonService.myNavigationWithQueryString("/admin/testbank/homework-results-list/"+l.classID+"/"+l.itemHomework.id+"/"+this.homeworkHashId,k),console.log("queryString",k)}})}remark(e,o,i){let a=JSON.stringify({type:"homework",id:this.homeworkObj.id,user:this.homeworkObj.tenantId});if(""==this.historyId)if(1==this.permissionService.hasMarkPointPermission("homework",this.homeworkObj.permissionObj)){let s={id:e,comment:i.comment,hideMark:i.hideMark?1:0,point:o?parseFloat(o.replace(",",".")):0,result:this.zipDataService.convertContentGzip(JSON.stringify(i)),homeworkHashId:this.homeworkHashId};this.answerService.apiAnswerSaveResultPost(s,a).subscribe(l=>{var m,u;1==l.success?(this.openDialog(!0,null===(u=null===(m=l.data)||void 0===m?void 0:m.obj)||void 0===u?void 0:u.point),this.successStatusObj()):(this.stopStatusObj(),this.showErrorSnack("lang_cms_mark_fail"))})}else this.showErrorSnack("lang_cms_no_permission_on_homework"),this.stopStatusObj();else this.stopStatusObj(),this.showErrorSnack("lang_cms_cannot_remark_student_history_result")}goBack(){var e;this.backToLink?this.backToLink.includes("shareType")?this.commonService.myNavigationBySpecialQueryString(this.backToLink):this.commonService.myNavigation(this.backToLink):this.commonService.myNavigation(this.useNewDashboard?"/admin/testbank/homework-results-list/"+(null!==(e=this.homeworkObj.categoryId)&&void 0!==e?e:"0")+"/"+this.homeworkID+"/"+this.homeworkObj.hashId:"/admin/testbank/homework-results-list/"+this.classID+"/"+this.homeworkID+"/"+this.homeworkObj.hashId);let o=document.body,i=document.getElementById("azota-app-html");i?.classList.remove("overflow-hidden"),i?.classList.remove("height-100"),o.classList.remove("overflow-hidden"),o.classList.remove("height-100")}ngOnInit(){var e,o,i;let a=document.body,s=document.getElementById("azota-app-html");s?.classList.add("overflow-hidden"),s?.classList.add("height-100"),a.classList.add("overflow-hidden"),a.classList.add("height-100"),this.iframeSrc=null!==(e=this.envService.getEnvValue("classliveUrl"))&&void 0!==e?e:"";const l=this.commonService.getMyParam(this.activeRoute,"id")?Number(this.commonService.getMyParam(this.activeRoute,"id")):0,m=null!==(o=this.commonService.getMyParam(this.activeRoute,"historyId"))&&void 0!==o?o:"";this.homeworkHashId=null!==(i=this.commonService.getMyParam(this.activeRoute,"hash_id"))&&void 0!==i?i:"";let u=this.commonService.getMyQueryParam("backto");this.backToLink=u?u.includes("shareType")?decodeURIComponent(u):u:"",console.log(this.backToLink),this.getData(l),this.getHistoryObjs(l),m&&this.getDataHistory(m),this.commonService.translateMetaData({title:"lang_cms_homework_mark_exercise_title",description:"lang_cms_homework_mark_exercise_description",image:"lang_cms_test_image"}),super.ngOnInit()}ngAfterViewInit(){window.addEventListener("message",this.handleIframe)}constructor(e,o,i,a,s,l,m,u,k,y){super(a),this.activeRoute=e,this.answerService=o,this.baseApiService=i,this.commonService=a,this.permissionService=s,this.dialog=l,this.cdnService=m,this.zipDataService=u,this.envService=k,this.apiUploadService=y,this.subscriptions=new lt.w0,this.result={},this.answerId=0,this.homeworkID="",this.historyId="",this.iframeSrc="",this.isMarked=!1,this.jsonData={},this.errorMessage="",this.files=[],this.classID="",this.homeworkObj={},this.studentName="",this.markedByObj={},this.studentObj={},this.classroomObj={},this.score=0,this.mnoteJsonData={},this.pagesCount=0,this.backToLink="",this.hasSendDataToIframe=!1,this.hasLoadedData=!1,this.historyAnswerObjs=[],this.countLoad=1,this.homeworkHashId="",this.useNewDashboard=!1,this.handleIframe=f=>{var x;"MNoteJson"==f.data.cmd&&(this.initStatusObj(),this.mnoteJsonData=f.data.data,this.uploadAll(null!==(x=this.mnoteJsonData.pages)&&void 0!==x?x:[],f.data.data.point)),"MNoteReSubmit"==f.data.cmd&&(console.log("listend res submit"),this.handleOpenReSubmit()),"MNoteLoadComplete"==f.data&&(this.hasLoadedData?(this.hasSendDataToIframe=!0,""==this.historyId?this.sendDataToIframe():this.sendDataToIframeHistory()):this.hasSendDataToIframe=!1)}}ngOnDestroy(){window.removeEventListener("message",this.handleIframe),super.ngOnDestroy()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(R.gz),t.Y36(ct.P),t.Y36(At._),t.Y36(X.v),t.Y36(Mt.$),t.Y36(L.on),t.Y36(_t.U),t.Y36(it.D),t.Y36(gt.D),t.Y36(ht.$))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-mark-exericse"]],hostBindings:function(e,o){1&e&&t.NdJ("popstate",function(a){return o.onPopState(a)},!1,t.Jf7)},features:[t.qOj],decls:22,vars:13,consts:[["id","markContainer",1,"maxW1000"],["id","titleRow"],[1,"block-left"],["azt-track-service","mark-exercise-bqS4xx4zrp","mat-button","",3,"title","click"],["mat-icon-button","",3,"matTooltip","matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],[1,"dropdown-menu","w-56","show","relative"],[1,"dropdown-content"],["azt-track-service","mark-exercise-7krhNQm3da",1,"dropdown-item","w-full",3,"click"],[4,"ngFor","ngForOf"],["class","studentInfo","style","padding-right: 10px; color: #fff",4,"ngIf"],[3,"customText",4,"ngIf"],[3,"hidden"],[4,"ngIf"],["class","card-box listPhotos",4,"ngIf"],["mat-icon-button","",3,"matTooltip","matMenuTriggerFor"],["azt-track-service","mark-exercise-5mJpoIUV_A",1,"dropdown-item","w-full",3,"click"],[1,"studentInfo",2,"padding-right","10px","color","#fff"],[2,"cursor","pointer",3,"matTooltip","nameCreateAvatar","size","linkAvatar"],[3,"customText"],[1,"row","justify-content-center","py-5"],[1,"col-12","text-center"],[1,"alert","alert-danger"],[1,"card-box","listPhotos"],["id","mNote","frameborder","0",2,"width","100%","height","100%",3,"src"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-icon",3),t.NdJ("click",function(){return o.goBack()}),t.ALo(4,"mytranslate"),t._uU(5,"keyboard_arrow_left"),t.qZA(),t.YNc(6,uo,4,4,"button",4),t.TgZ(7,"mat-menu",null,5)(9,"div",6)(10,"ul",7)(11,"li")(12,"button",8),t.NdJ("click",function(){return o.reloadPage()}),t.TgZ(13,"span"),t._uU(14),t.ALo(15,"mytranslate"),t.qZA()()(),t.YNc(16,_o,6,7,"li",9),t.qZA()()()(),t.YNc(17,po,3,3,"h4",10),t.qZA(),t.YNc(18,vo,2,3,"azt-loading-effect",11),t.TgZ(19,"div",12),t.YNc(20,fo,6,3,"div",13),t.YNc(21,bo,3,3,"div",14),t.qZA()()),2&e&&(t.xp6(3),t.s9C("title",t.lcZ(4,9,"lang_buttom_back")),t.xp6(3),t.Q6J("ngIf",null!=o.historyAnswerObjs&&o.historyAnswerObjs.length>0),t.xp6(8),t.Oqu(t.lcZ(15,11,"lang_homework_mark_exercise_last")),t.xp6(2),t.Q6J("ngForOf",o.historyAnswerObjs),t.xp6(1),t.Q6J("ngIf",o.classroomObj),t.xp6(1),t.Q6J("ngIf",o.statusObj.loading),t.xp6(1),t.Q6J("hidden",o.statusObj.loading),t.xp6(1),t.Q6J("ngIf",""!=o.errorMessage),t.xp6(1),t.Q6J("ngIf",""==o.errorMessage))},dependencies:[Z.sg,Z.O5,ho.eB,nt.Hw,Dt.W0,Dt.D8,xt.Kd,st.Q,Tt.g,W.bT,W.yl,W.tO],styles:["#markContainer[_ngcontent-%COMP%]{position:relative}  .studentInfo img{display:inline-flex!important}#titleRow[_ngcontent-%COMP%]{background-color:#00a7d0;height:40px;position:relative;align-items:center;display:flex;justify-content:space-between;color:#fff}#titleRow[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer}#titleRow[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-bottom:0;font-weight:500;font-size:16px;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;display:-webkit-box}#titleRow[_ngcontent-%COMP%]   .score[_ngcontent-%COMP%]{margin-right:5px}.block-left[_ngcontent-%COMP%]{display:flex;align-items:center}button[_ngcontent-%COMP%]{border:none}.listPhotos[_ngcontent-%COMP%]{width:100%;position:fixed;top:40px;bottom:0}.file[_ngcontent-%COMP%]{border-width:0px;background:inherit;background-color:#f2f2f2;box-sizing:border-box;border-width:1px;border-style:solid;border-color:#e5e5e5;border-left:0px;border-right:0px;border-radius:0;box-shadow:none}.file[_ngcontent-%COMP%]:first-child{margin-top:52px}.file[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.back[_ngcontent-%COMP%]{padding:15px 10px}.back-to[_ngcontent-%COMP%]{color:#fff;display:flex}.back-to[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-bottom:10px}.block[_ngcontent-%COMP%]{padding-top:2px}.mat-expansion-indicator[_ngcontent-%COMP%]:after{color:#fff!important}.add-click[_ngcontent-%COMP%]{display:flex}.add-icon[_ngcontent-%COMP%]{margin-top:5px}.file-custom[_ngcontent-%COMP%]{margin-top:6px}.description__share[_ngcontent-%COMP%]{margin-top:10px}.description__share[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#fff;color:#666;margin-right:15px;padding:5px 10px 0}.row-check[_ngcontent-%COMP%]{border-bottom:1px solid #eee;padding:10px 0}.col-check[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:5px}.exercise[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:25px 0 15px;border-bottom:1px solid #eee}.btn-custom[_ngcontent-%COMP%]{background-color:#f39c12;color:#fff;border-radius:5px;padding:10px 25px}.files-custom[_ngcontent-%COMP%]{margin:0}.btn-share[_ngcontent-%COMP%]{border:1px solid #eee}.score-exercise[_ngcontent-%COMP%]{background-color:#ea3d19;border-radius:50%;padding:3px 5px 3px 7px;color:#fff;font-weight:600;margin:0 10px}#listNumber[_ngcontent-%COMP%]{display:contents}#markNumber[_ngcontent-%COMP%]{position:absolute;top:40px;right:50%;z-index:9;margin-right:-60px;color:#fff;text-transform:uppercase;width:120px}@media (min-width: 1000px){.mark-edit[_ngcontent-%COMP%]{width:250px}.file[_ngcontent-%COMP%]:first-child{margin-top:0}.listPhotos[_ngcontent-%COMP%]{width:1000px}}"]}),n})();const yo=[{path:"",component:(()=>{class n extends $.Q{ngOnInit(){super.ngOnInit()}constructor(e){super(e),this.commonService=e}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(X.v))},n.\u0275cmp=t.Xpm({type:n,selectors:[["homework-master-page"]],features:[t.qOj],decls:2,vars:0,consts:[["id","homework-layout"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"router-outlet"),t.qZA())},dependencies:[R.lC],encapsulation:2}),n})(),canActivate:[S.v],children:[{path:"add-new-homework/:cat_id",component:oe},{path:"mark-exercise/:id/:hash_id",component:wo},{path:"switch-mark-exercise/:id/:hash_id",component:(()=>{class n extends $.Q{getData(e){this.initStatusObj(),this.answerService.apiAnswerGetObjGet(this.homeworkHashId,e).subscribe(o=>{var i,a,s,l,m,u,k,y,f,x;if(1==o.success)if(this.zipDataService.convertSubmittedAnswersObj(null===(i=o.data)||void 0===i?void 0:i.answerObj),null!==(a=o.data)&&void 0!==a&&a.hasOwnProperty("studentObj")&&null!=(null===(s=o.data)||void 0===s?void 0:s.studentObj)){const O=o.data,N=parseInt(this.classliveUrl.split("?")[1].split("=")[1]),H=1e6;null!==(l=O.answerObj)&&void 0!==l&&l.result?(null!==(u=null===(m=O.answerObj)||void 0===m?void 0:m.result)&&void 0!==u?u:"").includes("urlDataMark")?this.commonService.myNavigationWithQueryString(`/admin/homework/mark-exercise-new/${null===(k=O.answerObj)||void 0===k?void 0:k.id}/${this.homeworkHashId}`,`?backto=${encodeURIComponent(this.backToLink)}`):this.commonService.myNavigationWithQueryString(`/admin/homework/mark-exercise/${null===(y=O.answerObj)||void 0===y?void 0:y.id}/${this.homeworkHashId}`,`?backto=${encodeURIComponent(this.backToLink)}`):this.commonService.myNavigationWithQueryString(N>H?`/admin/homework/mark-exercise-new/${null===(f=O.answerObj)||void 0===f?void 0:f.id}/${this.homeworkHashId}`:`/admin/homework/mark-exercise/${null===(x=O.answerObj)||void 0===x?void 0:x.id}/${this.homeworkHashId}`,`?backto=${encodeURIComponent(this.backToLink)}`),this.successStatusObj()}else this.stopStatusObj();else this.stopStatusObj()})}ngOnInit(){var e,o;this.classliveUrl=null!==(e=this.envService.getEnvValue("classliveUrl"))&&void 0!==e?e:"",this.homeworkHashId=null!==(o=this.commonService.getMyParam(this.activeRoute,"hash_id"))&&void 0!==o?o:"";const i=this.commonService.getMyParam(this.activeRoute,"id")?Number(this.commonService.getMyParam(this.activeRoute,"id")):0;let a=this.commonService.getMyQueryParam("backto");this.backToLink=a?a.includes("shareType")?decodeURIComponent(a):a:"",this.getData(i),super.ngOnInit()}constructor(e,o,i,a,s,l,m){super(i),this.activeRoute=e,this.answerService=o,this.commonService=i,this.dialog=a,this.zipDataService=s,this.vcRef=l,this.envService=m,this.homeworkHashId="",this.backToLink="",this.classliveUrl=""}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(R.gz),t.Y36(at.P6),t.Y36(X.v),t.Y36(L.on),t.Y36(it.D),t.Y36(t.s_b),t.Y36(gt.D))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-mark-exercise-new"]],features:[t.qOj],decls:0,vars:0,template:function(e,o){},encapsulation:2}),n})()},{path:"mark-exercise-new/:id/:hash_id",component:mo},{path:"export-homework/:class_id/:id/:hash_id",component:Ve},{path:"content-store",component:ye}]}];let Oo=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[R.Bz.forChild(yo),R.Bz,w.fQ]}),n})(),Co=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[A.kb,R.Bz,Z.ez,p.j,d.Z_,Oo,r.u5,r.UX,L.yj,v.Z,D.xC,q.W,g.d,b.k,_.qyJ.pick(_.ciZ)]}),n})()}}]);