"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[237],{1643:(Q,M,v)=>{v.d(M,{p:()=>p});var I=v(55330),t=v(94650),W=v(63382),y=v(36895),O=v(1033);function z(o,a){if(1&o&&(t.TgZ(0,"h3",6),t._uU(1),t.qZA()),2&o){const n=t.oxw(3);t.xp6(1),t.Oqu(n.title)}}const A=function(o){return{"rotated-img":o}},L=function(o,a,n,c){return{"width.px":o,"height.px":a,"aspect-ratio":n,transform:c}};function D(o,a){if(1&o&&(t._UZ(0,"img",10),t.ALo(1,"mycdn")),2&o){const n=t.oxw(2).$implicit,c=t.oxw(2);t.s9C("src",t.lcZ(1,4,n.backgroundImage),t.LSH),t.Q6J("ngClass",t.VKq(6,A,c.isRightRotation(n.rotation||0)))("ngStyle",t.l5B(8,L,(n.width||0)<(n.height||0)?"auto":c.isRightRotation(n.rotation||0)?n.height:n.width,(n.width||0)>(n.height||0)?"auto":c.isRightRotation(n.rotation||0)?n.width:n.height,(n.width||0)/(n.height||1),"rotate("+n.rotation+"deg)")),t.uIk("data-ratio",(n.width||0)/(n.height||1))}}function F(o,a){1&o&&(t.TgZ(0,"div",11),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"lang_auto_dinh_dang_file_khong_ho_tro_xuat_ra_pdf_he_thong_chi_xuat_duoc_file_pdf_doi_voi_file_tai_len_dang_anh_va_pdf")))}function s(o,a){if(1&o&&(t._UZ(0,"img",12),t.ALo(1,"mycdn")),2&o){const n=t.oxw(2).$implicit;t.s9C("src",t.lcZ(1,1,n.draw),t.LSH)}}function r(o,a){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const n=t.oxw(6);t.xp6(1),t.hij(" ",null==n.result.staticTextConfigParse?null:n.result.staticTextConfigParse.textCorrect," ")}}function d(o,a){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const n=t.oxw(6);t.xp6(1),t.hij(" ",null==n.result.staticTextConfigParse?null:n.result.staticTextConfigParse.textWrong," ")}}function u(o,a){if(1&o&&t._UZ(0,"img",15),2&o){const n=t.oxw(6);t.s9C("src","assets/images/classlive/"+(null==n.result.staticTextConfigParse?null:n.result.staticTextConfigParse.urlImgCorrect),t.LSH)}}function m(o,a){if(1&o&&t._UZ(0,"img",15),2&o){const n=t.oxw(6);t.s9C("src","assets/images/classlive/"+(null==n.result.staticTextConfigParse?null:n.result.staticTextConfigParse.urlImgWrong),t.LSH)}}const C=function(o,a,n,c,f){return{"font-family":o,color:a,"font-size":n,position:"absolute","z-index":2,"top.px":c,"left.px":f}};function T(o,a){if(1&o&&(t.ynx(0),t.TgZ(1,"span",13),t.YNc(2,r,2,1,"ng-container",0),t.YNc(3,d,2,1,"ng-container",0),t.YNc(4,u,1,1,"img",14),t.YNc(5,m,1,1,"img",14),t.qZA(),t.BQk()),2&o){const n=a.$implicit,c=t.oxw(5);t.xp6(1),t.Q6J("ngStyle",t.qbA(5,C,null==c.result.staticTextConfigParse?null:c.result.staticTextConfigParse.fontText,null==c.result.staticTextConfigParse?null:c.result.staticTextConfigParse.fontColor,(null==c.result.staticTextConfigParse?null:c.result.staticTextConfigParse.fontSize)+"px",n.y,n.x)),t.xp6(1),t.Q6J("ngIf",(null==c.result.staticTextConfigParse?null:c.result.staticTextConfigParse.useCorrectText)&&"correct"==n.value),t.xp6(1),t.Q6J("ngIf",(null==c.result.staticTextConfigParse?null:c.result.staticTextConfigParse.useCorrectText)&&"wrong"==n.value),t.xp6(1),t.Q6J("ngIf",!(null!=c.result.staticTextConfigParse&&c.result.staticTextConfigParse.useCorrectText)&&"correct"==n.value),t.xp6(1),t.Q6J("ngIf",!(null!=c.result.staticTextConfigParse&&c.result.staticTextConfigParse.useWrongText)&&"wrong"==n.value)}}function P(o,a){if(1&o&&t.YNc(0,T,6,11,"ng-container",1),2&o){const n=t.oxw(2).$implicit;t.Q6J("ngForOf",n.staticText)}}const x=function(o,a,n,c,f,E){return{"font-family":o,color:a,"font-size":n,display:"block","line-height":1.5,position:"absolute",letterSpacing:"3px",fontWeight:"bold","z-index":3,"text-align":c,"top.px":f,"left.px":E}};function e(o,a){if(1&o&&(t.ynx(0),t._UZ(1,"span",16),t.ALo(2,"formatNoteBreak"),t.BQk()),2&o){const n=a.$implicit;t.xp6(1),t.Q6J("ngStyle",t.HTZ(4,x,n.textStyle.font,n.textStyle.color,n.textStyle.size+"px",n.textStyle.align,n.y,n.x))("innerHtml",t.lcZ(2,2,n.value),t.oJD)}}function i(o,a){if(1&o&&t.YNc(0,e,3,11,"ng-container",1),2&o){const n=t.oxw(2).$implicit;t.Q6J("ngForOf",n.objText)}}function l(o,a){if(1&o&&(t.YNc(0,D,2,13,"img",7),t.ALo(1,"isImageExtension"),t.YNc(2,F,3,3,"ng-template",null,8,t.W1O),t.YNc(4,s,2,3,"img",9),t.YNc(5,P,1,1,"ng-template",5),t.YNc(6,i,1,1,"ng-template",5)),2&o){const n=t.MAs(3),c=t.oxw().$implicit;t.Q6J("ngIf",t.lcZ(1,5,(null==c?null:c.backgroundImage)||""))("ngIfElse",n),t.xp6(4),t.Q6J("ngIf",c.draw),t.xp6(1),t.Q6J("ngIf",c.staticText&&c.staticText.length>0),t.xp6(1),t.Q6J("ngIf",c.objText&&c.objText.length>0)}}const _=function(o,a){return{position:"relative","width.px":o,"height.px":a,display:"flex","justify-content":"center","align-items":"center"}};function g(o,a){if(1&o&&(t.ynx(0),t.TgZ(1,"div",2),t.YNc(2,z,2,1,"h3",3),t.TgZ(3,"div",4),t.YNc(4,l,7,7,"ng-template",5),t.qZA()(),t.BQk()),2&o){const n=a.$implicit,c=a.first,f=t.oxw(2);t.xp6(1),t.Tol("mb-2 essayPdfImage "+f.blockItemCropClass+" "+f.blockItemEssayCropClass),t.xp6(1),t.Q6J("ngIf",c),t.xp6(1),t.Q6J("ngStyle",t.WLB(6,_,n.width,n.height)),t.xp6(1),t.Q6J("ngIf",null==n?null:n.backgroundImage)}}function h(o,a){if(1&o&&(t.ynx(0),t.YNc(1,g,5,9,"ng-container",1),t.BQk()),2&o){const n=t.oxw();t.xp6(1),t.Q6J("ngForOf",n.result.pages)}}let p=(()=>{class o extends I.Q{isRightRotation(n){return 1==Math.abs(n/90%2)}ngOnInit(){var n;this.title=null!==(n=this.commonService.myTranslateInstant("lang_auto_anh_bai_lam_tu_luan"))&&void 0!==n?n:"",this.result.staticTextConfig&&(this.result.staticTextConfigParse=this.commonService.myParseJson(this.result.staticTextConfig)),super.ngOnInit()}ngOnChanges(){this.result.staticTextConfig&&(this.result.staticTextConfigParse=this.commonService.myParseJson(this.result.staticTextConfig))}constructor(n){super(),this.iframeService=n,this.title="",this.result={}}}return o.\u0275fac=function(n){return new(n||o)(t.Y36(W.X))},o.\u0275cmp=t.Xpm({type:o,selectors:[["azt-export-essay-template"]],inputs:{title:"title",blockItemEssayCropClass:"blockItemEssayCropClass",blockItemCropClass:"blockItemCropClass",result:"result"},features:[t.qOj,t.TTD],decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"display","flex","justify-content","center","align-items","center","flex-direction","column"],["id","essayPdfTitle","class","text-center",4,"ngIf"],[3,"ngStyle"],[3,"ngIf"],["id","essayPdfTitle",1,"text-center"],["class","user-img img_respon","alt","",3,"ngClass","ngStyle","src",4,"ngIf","ngIfElse"],["noSupportExtension",""],["style","position: absolute; z-index: 1; top: 0; left: 0","class","user-img img_respon","alt","",3,"src",4,"ngIf"],["alt","",1,"user-img","img_respon",3,"ngClass","ngStyle","src"],[1,"p-2","text-center",2,"border","2px solid red"],["alt","",1,"user-img","img_respon",2,"position","absolute","z-index","1","top","0","left","0",3,"src"],[2,"min-height","50px","min-width","50px","font-weight","bold","display","flex","line-height","1.5","font-weight","bold","align-items","center","justify-content","center","text-shadow","rgb(130 126 126) 1px 1px 1px",3,"ngStyle"],["width","30","height","30","class","","alt","",3,"src",4,"ngIf"],["width","30","height","30","alt","",1,"",3,"src"],[3,"ngStyle","innerHtml"]],template:function(n,c){1&n&&t.YNc(0,h,2,1,"ng-container",0),2&n&&t.Q6J("ngIf",c.result)},dependencies:[y.mk,y.sg,y.O5,y.PC,O.bT,O.GT,O.AL,O.kJ],encapsulation:2}),o})()},16031:(Q,M,v)=>{v.d(M,{I:()=>T});var I=v(70655),t=v(4159),y=v(86360),O=v(17489),A=v(94650),L=v(296),D=v(20814),F=v(88161),s=v(72491);const C={top:60,left:60,right:60,bottom:60};let T=(()=>{class P{get loadPercent(){return Math.floor(this.countDraw/this.totalDraw*100)}getSourceCanvas(e){return(0,I.mG)(this,void 0,void 0,function*(){var i=document.getElementById(e);return yield t(i,{scale:2})})}resetPosition(e){e&&(this.currentPos={left:60,top:60,right:60,bottom:60})}drawHomeworkNoteBoxOfTeacher(e){return(0,I.mG)(this,void 0,void 0,function*(){let i=document.querySelector(".box-point.display .text-mark");if(e){e.font="25px font_chu_dep",e.fillStyle="#000",i&&e.fillText("\u0110i\u1ec3m",90,this.currentPos.top+20),e.fillText("L\u1eddi ph\xea c\u1ee7a gi\xe1o vi\xean",420,this.currentPos.top+20),this.currentPos.top+=30;let l=document.querySelector(".box-msg .note p");if(l){e.lineWidth=2,e.fillStyle="#000",e.fillRect(this.currentPos.left,this.currentPos.top,e.canvas.width-this.currentPos.left-this.currentPos.right,1);const _=this.currentPos.top;let g=window.getComputedStyle(l,null).getPropertyValue("font"),h=window.getComputedStyle(l,null).getPropertyValue("color"),p=parseInt(g.split(" ")[0].split("p")[0],10);e.font=g;let a=this.exportPdfUtilsService.essayText2LinesArr(l.innerHTML,e,e.canvas.width-60-30-(i?200:0),16,g);this.currentPos.top+=35;const n=Math.round(1.5*p),c=this.currentPos.left+(i?200:0)+15;let f=0,E=200;for(let B=0;B<a.length;B++)for(let U=0;U<a[B].length;U++){const R=a[B][U];e.font=g,e.fillStyle=h,e.fillText(R,c,this.currentPos.top),this.currentPos.top+=n,f+=n}let S=document.querySelectorAll(".box-emoji> img"),w=this.currentPos.left+(i?100:0)+15,H=this.currentPos.top,k=78,N=78,j=15;S.forEach(B=>{var U;let R=new Image;R.src=null!==(U=B.getAttribute("src"))&&void 0!==U?U:"",R.onload=()=>{w=w+k+j,e.drawImage(R,w,H,k,N)}});let K=30+N;if(f>E-K&&(E=f+K),e.lineWidth=2,e.fillStyle="#000",e.fillRect(this.currentPos.left,_,1,E),i&&e.fillRect(this.currentPos.left+200,_,1,E),e.fillRect(e.canvas.width-this.currentPos.right,_,1,E),e.fillRect(this.currentPos.left,_+E,e.canvas.width-this.currentPos.right-this.currentPos.left,1),i){let B=i.getBoundingClientRect().width,U=i.getBoundingClientRect().height,R=window.getComputedStyle(i,null).getPropertyValue("font"),Y=window.getComputedStyle(i,null).getPropertyValue("color");e.font=R,e.fillStyle=Y,e.fillText(i.textContent?i.textContent:"",this.currentPos.left+100-B/2,_+E/2+U/4)}this.currentPos.top=_+E+20}else{if(e.lineWidth=2,e.rect(this.currentPos.left,this.currentPos.top,e.canvas.width-this.currentPos.left-this.currentPos.right,200),e.stroke(),i&&e.fillRect(this.currentPos.left+200,this.currentPos.top,1,200),i){let _=i.getBoundingClientRect().width,g=i.getBoundingClientRect().height,h=window.getComputedStyle(i,null).getPropertyValue("font"),p=window.getComputedStyle(i,null).getPropertyValue("color");e.font=h,e.fillStyle=p,e.fillText(i.textContent?i.textContent:"",this.currentPos.left+100-_/2,this.currentPos.top+150-g/2)}this.currentPos.top+=220}}})}drawExamTitle(e){if(e){let f=document.querySelector("#mainTitle span"),E=f?window.getComputedStyle(f,null).getPropertyValue("font"):"",S=f?.getBoundingClientRect().width,w=f?.getBoundingClientRect().height;var i=f?.querySelector("img"),l=i?.getBoundingClientRect().width,_=i?.getBoundingClientRect().height,g=0;if(f&&f.textContent&&S&&w&&!(i&&l&&_)){var h=(e.canvas.width-S)/2,p=this.currentPos.top+15;e.font=E,e.fillStyle="#000",e.fillText(f.textContent,h,p),g=w+20}else f&&f.textContent&&S&&w&&i&&l&&_&&(h=(e.canvas.width-S)/2,p=this.currentPos.top+20,e.font=E,e.fillStyle="#000",e.fillText(f.textContent,h,p),g=w+40,e.drawImage(i,0,0,l,_,h+(S-l)+5,this.currentPos.top-10,l,_));g>0&&(this.currentPos.top+=g,this.countDraw++)}}drawColLeftRightInHeaderOfExam(e){var i;let l=document.getElementById("colLeftInfo"),_=document.getElementById("colRightInfo"),g=l?l.querySelectorAll("h3"):void 0,h=_?_.querySelectorAll("h3"):void 0,p={top:0,left:0,right:0,bottom:0};if(e){if(e.font="16px Arial",g)for(let o=0;o<g.length;o++){0==o&&(p=O.cloneDeep(this.currentPos));const a=g[o];a.textContent&&(e.fillText(null!==(i=a.textContent)&&void 0!==i?i:"",this.currentPos.left,this.currentPos.top),this.currentPos.top+=a.getBoundingClientRect().height+5)}if(h)for(let o=0;o<h.length;o++){const a=h[o];a.textContent&&(e.fillText(a.textContent,e.canvas.width-this.currentPos.right-a.getBoundingClientRect().width,p.top),p.top+=a.getBoundingClientRect().height+5)}}}drawBlockItemToPageForExam(e,i){return(0,I.mG)(this,void 0,void 0,function*(){if(e){let _=document.querySelectorAll(`.${this.exportPdfUtilsService.blockCropItemClass}`);if(_.length>0){let g=[];for(let h=0;h<_.length;h++)g.push(h);var l=yield this.getSourceCanvas("multipleChoiceWrap");for(const h of g){const p=_[h];let o=p.classList.contains(this.exportPdfUtilsService.blockEssayCropItemClass),a=p.classList.contains("__TXT_ESSAY_PARA");console.log("nvanh 1",a,o);let n=2*p.offsetLeft,c=2*p.offsetTop,f=2*p.getBoundingClientRect().width,E=2*p.getBoundingClientRect().height;const S=e.canvas.width-this.currentPos.left-this.currentPos.right,w=S*E/f;if(w<=e.canvas.height-this.currentPos.bottom-this.currentPos.top&&!o)this.drawSingleBlockItemToCanvas(e,l,S,w,{left:n,top:c,width:f,height:E},a);else if(this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,e.canvas.toDataURL("image/jpeg",1)),this.pdfDoc.addPage(),this.exportPdfUtilsService.eraseCanvas(e),this.resetPosition(i),"h"==this.exportPdfConvertDataService.findScaleDirection(f,E)){const H=e.canvas.height-C.top-C.bottom,k=H*f/E;this.drawSingleBlockItemToCanvas(e,l,S,w,{left:n,top:c,width:f,height:E},a,(e.canvas.width-k)/2,C.top,k,H)}else this.drawSingleBlockItemToCanvas(e,l,S,w,{left:n,top:c,width:f,height:E},a)}this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,e.canvas.toDataURL("image/jpeg",1))}else this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,e.canvas.toDataURL("image/jpeg",1))}})}convertEssayBoxes2Canvas(e,i,l,_){return(0,I.mG)(this,void 0,void 0,function*(){let g=[];for(let h=0;h<e.length;h++)g.push(h);for(const h of g){const p=yield t(e[h]);0==h&&i?(_&&(i.canvas.width-50-50)*p.height/p.width>i.canvas.height-50-this.currentPos.top&&(this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,i.canvas.toDataURL("image/jpeg",1)),this.exportPdfUtilsService.eraseCanvas(i),this.resetPosition(l),this.pdfDoc.addPage()),this.addEssayImage(i,e,p,h)):(this.exportPdfUtilsService.eraseCanvas(i),this.resetPosition(l),this.addEssayImage(i,e,p,h))}})}drawEssayIframeContent(e,i,l){return(0,I.mG)(this,void 0,void 0,function*(){let _=document.querySelectorAll(".essayPdfImage");if(_.length>0&&e){l||(this.exportPdfUtilsService.eraseCanvas(e),this.resetPosition(i),this.pdfDoc.addPage());let g=document.querySelector("#essayPdfTitle span");e&&g&&g.textContent&&(e.font="18px Georgia",e.fillStyle="#333",e.fillText(g.textContent,(e.canvas.width-g.getBoundingClientRect().width)/2,this.currentPos.top+20),this.currentPos.top+=g.getBoundingClientRect().height+20),yield this.convertEssayBoxes2Canvas(_,e,i,l)}})}addEssayImage(e,i,l,_){if(e){if("w"==this.exportPdfConvertDataService.findScaleDirection(l.width,l.height))e.drawImage(l,0,0,l.width,l.height,50,this.currentPos.top+50,e.canvas.width-100,(e.canvas.width-100)*l.height/l.width);else{let g=e.canvas.height-this.currentPos.top-this.currentPos.bottom,h=g*l.width/l.height;e.drawImage(l,0,0,l.width,l.height,(e.canvas.width-h)/2,this.currentPos.top,h,g)}console.log(`[_Essay_image_] V\u1ebd \u1ea3nh t\u1ef1 lu\u1eadn s\u1ed1 ${_+1}`),this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,e.canvas.toDataURL("image/jpeg",1)),this.countDraw++,_!=i.length-1&&this.pdfDoc.addPage()}}drawSingleBlockItemToCanvas(e,i,l,_,g,h,p,o,a,n){h&&this.currentPos.top!=C.top&&(this.currentPos.top-=60),e.drawImage(i,g.left,g.top,g.width,g.height,p||this.currentPos.left,o||this.currentPos.top,a||l,n||_),this.currentPos.top+=_+80,this.countDraw++}examToPdf(e,i){return(0,I.mG)(this,void 0,void 0,function*(){this.countDraw=0,this.totalDraw=document.querySelectorAll(`.${this.exportPdfUtilsService.blockCropItemClass}`).length,this.pdfDoc=new y.jsPDF;let l=document.createElement("canvas"),_=document.getElementById("multipleChoiceWrap");if(console.log("nvanh",_),_){let p=_.getBoundingClientRect().width;l.width=2*p,l.height=297*p/210*2}let g=l.getContext("2d");return this.exportPdfUtilsService.eraseCanvas(g),_&&this.resetPosition(_),_&&(yield this.drawBlockItemToPageForExam(g,_)),this.countDraw=this.totalDraw,yield this.exportPdfUtilsService.asyncTimeout(1e3),"class"==e?this.pdfDoc.output("blob"):(this.pdfDoc.save(i||"test_result.pdf"),!0)})}homeworkToPdf(){return(0,I.mG)(this,void 0,void 0,function*(){this.pdfDoc=new y.jsPDF;let e=document.createElement("canvas"),i=document.getElementById("multipleChoiceWrap");if(i){let g=i.getBoundingClientRect().width;e.width=g,e.height=297*g/210}let l=e.getContext("2d");return this.exportPdfUtilsService.eraseCanvas(l),i&&this.resetPosition(i),this.drawExamTitle(l),this.drawColLeftRightInHeaderOfExam(l),yield this.drawHomeworkNoteBoxOfTeacher(l),i&&(yield this.drawEssayIframeContent(l,i,!0)),this.pdfDoc.output("blob")})}constructor(e,i,l,_){this.exportPdfConvertDataService=e,this.exportPdfUtilsService=i,this.answerTypeService=l,this.timeService=_,this.totalDraw=1,this.countDraw=0,this.currentPos=C,this.pdfDoc=new y.jsPDF}}return P.\u0275fac=function(e){return new(e||P)(A.LFG(L.S),A.LFG(D.V),A.LFG(F.T),A.LFG(s.O))},P.\u0275prov=A.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),P})()},50136:(Q,M,v)=>{v.d(M,{J:()=>L});var I=v(80529),t=v(69751),W=v(51442),y=v(94650),O=v(51009),z=v(45511),A=v(58326);let L=(()=>{class D{replaceImageInContent(s){return new t.y(r=>{if(s.includes("<img ")){var d=this.findAllSubString(s,"<img"),u=[],m=[];d.forEach(C=>{var T=s.indexOf("src=",C),P=s.indexOf('"',Number(T)+5),x=s.substring(Number(T)+5,Number(P)+1);x.includes(";base64")?u.push({oldUrl:x}):x.includes("blob:")&&m.push({oldUrl:x})}),u.length>0?this.reUploadBase64File(u,(C,T)=>{null!=T?this.reUploadBlobFile(m,(P,x)=>{null!=x?(s=this.replaceHomeworkContent(s,C),s=this.replaceHomeworkContent(s,P),r.next({errorMessage:void 0,content:s}),r.complete()):(r.next({errorMessage:x,content:s}),r.complete())}):(r.next({errorMessage:T,content:s}),r.complete())}):m.length>0?this.reUploadBlobFile(m,(C,T)=>{null!=T?(s=this.replaceHomeworkContent(s,C),r.next({errorMessage:void 0,content:s}),r.complete()):(r.next({errorMessage:T,content:s}),r.complete())}):(s=this.replaceHomeworkContent(s,[]),r.next({errorMessage:void 0,content:s}),r.complete())}else r.next({errorMessage:void 0,content:s}),r.complete()})}replaceHomeworkContent(s,r){return r.length>0&&r.forEach(d=>{var u,m=s.replace(null!==(u=d.oldUrl)&&void 0!==u?u:"  ",d.newUrl+'" class="w-100 img-fluid"');s=m}),s}findAllSubString(s,r){for(var d=0,u=0,m=[];s.indexOf(r,d)>-1;)u=s.indexOf(r,d),m.push(u),d=u+r.length;return m}getTypeFile(s){var r=s.indexOf(";");return s.substring(5,r)}getFileName(s){var r=s.split("").reverse().join(""),d=r.indexOf(";"),u=r.indexOf("/",d);return r.substring(d,u).split("").reverse().join("")}convertBlobToBase64(s){return new Promise(r=>{var d=new Image;d.crossOrigin="Anonymous",d.addEventListener("load",function(){var u=document.createElement("canvas"),m=u.getContext("2d");u.width=d.width,u.height=d.height,m?.drawImage(d,0,0);var C=u.toDataURL("image/png");r(C)},!1),d.src=s})}reUploadBase64File(s,r){var d;if(s&&s.length>0){let T,C=s.length;for(var u=[],m=0;m<s.length;m++){const P=s[m],x=null===(d=P.oldUrl)||void 0===d?void 0:d.substring(0,P.oldUrl.length-1);this.startUploadBlobFile(P,x??"",[],(e,i)=>{null==i?u=u.concat(e):T=i,C-=1,0==C&&r(u,T)})}}else r([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}reUploadBlobFile(s,r){var d;if(s&&s.length>0){let T,C=s.length;for(var u=[],m=0;m<s.length;m++){const P=s[m],x=null===(d=P?.oldUrl)||void 0===d?void 0:d.substring(0,P.oldUrl.length-1);this.convertBlobToBase64(x??"").then(e=>{this.startUploadBlobFile(P,e,[],(i,l)=>{null==l?u=u.concat(i):T=l,C-=1,0==C&&r(u,T)})})}}else r([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}startUploadBlobFile(s,r,d,u){if(r&&""!=r){var m=this.getTypeFile(r),C=this.myPdfService.b64toFile(r,this.getFileName(m),m);(0,W.hv)(C).then(T=>{this.apiUploadService.uploadToCdnForHomework(T).subscribe(P=>{var x,e,i;if(P.type!=I.dt.UploadProgress)if(1==P.success){var l=Object.assign(Object.assign({},s),{newUrl:null!==(e=null===(x=P.data)||void 0===x?void 0:x.url)&&void 0!==e?e:""});d.push(l),u(d,void 0)}else u(d,this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi",null!==(i=P.message)&&void 0!==i?i:"none"))})})}else u(d,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}constructor(s,r,d){this.commonService=s,this.apiUploadService=r,this.myPdfService=d}}return D.\u0275fac=function(s){return new(s||D)(y.LFG(O.v),y.LFG(z.$),y.LFG(A.t))},D.\u0275prov=y.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),D})()}}]);