"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[237],{1643:(Q,M,v)=>{v.d(M,{p:()=>p});var I=v(55330),t=v(94650),W=v(63382),y=v(36895),A=v(1033);function z(i,a){if(1&i&&(t.TgZ(0,"h3",6),t._uU(1),t.qZA()),2&i){const n=t.oxw(3);t.xp6(1),t.Oqu(n.title)}}const O=function(i){return{"rotated-img":i}},L=function(i,a,n,c){return{"width.px":i,"height.px":a,"aspect-ratio":n,transform:c}};function D(i,a){if(1&i&&(t._UZ(0,"img",10),t.ALo(1,"mycdn")),2&i){const n=t.oxw(2).$implicit,c=t.oxw(2);t.s9C("src",t.lcZ(1,4,n.backgroundImage),t.LSH),t.Q6J("ngClass",t.VKq(6,O,c.isRightRotation(n.rotation||0)))("ngStyle",t.l5B(8,L,(n.width||0)<(n.height||0)?"auto":c.isRightRotation(n.rotation||0)?n.height:n.width,(n.width||0)>(n.height||0)?"auto":c.isRightRotation(n.rotation||0)?n.width:n.height,(n.width||0)/(n.height||1),"rotate("+n.rotation+"deg)")),t.uIk("data-ratio",(n.width||0)/(n.height||1))}}function F(i,a){1&i&&(t.TgZ(0,"div",11),t._uU(1),t.ALo(2,"mytranslate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"lang_auto_dinh_dang_file_khong_ho_tro_xuat_ra_pdf_he_thong_chi_xuat_duoc_file_pdf_doi_voi_file_tai_len_dang_anh_va_pdf")))}function l(i,a){if(1&i&&(t._UZ(0,"img",12),t.ALo(1,"mycdn")),2&i){const n=t.oxw(2).$implicit;t.s9C("src",t.lcZ(1,1,n.draw),t.LSH)}}function r(i,a){if(1&i&&(t.ynx(0),t._uU(1),t.BQk()),2&i){const n=t.oxw(6);t.xp6(1),t.hij(" ",null==n.result.staticTextConfigParse?null:n.result.staticTextConfigParse.textCorrect," ")}}function d(i,a){if(1&i&&(t.ynx(0),t._uU(1),t.BQk()),2&i){const n=t.oxw(6);t.xp6(1),t.hij(" ",null==n.result.staticTextConfigParse?null:n.result.staticTextConfigParse.textWrong," ")}}function u(i,a){if(1&i&&t._UZ(0,"img",15),2&i){const n=t.oxw(6);t.s9C("src","assets/images/classlive/"+(null==n.result.staticTextConfigParse?null:n.result.staticTextConfigParse.urlImgCorrect),t.LSH)}}function m(i,a){if(1&i&&t._UZ(0,"img",15),2&i){const n=t.oxw(6);t.s9C("src","assets/images/classlive/"+(null==n.result.staticTextConfigParse?null:n.result.staticTextConfigParse.urlImgWrong),t.LSH)}}const C=function(i,a,n,c,f){return{"font-family":i,color:a,"font-size":n,position:"absolute","z-index":2,"top.px":c,"left.px":f}};function T(i,a){if(1&i&&(t.ynx(0),t.TgZ(1,"span",13),t.YNc(2,r,2,1,"ng-container",0),t.YNc(3,d,2,1,"ng-container",0),t.YNc(4,u,1,1,"img",14),t.YNc(5,m,1,1,"img",14),t.qZA(),t.BQk()),2&i){const n=a.$implicit,c=t.oxw(5);t.xp6(1),t.Q6J("ngStyle",t.qbA(5,C,null==c.result.staticTextConfigParse?null:c.result.staticTextConfigParse.fontText,null==c.result.staticTextConfigParse?null:c.result.staticTextConfigParse.fontColor,(null==c.result.staticTextConfigParse?null:c.result.staticTextConfigParse.fontSize)+"px",n.y,n.x)),t.xp6(1),t.Q6J("ngIf",(null==c.result.staticTextConfigParse?null:c.result.staticTextConfigParse.useCorrectText)&&"correct"==n.value),t.xp6(1),t.Q6J("ngIf",(null==c.result.staticTextConfigParse?null:c.result.staticTextConfigParse.useCorrectText)&&"wrong"==n.value),t.xp6(1),t.Q6J("ngIf",!(null!=c.result.staticTextConfigParse&&c.result.staticTextConfigParse.useCorrectText)&&"correct"==n.value),t.xp6(1),t.Q6J("ngIf",!(null!=c.result.staticTextConfigParse&&c.result.staticTextConfigParse.useWrongText)&&"wrong"==n.value)}}function P(i,a){if(1&i&&t.YNc(0,T,6,11,"ng-container",1),2&i){const n=t.oxw(2).$implicit;t.Q6J("ngForOf",n.staticText)}}const x=function(i,a,n,c,f,E){return{"font-family":i,color:a,"font-size":n,display:"block","line-height":1.5,position:"absolute",letterSpacing:"3px",fontWeight:"bold","z-index":3,"text-align":c,"top.px":f,"left.px":E}};function e(i,a){if(1&i&&(t.ynx(0),t._UZ(1,"span",16),t.ALo(2,"formatNoteBreak"),t.BQk()),2&i){const n=a.$implicit;t.xp6(1),t.Q6J("ngStyle",t.HTZ(4,x,n.textStyle.font,n.textStyle.color,n.textStyle.size+"px",n.textStyle.align,n.y,n.x))("innerHtml",t.lcZ(2,2,n.value),t.oJD)}}function o(i,a){if(1&i&&t.YNc(0,e,3,11,"ng-container",1),2&i){const n=t.oxw(2).$implicit;t.Q6J("ngForOf",n.objText)}}function s(i,a){if(1&i&&(t.YNc(0,D,2,13,"img",7),t.ALo(1,"isImageExtension"),t.YNc(2,F,3,3,"ng-template",null,8,t.W1O),t.YNc(4,l,2,3,"img",9),t.YNc(5,P,1,1,"ng-template",5),t.YNc(6,o,1,1,"ng-template",5)),2&i){const n=t.MAs(3),c=t.oxw().$implicit;t.Q6J("ngIf",t.lcZ(1,5,(null==c?null:c.backgroundImage)||""))("ngIfElse",n),t.xp6(4),t.Q6J("ngIf",c.draw),t.xp6(1),t.Q6J("ngIf",c.staticText&&c.staticText.length>0),t.xp6(1),t.Q6J("ngIf",c.objText&&c.objText.length>0)}}const _=function(i,a){return{position:"relative","width.px":i,"height.px":a,display:"flex","justify-content":"center","align-items":"center"}};function g(i,a){if(1&i&&(t.ynx(0),t.TgZ(1,"div",2),t.YNc(2,z,2,1,"h3",3),t.TgZ(3,"div",4),t.YNc(4,s,7,7,"ng-template",5),t.qZA()(),t.BQk()),2&i){const n=a.$implicit,c=a.first,f=t.oxw(2);t.xp6(1),t.Tol("mb-2 essayPdfImage "+f.blockItemCropClass+" "+f.blockItemEssayCropClass),t.xp6(1),t.Q6J("ngIf",c),t.xp6(1),t.Q6J("ngStyle",t.WLB(6,_,n.width,n.height)),t.xp6(1),t.Q6J("ngIf",null==n?null:n.backgroundImage)}}function h(i,a){if(1&i&&(t.ynx(0),t.YNc(1,g,5,9,"ng-container",1),t.BQk()),2&i){const n=t.oxw();t.xp6(1),t.Q6J("ngForOf",n.result.pages)}}let p=(()=>{class i extends I.Q{constructor(n){super(),this.iframeService=n,this.title="",this.result={}}isRightRotation(n){return 1==Math.abs(n/90%2)}ngOnInit(){var n;this.title=null!==(n=this.commonService.myTranslateInstant("lang_auto_anh_bai_lam_tu_luan"))&&void 0!==n?n:"",this.result.staticTextConfig&&(this.result.staticTextConfigParse=this.commonService.myParseJson(this.result.staticTextConfig)),super.ngOnInit()}ngOnChanges(){this.result.staticTextConfig&&(this.result.staticTextConfigParse=this.commonService.myParseJson(this.result.staticTextConfig))}}return i.\u0275fac=function(n){return new(n||i)(t.Y36(W.X))},i.\u0275cmp=t.Xpm({type:i,selectors:[["azt-export-essay-template"]],inputs:{title:"title",blockItemEssayCropClass:"blockItemEssayCropClass",blockItemCropClass:"blockItemCropClass",result:"result"},features:[t.qOj,t.TTD],decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"display","flex","justify-content","center","align-items","center","flex-direction","column"],["id","essayPdfTitle","class","text-center",4,"ngIf"],[3,"ngStyle"],[3,"ngIf"],["id","essayPdfTitle",1,"text-center"],["class","user-img img_respon","alt","",3,"ngClass","ngStyle","src",4,"ngIf","ngIfElse"],["noSupportExtension",""],["style","position: absolute; z-index: 1; top: 0; left: 0","class","user-img img_respon","alt","",3,"src",4,"ngIf"],["alt","",1,"user-img","img_respon",3,"ngClass","ngStyle","src"],[1,"p-2","text-center",2,"border","2px solid red"],["alt","",1,"user-img","img_respon",2,"position","absolute","z-index","1","top","0","left","0",3,"src"],[2,"min-height","50px","min-width","50px","font-weight","bold","display","flex","line-height","1.5","font-weight","bold","align-items","center","justify-content","center","text-shadow","rgb(130 126 126) 1px 1px 1px",3,"ngStyle"],["width","30","height","30","class","","alt","",3,"src",4,"ngIf"],["width","30","height","30","alt","",1,"",3,"src"],[3,"ngStyle","innerHtml"]],template:function(n,c){1&n&&t.YNc(0,h,2,1,"ng-container",0),2&n&&t.Q6J("ngIf",c.result)},dependencies:[y.mk,y.sg,y.O5,y.PC,A.bT,A.GT,A.AL,A.kJ],encapsulation:2}),i})()},16031:(Q,M,v)=>{v.d(M,{I:()=>T});var I=v(70655),t=v(4159),y=v(86360),A=v(17489),O=v(94650),L=v(296),D=v(20814),F=v(88161),l=v(72491);const C={top:60,left:60,right:60,bottom:60};let T=(()=>{class P{constructor(e,o,s,_){this.exportPdfConvertDataService=e,this.exportPdfUtilsService=o,this.answerTypeService=s,this.timeService=_,this.totalDraw=1,this.countDraw=0,this.currentPos=C,this.pdfDoc=new y.jsPDF}get loadPercent(){return Math.floor(this.countDraw/this.totalDraw*100)}getSourceCanvas(e){return(0,I.mG)(this,void 0,void 0,function*(){var o=document.getElementById(e);return yield t(o,{scale:2})})}resetPosition(e){e&&(this.currentPos={left:60,top:60,right:60,bottom:60})}drawHomeworkNoteBoxOfTeacher(e){return(0,I.mG)(this,void 0,void 0,function*(){let o=document.querySelector(".box-point.display .text-mark");if(e){e.font="25px font_chu_dep",e.fillStyle="#000",o&&e.fillText("\u0110i\u1ec3m",90,this.currentPos.top+20),e.fillText("L\u1eddi ph\xea c\u1ee7a gi\xe1o vi\xean",420,this.currentPos.top+20),this.currentPos.top+=30;let s=document.querySelector(".box-msg .note p");if(s){e.lineWidth=2,e.fillStyle="#000",e.fillRect(this.currentPos.left,this.currentPos.top,e.canvas.width-this.currentPos.left-this.currentPos.right,1);const _=this.currentPos.top;let g=window.getComputedStyle(s,null).getPropertyValue("font"),h=window.getComputedStyle(s,null).getPropertyValue("color"),p=parseInt(g.split(" ")[0].split("p")[0],10);e.font=g;let a=this.exportPdfUtilsService.essayText2LinesArr(s.innerHTML,e,e.canvas.width-60-30-(o?200:0),16,g);this.currentPos.top+=35;const n=Math.round(1.5*p),c=this.currentPos.left+(o?200:0)+15;let f=0,E=200;for(let B=0;B<a.length;B++)for(let U=0;U<a[B].length;U++){const R=a[B][U];e.font=g,e.fillStyle=h,e.fillText(R,c,this.currentPos.top),this.currentPos.top+=n,f+=n}let S=document.querySelectorAll(".box-emoji> img"),w=this.currentPos.left+(o?100:0)+15,N=this.currentPos.top,k=78,H=78,j=15;S.forEach(B=>{var U;let R=new Image;R.src=null!==(U=B.getAttribute("src"))&&void 0!==U?U:"",R.onload=()=>{w=w+k+j,e.drawImage(R,w,N,k,H)}});let K=30+H;if(f>E-K&&(E=f+K),e.lineWidth=2,e.fillStyle="#000",e.fillRect(this.currentPos.left,_,1,E),o&&e.fillRect(this.currentPos.left+200,_,1,E),e.fillRect(e.canvas.width-this.currentPos.right,_,1,E),e.fillRect(this.currentPos.left,_+E,e.canvas.width-this.currentPos.right-this.currentPos.left,1),o){let B=o.getBoundingClientRect().width,U=o.getBoundingClientRect().height,R=window.getComputedStyle(o,null).getPropertyValue("font"),Y=window.getComputedStyle(o,null).getPropertyValue("color");e.font=R,e.fillStyle=Y,e.fillText(o.textContent?o.textContent:"",this.currentPos.left+100-B/2,_+E/2+U/4)}this.currentPos.top=_+E+20}else{if(e.lineWidth=2,e.rect(this.currentPos.left,this.currentPos.top,e.canvas.width-this.currentPos.left-this.currentPos.right,200),e.stroke(),o&&e.fillRect(this.currentPos.left+200,this.currentPos.top,1,200),o){let _=o.getBoundingClientRect().width,g=o.getBoundingClientRect().height,h=window.getComputedStyle(o,null).getPropertyValue("font"),p=window.getComputedStyle(o,null).getPropertyValue("color");e.font=h,e.fillStyle=p,e.fillText(o.textContent?o.textContent:"",this.currentPos.left+100-_/2,this.currentPos.top+150-g/2)}this.currentPos.top+=220}}})}drawExamTitle(e){if(e){let f=document.querySelector("#mainTitle span"),E=f?window.getComputedStyle(f,null).getPropertyValue("font"):"",S=f?.getBoundingClientRect().width,w=f?.getBoundingClientRect().height;var o=f?.querySelector("img"),s=o?.getBoundingClientRect().width,_=o?.getBoundingClientRect().height,g=0;if(f&&f.textContent&&S&&w&&!(o&&s&&_)){var h=(e.canvas.width-S)/2,p=this.currentPos.top+15;e.font=E,e.fillStyle="#000",e.fillText(f.textContent,h,p),g=w+20}else f&&f.textContent&&S&&w&&o&&s&&_&&(h=(e.canvas.width-S)/2,p=this.currentPos.top+20,e.font=E,e.fillStyle="#000",e.fillText(f.textContent,h,p),g=w+40,e.drawImage(o,0,0,s,_,h+(S-s)+5,this.currentPos.top-10,s,_));g>0&&(this.currentPos.top+=g,this.countDraw++)}}drawColLeftRightInHeaderOfExam(e){var o;let s=document.getElementById("colLeftInfo"),_=document.getElementById("colRightInfo"),g=s?s.querySelectorAll("h3"):void 0,h=_?_.querySelectorAll("h3"):void 0,p={top:0,left:0,right:0,bottom:0};if(e){if(e.font="16px Arial",g)for(let i=0;i<g.length;i++){0==i&&(p=A.cloneDeep(this.currentPos));const a=g[i];a.textContent&&(e.fillText(null!==(o=a.textContent)&&void 0!==o?o:"",this.currentPos.left,this.currentPos.top),this.currentPos.top+=a.getBoundingClientRect().height+5)}if(h)for(let i=0;i<h.length;i++){const a=h[i];a.textContent&&(e.fillText(a.textContent,e.canvas.width-this.currentPos.right-a.getBoundingClientRect().width,p.top),p.top+=a.getBoundingClientRect().height+5)}}}drawBlockItemToPageForExam(e,o){return(0,I.mG)(this,void 0,void 0,function*(){if(e){let _=document.querySelectorAll(`.${this.exportPdfUtilsService.blockCropItemClass}`);if(_.length>0){let g=[];for(let h=0;h<_.length;h++)g.push(h);var s=yield this.getSourceCanvas("multipleChoiceWrap");for(const h of g){const p=_[h];let i=p.classList.contains(this.exportPdfUtilsService.blockEssayCropItemClass),a=p.classList.contains("__TXT_ESSAY_PARA");console.log("nvanh 1",a,i);let n=2*p.offsetLeft,c=2*p.offsetTop,f=2*p.getBoundingClientRect().width,E=2*p.getBoundingClientRect().height;const S=e.canvas.width-this.currentPos.left-this.currentPos.right,w=S*E/f;if(w<=e.canvas.height-this.currentPos.bottom-this.currentPos.top&&!i)this.drawSingleBlockItemToCanvas(e,s,S,w,{left:n,top:c,width:f,height:E},a);else if(this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,e.canvas.toDataURL("image/jpeg",1)),this.pdfDoc.addPage(),this.exportPdfUtilsService.eraseCanvas(e),this.resetPosition(o),"h"==this.exportPdfConvertDataService.findScaleDirection(f,E)){const N=e.canvas.height-C.top-C.bottom,k=N*f/E;this.drawSingleBlockItemToCanvas(e,s,S,w,{left:n,top:c,width:f,height:E},a,(e.canvas.width-k)/2,C.top,k,N)}else this.drawSingleBlockItemToCanvas(e,s,S,w,{left:n,top:c,width:f,height:E},a)}this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,e.canvas.toDataURL("image/jpeg",1))}else this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,e.canvas.toDataURL("image/jpeg",1))}})}convertEssayBoxes2Canvas(e,o,s,_){return(0,I.mG)(this,void 0,void 0,function*(){let g=[];for(let h=0;h<e.length;h++)g.push(h);for(const h of g){const p=yield t(e[h]);0==h&&o?(_&&(o.canvas.width-50-50)*p.height/p.width>o.canvas.height-50-this.currentPos.top&&(this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,o.canvas.toDataURL("image/jpeg",1)),this.exportPdfUtilsService.eraseCanvas(o),this.resetPosition(s),this.pdfDoc.addPage()),this.addEssayImage(o,e,p,h)):(this.exportPdfUtilsService.eraseCanvas(o),this.resetPosition(s),this.addEssayImage(o,e,p,h))}})}drawEssayIframeContent(e,o,s){return(0,I.mG)(this,void 0,void 0,function*(){let _=document.querySelectorAll(".essayPdfImage");if(_.length>0&&e){s||(this.exportPdfUtilsService.eraseCanvas(e),this.resetPosition(o),this.pdfDoc.addPage());let g=document.querySelector("#essayPdfTitle span");e&&g&&g.textContent&&(e.font="18px Georgia",e.fillStyle="#333",e.fillText(g.textContent,(e.canvas.width-g.getBoundingClientRect().width)/2,this.currentPos.top+20),this.currentPos.top+=g.getBoundingClientRect().height+20),yield this.convertEssayBoxes2Canvas(_,e,o,s)}})}addEssayImage(e,o,s,_){if(e){if("w"==this.exportPdfConvertDataService.findScaleDirection(s.width,s.height))e.drawImage(s,0,0,s.width,s.height,50,this.currentPos.top+50,e.canvas.width-100,(e.canvas.width-100)*s.height/s.width);else{let g=e.canvas.height-this.currentPos.top-this.currentPos.bottom,h=g*s.width/s.height;e.drawImage(s,0,0,s.width,s.height,(e.canvas.width-h)/2,this.currentPos.top,h,g)}console.log(`[_Essay_image_] V\u1ebd \u1ea3nh t\u1ef1 lu\u1eadn s\u1ed1 ${_+1}`),this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,e.canvas.toDataURL("image/jpeg",1)),this.countDraw++,_!=o.length-1&&this.pdfDoc.addPage()}}drawSingleBlockItemToCanvas(e,o,s,_,g,h,p,i,a,n){h&&this.currentPos.top!=C.top&&(this.currentPos.top-=60),e.drawImage(o,g.left,g.top,g.width,g.height,p||this.currentPos.left,i||this.currentPos.top,a||s,n||_),this.currentPos.top+=_+80,this.countDraw++}examToPdf(e,o){return(0,I.mG)(this,void 0,void 0,function*(){this.countDraw=0,this.totalDraw=document.querySelectorAll(`.${this.exportPdfUtilsService.blockCropItemClass}`).length,this.pdfDoc=new y.jsPDF;let s=document.createElement("canvas"),_=document.getElementById("multipleChoiceWrap");if(console.log("nvanh",_),_){let p=_.getBoundingClientRect().width;s.width=2*p,s.height=297*p/210*2}let g=s.getContext("2d");return this.exportPdfUtilsService.eraseCanvas(g),_&&this.resetPosition(_),_&&(yield this.drawBlockItemToPageForExam(g,_)),this.countDraw=this.totalDraw,yield this.exportPdfUtilsService.asyncTimeout(1e3),"class"==e?this.pdfDoc.output("blob"):(this.pdfDoc.save(o||"test_result.pdf"),!0)})}homeworkToPdf(){return(0,I.mG)(this,void 0,void 0,function*(){this.pdfDoc=new y.jsPDF;let e=document.createElement("canvas"),o=document.getElementById("multipleChoiceWrap");if(o){let g=o.getBoundingClientRect().width;e.width=g,e.height=297*g/210}let s=e.getContext("2d");return this.exportPdfUtilsService.eraseCanvas(s),o&&this.resetPosition(o),this.drawExamTitle(s),this.drawColLeftRightInHeaderOfExam(s),yield this.drawHomeworkNoteBoxOfTeacher(s),o&&(yield this.drawEssayIframeContent(s,o,!0)),this.pdfDoc.output("blob")})}}return P.\u0275fac=function(e){return new(e||P)(O.LFG(L.S),O.LFG(D.V),O.LFG(F.T),O.LFG(l.O))},P.\u0275prov=O.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),P})()},50136:(Q,M,v)=>{v.d(M,{J:()=>L});var I=v(80529),t=v(69751),W=v(51442),y=v(94650),A=v(51009),z=v(45511),O=v(58326);let L=(()=>{class D{constructor(l,r,d){this.commonService=l,this.apiUploadService=r,this.myPdfService=d}replaceImageInContent(l){return new t.y(r=>{if(l.includes("<img ")){var d=this.findAllSubString(l,"<img"),u=[],m=[];d.forEach(C=>{var T=l.indexOf("src=",C),P=l.indexOf('"',Number(T)+5),x=l.substring(Number(T)+5,Number(P)+1);x.includes(";base64")?u.push({oldUrl:x}):x.includes("blob:")&&m.push({oldUrl:x})}),u.length>0?this.reUploadBase64File(u,(C,T)=>{null!=T?this.reUploadBlobFile(m,(P,x)=>{null!=x?(l=this.replaceHomeworkContent(l,C),l=this.replaceHomeworkContent(l,P),r.next({errorMessage:void 0,content:l}),r.complete()):(r.next({errorMessage:x,content:l}),r.complete())}):(r.next({errorMessage:T,content:l}),r.complete())}):m.length>0?this.reUploadBlobFile(m,(C,T)=>{null!=T?(l=this.replaceHomeworkContent(l,C),r.next({errorMessage:void 0,content:l}),r.complete()):(r.next({errorMessage:T,content:l}),r.complete())}):(l=this.replaceHomeworkContent(l,[]),r.next({errorMessage:void 0,content:l}),r.complete())}else r.next({errorMessage:void 0,content:l}),r.complete()})}replaceHomeworkContent(l,r){return r.length>0&&r.forEach(d=>{var u,m=l.replace(null!==(u=d.oldUrl)&&void 0!==u?u:"  ",d.newUrl+'" class="w-100 img-fluid"');l=m}),l}findAllSubString(l,r){for(var d=0,u=0,m=[];l.indexOf(r,d)>-1;)u=l.indexOf(r,d),m.push(u),d=u+r.length;return m}getTypeFile(l){var r=l.indexOf(";");return l.substring(5,r)}getFileName(l){var r=l.split("").reverse().join(""),d=r.indexOf(";"),u=r.indexOf("/",d);return r.substring(d,u).split("").reverse().join("")}convertBlobToBase64(l){return new Promise(r=>{var d=new Image;d.crossOrigin="Anonymous",d.addEventListener("load",function(){var u=document.createElement("canvas"),m=u.getContext("2d");u.width=d.width,u.height=d.height,m?.drawImage(d,0,0);var C=u.toDataURL("image/png");r(C)},!1),d.src=l})}reUploadBase64File(l,r){var d;if(l&&l.length>0){let T,C=l.length;for(var u=[],m=0;m<l.length;m++){const P=l[m],x=null===(d=P.oldUrl)||void 0===d?void 0:d.substring(0,P.oldUrl.length-1);this.startUploadBlobFile(P,x??"",[],(e,o)=>{null==o?u=u.concat(e):T=o,C-=1,0==C&&r(u,T)})}}else r([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}reUploadBlobFile(l,r){var d;if(l&&l.length>0){let T,C=l.length;for(var u=[],m=0;m<l.length;m++){const P=l[m],x=null===(d=P?.oldUrl)||void 0===d?void 0:d.substring(0,P.oldUrl.length-1);this.convertBlobToBase64(x??"").then(e=>{this.startUploadBlobFile(P,e,[],(o,s)=>{null==s?u=u.concat(o):T=s,C-=1,0==C&&r(u,T)})})}}else r([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}startUploadBlobFile(l,r,d,u){if(r&&""!=r){var m=this.getTypeFile(r),C=this.myPdfService.b64toFile(r,this.getFileName(m),m);(0,W.hv)(C).then(T=>{this.apiUploadService.uploadToCdnForHomework(T).subscribe(P=>{var x,e;if(P.type!=I.dt.UploadProgress)if(1==P.success){var o=Object.assign(Object.assign({},l),{newUrl:null!==(e=null===(x=P.data)||void 0===x?void 0:x.url)&&void 0!==e?e:""});d.push(o),u(d,void 0)}else u(d,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi[SPLIT_LANG] [SPLIT_LANG]"+P.message)})})}else u(d,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}}return D.\u0275fac=function(l){return new(l||D)(y.LFG(A.v),y.LFG(z.$),y.LFG(O.t))},D.\u0275prov=y.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),D})()}}]);