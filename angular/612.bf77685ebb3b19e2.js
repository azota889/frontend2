"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[612],{77462:(z,T,r)=>{r.d(T,{a:()=>o,e:()=>e});var e=function(a){return a.exam="exam",a.ref="ref",a.lecture="lecture",a}(e||{}),o=function(a){return a.video="video",a.powerpoint="ppt",a.docx="docx",a.pdf="pdf",a}(o||{})},42047:(z,T,r)=>{r.d(T,{Z:()=>e});class e{constructor(a,A,_,x,u,v=1,L=!1,D=!1,w,P){this.id=a,this.pr=A,this.type=_,this.shareType=x,this.item=u,this.level=v,this.expandable=L,this.isLoading=D,this.prNode=w,this.isLeaf=P}}},59694:(z,T,r)=>{r.d(T,{O:()=>A});var e=r(65879),o=r(88489),a=r(46558);let A=(()=>{class _{constructor(u,v){this.browserStorageService=u,this.commonService=v,this.data={}}setMode(u){this.browserStorageService.saveSimpleStorage("__editor:mode_open",u)}getMode(){var u=this.browserStorageService.getSimpleStorage("__editor:mode_open")||"editor";return this.browserStorageService.removeSimpleStorage("__editor:mode_open"),u}setFileProcess(u){this.file=u}getFirstFile(){let u=this.file;return this.file=void 0,u}setOutputData(u){this.data=u}getOutputData(){return this.data}redirectToConfig(u){this.data.homework&&u.showHomework(),(this.data.exam||this.data.examOffline)&&u.showExam()}setMatrixData(u,v){v?this.matrix=u:this.browserStorageService.saveSimpleStorage("__editor:matrix-data",JSON.stringify(u))}getMatrixData(){var u=this.browserStorageService.getSimpleStorage("__editor:matrix-data");return this.browserStorageService.removeSimpleStorage("__editor:matrix-data"),u?this.commonService.castJsonToObj(u):this.matrix}static#e=this.\u0275fac=function(v){return new(v||_)(e.LFG(o.n),e.LFG(a.z))};static#t=this.\u0275prov=e.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})()},7827:(z,T,r)=>{r.d(T,{i:()=>o});var e=r(65879);let o=(()=>{class a{constructor(){this.fileDrop=new e.vpe,this.preventBodyDrop=!0,this.active=!1}onDrop(_){_.preventDefault(),this.active=!1;const{dataTransfer:x}=_;if(x?.items){const u=[];for(let v=0;v<x.items.length;v++)"file"===x.items[v].kind&&x.items[v].getAsFile()&&u.push(x.items[v].getAsFile());x.items.clear(),Array.isArray(u)&&this.fileDrop.emit(this.removeNullFile(u))}else{const u=x?.files;x?.clearData(),u&&this.fileDrop.emit(Array.from(u))}}removeNullFile(_){for(var x=[],u=0;u<_.length;u++)_[u]&&x.push(_[u]);return x}onDragOver(_){_.stopPropagation(),_.preventDefault(),this.active=!0}onDragLeave(_){this.active=!1}onBodyDragOver(_){this.preventBodyDrop&&(_.preventDefault(),_.stopPropagation())}onBodyDrop(_){this.preventBodyDrop&&_.preventDefault()}static#e=this.\u0275fac=function(x){return new(x||a)};static#t=this.\u0275dir=e.lG2({type:a,selectors:[["","appDropZone",""]],hostVars:2,hostBindings:function(x,u){1&x&&e.NdJ("drop",function(L){return u.onDrop(L)})("dragover",function(L){return u.onDragOver(L)})("dragleave",function(L){return u.onDragLeave(L)})("dragover",function(L){return u.onBodyDragOver(L)},!1,e.pYS)("drop",function(L){return u.onBodyDrop(L)},!1,e.pYS),2&x&&e.ekj("drop-zone-active",u.active)},inputs:{preventBodyDrop:"preventBodyDrop"},outputs:{fileDrop:"appDropZone"}})}return a})()},46685:(z,T,r)=>{r.d(T,{v:()=>je});var e=r(65879),o=r(56223),a=r(77462),A=r(47496),_=r(91765),x=r(77203),u=r(21266),v=r(50014),L=r(69862),D=r(70731),w=r(61713),P=r(46558),Z=r(82228);let U=(()=>{class l{constructor(t,s){this.commonService=t,this.apiUploadService=s,this.sizeDefaultCanvas=1100,this.actionRunAfterConvert=[],this.imageMaps=[],this.pattern_base64=/data:image[^"'\\]+/i,this.pattern_image=/<img[^>]+data:image[^>]+>/g,this.taskConvertBase64ToCanvas=new D.Q(50,{function:(i,n)=>{this.callbackBase64ToCanvas&&this.callbackBase64ToCanvas(i,n)}}),this.taskUploadImage=new D.Q(10,{function:(i,n)=>{this.callbackUploadImage&&this.callbackUploadImage(i,n)}})}convertQuestions(t,s,i){return new Promise(n=>{this.reset(),t.forEach(c=>{const g=this.commonService.willDeleteParseJson(c.answerConfig||"[]");c.questionContent?.includes("<img ")&&this.replaceImageCdnInContent(c,"questionContent"),c.questionText?.includes("<img ")&&this.replaceImageCdnInContent(c,"questionText"),c.answerMedia?.includes("<img ")&&this.replaceImageCdnInContent(c,"answerMedia"),c.mediaMeta?.includes("<img ")&&this.replaceImageCdnInContent(c,"mediaMeta"),g.forEach(C=>{C.content.includes("<img ")&&this.replaceImageCdnInContent(C,"content")}),this.actionRunAfterConvert.push(()=>{c.answerConfig=JSON.stringify(g)})}),this.imageMaps.forEach(c=>{this.taskConvertBase64ToCanvas.addTask(this,this.startConvertCanvas,[c])}),this.taskConvertBase64ToCanvas.start().then(c=>{if(c.errs.length>0)i(c.errs,void 0);else{let C=0;const p=[],W=()=>{const y=document.createElement("canvas");y.width=this.sizeDefaultCanvas,y.height=this.sizeDefaultCanvas;const F=y.getContext("2d");F&&(F.fillStyle="white",F.fillRect(0,0,this.sizeDefaultCanvas,this.sizeDefaultCanvas)),p.push({cdn:"",cX:0,cY:0,canvas:y,imgs:[]})};W(),c.datas.forEach((y,F)=>{var I=p[p.length-1];I.cX+y.canvas.width+4>this.sizeDefaultCanvas?(I.cX=4,I.cY+=C+4,C=0):I.cX+=4,I.cY+y.canvas.height>this.sizeDefaultCanvas&&(W(),I=p[p.length-1]);var Q=I.canvas.getContext("2d");I.imgs.push({x:I.cX,y:I.cY,width:y.canvas.width,height:y.canvas.height,index:F}),Q?.drawImage(y.canvas,0,0,y.canvas.width,y.canvas.height,I.cX,I.cY,y.canvas.width,y.canvas.height),I.cX+=y.canvas.width,C=C<y.canvas.height?y.canvas.height:C}),p[0].imgs.length>0&&p.forEach(y=>{this.taskUploadImage.addTask(this,this.startUploadFile,[y])}),this.taskUploadImage.start().then(y=>{if(y.errs.length>0)i(c.errs,void 0);else{let F=!0;y.datas.forEach(I=>{I.imgs.forEach(Q=>{const E=c.datas[Q.index];if(E){const B={link:I.cdn,data:{x:Q.x,y:Q.y,width:Q.width,height:Q.height}};E.objs.forEach(M=>{if(M[E.path])if(this.commonService.isJson(M[E.path])){const K=this.commonService.willDeleteParseJson(M[E.path]);Object.prototype.hasOwnProperty.call(K,"renderedStr")?(K.renderedStr=K.renderedStr.replace(E.base,`@[]${JSON.stringify(B)}@[]`),M[E.path]=JSON.stringify(K)):M[E.path]=M[E.path].replace(E.base,`@[]${JSON.stringify(B)}@[]`)}else M[E.path]=M[E.path].replace(E.base,`@[]${JSON.stringify(B)}@[]`);else F=!1})}})}),F?(this.actionRunAfterConvert.forEach(I=>{I()}),t.forEach((I,Q)=>{let E=this.commonService.willDeleteParseJson(I.mediaMeta||"{}"),B=s[Q];const M={id:0,name:I.name,extension:"text",content:I.questionContent,groupContent:E.renderedStr,metaData:{isFixAns:Number(I.isFixAns),forcedFixAns:!1,groupType:I.groupType?Number(I.groupType):void 0}};B&&(M.vMetaEditor=B.meta),I.questionContent=JSON.stringify([M])}),n()):i(c.errs,void 0,!0)}})}})})}reset(){this.imageMaps=[],this.actionRunAfterConvert=[]}replaceImageCdnInContent(t,s){var i=t[s];if(this.commonService.isJson(t[s])){const g=this.commonService.willDeleteParseJson(t[s]);Object.prototype.hasOwnProperty.call(g,"renderedStr")&&(i=g.renderedStr)}let n=i.matchAll(this.pattern_image);for(;;){let g=n.next();if(g.done)break;let C=g.value[0];var c=this.imageMaps.findIndex(p=>p.base===C&&p.path===s);-1===c?this.imageMaps.push({base:C,cdn:"",data:null,objs:[t],path:s,canvas:document.createElement("canvas")}):this.imageMaps[c].objs.push(t)}}startConvertCanvas(t){return new Promise((s,i)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{let g=1;if(n.width>this.sizeDefaultCanvas&&(g=this.sizeDefaultCanvas/n.width),n.height>this.sizeDefaultCanvas){let p=this.sizeDefaultCanvas/n.height;p<g&&(g=p)}t.canvas.width=n.width*g,t.canvas.height=n.height*g,t.canvas.getContext("2d")?.drawImage(n,0,0,n.width,n.height,0,0,t.canvas.width,t.canvas.height),s(t)},n.onerror=()=>{t.canvas.width=1,t.canvas.height=1;const g=t.canvas.getContext("2d");g&&(g.fillStyle="white",g.fillRect(0,0,1,1)),s(t)};let c=this.pattern_base64.exec(t.base);null!=c?n.src=c[0]:i(new Error("l\u1ed7i regex"))})}startUploadFile(t){return new Promise((s,i)=>{const n=this.dataURLtoFile(t.canvas.toDataURL("image/png",1));(0,w.hv)(n).then(c=>{this.apiUploadService.uploadToCdnProgressForExamQuestionContent(c).subscribe(g=>{g.type!=L.dt.UploadProgress&&(1==g.success&&g.data?s({...t,cdn:g.data.url||""}):i(new Error(this.commonService.translateToKeyParam("lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi",g.message??"none"))))})})})}dataURLtoFile(t){let s=this.getFileName(t);for(var i=t.split(","),n=i[0].match(/:(.*?);/),c=atob(i[1]),g=c.length,C=new Uint8Array(g);g--;)C[g]=c.charCodeAt(g);return new File([C],s,{type:n&&n.length>0?n[1]:"png"})}getFileName(t){var s=t.split("").reverse().join(""),i=s.indexOf(";"),n=s.indexOf("/",i);return s.substring(i,n).split("").reverse().join("")}static#e=this.\u0275fac=function(s){return new(s||l)(e.LFG(P.z),e.LFG(Z.W))};static#t=this.\u0275prov=e.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var j=r(59694),S=r(11460),f=r(24276),b=r(32169);let h=(()=>{class l{constructor(t,s){this.questionService=t,this.dataAztMathRawHelper=s,this.commonService=(0,e.f3M)(P.z)}convertSaveQuestion(t){return new Promise((s,i)=>{const n=new D.Q(10);t.forEach(c=>{n.addTask(this.dataAztMathRawHelper,this.dataAztMathRawHelper.encodeQuestion,[c])}),n.start().then(c=>{0===c.errs.length?s(c.datas):i(c.errs[0])})})}saveQuestionObjsFromEditor(t,s,i){return new Promise(n=>{this.convertSaveQuestion(s).then(c=>{let g=[];for(let C=0;C<c.length;C++){let p=c[C];p.expandInfo=this.commonService.serializeJson(t.exam?.examObj.expandInfoObj),g.push(p)}this.questionService.apiQuestionsPost({listQuestions:g}).subscribe(C=>{n(C.list?{indexSaved:C.list.length+i,listQuestionId:C.list}:{indexSaved:i,listQuestionId:[]})})}).catch(()=>{n({indexSaved:i,listQuestionId:[]})})})}static#e=this.\u0275fac=function(s){return new(s||l)(e.LFG(f.aE),e.LFG(b.n))};static#t=this.\u0275prov=e.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var m=r(88489),d=r(96814),N=r(43389),k=r(67679),G=r(71646),R=r(35861),V=r(18727),H=r(78337),$=r(41894),J=r(98445),X=r(84003),ee=r(32296),te=r(37722),oe=r(76024),Y=r(40750);function se(l,O){1&l&&(e.TgZ(0,"div",28)(1,"span"),e._uU(2),e.ALo(3,"mytranslate"),e.qZA()()),2&l&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"lang_auto_vui_long_nhap_ho_va_ten")))}function ie(l,O){1&l&&(e.TgZ(0,"div",28)(1,"span"),e._uU(2),e.ALo(3,"mytranslate"),e.qZA()()),2&l&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"lang_auto_vui_long_nhap_so_dien_thoai")))}function ne(l,O){1&l&&(e.TgZ(0,"div",28)(1,"span"),e._uU(2),e.ALo(3,"mytranslate"),e.qZA()()),2&l&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"lang_student_utils_reques_phone_ten_number")))}function ae(l,O){1&l&&(e.TgZ(0,"div",28)(1,"span"),e._uU(2),e.ALo(3,"mytranslate"),e.qZA()()),2&l&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"lang_document_please_enter_the_author_workplace")))}function re(l,O){if(1&l&&(e.TgZ(0,"div",14)(1,"div",19)(2,"div",16),e._UZ(3,"input",22),e.ALo(4,"mytranslate"),e.YNc(5,se,4,3,"div",23),e.qZA(),e.TgZ(6,"div",24),e._UZ(7,"input",25),e.ALo(8,"mytranslate"),e.YNc(9,ie,4,3,"div",23),e.YNc(10,ne,4,3,"div",23),e.qZA(),e.TgZ(11,"div",26),e._UZ(12,"input",27),e.ALo(13,"mytranslate"),e.YNc(14,ae,4,3,"div",23),e.qZA()()()),2&l){const t=e.oxw();e.xp6(3),e.s9C("placeholder",e.lcZ(4,7,"lang_auto_nhap_ho_va_ten")),e.xp6(2),e.Q6J("ngIf","0"==t.form.controls.creatorId.value&&!t.form.controls.creatorFullName.value),e.xp6(2),e.s9C("placeholder",e.lcZ(8,9,"lang_auto_nhap_so_dien_thoai")),e.xp6(2),e.Q6J("ngIf","0"==t.form.controls.creatorId.value&&!t.form.controls.creatorPhone.value),e.xp6(1),e.Q6J("ngIf","0"==t.form.controls.creatorId.value&&t.form.controls.creatorPhone.value&&10!==t.form.controls.creatorPhone.value.length),e.xp6(2),e.s9C("placeholder",e.lcZ(13,11,"lang_document_workplace")),e.xp6(2),e.Q6J("ngIf","0"==t.form.controls.creatorId.value&&!t.form.controls.creatorWorkingAddress.value)}}function le(l,O){if(1&l){const t=e.EpF();e.TgZ(0,"mat-tree-node",33),e._UZ(1,"button",34),e.TgZ(2,"div",35)(3,"input",36),e.NdJ("change",function(){const n=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.checklistSelection.toggle(n))}),e.qZA(),e.TgZ(4,"label",37)(5,"span"),e._uU(6),e.qZA()()()()}if(2&l){const t=O.$implicit,s=e.oxw(2);e.xp6(3),e.s9C("id","knowledge-"+t.id),e.Q6J("checked",s.checklistSelection.isSelected(t)),e.xp6(1),e.s9C("for","knowledge-"+t.id),e.xp6(2),e.Oqu(t.item)}}function ce(l,O){if(1&l){const t=e.EpF();e.TgZ(0,"mat-tree-node",38)(1,"button",39)(2,"span",40),e._UZ(3,"lucide-icon",41),e.qZA()(),e.TgZ(4,"div",35)(5,"input",42),e.NdJ("change",function(){const n=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.todoItemSelectionToggle(n))}),e.qZA(),e.TgZ(6,"label",37)(7,"span"),e._uU(8),e.qZA()()()()}if(2&l){const t=O.$implicit,s=e.oxw(2);e.xp6(1),e.uIk("aria-label","toggle "+t.filename),e.xp6(2),e.s9C("name",s.treeControl.isExpanded(t)?"chevron-down":"chevron-right"),e.xp6(2),e.s9C("id","knowledge-"+t.id),e.Q6J("checked",s.descendantsAllSelected(t))("indeterminate",s.descendantsPartiallySelected(t)),e.xp6(1),e.s9C("for","knowledge-"+t.id),e.xp6(2),e.Oqu(t.item)}}function ue(l,O){if(1&l&&(e.TgZ(0,"div",14)(1,"div",3)(2,"div",16)(3,"span",17),e._uU(4),e.ALo(5,"mytranslate"),e.qZA()(),e.TgZ(6,"div",29)(7,"mat-tree",30),e.YNc(8,le,7,4,"mat-tree-node",31),e.YNc(9,ce,9,7,"mat-tree-node",32),e.qZA()()()()),2&l){const t=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,4,"lang_document_the_knowledge_units_present_in_the_exam")," "),e.xp6(3),e.Q6J("dataSource",t.dataSource)("treeControl",t.treeControl),e.xp6(2),e.Q6J("matTreeNodeDefWhen",t.hasChild)}}function he(l,O){1&l&&(e.TgZ(0,"span",48),e._uU(1),e.ALo(2,"mytranslate"),e.qZA()),2&l&&(e.xp6(1),e.hij("(",e.lcZ(2,1,"lang_document_current"),")"))}const de=function(l){return{"font-medium":l}};function me(l,O){if(1&l&&(e.TgZ(0,"div",43)(1,"div",44),e._UZ(2,"input",45),e.TgZ(3,"label",46)(4,"span"),e._uU(5),e.ALo(6,"mytranslate"),e.qZA(),e.YNc(7,he,3,3,"span",47),e.qZA()()()),2&l){const t=O.index,s=e.oxw();e.xp6(2),e.s9C("id","week-"+s.listWeek[t]),e.Q6J("formControlName",t),e.xp6(1),e.s9C("for","week-"+s.listWeek[t]),e.Q6J("ngClass",e.VKq(8,de,s.currentSchoolWeeks===s.listWeek[t])),e.xp6(2),e.Oqu(e.lcZ(6,6,"lang_document_week")+" "+s.listWeek[t]),e.xp6(2),e.Q6J("ngIf",s.currentSchoolWeeks===s.listWeek[t])}}function pe(l,O){1&l&&(e.TgZ(0,"div",49)(1,"span"),e._uU(2),e.ALo(3,"mytranslate"),e.qZA()()),2&l&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"lang_document_please_select_the_time_of_use")))}class ge{}class fe{}let _e=(()=>{class l extends A.Q{constructor(t){super(),this.timeService=t,this.listKnowledge=[],this.listWeek=[],this.emitChooseKnowledge=new e.vpe,this.formArrayListKnowledge=new o.Oe([]),this.formArrayListWeed=new o.Oe([]),this.flatNodeMap=new Map,this.nestedNodeMap=new Map,this.selectedParent=null,this.newItemName="",this.checklistSelection=new H.Ov(!0),this.listKnowledgeId=[],this.currentSchoolWeeks=0,this.checkChooseWeeks=!0,this.getLevel=s=>s.level??0,this.isExpandable=s=>s.expandable??!1,this.getChildren=s=>s.children??[],this.hasChild=(s,i)=>i.expandable??!1,this.hasNoContent=(s,i)=>""===i.item,this.transformer=(s,i)=>{const n=this.nestedNodeMap.get(s),c=n&&n.item===s.item?n:new fe;return c.item=s.item,c.level=i,c.id=s.id,c.expandable=!!s.children,this.flatNodeMap.set(c,s),this.nestedNodeMap.set(s,c),c},this.treeFlattener=new J.JZ(this.transformer,this.getLevel,this.isExpandable,this.getChildren),this.treeControl=new $.C2(this.getLevel,this.isExpandable),this.dataSource=new J.kc(this.treeControl,this.treeFlattener)}ngOnInit(){super.ngOnInit(),this.initWeedCheckbox(this.listWeek),this.currentSchoolWeeks=this.timeService.getSchoolWeeks(),this.checklistSelection.changed.subscribe(t=>{let s=this.checklistSelection.selected.map(i=>i.id??0);this.listKnowledgeId=s.sort((i,n)=>i-n)??[],this.emitChooseKnowledge.emit(this.listKnowledgeId)}),this.form.controls.weeks.valueChanges.subscribe(t=>{this.checkChooseWeeks=!0,t.forEach(s=>{s&&(this.checkChooseWeeks=!1)})})}ngOnChanges(){this.initForm(),this.initKnowledgeCheckbox(this.listKnowledge),this.dataSource.data=this.buildFileTree(this.listKnowledge,0)}buildFileTree(t,s){const i=[];return t.forEach(n=>{const c=new ge;c.item=n.name,c.id=n.id,n.children&&(c.children=this.buildFileTree(n.children,s+1)),i.push(c)}),i}descendantsAllSelected(t){return this.treeControl.getDescendants(t).every(i=>this.checklistSelection.isSelected(i))}descendantsPartiallySelected(t){return this.treeControl.getDescendants(t).some(n=>this.checklistSelection.isSelected(n))&&!this.descendantsAllSelected(t)}todoItemSelectionToggle(t){this.checklistSelection.toggle(t);const s=this.treeControl.getDescendants(t);this.checklistSelection.isSelected(t)?this.checklistSelection.select(...s):this.checklistSelection.deselect(...s)}initKnowledgeCheckbox(t){this.formArrayListKnowledge.clear();for(let s=0;s<t.length;s++){const n=new o.NI(!1,{nonNullable:!0});this.formArrayListKnowledge.push(n)}}initWeedCheckbox(t){this.formArrayListWeed.clear();for(let s=0;s<t.length;s++){const n=new o.NI(!1,{nonNullable:!0});this.formArrayListWeed.push(n)}}initForm(){this.formArrayListWeed=this.form.controls.weeks,this.formArrayListKnowledge=this.form.controls.knowledgeIds}static#e=this.\u0275fac=function(s){return new(s||l)(e.Y36(X.D))};static#t=this.\u0275cmp=e.Xpm({type:l,selectors:[["azt-config-document-market"]],inputs:{form:"form",listKnowledge:"listKnowledge",listWeek:"listWeek"},outputs:{emitChooseKnowledge:"emitChooseKnowledge"},features:[e.qOj,e.TTD],decls:32,vars:17,consts:[[1,"mt-5"],[3,"formGroup"],[1,"box","p-3"],[1,"grid","grid-cols-12"],[1,"col-span-12","lg:col-span-5"],["for","general-name",1,"form-label","mb-0","font-medium","flex","items-center"],[1,"col-span-12","lg:col-span-7"],[1,"flex","flex-col","sm:flex-row"],[1,"form-check","mr-8"],["type","radio","id","creator-by-me","formControlName","creatorId","value","1",1,"form-check-input"],["for","creator-by-me",1,"form-check-label"],["type","radio","id","creator-by-user-other","formControlName","creatorId","value","0",1,"form-check-input"],["for","creator-by-user-other",1,"form-check-label"],["class","mt-3",4,"ngIf"],[1,"mt-3"],["formArrayName","weeks",1,"list-week","grid","grid-cols-12"],[1,"col-span-12"],[1,"form-label","mb-0","font-medium","flex","items-center"],[1,"list-week","col-span-12"],[1,"grid","grid-cols-12","gap-3"],["class","col-span-6 md:col-span-3 lg:col-span-2",4,"ngFor","ngForOf"],["class","col-span-12 mt-2 text-danger text-xs",4,"ngIf"],["type","text","name","creatorFullName","formControlName","creatorFullName",1,"form-control",3,"placeholder"],["class","text-danger text-xs mt-2",4,"ngIf"],[1,"col-span-12","md:col-span-4"],["type","text","appOnlyNumber","","name","creatorPhone","formControlName","creatorPhone",1,"form-control",3,"placeholder"],[1,"col-span-12","md:col-span-8"],["type","text","name","creatorWorkingAddress","formControlName","creatorWorkingAddress",1,"form-control",3,"placeholder"],[1,"text-danger","text-xs","mt-2"],[1,"list-knowledge","col-span-12"],[3,"dataSource","treeControl"],["matTreeNodeToggle","","matTreeNodePadding","",4,"matTreeNodeDef"],["matTreeNodePadding","",4,"matTreeNodeDef","matTreeNodeDefWhen"],["matTreeNodeToggle","","matTreeNodePadding",""],["mat-icon-button","","disabled",""],[1,"azt-form-checked"],["type","checkbox",1,"form-check-input",3,"checked","id","change"],[1,"form-check-label",2,"vertical-align","middle",3,"for"],["matTreeNodePadding",""],["mat-icon-button","","matTreeNodeToggle",""],[1,"mat-icon-rtl-mirror","w-5","h-5","inline-block",2,"vertical-align","bottom"],[3,"name"],["type","checkbox",1,"form-check-input",3,"checked","indeterminate","id","change"],[1,"col-span-6","md:col-span-3","lg:col-span-2"],[1,"azt-form-check"],["type","checkbox","value","41556",1,"form-check-input",3,"formControlName","id"],[1,"form-check-label",2,"vertical-align","middle",3,"ngClass","for"],["class","inline-block ml-1",4,"ngIf"],[1,"inline-block","ml-1"],[1,"col-span-12","mt-2","text-danger","text-xs"]],template:function(s,i){1&s&&(e.TgZ(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"label",5),e._uU(6),e.ALo(7,"mytranslate"),e.qZA()(),e.TgZ(8,"div",6)(9,"div",7)(10,"div",8),e._UZ(11,"input",9),e.TgZ(12,"label",10),e._uU(13),e.ALo(14,"mytranslate"),e.qZA()(),e.TgZ(15,"div",8),e._UZ(16,"input",11),e.TgZ(17,"label",12),e._uU(18),e.ALo(19,"mytranslate"),e.qZA()()()()(),e.YNc(20,re,15,13,"div",13),e.YNc(21,ue,10,6,"div",13),e.TgZ(22,"div",14)(23,"div",15)(24,"div",16)(25,"span",17),e._uU(26),e.ALo(27,"mytranslate"),e.qZA()(),e.TgZ(28,"div",18)(29,"div",19),e.YNc(30,me,8,10,"div",20),e.qZA()(),e.YNc(31,pe,4,3,"div",21),e.qZA()()()()()),2&s&&(e.xp6(1),e.Q6J("formGroup",i.form),e.xp6(5),e.hij(" ",e.lcZ(7,9,"lang_document_author")," "),e.xp6(7),e.hij(" ",e.lcZ(14,11,"lang_document_me")," "),e.xp6(5),e.hij(" ",e.lcZ(19,13,"lang_document_others")," "),e.xp6(2),e.Q6J("ngIf","0"==i.form.controls.creatorId.value),e.xp6(1),e.Q6J("ngIf",i.formArrayListKnowledge.controls.length),e.xp6(5),e.hij(" ",e.lcZ(27,15,"lang_document_time_of_use")," "),e.xp6(4),e.Q6J("ngForOf",i.formArrayListWeed.controls),e.xp6(1),e.Q6J("ngIf",i.checkChooseWeeks))},dependencies:[d.mk,d.sg,d.O5,ee.RK,J.fQ,J.ah,J.eu,J.gi,J.uo,o._Y,o.Fj,o.Wl,o._,o.JJ,o.JL,o.sg,o.u,o.CE,te.Nh5,oe.Y,k.M,Y.JV],encapsulation:2})}return l})();function ve(l,O){1&l&&e._UZ(0,"azt-loading-effect")}function be(l,O){1&l&&(e.TgZ(0,"div",28),e._uU(1),e.ALo(2,"mytranslate"),e.qZA()),2&l&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"lang_auto_vui_long_nhap_ten_de_thi")," "))}function Se(l,O){1&l&&(e.TgZ(0,"span",29),e._UZ(1,"azt-loading-ui"),e.qZA())}function xe(l,O){if(1&l){const t=e.EpF();e.TgZ(0,"div",3)(1,"form",4)(2,"div",5)(3,"div",6)(4,"div",7)(5,"div",8)(6,"div",9)(7,"label",10),e._uU(8),e.ALo(9,"mytranslate"),e.qZA()(),e.TgZ(10,"div",9)(11,"div",11),e._UZ(12,"input",12),e.ALo(13,"mytranslate"),e.qZA(),e.YNc(14,be,3,3,"div",13),e.qZA()(),e.TgZ(15,"div",14)(16,"config-level-subject",15),e.NdJ("idSubjectInLevel",function(i){e.CHM(t);const n=e.oxw();return e.KtG(n.checkSubjectIdInList(i))}),e.qZA()(),e.TgZ(17,"div",16),e._UZ(18,"config-purpose-exam",17),e.qZA(),e.TgZ(19,"div",18)(20,"div",9)(21,"label",19),e._uU(22),e.ALo(23,"mytranslate"),e.qZA()(),e.TgZ(24,"div",9)(25,"div",11),e._UZ(26,"textarea",20),e.ALo(27,"mytranslate"),e.qZA()()()(),e.TgZ(28,"div",21)(29,"azt-config-document-market",22),e.NdJ("emitChooseKnowledge",function(i){e.CHM(t);const n=e.oxw();return e.KtG(n.chooseKnowledge(i))}),e.qZA()(),e.TgZ(30,"div",23)(31,"div",24)(32,"button",25),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancelSaveDocumentObj())}),e._uU(33),e.ALo(34,"mytranslate"),e.qZA(),e.TgZ(35,"button",26),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.handleSaveDocument())}),e.YNc(36,Se,2,0,"span",27),e._uU(37),e.ALo(38,"mytranslate"),e.qZA()()()()()()()}if(2&l){const t=e.oxw();e.xp6(1),e.Q6J("formGroup",t.form),e.xp6(7),e.hij(" ",e.lcZ(9,20,"lang_auto_ten")," "),e.xp6(4),e.s9C("placeholder",e.lcZ(13,22,"lang_auto_nhap_ten")+" ..."),e.xp6(2),e.Q6J("ngIf",t.form.controls.name.errors),e.xp6(2),e.Q6J("form",t.form)("schoolLevelObjs",t.schoolLevelObjs)("schoolSubjectObjs",t.schoolSubjectObjs)("examSchoolLogObj",t.examSchoolLogObj)("isSetValueByLog",!1),e.xp6(2),e.Q6J("purposeList",t.listPurposeObjs)("form",t.form),e.xp6(4),e.hij(" ",e.lcZ(23,24,"lang_auto_mo_ta")," "),e.xp6(4),e.s9C("placeholder",e.lcZ(27,26,"lang_core_nhap_mo_ta")+" ..."),e.xp6(3),e.Q6J("form",t.form)("listWeek",t.listWeek)("listKnowledge",t.listKnowledge),e.xp6(4),e.hij(" ",e.lcZ(34,28,"lang_auto_huy")," "),e.xp6(2),e.Q6J("disabled",t.logConfig.status),e.xp6(1),e.Q6J("ngIf",t.logConfig.status),e.xp6(1),e.hij(" ",e.lcZ(38,30,"lang_auto_luu")," ")}}function Ce(l,O){if(1&l&&(e.TgZ(0,"div",30)(1,"div",31)(2,"div",32)(3,"span"),e._UZ(4,"span",33),e._uU(5," \xa0 "),e.qZA(),e.TgZ(6,"div",34),e._uU(7),e.qZA()()()()),2&l){const t=e.oxw();e.xp6(7),e.Oqu(t.logConfig.msg)}}let je=(()=>{class l extends A.Q{getLogPredictSubject(t){this.predictLogRequestObj=t}checkSubjectIdInList(t){this.isSubjectIdInList=t}chooseKnowledge(t){this.knowledgeList=t}cancelSaveDocumentObj(){this.onBack.emit(!0)}handleSaveDocument(){const t=this.getWeeksChecked(this.listWeek,this.form.controls.weeks.value);if(this.checkErrorValidateSave(t,this.knowledgeList))this.showErrorSnack("lang_cms_utils_folder_name_validate_space");else{if(this.type===a.e.exam&&this.isCreateQuestionToEditor&&this.dataSave.exam&&this.dataSave.exam.questionObj.listQuestions){this.logConfig.status=!0,this.logConfig.msg=this.commonService.myTranslateInstant("lang_auto_dang_luu_du_lieu_de_thi")??"",this.countProcess=0;const s=this.dataSave.exam.questionObj.listQuestions;let i=this.commonService.myTranslateInstant("lang_auto_xay_ra_loi_trong_qua_trinh_xu_ly_hinh_anh_cua_de_thi")??"";this.questionShareSaveService.convertQuestions(s,this.dataSave.exam.rootQuests,(n,c=i,g)=>{this.logConfig.status=!1,this.logConfig.msg="",this.showErrorSnack(c),g&&this.stopStatusObj()}).then(()=>{this.startMainProcessSaveEditor()})}this.type===a.e.exam&&!this.isCreateQuestionToEditor&&this.examObj?.id&&this.saveDocumentMarketQuestionObjs(),this.type!==a.e.exam&&this.link&&this.saveDocumentMarketQuestionObjs()}}initQuestionShare(){this.questionShareSaveService.callbackBase64ToCanvas=(t,s)=>{let i=this.commonService.myTranslateInstant("lang_auto_dang_xu_ly_hinh_anh_cho_de_thi");this.logConfig.msg=`${i} ${Math.floor(t/s*100*.7)}%`},this.questionShareSaveService.callbackUploadImage=(t,s)=>{let i=this.commonService.myTranslateInstant("lang_auto_dang_xu_ly_hinh_anh_cho_de_thi");this.logConfig.msg=`${i} ${Math.floor(t/s*100*.3)+70}%`}}processSaveQuestionsFromEditor(t,s,i){if(this.dataSave.exam?.questionObj&&this.dataSave.exam?.questionObj.listQuestions){var n=this.dataSave.exam?.questionObj.listQuestions.length;let c=t+100>n?n:t+100,g=this.dataSave.exam?.questionObj.listQuestions.slice(t,c)??[],C=[];for(const p of g)C.push({categoryId:p.categoryId,groupId:p.groupId,name:p.name??"none",metadata:p.metadata,isImage:p.isImage,questionContent:p.questionContent,answerMedia:p.answerMedia,questionText:p.questionText,answerType:p.answerType,answerConfig:p.answerConfig,coordinates:p.coordinates,answerResult:p.answerResult,totalQuestion:p.totalQuestion,tags:p.tags??[],mediaId:p.mediaId,mediaMeta:p.mediaMeta,attachments:p.attachments,version:p.version,isFixAns:p.isFixAns,groupType:p.groupType,__path:p.__path});C.length>0?this.sAztSaveProcessService.saveQuestionObjsFromEditor(this.dataSave,C,s).then(p=>{p&&p.listQuestionId.length>0?(i.listQuestionId=i.listQuestionId.concat(p.listQuestionId),this.processSaveQuestionsFromEditor(c,p.indexSaved,i)):(this.countProcess=0,this.logConfig.status=!1,this.logConfig.msg="",this.showErrorSnack("lang_auto_khong_luu_duoc_noi_dung_cau_hoi_trong_de_vui_long_kiem_tra_lai"))}):this.saveDocumentMarketQuestionObjs(i)}}startMainProcessSaveEditor(){this.dataSave.exam&&this.dataSave.exam.questionObj&&this.processSaveQuestionsFromEditor(0,0,{indexSaved:0,listQuestionId:[]})}GetSubjectAndLevel(){this.initStatusObj(),this.subscriptions.add(this.documentConfigService.apiDocumentConfigGetSubjectAndLevelObjsGet().subscribe(t=>{1==t.success?(this.examSchoolLogObj=t.data?.examSchoolLogObj,this.schoolLevelObjs=t.data?.schoolLevelObjs??[],this.schoolSubjectObjs=t.data?.schoolSubjectObjs??[],this.getListPurposeExam()):this.errorStatusObj(t.message??"")}))}getListPurposeExam(){this.initStatusObj(),this.subscriptions.add(this.examService.apiExamListExamPurposesGet().subscribe(t=>{1===t.success?(this.listPurposeObjs=t.data?.objs??[],this.successStatusObj()):this.errorStatusObj(t.message??"",!0)}))}getKnowledgeData(){const t=this.form.controls.schoolLevel.value,s=this.form.controls.schoolSubject.value;t&&s&&this.subscriptions.add(this.knowledgeService.apiKnowledgeGet(t,s).subscribe(i=>{i.list&&(this.listKnowledge=i.list)}))}checkErrorValidateSave(t,s){return!(!this.form.invalid&&("0"!=this.form.controls.creatorId.value||this.form.controls.creatorFullName.value&&this.form.controls.creatorFullName.value&&this.form.controls.creatorPhone.value&&this.form.controls.creatorWorkingAddress.value)&&("0"!=this.form.controls.creatorId.value||10===this.form.controls.creatorPhone.value.length)&&t.length)}fillConfig(){const t=Number(this.commonService.getMyParam(this.activeRoute,"levelId")),s=Number(this.commonService.getMyParam(this.activeRoute,"subjectId"));this.examObj?.id?this.subscriptions.add(this.documentConfigService.apiDocumentConfigGetExamConfigDataGet(this.examObj.hashId??"").subscribe(i=>{if(1===i.success){const n=i.data?.examObj;this.form.controls.name.setValue(n?.name??""),this.form.controls.description.setValue(n?.description??""),this.form.controls.schoolLevel.setValue(n?.schoolLevelId??t),this.form.controls.schoolSubject.setValue(n?.schoolSubjectId??s),this.form.controls.purposeExam.setValue(i.data?.purposeId??0),this.form.controls.purposeNote.setValue(i.data?.purposeNote??"")}else this.errorStatusObj(i.message??"",!0)})):this.isCreateQuestionToEditor||(this.form.controls.schoolLevel.setValue(t),this.form.controls.schoolSubject.setValue(s),this.form.controls.name.setValue(this.name))}getWeeksChecked(t,s){let i=[];for(let n=0;n<s.length;n++)s[n]&&t[n]&&i.push(t[n]);return i}createListWeek(){for(let s=0;s<35;s++)this.listWeek.push(s+1)}saveDocumentMarketQuestionObjs(t){const s=this.getWeeksChecked(this.listWeek,this.form.controls.weeks.value);this.logConfig.status=!0;let i={name:this.form.controls.name.value,type:this.type,schoolLevelId:this.form.controls.schoolLevel.value,schoolSubjectId:this.form.controls.schoolSubject.value,purposeId:this.form.controls.purposeExam.value,purposeNote:this.form.controls.purposeNote.value,description:this.form.controls.description.value,creatorId:Number(this.form.controls.creatorId.value),creatorFullName:this.form.controls.creatorFullName.value,creatorPhone:this.form.controls.creatorPhone.value,creatorWorkingAddress:this.form.controls.creatorWorkingAddress.value,knowledgeIds:this.knowledgeList,weeks:s,fileType:this.fileType};switch(this.type){case a.e.exam:if(t&&this.isCreateQuestionToEditor){let n=[];n=t.listQuestionId.map(c=>c??0)??[],i.questionIds=n}this.examObj?.id&&!this.isCreateQuestionToEditor&&(i.examId=this.examObj?.id,i.questionIds=[]);break;case a.e.lecture:case a.e.ref:i.link=this.link}this.subscriptions.add(this.documentService.apiDocumentsPost(i).subscribe(n=>{n.id?(this.successStatusObj("lang_document_successful_sharing",!0),this.myNavigation("/document-market/list-documents/your-documents/1")):this.errorStatusObj(""),this.logConfig.status=!0,this.logConfig.msg=""}))}ngOnInit(){if(super.ngOnInit(),this.GetSubjectAndLevel(),this.createListWeek(),this.getKnowledgeData(),this.form.controls.schoolSubject.valueChanges.subscribe(t=>{this.getKnowledgeData()}),this.form.controls.schoolLevel.valueChanges.subscribe(t=>{this.getKnowledgeData()}),this.type===a.e.exam&&this.isCreateQuestionToEditor){this.dataSave=this.editorOutputDataService.getOutputData();const t=25;this.questionContent=[],this.dataSave.exam?.questionObj.listQuestions?.forEach((i,n)=>{n<t&&this.questionContent.push(this.partQuestionSearchTextService.partQuestionSearchTextByQuestionForm(i))}),this.form.controls.name.setValue(this.dataSave.exam?.examObj.name??this.dataSave.homework?.name??""),this.GetSubjectAndLevel()}this.fillConfig()}constructor(t,s,i,n,c,g,C,p,W,y){super(),this.documentConfigService=t,this.activeRoute=s,this.examService=i,this.documentService=n,this.knowledgeService=c,this.questionShareSaveService=g,this.editorOutputDataService=C,this.partQuestionSearchTextService=p,this.sAztSaveProcessService=W,this.browserStorageService=y,this.type=a.e.exam,this.isCreateQuestionToEditor=!1,this.name="",this.onBack=new e.vpe,this.schoolLevelObjs=[],this.schoolSubjectObjs=[],this.listPurposeObjs=[],this.listKnowledge=[],this.isSubjectIdInList=!1,this.logConfig={},this.dataSave={},this.saveParts=[],this.questionContent=[],this.countProcess=0,this.knowledgeList=[],this.listWeek=[],this.form=new o.cw({name:new o.NI("",{nonNullable:!0,validators:[o.kI.required,_._.noWhiteSpace]}),description:new o.NI("",{nonNullable:!0}),schoolLevel:new o.NI(0,{nonNullable:!0,validators:[o.kI.required,o.kI.min(1)]}),schoolSubject:new o.NI(0,{nonNullable:!0,validators:[o.kI.required,o.kI.min(1)]}),purposeExam:new o.NI(0,{nonNullable:!0,validators:[o.kI.required,o.kI.min(1)]}),purposeNote:new o.NI("",{nonNullable:!0}),knowledgeIds:new o.Oe([]),weeks:new o.Oe([]),creatorId:new o.NI("1",{nonNullable:!0}),creatorFullName:new o.NI("",{nonNullable:!0}),creatorPhone:new o.NI("",{nonNullable:!0}),creatorWorkingAddress:new o.NI("",{nonNullable:!0})}),this.type===a.e.exam&&this.isCreateQuestionToEditor&&this.initQuestionShare()}static#e=this.\u0275fac=function(s){return new(s||l)(e.Y36(x.Cq),e.Y36(u.gz),e.Y36(x.Oe),e.Y36(v.Zg),e.Y36(v.zH),e.Y36(U),e.Y36(j.O),e.Y36(S.r),e.Y36(h),e.Y36(m.n))};static#t=this.\u0275cmp=e.Xpm({type:l,selectors:[["azt-config-share-document"]],inputs:{type:"type",isCreateQuestionToEditor:"isCreateQuestionToEditor",fileType:"fileType",link:"link",name:"name",examObj:"examObj"},outputs:{onBack:"onBack"},features:[e.qOj],decls:4,vars:3,consts:[[4,"ngIf","ngIfElse"],["doneLoading",""],["style","width: 100vw; height: 100vh; position: fixed; z-index: 9999; top: 0; left: 0; display: flex; justify-content: center; align-items: center; background-color: rgba(0, 0, 0, 0.4)",4,"ngIf"],[1,"intro-y","mt-8","p-3"],[3,"formGroup"],[1,"mx-auto",2,"max-width","1100px"],[1,"setting-block"],[1,"box","mt-2","p-3"],["id","azt-config-name",1,"grid","grid-cols-12"],[1,"col-span-12","lg:col-span-12"],["for","general-name",1,"form-label","mb-0","font-medium","flex","items-center"],[1,"setting-input"],["id","general-name","formControlName","name","type","text",1,"form-control",3,"placeholder"],["class","mt-2 text-danger text-xs fade",4,"ngIf"],[1,"mt-4"],[3,"form","schoolLevelObjs","schoolSubjectObjs","examSchoolLogObj","isSetValueByLog","idSubjectInLevel"],[1,"mt-2"],[3,"purposeList","form"],["id","azt-config-desc",1,"grid","grid-cols-12","mt-4"],["for","general-desc",1,"form-label","mb-0","font-medium","flex","items-center"],["id","general-desc","formControlName","description",1,"form-control","w-full",2,"height","150px",3,"placeholder"],[1,"config-document-market"],[3,"form","listWeek","listKnowledge","emitChooseKnowledge"],[1,"mt-5"],[1,"text-right"],[1,"btn","btn-secondary","w-24","mr-2",3,"click"],[1,"btn","w-24","btn-primary",3,"disabled","click"],["class","w-4 h-4 mr-2",4,"ngIf"],[1,"mt-2","text-danger","text-xs","fade"],[1,"w-4","h-4","mr-2"],[2,"width","100vw","height","100vh","position","fixed","z-index","9999","top","0","left","0","display","flex","justify-content","center","align-items","center","background-color","rgba(0, 0, 0, 0.4)"],[2,"text-align","center","color","#000000"],[2,"margin-bottom","10px"],["role","status",1,"spinner-border","spinner-border-sm"],[2,"font-size","20px","margin-top","10px","background-color","#f0f8ffa3","padding","10px","border-radius","5px"]],template:function(s,i){if(1&s&&(e.YNc(0,ve,1,0,"azt-loading-effect",0),e.YNc(1,xe,39,32,"ng-template",null,1,e.W1O),e.YNc(3,Ce,8,1,"div",2)),2&s){const n=e.MAs(2);e.Q6J("ngIf",i.statusObj.loading)("ngIfElse",n),e.xp6(3),e.Q6J("ngIf",i.logConfig.status&&i.isCreateQuestionToEditor)}},dependencies:[d.O5,o._Y,o.Fj,o.JJ,o.JL,o.sg,o.u,N.l,k.M,G.n,R.Z,V.u,_e,Y.JV],encapsulation:2})}return l})()},35861:(z,T,r)=>{r.d(T,{Z:()=>S});var e=r(65879),o=r(47496),a=r(64728),A=r(96814),_=r(23680),x=r(64170),u=r(98525),v=r(56223),L=r(67679),D=r(40750);let w=(()=>{class f{transform(h,m){if(!h)return"";const d=h.find(k=>k.id==m);return d?d.key??"":""}static#e=this.\u0275fac=function(m){return new(m||f)};static#t=this.\u0275pipe=e.Yjl({name:"aztFindSchoolSubjectById",type:f,pure:!0})}return f})();function P(f,b){if(1&f&&(e.TgZ(0,"mat-option",15),e._uU(1),e.ALo(2,"mytranslate"),e.qZA()),2&f){const h=b.$implicit;e.Q6J("value",h.id),e.xp6(1),e.hij(" ",e.lcZ(2,2,h.key)," ")}}function Z(f,b){if(1&f&&(e.TgZ(0,"mat-option",15),e._uU(1),e.ALo(2,"mytranslate"),e.qZA()),2&f){const h=b.$implicit;e.Q6J("value",h.id),e.xp6(1),e.hij(" ",e.lcZ(2,2,h.key)," ")}}function U(f,b){1&f&&(e.TgZ(0,"div",16),e._uU(1),e.ALo(2,"mytranslate"),e.qZA()),2&f&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"lang_auto_vui_long_chon_khoi_hoc_va_mon_hoc")," "))}function j(f,b){if(1&f){const h=e.EpF();e.TgZ(0,"div",17)(1,"div",18)(2,"span"),e._uU(3),e.ALo(4,"mytranslate"),e.ALo(5,"mytranslate"),e.ALo(6,"mytranslate"),e.ALo(7,"aztFindSchoolSubjectById"),e.ALo(8,"mytranslate"),e.ALo(9,"mytranslate"),e.ALo(10,"aztFindSchoolSubjectById"),e.qZA(),e.TgZ(11,"a",19),e.NdJ("click",function(){e.CHM(h);const d=e.oxw();return e.KtG(d.changeSubjectIdByPredict())}),e._uU(12),e.ALo(13,"mytranslate"),e.qZA()()()}if(2&f){const h=e.oxw();e.xp6(3),e.hij("",e.lcZ(4,2,"lang_testbank_please_double_check_the_subject_for_accuracy")+". "+e.lcZ(5,4,"lang_testbank_the_system_recognizes_your_subject_as_a_subject")+" "+e.lcZ(6,6,e.xi3(7,8,h.schoolSubjectObjs,h.predictSchoolSubjectId))+", "+e.lcZ(8,11,"lang_testbank_you_are_choosing_subject")+" "+e.lcZ(9,13,e.xi3(10,15,h.schoolSubjectObjs,h.form.controls.schoolSubject.value))+". "," "),e.xp6(9),e.hij(" ",e.lcZ(13,18,"lang_testbank_click_here_to_change_it_to_the_correct_one")+"."," ")}}let S=(()=>{class f extends o.Q{filterSchoolSubject(h){this.filterSubject(h??1)}changeSubjectIdByPredict(){const h=this.schoolSubjectObjs.find(N=>N.id==this.predictSchoolSubjectId),m=this.form?.controls.schoolLevel.value??0;let d=0;h&&h.from&&h.to&&(Number(m)>=h.from||Number(m)<=h.to?(d=this.getSubjectIdFilter(this.subjectSelectedList),this.form?.controls.schoolSubject.setValue(d)):(this.form?.controls.schoolLevel.setValue(h.from),this.filterSchoolSubject(this.form?.controls.schoolLevel.value),d=this.getSubjectIdFilter(this.subjectSelectedList),this.form?.controls.schoolSubject.setValue(d)),this.predictLogRequestObj.acceptPredictStatus=1,this.sendLogPredictSubject.emit(this.predictLogRequestObj))}predictSchoolSubjectByQuestionContent(){this.initStatusObj(),this.subscriptions.add(this.aiService.apiAiPredictSubjectPost({questionContents:this.questionContents}).subscribe(m=>{1===m.success?(this.predictSchoolSubjectId=m.data?.schoolSubjectId??0,this.predictSchoolSubjectId&&(this.checkPredictSchoolSubject=this.checkPredictSubject(),this.predictLogRequestObj={predictSchoolSubjectId:this.predictSchoolSubjectId,acceptPredictStatus:-1!=this.predictSchoolSubjectId&&this.showPredictSchoolSubject&&!this.checkPredictSchoolSubject?0:2,predictByTotalQuestion:this.questionContents.length},this.sendLogPredictSubject.emit(this.predictLogRequestObj)),this.successStatusObj()):this.errorStatusObj(m.message??"",!0)}))}getArrayIdSubject(){const h=this.getKeySubjectById(this.predictSchoolSubjectId,this.schoolSubjectObjs);return this.convertSubjectList(this.schoolSubjectObjs)[h]}getSubjectIdFilter(h){const m=this.getArrayIdSubject();let d=0;for(let N=0;N<h.length;N++){const k=h[N];if(k.id&&m.includes(k.id)){d=k.id;break}}return d}filterSubject(h){let m=this.commonService.myClone(this.schoolSubjectObjs);this.subjectSelectedList=m.filter(k=>!(k.from&&k.to&&h)||h>=k.from&&h<=k.to);let d=this.form?.controls.schoolSubject.value,N=this.subjectSelectedList.filter(k=>k.id==d);(!N||!N.length)&&this.form?.controls.schoolSubject.setValue(0)}checkPredictSubject(){const h=this.getArrayIdSubject(),m=Number(this.form?.controls.schoolSubject.value)??0;return h?.includes(m)}convertSubjectList(h){const m={};return h.forEach(d=>{d.key&&(m[d.key]||(m[d.key]=[]),m[d.key].push(d.id))}),m}getKeySubjectById(h,m){const d=m.find(k=>k.id==h);return d?d.key??"":""}renderData(){0==this.typeView?this.examSchoolLogObj?.id?(this.filterSchoolSubject(this.examSchoolLogObj?.lastSchoolLevelId??0??this.schoolLevelObjs[0].id),this.isSetValueByLog&&(this.form?.controls.schoolLevel.setValue(this.examSchoolLogObj?.lastSchoolLevelId??0),this.form?.controls.schoolSubject.setValue(this.examSchoolLogObj?.lastSchoolSubjectId??0))):this.filterSchoolSubject(0):this.filterSchoolSubject(this.form?.controls.schoolLevel.value)}checkSubjectIdInLevel(){const h=this.form.controls.schoolSubject.value;for(let m=0;m<this.subjectSelectedList.length;m++)if(this.subjectSelectedList[m].id==h)return!0;return!1}ngOnChanges(){(this.schoolLevelObjs||this.subjectSelectedList)&&this.renderData()}ngOnInit(){this.renderData(),this.showPredictSchoolSubject&&this.predictSchoolSubjectByQuestionContent(),this.isSubjectIdInList=this.checkSubjectIdInLevel(),this.idSubjectInLevel.emit(this.isSubjectIdInList),this.form?.controls.schoolSubject?.valueChanges.subscribe(()=>{this.predictSchoolSubjectId&&(this.checkPredictSchoolSubject=this.checkPredictSubject(),this.predictLogRequestObj.acceptPredictStatus=-1!=this.predictSchoolSubjectId&&this.showPredictSchoolSubject&&!this.checkPredictSchoolSubject?0:2,this.sendLogPredictSubject.emit(this.predictLogRequestObj)),this.isSubjectIdInList=this.checkSubjectIdInLevel(),this.idSubjectInLevel.emit(this.isSubjectIdInList)})}constructor(h){super(),this.aiService=h,this.schoolLevelObjs=[],this.schoolSubjectObjs=[],this.formControlName="",this.typeView=0,this.questionContents=[],this.showPredictSchoolSubject=!1,this.isSetValueByLog=!0,this.sendLogPredictSubject=new e.vpe,this.idSubjectInLevel=new e.vpe,this.subjectSelectedList=[],this.targetExamGroupObjs=[],this.checkPredictSchoolSubject=!1,this.predictSchoolSubjectId=-1,this.predictLogRequestObj={predictSchoolSubjectId:0,acceptPredictStatus:0,predictByTotalQuestion:0},this.isSubjectIdInList=!0}static#e=this.\u0275fac=function(m){return new(m||f)(e.Y36(a.p))};static#t=this.\u0275cmp=e.Xpm({type:f,selectors:[["config-level-subject"]],inputs:{form:"form",schoolLevelObjs:"schoolLevelObjs",schoolSubjectObjs:"schoolSubjectObjs",examSchoolLogObj:"examSchoolLogObj",formControlName:"formControlName",typeView:"typeView",questionContents:"questionContents",showPredictSchoolSubject:"showPredictSchoolSubject",isSetValueByLog:"isSetValueByLog"},outputs:{sendLogPredictSubject:"sendLogPredictSubject",idSubjectInLevel:"idSubjectInLevel"},features:[e.qOj,e.TTD],decls:28,vars:19,consts:[[1,"config-level-subject"],[3,"formGroup"],["id","azt-config-level-subject",1,"grid","grid-cols-12","gap-5"],[1,"col-span-12","lg:col-span-6"],[1,"font-medium"],["for","schoolLevel",1,"form-label","flex","items-center"],["appearance","outline"],["formControlName","schoolLevel","name","schoolLevel",3,"selectionChange"],["disabled","",3,"value"],[3,"value",4,"ngFor","ngForOf"],["for","schoolSubject",1,"form-label","flex","items-center"],["id","schoolSubject","formControlName","schoolSubject","name","schoolSubject"],[1,"col-span-12",2,"margin-top","-20px"],["class","text-xs mt-2 text-danger",4,"ngIf"],["class","col-span-12","style","margin-top: -32px;",4,"ngIf"],[3,"value"],[1,"text-xs","mt-2","text-danger"],[1,"col-span-12",2,"margin-top","-32px"],[1,"text-xs","text-pending","font-medium"],[1,"btn-text-primary","font-medium",3,"click"]],template:function(m,d){1&m&&(e.TgZ(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"label",5),e._uU(6),e.ALo(7,"mytranslate"),e.qZA()(),e.TgZ(8,"mat-form-field",6)(9,"mat-select",7),e.NdJ("selectionChange",function(){return d.filterSchoolSubject(d.form.controls.schoolLevel.value)}),e.TgZ(10,"mat-option",8),e._uU(11),e.ALo(12,"mytranslate"),e.qZA(),e.YNc(13,P,3,4,"mat-option",9),e.qZA()()(),e.TgZ(14,"div",3)(15,"div",4)(16,"label",10),e._uU(17),e.ALo(18,"mytranslate"),e.qZA()(),e.TgZ(19,"mat-form-field",6)(20,"mat-select",11)(21,"mat-option",8),e._uU(22),e.ALo(23,"mytranslate"),e.qZA(),e.YNc(24,Z,3,4,"mat-option",9),e.qZA()()(),e.TgZ(25,"div",12),e.YNc(26,U,3,3,"div",13),e.qZA(),e.YNc(27,j,14,20,"div",14),e.qZA()()()),2&m&&(e.xp6(1),e.Q6J("formGroup",d.form),e.xp6(5),e.hij(" ",e.lcZ(7,11,"lang_auto_khoi_hoc")," "),e.xp6(4),e.Q6J("value",0),e.xp6(1),e.hij("",e.lcZ(12,13,"lang_auto_---chon_khoi"),"---"),e.xp6(2),e.Q6J("ngForOf",d.schoolLevelObjs),e.xp6(4),e.hij(" ",e.lcZ(18,15,"lang_auto_mon_hoc")," "),e.xp6(4),e.Q6J("value",0),e.xp6(1),e.hij("",e.lcZ(23,17,"lang_auto_---chon_mon"),"---"),e.xp6(2),e.Q6J("ngForOf",d.subjectSelectedList),e.xp6(2),e.Q6J("ngIf",0==(null==d.form||null==d.form.controls||null==d.form.controls.schoolLevel?null:d.form.controls.schoolLevel.value)||0==(null==d.form||null==d.form.controls||null==d.form.controls.schoolSubject?null:d.form.controls.schoolSubject.value)||!d.isSubjectIdInList),e.xp6(1),e.Q6J("ngIf",-1!=d.predictSchoolSubjectId&&d.showPredictSchoolSubject&&!d.checkPredictSchoolSubject&&0!=(null==d.form||null==d.form.controls||null==d.form.controls.schoolSubject?null:d.form.controls.schoolSubject.value)&&!d.statusObj.loading))},dependencies:[A.sg,A.O5,_.ey,x.KE,u.gD,v._Y,v.JJ,v.JL,v.sg,v.u,L.M,D.JV,w],encapsulation:2})}return f})()},18727:(z,T,r)=>{r.d(T,{u:()=>j});var e=r(47496),o=r(65879),a=r(96814),A=r(23680),_=r(64170),x=r(98525),u=r(56223),v=r(67679),L=r(40750);function D(S,f){if(1&S&&(o.TgZ(0,"mat-option",14),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()),2&S){const b=f.$implicit;o.Q6J("value",b.id),o.xp6(1),o.hij(" ",o.lcZ(2,2,b.code)," ")}}function w(S,f){if(1&S&&(o.TgZ(0,"mat-optgroup",12),o.ALo(1,"mytranslate"),o.YNc(2,D,3,4,"mat-option",13),o.qZA()),2&S){const b=f.$implicit;o.s9C("label",o.lcZ(1,2,b.groupName)),o.xp6(2),o.Q6J("ngForOf",b.purposeListInGroup)}}function P(S,f){1&S&&(o.TgZ(0,"div",15),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()),2&S&&(o.xp6(1),o.hij(" ",o.lcZ(2,1,"lang_testbank_please_choose_purpose_exam")," "))}function Z(S,f){1&S&&(o.TgZ(0,"div",15),o._uU(1),o.ALo(2,"mytranslate"),o.qZA()),2&S&&(o.xp6(1),o.hij(" ",o.lcZ(2,1,"lang_testbank_please_enter_purpose_create_exam")," "))}function U(S,f){if(1&S&&(o.TgZ(0,"div",3)(1,"div",4)(2,"label",16),o._uU(3),o.ALo(4,"mytranslate"),o.qZA()(),o.TgZ(5,"div",17),o._UZ(6,"input",18),o.ALo(7,"mytranslate"),o.qZA(),o.YNc(8,Z,3,3,"div",10),o.qZA()),2&S){const b=o.oxw();o.xp6(3),o.hij(" ",o.lcZ(4,3,"lang_testbank_enter_create_exam_target")," "),o.xp6(3),o.s9C("placeholder",o.lcZ(7,5,"lang_testbank_enter_create_exam_target")+" ..."),o.xp6(2),o.Q6J("ngIf",(4==(null==b.form.controls.purposeExam?null:b.form.controls.purposeExam.value)||8==(null==b.form.controls.purposeExam?null:b.form.controls.purposeExam.value)||12==(null==b.form.controls.purposeExam?null:b.form.controls.purposeExam.value))&&""===(null==b.form.controls.purposeNote||null==b.form.controls.purposeNote.value?null:b.form.controls.purposeNote.value.trim()))}}let j=(()=>{class S extends e.Q{convertPurposeList(){this.targetExamGroupObjs=[],this.purposeList.forEach(b=>{const{semester:h}=b;let m=this.targetExamGroupObjs.find(d=>d.semester===h);m||(m={semester:h,groupName:this.getGroupNamePurpose(b.semester??1),purposeListInGroup:[]},this.targetExamGroupObjs.push(m)),m.purposeListInGroup?.push(b)})}getGroupNamePurpose(b){switch(b){case 1:default:return"lang_testbank_semester_one";case 2:return"lang_testbank_semester_two";case 3:return"lang_testbank_another_purpose"}}ngOnInit(){this.convertPurposeList()}constructor(){super(),this.purposeList=[],this.targetExamGroupObjs=[]}static#e=this.\u0275fac=function(h){return new(h||S)};static#t=this.\u0275cmp=o.Xpm({type:S,selectors:[["config-purpose-exam"]],inputs:{form:"form",purposeList:"purposeList"},features:[o.qOj],decls:16,vars:11,consts:[[1,"config-purpose-exan"],[3,"formGroup"],["id","azt-config-purpose-exam",1,"grid","grid-cols-12","gap-5"],[1,"col-span-12"],[1,"font-medium"],[1,"form-label","flex","items-center"],["appearance","outline"],["formControlName","purposeExam","name","purposeExam"],["disabled","",3,"value"],[3,"label",4,"ngFor","ngForOf"],["class","mt-2 text-danger text-xs",4,"ngIf"],["class","col-span-12",4,"ngIf"],[3,"label"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"mt-2","text-danger","text-xs"],["for","enter_target_create_exam",1,"form-label","flex","items-center"],[1,"setting-input"],["id","enter_target_create_exam","formControlName","purposeNote","type","text",1,"form-control",3,"placeholder"]],template:function(h,m){1&h&&(o.TgZ(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"label",5),o._uU(6),o.ALo(7,"mytranslate"),o.qZA()(),o.TgZ(8,"mat-form-field",6)(9,"mat-select",7)(10,"mat-option",8),o._uU(11),o.ALo(12,"mytranslate"),o.qZA(),o.YNc(13,w,3,4,"mat-optgroup",9),o.qZA()(),o.YNc(14,P,3,3,"div",10),o.qZA(),o.YNc(15,U,9,7,"div",11),o.qZA()()()),2&h&&(o.xp6(1),o.Q6J("formGroup",m.form),o.xp6(5),o.hij(" ",o.lcZ(7,7,"lang_testbank_target_exam")," "),o.xp6(4),o.Q6J("value",0),o.xp6(1),o.hij("---",o.lcZ(12,9,"lang_testbank_choose_purpose"),"---"),o.xp6(2),o.Q6J("ngForOf",m.targetExamGroupObjs),o.xp6(1),o.Q6J("ngIf",0==m.form.controls.purposeExam.value),o.xp6(1),o.Q6J("ngIf",4==(null==m.form.controls.purposeExam?null:m.form.controls.purposeExam.value)||8==(null==m.form.controls.purposeExam?null:m.form.controls.purposeExam.value)||12==(null==m.form.controls.purposeExam?null:m.form.controls.purposeExam.value)))},dependencies:[a.sg,a.O5,A.ey,A.Nv,_.KE,x.gD,u._Y,u.Fj,u.JJ,u.JL,u.sg,u.u,v.M,L.JV],encapsulation:2})}return S})()},89310:(z,T,r)=>{r.d(T,{P:()=>P});var e=r(37398),o=r(47496),a=r(65879),A=r(97151),_=r(46558),x=r(69862),u=r(96814),v=r(40750);function L(Z,U){if(1&Z){const j=a.EpF();a.ynx(0),a.TgZ(1,"a",2),a.NdJ("click",function(){a.CHM(j);const f=a.oxw();return a.KtG(f.shareFileToFlutter())}),a.TgZ(2,"span"),a._uU(3),a.ALo(4,"mytranslate"),a.qZA(),a.Hsn(5),a.qZA(),a.BQk()}if(2&Z){const j=a.oxw();a.xp6(1),a.Akn(j.style),a.Tol(j.classStyle),a.s9C("target",j.target),a.xp6(2),a.Oqu(a.lcZ(4,7,j.fileDescription))}}function D(Z,U){if(1&Z&&(a.TgZ(0,"a",3)(1,"span"),a._uU(2),a.ALo(3,"mytranslate"),a.qZA(),a.Hsn(4,1),a.qZA()),2&Z){const j=a.oxw();a.Akn(j.style),a.Tol(j.classStyle),a.s9C("href",j.dataUrl,a.LSH),a.s9C("target",j.target),a.s9C("download",j.fileName),a.xp6(2),a.Oqu(a.lcZ(3,9,j.fileDescription))}}const w=["*","*"];let P=(()=>{class Z extends o.Q{downloadFile(){return this.http.get(this.dataUrl,{responseType:"blob"}).pipe((0,e.U)(j=>j))}shareFileToFlutter(){this.downloadFile().subscribe(j=>{this.shareFileFlutterService.shareFileWithBlob(j,this.fileName)})}ngOnInit(){super.ngOnInit()}constructor(j,S,f){super(),this.shareFileFlutterService=j,this.commonService=S,this.http=f,this.dataUrl="",this.target="",this.fileName="",this.fileDescription="",this.classStyle="",this.style=""}static#e=this.\u0275fac=function(S){return new(S||Z)(a.Y36(A.g),a.Y36(_.z),a.Y36(x.eN))};static#t=this.\u0275cmp=a.Xpm({type:Z,selectors:[["azt-download-link-item"]],inputs:{dataUrl:"dataUrl",target:"target",fileName:"fileName",fileDescription:"fileDescription",classStyle:"classStyle",style:"style"},features:[a.qOj],ngContentSelectors:w,decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["NormalWeb",""],[3,"target","click"],[3,"href","target","download"]],template:function(S,f){if(1&S&&(a.F$t(w),a.YNc(0,L,6,9,"ng-container",0),a.YNc(1,D,5,11,"ng-template",null,1,a.W1O)),2&S){const b=a.MAs(2);a.Q6J("ngIf",f.isMobileWebView)("ngIfElse",b)}},dependencies:[u.O5,v.JV],encapsulation:2})}return Z})()},72358:(z,T,r)=>{r.d(T,{M:()=>x});var e=r(47496),o=r(65879),a=r(96814);function A(u,v){1&u&&(o.O4$(),o.TgZ(0,"svg",2),o._UZ(1,"polyline",3)(2,"polyline",4),o.qZA())}function _(u,v){1&u&&(o.O4$(),o.TgZ(0,"svg",2),o._UZ(1,"polyline",5)(2,"polyline",6),o.qZA())}let x=(()=>{class u extends e.Q{constructor(){super(...arguments),this.isScrollToTop=!1}scrollTo(){this.isScrollToTop?window.scrollTo(0,0):window.scrollTo(0,document.body.scrollHeight)}ngOnInit(){super.ngOnInit()}static#e=this.\u0275fac=function(){let L;return function(w){return(L||(L=o.n5z(u)))(w||u)}}();static#t=this.\u0275cmp=o.Xpm({type:u,selectors:[["azt-scroll-to-top-bottom"]],inputs:{isScrollToTop:"isScrollToTop"},features:[o.qOj],decls:3,vars:2,consts:[["azt-track-service","azt-scroll-to-top-bottom-DbRV8ySsXT1",1,"toolBarMobile","clickable",3,"click"],["style","color: white","xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",2,"color","white"],["points","17 11 12 6 7 11"],["points","17 18 12 13 7 18"],["points","7 13 12 18 17 13"],["points","7 6 12 11 17 6"]],template:function(D,w){1&D&&(o.TgZ(0,"div",0),o.NdJ("click",function(){return w.scrollTo()}),o.YNc(1,A,3,0,"svg",1),o.YNc(2,_,3,0,"svg",1),o.qZA()),2&D&&(o.xp6(1),o.Q6J("ngIf",w.isScrollToTop),o.xp6(1),o.Q6J("ngIf",!w.isScrollToTop))},dependencies:[a.O5],styles:[".toolBarMobile[_ngcontent-%COMP%]{position:fixed;bottom:0;right:0;z-index:100;margin:0 40px 25px;padding:5px;background:rgba(181,181,181,.5294117647);border-radius:3px}"]})}return u})()}}]);