"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[495],{29225:(F,M,p)=>{p.d(M,{Z:()=>u});var t=p(5e3),e=p(93075),b=p(55330),D=p(60284),A=p(43147),B=p(50690),O=p(74202),k=p(69808),S=p(75477),R=p(74650),c=p(76224),_=p(1033);function f(a,g){if(1&a){const r=t.EpF();t.TgZ(0,"button",25),t.NdJ("click",function(){t.CHM(r);const o=t.oxw(2);return t.KtG(o.goBack())}),t.O4$(),t.TgZ(1,"svg",26),t._UZ(2,"polyline",27),t.qZA()()}}function m(a,g){if(1&a){const r=t.EpF();t.TgZ(0,"button",25),t.NdJ("click",function(){t.CHM(r);const o=t.oxw(2);return t.KtG(o.goBackDialog())}),t.O4$(),t.TgZ(1,"svg",26),t._UZ(2,"polyline",27),t.qZA()()}}function v(a,g){1&a&&t._UZ(0,"div",28)}function T(a,g){if(1&a&&(t.ynx(0),t._UZ(1,"input",29),t.ALo(2,"mytranslate"),t.BQk()),2&a){const r=t.oxw(2);t.xp6(1),t.s9C("placeholder",t.lcZ(2,2,"lang_auto_nhap_ten")+" ..."),t.Q6J("formControl",r.examName)}}function y(a,g){if(1&a){const r=t.EpF();t.TgZ(0,"div",28)(1,"button",30),t.NdJ("click",function(){t.CHM(r);const o=t.oxw(2);return t.KtG(o.clickHandelCancel())}),t._uU(2),t.ALo(3,"mytranslate"),t.qZA(),t.TgZ(4,"button",31),t.NdJ("click",function(){t.CHM(r);const o=t.oxw(2);return t.KtG(o.clickHandelConfirm())}),t._uU(5),t.ALo(6,"mytranslate"),t.qZA()()}if(2&a){const r=t.oxw(2);t.xp6(2),t.hij(" ",t.lcZ(3,2,"lang_auto_huy")," "),t.xp6(3),t.hij(" ",t.lcZ(6,4,r.confirmTitle)," ")}}function x(a,g){if(1&a&&(t.ynx(0),t._UZ(1,"input",32),t.ALo(2,"mytranslate"),t.BQk()),2&a){const r=t.oxw(2);t.xp6(1),t.s9C("placeholder",t.lcZ(2,2,"lang_auto_nhap_ten")+" ..."),t.Q6J("formControl",r.examName)}}function P(a,g){if(1&a){const r=t.EpF();t.TgZ(0,"div",33)(1,"button",34),t.NdJ("click",function(){t.CHM(r);const o=t.oxw(2);return t.KtG(o.clickHandelCancel())}),t._uU(2),t.ALo(3,"mytranslate"),t.qZA(),t.TgZ(4,"button",35),t.NdJ("click",function(){t.CHM(r);const o=t.oxw(2);return t.KtG(o.clickHandelConfirm())}),t._uU(5),t.ALo(6,"mytranslate"),t.qZA()()}2&a&&(t.xp6(2),t.hij(" ",t.lcZ(3,2,"lang_auto_huy")," "),t.xp6(3),t.hij(" ",t.lcZ(6,4,"lang_auto_tiep_tuc")," "))}const n=function(a){return[a]};function l(a,g){if(1&a&&(t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",3)(7,"div",7)(8,"a",8),t.ALo(9,"mylocalize"),t._UZ(10,"img",9),t.ALo(11,"convertCdnLinkOfGitHub"),t.qZA()(),t.YNc(12,f,3,0,"button",10),t.YNc(13,m,3,0,"button",10),t.qZA()(),t.TgZ(14,"div",11)(15,"div",12),t.YNc(16,v,1,0,"div",13),t.TgZ(17,"div",14),t.YNc(18,T,3,4,"ng-container",15),t.qZA(),t.YNc(19,y,7,6,"div",13),t.qZA()(),t.TgZ(20,"div",6)(21,"div",16)(22,"div",17),t._UZ(23,"azt-switch-language"),t.qZA(),t.TgZ(24,"div",17),t._UZ(25,"header-notice-box"),t.qZA(),t.TgZ(26,"div",18),t._UZ(27,"header-account-menu",19),t.qZA()()(),t.TgZ(28,"div",20)(29,"div",21)(30,"div",22),t.YNc(31,x,3,4,"ng-container",15),t.qZA(),t.YNc(32,P,7,6,"div",23),t.qZA()()(),t.TgZ(33,"div",24),t.Hsn(34),t.qZA()()()()()),2&a){const r=t.oxw();t.xp6(8),t.Q6J("routerLink",t.VKq(14,n,t.lcZ(9,10,"/admin/dashboard"))),t.xp6(2),t.Q6J("src",t.lcZ(11,12,"azota_assets/images/logo.svg"),t.LSH),t.xp6(2),t.Q6J("ngIf",""!=r.headerBackTolink),t.xp6(1),t.Q6J("ngIf",r.checkBackDialog),t.xp6(3),t.Q6J("ngIf",r.showConfirmButton),t.xp6(2),t.Q6J("ngIf",r.showInput),t.xp6(1),t.Q6J("ngIf",r.showConfirmButton),t.xp6(8),t.Q6J("isTeacherDashboard",!0),t.xp6(4),t.Q6J("ngIf",r.showInput),t.xp6(1),t.Q6J("ngIf",r.showConfirmButton)}}const d=["*"];let u=(()=>{class a extends b.Q{constructor(r,C,o){super(o),this.processNoticeService=r,this.baseApiService=C,this.commonService=o,this.headerBackTolink="",this.headerTitle="",this.confirmTitle="lang_auto_tiep_tuc",this.checkBackDialog=!1,this.showConfirmButton=!1,this.showInput=!1,this.examName=new e.p4,this.handleConfirm=new t.vpe,this.handleCancel=new t.vpe,this.handleBackDialog=new t.vpe,this.isLogin=!1,this.isMobileWebView=!1}goBack(){this.commonService.myNavigationBySpecialQueryString(this.headerBackTolink)}clickHandelCancel(){this.handleCancel.emit()}clickHandelConfirm(){this.handleConfirm.emit()}goBackDialog(){this.handleBackDialog.emit()}openMenuMobile(){let r=document.getElementById("toggle-menu");null==r||r.classList.add("mobile-menu--active")}closeMenuMobile(){let r=document.getElementById("toggle-menu");null==r||r.classList.remove("mobile-menu--active")}ngOnInit(){super.ngOnInit(),window.scrollTo(0,0),this.isLogin=this.baseApiService.isLogin(),this.isMobileWebView=this.commonService.isMobileWebview()}}return a.\u0275fac=function(r){return new(r||a)(t.Y36(D.e),t.Y36(A._),t.Y36(B.v))},a.\u0275cmp=t.Xpm({type:a,selectors:[["editor-layout"]],inputs:{headerBackTolink:"headerBackTolink",headerTitle:"headerTitle",confirmTitle:"confirmTitle",checkBackDialog:"checkBackDialog",showConfirmButton:"showConfirmButton",showInput:"showInput",examName:"examName"},outputs:{handleConfirm:"handleConfirm",handleCancel:"handleCancel",handleBackDialog:"handleBackDialog"},features:[t.qOj],ngContentSelectors:d,decls:1,vars:1,consts:[["id","azt-layout","class","azt-layout",4,"ngIf"],["id","azt-layout",1,"azt-layout"],[1,"azt-body",2,"padding","0"],[1,"flex"],[1,"content","relative",2,"padding","0","border-radius","0"],[1,"top-bar","py-2","bg-white","dark:bg-darkmode-600","px-3","grid","grid-cols-12","gap-3",2,"height","auto","z-index","0","display","grid"],[1,"col-span-6","md:col-span-2"],[1,"mr-3"],[3,"routerLink"],["width","95px",3,"src"],["class","btn btn-transparent",3,"click",4,"ngIf"],[1,"col-span-12","md:col-span-8","azt-hidden","md:block"],[1,"flex","items-center"],["class","mr-2","style","width: 25%;",4,"ngIf"],[1,"mr-auto",2,"width","50%","padding-right","10px"],[4,"ngIf"],[1,"flex","items-center","justify-end","pr-4"],[1,"dropdown","mr-2","sm:mr-4"],[1,"dropdown","w-8","h-8"],[3,"isTeacherDashboard"],[1,"col-span-12","md:col-span-8","block","md:hidden"],[1,"flex","items-center","w-full",2,"flex-wrap","wrap"],[1,"mr-auto",2,"width","55%"],["class","mr-2 ml-auto",4,"ngIf"],[1,"azt-content"],[1,"btn","btn-transparent",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"lucide","w-5","h-5"],["points","15 18 9 12 15 6"],[1,"mr-2",2,"width","25%"],["type","text",1,"form-control",2,"text-align","center","border","0","box-shadow","none",3,"formControl","placeholder"],[1,"btn","btn-secondary","w-20","mr-2",3,"click"],[1,"btn","btn-primary","w-20",3,"click"],["type","text",1,"form-control",3,"formControl","placeholder"],[1,"mr-2","ml-auto"],[1,"btn","btn-secondary","mr-2",3,"click"],[1,"btn","btn-primary",3,"click"]],template:function(r,C){1&r&&(t.F$t(),t.YNc(0,l,35,16,"div",0)),2&r&&t.Q6J("ngIf",C.isLogin)},dependencies:[O.yS,k.O5,e.Fj,e.JJ,e.oH,S.x,R.H,c.y,_.mp,_.bT,_.Jc],encapsulation:2}),a})()},1643:(F,M,p)=>{p.d(M,{p:()=>C});var t=p(55330),e=p(5e3),b=p(63382),D=p(50690),A=p(69808),B=p(1033);function O(o,h){if(1&o&&(e.TgZ(0,"h3",6),e._uU(1),e.qZA()),2&o){const i=e.oxw(3);e.xp6(1),e.Oqu(i.title)}}const k=function(o){return{"rotated-img":o}},S=function(o,h,i,s){return{"width.px":o,"height.px":h,"aspect-ratio":i,transform:s}};function R(o,h){if(1&o&&(e._UZ(0,"img",10),e.ALo(1,"mycdn")),2&o){const i=e.oxw(2).$implicit,s=e.oxw(2);e.s9C("src",e.lcZ(1,4,i.backgroundImage),e.LSH),e.Q6J("ngClass",e.VKq(6,k,s.isRightRotation(i.rotation||0)))("ngStyle",e.l5B(8,S,(i.width||0)<(i.height||0)?"auto":s.isRightRotation(i.rotation||0)?i.height:i.width,(i.width||0)>(i.height||0)?"auto":s.isRightRotation(i.rotation||0)?i.width:i.height,(i.width||0)/(i.height||1),"rotate("+i.rotation+"deg)")),e.uIk("data-ratio",(i.width||0)/(i.height||1))}}function c(o,h){1&o&&(e.TgZ(0,"div",11),e._uU(1),e.ALo(2,"mytranslate"),e.qZA()),2&o&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"lang_auto_dinh_dang_file_khong_ho_tro_xuat_ra_pdf_he_thong_chi_xuat_duoc_file_pdf_doi_voi_file_tai_len_dang_anh_va_pdf")))}function _(o,h){if(1&o&&(e._UZ(0,"img",12),e.ALo(1,"mycdn")),2&o){const i=e.oxw(2).$implicit;e.s9C("src",e.lcZ(1,1,i.draw),e.LSH)}}function f(o,h){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const i=e.oxw(6);e.xp6(1),e.hij(" ",null==i.result.staticTextConfigParse?null:i.result.staticTextConfigParse.textCorrect," ")}}function m(o,h){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const i=e.oxw(6);e.xp6(1),e.hij(" ",null==i.result.staticTextConfigParse?null:i.result.staticTextConfigParse.textWrong," ")}}function v(o,h){if(1&o&&e._UZ(0,"img",15),2&o){const i=e.oxw(6);e.s9C("src","assets/images/classlive/"+(null==i.result.staticTextConfigParse?null:i.result.staticTextConfigParse.urlImgCorrect),e.LSH)}}function T(o,h){if(1&o&&e._UZ(0,"img",15),2&o){const i=e.oxw(6);e.s9C("src","assets/images/classlive/"+(null==i.result.staticTextConfigParse?null:i.result.staticTextConfigParse.urlImgWrong),e.LSH)}}const y=function(o,h,i,s,E){return{"font-family":o,color:h,"font-size":i,position:"absolute","z-index":2,"top.px":s,"left.px":E}};function x(o,h){if(1&o&&(e.ynx(0),e.TgZ(1,"span",13),e.YNc(2,f,2,1,"ng-container",0),e.YNc(3,m,2,1,"ng-container",0),e.YNc(4,v,1,1,"img",14),e.YNc(5,T,1,1,"img",14),e.qZA(),e.BQk()),2&o){const i=h.$implicit,s=e.oxw(5);e.xp6(1),e.Q6J("ngStyle",e.qbA(5,y,null==s.result.staticTextConfigParse?null:s.result.staticTextConfigParse.fontText,null==s.result.staticTextConfigParse?null:s.result.staticTextConfigParse.fontColor,(null==s.result.staticTextConfigParse?null:s.result.staticTextConfigParse.fontSize)+"px",i.y,i.x)),e.xp6(1),e.Q6J("ngIf",(null==s.result.staticTextConfigParse?null:s.result.staticTextConfigParse.useCorrectText)&&"correct"==i.value),e.xp6(1),e.Q6J("ngIf",(null==s.result.staticTextConfigParse?null:s.result.staticTextConfigParse.useCorrectText)&&"wrong"==i.value),e.xp6(1),e.Q6J("ngIf",!(null!=s.result.staticTextConfigParse&&s.result.staticTextConfigParse.useCorrectText)&&"correct"==i.value),e.xp6(1),e.Q6J("ngIf",!(null!=s.result.staticTextConfigParse&&s.result.staticTextConfigParse.useWrongText)&&"wrong"==i.value)}}function P(o,h){if(1&o&&e.YNc(0,x,6,11,"ng-container",1),2&o){const i=e.oxw(2).$implicit;e.Q6J("ngForOf",i.staticText)}}const n=function(o,h,i,s,E,w){return{"font-family":o,color:h,"font-size":i,display:"block","line-height":1.5,position:"absolute",letterSpacing:"3px",fontWeight:"bold","z-index":3,"text-align":s,"top.px":E,"left.px":w}};function l(o,h){if(1&o&&(e.ynx(0),e._UZ(1,"span",16),e.ALo(2,"formatNoteBreak"),e.BQk()),2&o){const i=h.$implicit;e.xp6(1),e.Q6J("ngStyle",e.HTZ(4,n,i.textStyle.font,i.textStyle.color,i.textStyle.size+"px",i.textStyle.align,i.y,i.x))("innerHtml",e.lcZ(2,2,i.value),e.oJD)}}function d(o,h){if(1&o&&e.YNc(0,l,3,11,"ng-container",1),2&o){const i=e.oxw(2).$implicit;e.Q6J("ngForOf",i.objText)}}function u(o,h){if(1&o&&(e.YNc(0,R,2,13,"img",7),e.ALo(1,"isImageExtension"),e.YNc(2,c,3,3,"ng-template",null,8,e.W1O),e.YNc(4,_,2,3,"img",9),e.YNc(5,P,1,1,"ng-template",5),e.YNc(6,d,1,1,"ng-template",5)),2&o){const i=e.MAs(3),s=e.oxw().$implicit;e.Q6J("ngIf",e.lcZ(1,5,(null==s?null:s.backgroundImage)||""))("ngIfElse",i),e.xp6(4),e.Q6J("ngIf",s.draw),e.xp6(1),e.Q6J("ngIf",s.staticText&&s.staticText.length>0),e.xp6(1),e.Q6J("ngIf",s.objText&&s.objText.length>0)}}const a=function(o,h){return{position:"relative","width.px":o,"height.px":h,display:"flex","justify-content":"center","align-items":"center"}};function g(o,h){if(1&o&&(e.ynx(0),e.TgZ(1,"div",2),e.YNc(2,O,2,1,"h3",3),e.TgZ(3,"div",4),e.YNc(4,u,7,7,"ng-template",5),e.qZA()(),e.BQk()),2&o){const i=h.$implicit,s=h.first,E=e.oxw(2);e.xp6(1),e.Tol("mb-2 essayPdfImage "+E.blockItemCropClass+" "+E.blockItemEssayCropClass),e.xp6(1),e.Q6J("ngIf",s),e.xp6(1),e.Q6J("ngStyle",e.WLB(6,a,i.width,i.height)),e.xp6(1),e.Q6J("ngIf",null==i?null:i.backgroundImage)}}function r(o,h){if(1&o&&(e.ynx(0),e.YNc(1,g,5,9,"ng-container",1),e.BQk()),2&o){const i=e.oxw();e.xp6(1),e.Q6J("ngForOf",i.result.pages)}}let C=(()=>{class o extends t.Q{constructor(i,s){super(s),this.iframeService=i,this.commonService=s,this.title="",this.result={}}isRightRotation(i){return 1==Math.abs(i/90%2)}ngOnInit(){var i;this.title=null!==(i=this.commonService.myTranslateInstant("lang_auto_anh_bai_lam_tu_luan"))&&void 0!==i?i:"",this.result.staticTextConfig&&(this.result.staticTextConfigParse=this.commonService.myParseJson(this.result.staticTextConfig)),super.ngOnInit()}ngOnChanges(){this.result.staticTextConfig&&(this.result.staticTextConfigParse=this.commonService.myParseJson(this.result.staticTextConfig))}}return o.\u0275fac=function(i){return new(i||o)(e.Y36(b.X),e.Y36(D.v))},o.\u0275cmp=e.Xpm({type:o,selectors:[["azt-export-essay-template"]],inputs:{title:"title",blockItemEssayCropClass:"blockItemEssayCropClass",blockItemCropClass:"blockItemCropClass",result:"result"},features:[e.qOj,e.TTD],decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"display","flex","justify-content","center","align-items","center","flex-direction","column"],["id","essayPdfTitle","class","text-center",4,"ngIf"],[3,"ngStyle"],[3,"ngIf"],["id","essayPdfTitle",1,"text-center"],["class","user-img img_respon","alt","",3,"ngClass","ngStyle","src",4,"ngIf","ngIfElse"],["noSupportExtension",""],["style","position: absolute; z-index: 1; top: 0; left: 0","class","user-img img_respon","alt","",3,"src",4,"ngIf"],["alt","",1,"user-img","img_respon",3,"ngClass","ngStyle","src"],[1,"p-2","text-center",2,"border","2px solid red"],["alt","",1,"user-img","img_respon",2,"position","absolute","z-index","1","top","0","left","0",3,"src"],[2,"min-height","50px","min-width","50px","font-weight","bold","display","flex","line-height","1.5","font-weight","bold","align-items","center","justify-content","center","text-shadow","rgb(130 126 126) 1px 1px 1px",3,"ngStyle"],["width","30","height","30","class","","alt","",3,"src",4,"ngIf"],["width","30","height","30","alt","",1,"",3,"src"],[3,"ngStyle","innerHtml"]],template:function(i,s){1&i&&e.YNc(0,r,2,1,"ng-container",0),2&i&&e.Q6J("ngIf",s.result)},dependencies:[A.mk,A.sg,A.O5,A.PC,B.bT,B.GT,B.AL,B.kJ],encapsulation:2}),o})()},16031:(F,M,p)=>{p.d(M,{I:()=>y});var t=p(70655),e=p(4159),D=p(53583),A=p(17489),O=p(5e3),k=p(296),S=p(20814),R=p(88161),c=p(72491);const T={top:60,left:60,right:60,bottom:60};let y=(()=>{class x{constructor(n,l,d,u){this.exportPdfConvertDataService=n,this.exportPdfUtilsService=l,this.answerTypeService=d,this.timeService=u,this.totalDraw=1,this.countDraw=0,this.currentPos=T,this.pdfDoc=new D.jsPDF}get loadPercent(){return Math.floor(this.countDraw/this.totalDraw*100)}getSourceCanvas(n){return(0,t.mG)(this,void 0,void 0,function*(){var l=document.getElementById(n);return yield e(l,{scale:2})})}resetPosition(n){n&&(this.currentPos={left:60,top:60,right:60,bottom:60})}drawHomeworkNoteBoxOfTeacher(n){return(0,t.mG)(this,void 0,void 0,function*(){let l=document.querySelector(".box-point.display .text-mark");if(n){n.font="25px font_chu_dep",n.fillStyle="#000",l&&n.fillText("\u0110i\u1ec3m",90,this.currentPos.top+20),n.fillText("L\u1eddi ph\xea c\u1ee7a gi\xe1o vi\xean",420,this.currentPos.top+20),this.currentPos.top+=30;let d=document.querySelector(".box-msg .note p");if(d){n.lineWidth=2,n.fillStyle="#000",n.fillRect(this.currentPos.left,this.currentPos.top,n.canvas.width-this.currentPos.left-this.currentPos.right,1);const u=this.currentPos.top;let a=window.getComputedStyle(d,null).getPropertyValue("font"),g=window.getComputedStyle(d,null).getPropertyValue("color"),r=parseInt(a.split(" ")[0].split("p")[0],10);n.font=a;let o=this.exportPdfUtilsService.essayText2LinesArr(d.innerHTML,n,n.canvas.width-60-30-(l?200:0),16,a);this.currentPos.top+=35;const h=Math.round(1.5*r),i=this.currentPos.left+(l?200:0)+15;let s=0,E=200;for(let U=0;U<o.length;U++)for(let L=0;L<o[U].length;L++){const Z=o[U][L];n.font=a,n.fillStyle=g,n.fillText(Z,i,this.currentPos.top),this.currentPos.top+=h,s+=h}let w=document.querySelectorAll(".box-emoji> img"),I=this.currentPos.left+(l?100:0)+15,N=this.currentPos.top,W=78,H=78,z=15;w.forEach(U=>{var L;let Z=new Image;Z.src=null!==(L=U.getAttribute("src"))&&void 0!==L?L:"",Z.onload=()=>{I=I+W+z,n.drawImage(Z,I,N,W,H)}});let J=30+H;if(s>E-J&&(E=s+J),n.lineWidth=2,n.fillStyle="#000",n.fillRect(this.currentPos.left,u,1,E),l&&n.fillRect(this.currentPos.left+200,u,1,E),n.fillRect(n.canvas.width-this.currentPos.right,u,1,E),n.fillRect(this.currentPos.left,u+E,n.canvas.width-this.currentPos.right-this.currentPos.left,1),l){let U=l.getBoundingClientRect().width,L=l.getBoundingClientRect().height,Z=window.getComputedStyle(l,null).getPropertyValue("font"),K=window.getComputedStyle(l,null).getPropertyValue("color");n.font=Z,n.fillStyle=K,n.fillText(l.textContent?l.textContent:"",this.currentPos.left+100-U/2,u+E/2+L/4)}this.currentPos.top=u+E+20}else{if(n.lineWidth=2,n.rect(this.currentPos.left,this.currentPos.top,n.canvas.width-this.currentPos.left-this.currentPos.right,200),n.stroke(),l&&n.fillRect(this.currentPos.left+200,this.currentPos.top,1,200),l){let u=l.getBoundingClientRect().width,a=l.getBoundingClientRect().height,g=window.getComputedStyle(l,null).getPropertyValue("font"),r=window.getComputedStyle(l,null).getPropertyValue("color");n.font=g,n.fillStyle=r,n.fillText(l.textContent?l.textContent:"",this.currentPos.left+100-u/2,this.currentPos.top+150-a/2)}this.currentPos.top+=220}}})}drawExamTitle(n){if(n){let s=document.querySelector("#mainTitle span"),E=s?window.getComputedStyle(s,null).getPropertyValue("font"):"",w=null==s?void 0:s.getBoundingClientRect().width,I=null==s?void 0:s.getBoundingClientRect().height;var l=null==s?void 0:s.querySelector("img"),d=null==l?void 0:l.getBoundingClientRect().width,u=null==l?void 0:l.getBoundingClientRect().height,a=0;if(s&&s.textContent&&w&&I&&!(l&&d&&u)){var g=(n.canvas.width-w)/2,r=this.currentPos.top+15;n.font=E,n.fillStyle="#000",n.fillText(s.textContent,g,r),a=I+20}else s&&s.textContent&&w&&I&&l&&d&&u&&(g=(n.canvas.width-w)/2,r=this.currentPos.top+20,n.font=E,n.fillStyle="#000",n.fillText(s.textContent,g,r),a=I+40,n.drawImage(l,0,0,d,u,g+(w-d)+5,this.currentPos.top-10,d,u));a>0&&(this.currentPos.top+=a,this.countDraw++)}}drawColLeftRightInHeaderOfExam(n){var l;let d=document.getElementById("colLeftInfo"),u=document.getElementById("colRightInfo"),a=d?d.querySelectorAll("h3"):void 0,g=u?u.querySelectorAll("h3"):void 0,r={top:0,left:0,right:0,bottom:0};if(n){if(n.font="16px Arial",a)for(let C=0;C<a.length;C++){0==C&&(r=A.cloneDeep(this.currentPos));const o=a[C];o.textContent&&(n.fillText(null!==(l=o.textContent)&&void 0!==l?l:"",this.currentPos.left,this.currentPos.top),this.currentPos.top+=o.getBoundingClientRect().height+5)}if(g)for(let C=0;C<g.length;C++){const o=g[C];o.textContent&&(n.fillText(o.textContent,n.canvas.width-this.currentPos.right-o.getBoundingClientRect().width,r.top),r.top+=o.getBoundingClientRect().height+5)}}}drawBlockItemToPageForExam(n,l){return(0,t.mG)(this,void 0,void 0,function*(){if(n){let u=document.querySelectorAll(`.${this.exportPdfUtilsService.blockCropItemClass}`);if(u.length>0){let a=[];for(let g=0;g<u.length;g++)a.push(g);var d=yield this.getSourceCanvas("multipleChoiceWrap");for(const g of a){const r=u[g];let C=r.classList.contains(this.exportPdfUtilsService.blockEssayCropItemClass),o=r.classList.contains("__TXT_ESSAY_PARA");console.log("nvanh 1",o,C);let h=2*r.offsetLeft,i=2*r.offsetTop,s=2*r.getBoundingClientRect().width,E=2*r.getBoundingClientRect().height;const w=n.canvas.width-this.currentPos.left-this.currentPos.right,I=w*E/s;if(I<=n.canvas.height-this.currentPos.bottom-this.currentPos.top&&!C)this.drawSingleBlockItemToCanvas(n,d,w,I,{left:h,top:i,width:s,height:E},o);else if(this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,n.canvas.toDataURL("image/jpeg",1)),this.pdfDoc.addPage(),this.exportPdfUtilsService.eraseCanvas(n),this.resetPosition(l),"h"==this.exportPdfConvertDataService.findScaleDirection(s,E)){const N=n.canvas.height-T.top-T.bottom,W=N*s/E;this.drawSingleBlockItemToCanvas(n,d,w,I,{left:h,top:i,width:s,height:E},o,(n.canvas.width-W)/2,T.top,W,N)}else this.drawSingleBlockItemToCanvas(n,d,w,I,{left:h,top:i,width:s,height:E},o)}this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,n.canvas.toDataURL("image/jpeg",1))}else this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,n.canvas.toDataURL("image/jpeg",1))}})}convertEssayBoxes2Canvas(n,l,d,u){return(0,t.mG)(this,void 0,void 0,function*(){let a=[];for(let g=0;g<n.length;g++)a.push(g);for(const g of a){const r=yield e(n[g]);if(0==g&&l){const h=(l.canvas.width-50-50)*r.height/r.width;u&&h>l.canvas.height-50-this.currentPos.top&&(this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,l.canvas.toDataURL("image/jpeg",1)),this.exportPdfUtilsService.eraseCanvas(l),this.resetPosition(d),this.pdfDoc.addPage()),this.addEssayImage(l,n,r,g)}else this.exportPdfUtilsService.eraseCanvas(l),this.resetPosition(d),this.addEssayImage(l,n,r,g)}})}drawEssayIframeContent(n,l,d){return(0,t.mG)(this,void 0,void 0,function*(){let u=document.querySelectorAll(".essayPdfImage");if(u.length>0&&n){d||(this.exportPdfUtilsService.eraseCanvas(n),this.resetPosition(l),this.pdfDoc.addPage());let a=document.querySelector("#essayPdfTitle span");n&&a&&a.textContent&&(n.font="18px Georgia",n.fillStyle="#333",n.fillText(a.textContent,(n.canvas.width-a.getBoundingClientRect().width)/2,this.currentPos.top+20),this.currentPos.top+=a.getBoundingClientRect().height+20),yield this.convertEssayBoxes2Canvas(u,n,l,d)}})}addEssayImage(n,l,d,u){if(n){if("w"==this.exportPdfConvertDataService.findScaleDirection(d.width,d.height))n.drawImage(d,0,0,d.width,d.height,50,this.currentPos.top+50,n.canvas.width-100,(n.canvas.width-100)*d.height/d.width);else{let a=n.canvas.height-this.currentPos.top-this.currentPos.bottom,g=a*d.width/d.height;n.drawImage(d,0,0,d.width,d.height,(n.canvas.width-g)/2,this.currentPos.top,g,a)}console.log(`[_Essay_image_] V\u1ebd \u1ea3nh t\u1ef1 lu\u1eadn s\u1ed1 ${u+1}`),this.exportPdfUtilsService.addContentToPdf(this.pdfDoc,n.canvas.toDataURL("image/jpeg",1)),this.countDraw++,u!=l.length-1&&this.pdfDoc.addPage()}}drawSingleBlockItemToCanvas(n,l,d,u,a,g,r,C,o,h){g&&this.currentPos.top!=T.top&&(this.currentPos.top-=60),n.drawImage(l,a.left,a.top,a.width,a.height,r||this.currentPos.left,C||this.currentPos.top,o||d,h||u),this.currentPos.top+=u+80,this.countDraw++}examToPdf(n,l){return(0,t.mG)(this,void 0,void 0,function*(){this.countDraw=0,this.totalDraw=document.querySelectorAll(`.${this.exportPdfUtilsService.blockCropItemClass}`).length,this.pdfDoc=new D.jsPDF;let d=document.createElement("canvas"),u=document.getElementById("multipleChoiceWrap");if(console.log("nvanh",u),u){let r=u.getBoundingClientRect().width;d.width=2*r,d.height=297*r/210*2}let a=d.getContext("2d");return this.exportPdfUtilsService.eraseCanvas(a),u&&this.resetPosition(u),u&&(yield this.drawBlockItemToPageForExam(a,u)),this.countDraw=this.totalDraw,yield this.exportPdfUtilsService.asyncTimeout(1e3),"class"==n?this.pdfDoc.output("blob"):(this.pdfDoc.save(l||"test_result.pdf"),!0)})}homeworkToPdf(){return(0,t.mG)(this,void 0,void 0,function*(){this.pdfDoc=new D.jsPDF;let n=document.createElement("canvas"),l=document.getElementById("multipleChoiceWrap");if(l){let a=l.getBoundingClientRect().width;n.width=a,n.height=297*a/210}let d=n.getContext("2d");return this.exportPdfUtilsService.eraseCanvas(d),l&&this.resetPosition(l),this.drawExamTitle(d),this.drawColLeftRightInHeaderOfExam(d),yield this.drawHomeworkNoteBoxOfTeacher(d),l&&(yield this.drawEssayIframeContent(d,l,!0)),this.pdfDoc.output("blob")})}}return x.\u0275fac=function(n){return new(n||x)(O.LFG(k.S),O.LFG(S.V),O.LFG(R.T),O.LFG(c.O))},x.\u0275prov=O.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})()},50136:(F,M,p)=>{p.d(M,{J:()=>k});var t=p(40520),e=p(34202),b=p(51442),D=p(5e3),A=p(50690),B=p(12813),O=p(58326);let k=(()=>{class S{constructor(c,_,f){this.commonService=c,this.apiUploadService=_,this.myPdfService=f}replaceImageInContent(c){return new e.y(_=>{if(c.includes("<img ")){var f=this.findAllSubString(c,"<img"),m=[],v=[];f.forEach(T=>{var y=c.indexOf("src=",T),x=c.indexOf('"',Number(y)+5),P=c.substring(Number(y)+5,Number(x)+1);P.includes(";base64")?m.push({oldUrl:P}):P.includes("blob:")&&v.push({oldUrl:P})}),m.length>0?this.reUploadBase64File(m,(T,y)=>{null!=y?this.reUploadBlobFile(v,(x,P)=>{null!=P?(c=this.replaceHomeworkContent(c,T),c=this.replaceHomeworkContent(c,x),_.next({errorMessage:void 0,content:c}),_.complete()):(_.next({errorMessage:P,content:c}),_.complete())}):(_.next({errorMessage:y,content:c}),_.complete())}):v.length>0?this.reUploadBlobFile(v,(T,y)=>{null!=y?(c=this.replaceHomeworkContent(c,T),_.next({errorMessage:void 0,content:c}),_.complete()):(_.next({errorMessage:y,content:c}),_.complete())}):(c=this.replaceHomeworkContent(c,[]),_.next({errorMessage:void 0,content:c}),_.complete())}else _.next({errorMessage:void 0,content:c}),_.complete()})}replaceHomeworkContent(c,_){return _.length>0&&_.forEach(f=>{var m,v=c.replace(null!==(m=f.oldUrl)&&void 0!==m?m:"  ",f.newUrl+'" class="w-100 img-fluid"');c=v}),c}findAllSubString(c,_){for(var f=0,m=0,v=[];c.indexOf(_,f)>-1;)m=c.indexOf(_,f),v.push(m),f=m+_.length;return v}getTypeFile(c){var _=c.indexOf(";");return c.substring(5,_)}getFileName(c){var _=c.split("").reverse().join(""),f=_.indexOf(";"),m=_.indexOf("/",f);return _.substring(f,m).split("").reverse().join("")}convertBlobToBase64(c){return new Promise(_=>{var f=new Image;f.crossOrigin="Anonymous",f.addEventListener("load",function(){var m=document.createElement("canvas"),v=m.getContext("2d");m.width=f.width,m.height=f.height,null==v||v.drawImage(f,0,0);var T=m.toDataURL("image/png");_(T)},!1),f.src=c})}reUploadBase64File(c,_){var f;if(c&&c.length>0){let y,T=c.length;for(var m=[],v=0;v<c.length;v++){const x=c[v],P=null===(f=x.oldUrl)||void 0===f?void 0:f.substring(0,x.oldUrl.length-1);this.startUploadBlobFile(x,null!=P?P:"",[],(n,l)=>{null==l?m=m.concat(n):y=l,T-=1,0==T&&_(m,y)})}}else _([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}reUploadBlobFile(c,_){var f;if(c&&c.length>0){let y,T=c.length;for(var m=[],v=0;v<c.length;v++){const x=c[v],P=null===(f=null==x?void 0:x.oldUrl)||void 0===f?void 0:f.substring(0,x.oldUrl.length-1);this.convertBlobToBase64(null!=P?P:"").then(n=>{this.startUploadBlobFile(x,n,[],(l,d)=>{null==d?m=m.concat(l):y=d,T-=1,0==T&&_(m,y)})})}}else _([],"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}startUploadBlobFile(c,_,f,m){if(_&&""!=_){var v=this.getTypeFile(_),T=this.myPdfService.b64toFile(_,this.getFileName(v),v);(0,b.hv)(T).then(y=>{this.apiUploadService.uploadToCdnForHomework(y).subscribe(x=>{var P,n;if(x.type!=t.dt.UploadProgress)if(1==x.success){var l=Object.assign(Object.assign({},c),{newUrl:null!==(n=null===(P=x.data)||void 0===P?void 0:P.url)&&void 0!==n?n:""});f.push(l),m(f,void 0)}else m(f,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau_loi[SPLIT_LANG] [SPLIT_LANG]"+x.message)})})}else m(f,"lang_auto_khong_upload_duoc_anh_vui_long_thu_lai_sau")}}return S.\u0275fac=function(c){return new(c||S)(D.LFG(A.v),D.LFG(B.$),D.LFG(O.t))},S.\u0275prov=D.Yz7({token:S,factory:S.\u0275fac,providedIn:"root"}),S})()}}]);