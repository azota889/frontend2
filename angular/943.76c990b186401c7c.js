"use strict";(self.webpackChunkBalacoClient=self.webpackChunkBalacoClient||[]).push([[943],{10731:(w,C,c)=>{c.d(C,{x:()=>u});class u{constructor(){this.answerConfigParse=[],this.questionContentParse=[],this.answerLabelsMockup={}}}},296:(w,C,c)=>{c.d(C,{S:()=>v});var u=c(70655),m=c(10731),p=c(5e3),h=c(35018),E=c(15043),l=c(90893),g=c(20814);let v=(()=>{class f{constructor(e,i,t,r){this.commonService=e,this.cdnService=i,this.customQuestionAnswerConfig=t,this.exportPdfUtilsService=r}processEssayResultToBase64(e){var i,t,r,o,a;return(0,u.mG)(this,void 0,void 0,function*(){for(const s of null!==(i=e.pages)&&void 0!==i?i:[]){if(s.draw){this.cdnService.isViettelCDN(null!==(r=null===(t=e.pages)||void 0===t?void 0:t[0].backgroundImage)&&void 0!==r?r:"")&&(yield this.exportPdfUtilsService.asyncTimeout(500));const d=yield this.exportPdfUtilsService.convertAndRetryToBase64(s.draw);s.draw=d}if(this.cdnService.isViettelCDN(null!==(a=null===(o=e.pages)||void 0===o?void 0:o[0].backgroundImage)&&void 0!==a?a:"")&&(yield this.exportPdfUtilsService.asyncTimeout(500)),s.backgroundImage){const d=yield this.exportPdfUtilsService.convertAndRetryToBase64(s.backgroundImage);s.backgroundImage=d}}if(e.commentEmoji&&e.commentEmoji.length){let s="https://azota889.github.io/storage_public/mnote/",d=e.commentEmoji.length;for(let _=0;_<d;_++){let P=s+e.commentEmoji[_];const T=yield this.exportPdfUtilsService.convertAndRetryToBase64(P);e.commentEmoji[_]=T}}return e})}processGroupImagesToBase64(e,i){var t,r,o;return(0,u.mG)(this,void 0,void 0,function*(){if(e&&(null===(t=null==e?void 0:e[0].name)||void 0===t?void 0:t.startsWith("[PDFv2]")))for(const a of e)if(e[0].questionContentParse&&this.cdnService.isViettelCDN(null!==(r=e[0].questionContentParse[0].groupUrl)&&void 0!==r?r:"")&&(yield this.exportPdfUtilsService.asyncTimeout(500)),a.questionContentParse&&a.questionContentParse[0].groupUrl&&i.includes(null!==(o=a.indexLabel)&&void 0!==o?o:-1)){const s=yield this.exportPdfUtilsService.convertAndRetryToBase64(a.questionContentParse[0].groupUrl);a.questionContentParse[0].groupUrl=s}})}processQuestionImagesToBase64(e){var i,t,r,o;return(0,u.mG)(this,void 0,void 0,function*(){if(1==e[0].isImage)for(const a of e){this.cdnService.isViettelCDN(null!==(t=null===(i=e[0].questionContentParse)||void 0===i?void 0:i[0].url)&&void 0!==t?t:"")&&(yield this.exportPdfUtilsService.asyncTimeout(500));const s=yield this.exportPdfUtilsService.convertAndRetryToBase64(null!==(o=null===(r=a.questionContentParse)||void 0===r?void 0:r[0].url)&&void 0!==o?o:"");a.questionContentParse&&(a.questionContentParse[0].url=s)}})}processQuestionDocxContentToBase64(e){var i,t,r,o;return(0,u.mG)(this,void 0,void 0,function*(){if(0==e[0].isImage)for(const s of e){var a=this.exportPdfUtilsService.findImageSrcInContent(null!==(t=null===(i=s.questionContentParse)||void 0===i?void 0:i[0].content)&&void 0!==t?t:"");if(this.cdnService.isViettelCDN(a)&&(yield this.exportPdfUtilsService.asyncTimeout(500)),a&&!a.includes(";base64")){const d=yield this.exportPdfUtilsService.convertAndRetryToBase64(a);(null===(o=null===(r=s.questionContentParse)||void 0===r?void 0:r[0].content)||void 0===o?void 0:o.includes("img"))&&d&&(s.questionContentParse[0].content=s.questionContentParse[0].content.replace(a,d))}}})}convertAnswersArr(e,i){0!=e.length&&e.forEach(t=>{t.QuestionId&&t.AnswerContent&&t.AnswerContent[0]&&t.AnswerContent[0].Content&&(i[`id_${t.QuestionId}`]=t.AnswerContent[0].Content)})}parseQuestionsFor_PDFv2(e,i){var t,r;let o=this.commonService.castJsonToClassObjs(m.x,JSON.stringify(null===(t=i.data)||void 0===t?void 0:t.questionObjs));e=this.customQuestionAnswerConfig.changeQuestionContent(null!=o?o:[],!0);for(let a=0;a<e.length;a++)e[a].indexLabel=a,e[a].correctAnswer=this.commonService.filterArray(null===(r=i.data)||void 0===r?void 0:r.correctQuestionIds,e[a].id);return e}findScaleDirection(e,i){return e/i>=.7070707070707071?"w":"h"}}return f.\u0275fac=function(e){return new(e||f)(p.LFG(h.v),p.LFG(E.U),p.LFG(l.U),p.LFG(g.V))},f.\u0275prov=p.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},20814:(w,C,c)=>{c.d(C,{V:()=>g});var u=c(70655),m=c(5e3),p=c(35018),h=c(15043),E=c(88161),l=(()=>{return(v=l||(l={}))[v.Cdn=0]="Cdn",v[v.CdnTimestamp=1]="CdnTimestamp",v[v.Rawlink=2]="Rawlink",v[v.RawlinkTimestamp=3]="RawlinkTimestamp",l;var v})();let g=(()=>{class v{constructor(n,e,i){this.commonService=n,this.cdnService=e,this.answerTypeService=i}get blockCropItemClass(){return"__CANVAS_CROP_ITEM"}get blockEssayCropItemClass(){return"_ESSAY"}isSupportedBrowswer(){var r,t,o;let e=(t=navigator.userAgent,o=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],/trident/i.test(o[1])?"IE "+((r=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""):"Chrome"===o[1]&&null!=(r=t.match(/\b(OPR|Edge)\/(\d+)/))?r.slice(1).join(" ").replace("OPR","Opera"):(o=o[2]?[o[1],o[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(r=t.match(/version\/(\d+)/i))&&o.splice(1,1,r[1]),o.join(" "))).toString();return!(!["chrome"].includes(e.split(" ")[0].toLowerCase())||parseInt(e.split(" ")[1],10)<80)}getExtensionFile(n){if(!n)return"";var e=n.split(".");return e.length<=1?"":e[e.length-1].toLocaleLowerCase().split("_")[0]}translateMetaTitle(n){var e,i,t,r;let o="Export PDF: ";this.commonService.translateMetaData({title:o+(null===(i=null===(e=n.data)||void 0===e?void 0:e.examObj)||void 0===i?void 0:i.name),description:o+(null===(r=null===(t=n.data)||void 0===t?void 0:t.examObj)||void 0===r?void 0:r.name),image:"lang_cms_test_image"})}findImageSrcInContent(n){var e="";if(n.includes("img")){var i=n.indexOf("img"),t=n.indexOf("src=",i),r=n.indexOf('"',Number(t)+5);e=n.substring(Number(t)+5,Number(r))}return e}asyncTimeout(n){return(0,u.mG)(this,void 0,void 0,function*(){return`Waited ${yield new Promise(i=>{setTimeout(()=>i(n),n)})} miliseconds`})}parseEssayMarkResult(n,e,i){var t;let r=n.filter(s=>this.answerTypeService.isEssayAnswer(s.answerType));if(0!=r.length){if(e&&e.essayResult){var o=this.commonService.willDeleteParseJson(e.essayResult);if(o){var a=Object.entries(o);for(let s=0;s<r.length;s++)r[s].essayMarkParsed=a[s][1]}}for(let s=0;s<r.length;s++){let d=r[s].id,_=i.filter(T=>T.questionId==d)[0],P=this.commonService.willDeleteParseJson(null!==(t=_.config)&&void 0!==t?t:"");r[s].scorePerQuestion=P?Number(P.ScorePerQuestion):0}}}convertToBase64(n,e){return(0,u.mG)(this,void 0,void 0,function*(){let i=n;switch(e){case l.Cdn:i=this.cdnService.getMyCdn(n);break;case l.CdnTimestamp:i=this.cdnService.getMyCdn(n)+"?t="+Date.now();break;case l.RawlinkTimestamp:i=n+"?t="+Date.now()}const r=yield(yield fetch(i)).blob(),o=yield new Promise(a=>{const s=new FileReader;s.readAsDataURL(r),s.onloadend=()=>{a(s.result)}});return o&&"string"==typeof o?o:n})}convertAndRetryToBase64(n){return(0,u.mG)(this,void 0,void 0,function*(){let e=this.getExtensionFile(n);if(["pdf","jpg","jpeg","png","gif"].includes(e)){let i;const t=[l.Cdn,l.CdnTimestamp,l.Rawlink,l.RawlinkTimestamp];if(this.cdnService.isViettelCDN(n))try{i=yield this.convertToBase64(n,t[0])}catch(r){try{yield this.asyncTimeout(500),i=yield this.convertToBase64(n,t[1])}catch(o){i=n}}else try{i=yield this.convertToBase64(n,t[0])}catch(r){try{i=yield this.convertToBase64(n,t[1])}catch(o){try{i=yield this.convertToBase64(n,t[2])}catch(a){try{i=yield this.convertToBase64(n,t[3])}catch(s){console.log("Kh\xf4ng th\u1ec3 convert url n\xe0y th\xe0nh base64 sau v\xe0i l\u1ea7n retry: "+n),i=n}}}}return i}return n})}eraseCanvas(n){n&&(n.beginPath(),n.rect(0,0,n.canvas.width,n.canvas.height),n.fillStyle="white",n.fill())}addContentToPdf(n,e){n.addImage(e,"JPEG",0,0,n.internal.pageSize.getWidth(),n.internal.pageSize.getHeight())}drawTextWrap(n,e,i,t,r){let o=n.split(" "),a=[],s=o[0];if(e){e.font=r||`${t}px Arial`;for(let d=1;d<o.length;d++){let _=o[d];e.measureText(s+" "+_).width<i?s+=" "+_:(a.push(s),s=_)}a.push(s)}return a}essayText2LinesArr(n,e,i,t,r){var o;let a=new RegExp("(<br>|<br/>)+","igm"),d=(null!==(o=this.commonService.replaceAllByRegExp(n,a,"<br>"))&&void 0!==o?o:"").split("<br>"),_=[];for(let P=0;P<d.length;P++)_.push(this.drawTextWrap(d[P],e,i,t,r));return _}}return v.\u0275fac=function(n){return new(n||v)(m.LFG(p.v),m.LFG(h.U),m.LFG(E.T))},v.\u0275prov=m.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),v})()},63382:(w,C,c)=>{c.d(C,{X:()=>p});var u=c(5e3),m=c(35018);let p=(()=>{class h{constructor(l){this.commonService=l}isInIframe(){try{return window.self!==window.top}catch(l){return!0}}sendMessageToParentIframe(l){try{window.parent.postMessage(l,"*")}catch(g){}}sendMessageToIFrame(l,g){const v=document.getElementById(l),f=v?v.contentWindow:null;null!=f&&f.postMessage(g,"*")}}return h.\u0275fac=function(l){return new(l||h)(u.LFG(m.v))},h.\u0275prov=u.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()}}]);